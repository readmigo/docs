# Readmigo å®¢æœç³»ç»Ÿä¸è®¢å•ç®¡ç†è®¾è®¡

> ç‰ˆæœ¬: 2.0
> æœ€åæ›´æ–°: 2025-12-27
> çŠ¶æ€: âœ… è®¾è®¡å®Œæˆ | è¿›åº¦: 90%

## ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [å®¢æˆ·ç«¯åé¦ˆåŠŸèƒ½](#2-å®¢æˆ·ç«¯åé¦ˆåŠŸèƒ½)
3. [å·¥å•ç³»ç»Ÿè®¾è®¡](#3-å·¥å•ç³»ç»Ÿè®¾è®¡)
4. [è®¢å•ç³»ç»Ÿè®¾è®¡](#4-è®¢å•ç³»ç»Ÿè®¾è®¡)
5. [Dashboard å®¢æœç®¡ç†](#5-dashboard-å®¢æœç®¡ç†)
6. [API æ¥å£è®¾è®¡](#6-api-æ¥å£è®¾è®¡)
7. [æ•°æ®æ¨¡å‹è®¾è®¡](#7-æ•°æ®æ¨¡å‹è®¾è®¡)
8. [é€šçŸ¥ä¸æ²Ÿé€š](#8-é€šçŸ¥ä¸æ²Ÿé€š)
9. [è¿è¥ä¸åˆ†æ](#9-è¿è¥ä¸åˆ†æ)
10. [å®æ–½è®¡åˆ’](#10-å®æ–½è®¡åˆ’)
11. [å®æ–½è¿›åº¦](#11-å®æ–½è¿›åº¦)

**é™„å½•**:
- [é™„å½• Aï¼šå¸¸è§é—®é¢˜è‡ªåŠ¨å›å¤åº“](#é™„å½•-aå¸¸è§é—®é¢˜è‡ªåŠ¨å›å¤åº“)
- [é™„å½• Bï¼šå®¢æˆ·æ»¡æ„åº¦è°ƒæŸ¥ï¼ˆCSATï¼‰è®¾è®¡](#é™„å½•-bå®¢æˆ·æ»¡æ„åº¦è°ƒæŸ¥csatè®¾è®¡)
- [é™„å½• Cï¼šé‚®ä»¶æ¨¡æ¿ç¤ºä¾‹](#é™„å½•-cé‚®ä»¶æ¨¡æ¿ç¤ºä¾‹)
- [é™„å½• Dï¼šæŠ€æœ¯ä¾èµ–](#é™„å½•-dæŠ€æœ¯ä¾èµ–)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ç”¨æˆ·è§¦ç‚¹                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   iOS App å†…åé¦ˆ    â”‚   é‚®ä»¶ support@    â”‚    App Store Review              â”‚
â”‚   (ä¸»è¦å…¥å£)        â”‚   (å¤‡ç”¨æ¸ é“)        â”‚    (éœ€è¦ç›‘æ§)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                    â”‚                            â”‚
          â–¼                    â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           API Gateway                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Feedback API   â”‚  â”‚  Ticket API     â”‚  â”‚  Order API                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                    â”‚                            â”‚
          â–¼                    â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Business Services                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FeedbackService â”‚  â”‚  TicketService  â”‚  â”‚  OrderService               â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚ - åˆ›å»ºåé¦ˆ      â”‚  â”‚ - å·¥å•ç”Ÿå‘½å‘¨æœŸ   â”‚  â”‚ - Apple è®¢å•åŒæ­¥            â”‚  â”‚
â”‚  â”‚ - è‡ªåŠ¨åˆ†ç±»      â”‚  â”‚ - åˆ†é…å®¢æœ      â”‚  â”‚ - è®¢å•æŸ¥è¯¢                  â”‚  â”‚
â”‚  â”‚ - æƒ…æ„Ÿåˆ†æ      â”‚  â”‚ - SLA ç›‘æ§      â”‚  â”‚ - é€€æ¬¾å¤„ç†                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                    â”‚                            â”‚
          â–¼                    â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Database                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Feedback     â”‚  â”‚     Ticket      â”‚  â”‚     Order / Transaction     â”‚  â”‚
â”‚  â”‚    Attachment   â”‚  â”‚  TicketMessage  â”‚  â”‚     RefundRequest           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Dashboard (React-Admin)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  åé¦ˆç®¡ç†       â”‚  â”‚   å·¥å•å¤„ç†       â”‚  â”‚     è®¢å•ç®¡ç†                 â”‚  â”‚
â”‚  â”‚  - åé¦ˆåˆ—è¡¨     â”‚  â”‚   - å·¥å•é˜Ÿåˆ—     â”‚  â”‚     - è®¢å•åˆ—è¡¨               â”‚  â”‚
â”‚  â”‚  - å¿«é€Ÿå›å¤     â”‚  â”‚   - å¤„ç†é¢æ¿     â”‚  â”‚     - é€€æ¬¾å®¡æ‰¹               â”‚  â”‚
â”‚  â”‚  - æ‰¹é‡æ“ä½œ     â”‚  â”‚   - å®¢æœåˆ†é…     â”‚  â”‚     - è®¢å•è¯¦æƒ…               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

| æ¨¡å— | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| **ç”¨æˆ·åé¦ˆ** | å®¢æˆ·ç«¯å†…æäº¤åé¦ˆã€é—®é¢˜æŠ¥å‘Š | P0 |
| **å·¥å•ç³»ç»Ÿ** | åé¦ˆè½¬å·¥å•ã€åˆ†é…ã€è·Ÿè¸ªã€è§£å†³ | P0 |
| **è®¢å•ç®¡ç†** | æŸ¥çœ‹è®¢å•ã€å¤„ç†é€€æ¬¾ã€è®¢å•å†å² | P0 |
| **å®¢æœä»ªè¡¨ç›˜** | ç»Ÿä¸€ç®¡ç†ç•Œé¢ã€æ•°æ®åˆ†æ | P1 |
| **è‡ªåŠ¨åŒ–** | è‡ªåŠ¨åˆ†ç±»ã€æ™ºèƒ½å›å¤å»ºè®® | P2 |

---

## 2. å®¢æˆ·ç«¯åé¦ˆåŠŸèƒ½

### 2.1 åé¦ˆå…¥å£è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       åé¦ˆå…¥å£ä½ç½®                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. è®¾ç½®é¡µ â†’ å¸®åŠ©ä¸åé¦ˆ â†’ æäº¤åé¦ˆ                              â”‚
â”‚     (ä¸»å…¥å£ï¼Œæ°¸ä¹…å¯è§)                                          â”‚
â”‚                                                                 â”‚
â”‚  2. é˜…è¯»å™¨ â†’ æ›´å¤šèœå• â†’ æŠ¥å‘Šé—®é¢˜                                â”‚
â”‚     (ä¸Šä¸‹æ–‡ç›¸å…³ï¼Œè‡ªåŠ¨æºå¸¦ä¹¦ç±ä¿¡æ¯)                               â”‚
â”‚                                                                 â”‚
â”‚  3. é”™è¯¯å¼¹çª— â†’ åé¦ˆæ­¤é—®é¢˜                                       â”‚
â”‚     (å¼‚å¸¸æ—¶è§¦å‘ï¼Œè‡ªåŠ¨æºå¸¦é”™è¯¯æ—¥å¿—)                               â”‚
â”‚                                                                 â”‚
â”‚  4. è®¢é˜…é¡µ â†’ é‡åˆ°é—®é¢˜ï¼Ÿè”ç³»æˆ‘ä»¬                                 â”‚
â”‚     (è®¢é˜…ç›¸å…³é—®é¢˜å¿«é€Ÿå…¥å£)                                       â”‚
â”‚                                                                 â”‚
â”‚  5. Shake to Feedback (å¯é€‰)                                    â”‚
â”‚     (æ‘‡ä¸€æ‘‡è§¦å‘ï¼Œå¼€å‘/æµ‹è¯•æ¨¡å¼)                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 åé¦ˆç±»å‹åˆ†ç±»

```swift
enum FeedbackCategory: String, Codable, CaseIterable {
    // åŠŸèƒ½é—®é¢˜
    case bug = "BUG"                           // åŠŸèƒ½å¼‚å¸¸/å´©æºƒ
    case featureNotWorking = "FEATURE_NOT_WORKING" // åŠŸèƒ½æ— æ³•ä½¿ç”¨

    // å†…å®¹é—®é¢˜
    case bookContent = "BOOK_CONTENT"          // ä¹¦ç±å†…å®¹é—®é¢˜
    case translationError = "TRANSLATION"      // ç¿»è¯‘é”™è¯¯
    case aiResponse = "AI_RESPONSE"            // AI å›ç­”é—®é¢˜

    // è®¢é˜…é—®é¢˜
    case subscriptionIssue = "SUBSCRIPTION"    // è®¢é˜…ç›¸å…³
    case paymentIssue = "PAYMENT"              // æ”¯ä»˜é—®é¢˜
    case refundRequest = "REFUND"              // é€€æ¬¾è¯·æ±‚

    // è´¦æˆ·é—®é¢˜
    case accountIssue = "ACCOUNT"              // è´¦æˆ·é—®é¢˜
    case loginIssue = "LOGIN"                  // ç™»å½•é—®é¢˜
    case dataSync = "DATA_SYNC"                // æ•°æ®åŒæ­¥

    // å»ºè®®åé¦ˆ
    case featureRequest = "FEATURE_REQUEST"    // åŠŸèƒ½å»ºè®®
    case improvement = "IMPROVEMENT"           // æ”¹è¿›å»ºè®®

    // å…¶ä»–
    case other = "OTHER"

    var displayName: String {
        switch self {
        case .bug: return "åŠŸèƒ½å¼‚å¸¸"
        case .featureNotWorking: return "åŠŸèƒ½æ— æ³•ä½¿ç”¨"
        case .bookContent: return "ä¹¦ç±å†…å®¹é—®é¢˜"
        case .translationError: return "ç¿»è¯‘é”™è¯¯"
        case .aiResponse: return "AI å›ç­”é—®é¢˜"
        case .subscriptionIssue: return "è®¢é˜…é—®é¢˜"
        case .paymentIssue: return "æ”¯ä»˜é—®é¢˜"
        case .refundRequest: return "ç”³è¯·é€€æ¬¾"
        case .accountIssue: return "è´¦æˆ·é—®é¢˜"
        case .loginIssue: return "ç™»å½•é—®é¢˜"
        case .dataSync: return "æ•°æ®åŒæ­¥é—®é¢˜"
        case .featureRequest: return "åŠŸèƒ½å»ºè®®"
        case .improvement: return "æ”¹è¿›å»ºè®®"
        case .other: return "å…¶ä»–"
        }
    }

    var icon: String {
        switch self {
        case .bug, .featureNotWorking: return "ladybug"
        case .bookContent, .translationError: return "book"
        case .aiResponse: return "bubble.left.and.bubble.right"
        case .subscriptionIssue, .paymentIssue, .refundRequest: return "creditcard"
        case .accountIssue, .loginIssue: return "person.crop.circle"
        case .dataSync: return "arrow.triangle.2.circlepath"
        case .featureRequest, .improvement: return "lightbulb"
        case .other: return "ellipsis.circle"
        }
    }

    var priority: TicketPriority {
        switch self {
        case .bug, .paymentIssue, .refundRequest: return .high
        case .subscriptionIssue, .loginIssue, .featureNotWorking: return .medium
        default: return .low
        }
    }
}
```

### 2.3 åé¦ˆè¡¨å• UI è®¾è®¡

```swift
// FeedbackView.swift
struct FeedbackView: View {
    @StateObject private var viewModel = FeedbackViewModel()
    @Environment(\.dismiss) private var dismiss

    var body: some View {
        NavigationStack {
            Form {
                // 1. åé¦ˆç±»å‹é€‰æ‹©
                Section {
                    Picker("é—®é¢˜ç±»å‹", selection: $viewModel.category) {
                        ForEach(FeedbackCategory.allCases, id: \.self) { category in
                            Label(category.displayName, systemImage: category.icon)
                                .tag(category)
                        }
                    }
                    .pickerStyle(.navigationLink)
                } header: {
                    Text("é—®é¢˜ç±»å‹")
                }

                // 2. é—®é¢˜æè¿°
                Section {
                    TextEditor(text: $viewModel.description)
                        .frame(minHeight: 120)
                        .overlay(alignment: .topLeading) {
                            if viewModel.description.isEmpty {
                                Text("è¯·è¯¦ç»†æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜...")
                                    .foregroundColor(.secondary)
                                    .padding(.top, 8)
                                    .padding(.leading, 4)
                            }
                        }
                } header: {
                    Text("é—®é¢˜æè¿°")
                } footer: {
                    Text("è¯·å°½é‡è¯¦ç»†æè¿°ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¿«è§£å†³é—®é¢˜")
                }

                // 3. æˆªå›¾/é™„ä»¶
                Section {
                    AttachmentPicker(attachments: $viewModel.attachments)

                    if !viewModel.attachments.isEmpty {
                        ScrollView(.horizontal, showsIndicators: false) {
                            HStack {
                                ForEach(viewModel.attachments) { attachment in
                                    AttachmentThumbnail(attachment: attachment) {
                                        viewModel.removeAttachment(attachment)
                                    }
                                }
                            }
                        }
                    }
                } header: {
                    Text("æˆªå›¾æˆ–é™„ä»¶ï¼ˆå¯é€‰ï¼‰")
                } footer: {
                    Text("æœ€å¤šå¯æ·»åŠ  5 å¼ å›¾ç‰‡")
                }

                // 4. è”ç³»æ–¹å¼
                Section {
                    TextField("é‚®ç®±åœ°å€", text: $viewModel.contactEmail)
                        .keyboardType(.emailAddress)
                        .textContentType(.emailAddress)
                        .autocapitalization(.none)
                } header: {
                    Text("è”ç³»æ–¹å¼")
                } footer: {
                    Text("æˆ‘ä»¬ä¼šé€šè¿‡é‚®ä»¶å›å¤æ‚¨çš„åé¦ˆ")
                }

                // 5. è‡ªåŠ¨æ”¶é›†çš„ä¿¡æ¯ï¼ˆæŠ˜å æ˜¾ç¤ºï¼‰
                Section {
                    DisclosureGroup("æŸ¥çœ‹è¯Šæ–­ä¿¡æ¯") {
                        DiagnosticInfoView(info: viewModel.diagnosticInfo)
                    }
                } footer: {
                    Text("è¿™äº›ä¿¡æ¯å¸®åŠ©æˆ‘ä»¬è¯Šæ–­é—®é¢˜ï¼Œä¸åŒ…å«ä¸ªäººéšç§æ•°æ®")
                }
            }
            .navigationTitle("æäº¤åé¦ˆ")
            .navigationBarTitleDisplayMode(.inline)
            .toolbar {
                ToolbarItem(placement: .cancellationAction) {
                    Button("å–æ¶ˆ") { dismiss() }
                }
                ToolbarItem(placement: .confirmationAction) {
                    Button("æäº¤") {
                        Task { await viewModel.submit() }
                    }
                    .disabled(!viewModel.isValid || viewModel.isSubmitting)
                }
            }
            .overlay {
                if viewModel.isSubmitting {
                    ProgressOverlay(message: "æ­£åœ¨æäº¤...")
                }
            }
            .alert("æäº¤æˆåŠŸ", isPresented: $viewModel.showSuccess) {
                Button("å¥½çš„") { dismiss() }
            } message: {
                Text("æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼æˆ‘ä»¬ä¼šå°½å¿«å¤„ç†å¹¶é€šè¿‡é‚®ä»¶å›å¤æ‚¨ã€‚")
            }
        }
    }
}

// è¯Šæ–­ä¿¡æ¯ï¼ˆè‡ªåŠ¨æ”¶é›†ï¼‰
struct DiagnosticInfo: Codable {
    let appVersion: String           // App ç‰ˆæœ¬
    let buildNumber: String          // Build å·
    let iosVersion: String           // iOS ç‰ˆæœ¬
    let deviceModel: String          // è®¾å¤‡å‹å·
    let locale: String               // è¯­è¨€è®¾ç½®
    let timezone: String             // æ—¶åŒº

    // ç”¨æˆ·ä¸Šä¸‹æ–‡
    let userId: String?
    let subscriptionPlan: String?
    let subscriptionStatus: String?

    // å½“å‰é¡µé¢ä¸Šä¸‹æ–‡
    let currentScreen: String?
    let currentBookId: String?
    let currentBookTitle: String?

    // ç½‘ç»œçŠ¶æ€
    let networkType: String          // WiFi/Cellular/None
    let isOnline: Bool

    // æœ€è¿‘é”™è¯¯æ—¥å¿—ï¼ˆè„±æ•ï¼‰
    let recentErrors: [String]?      // æœ€è¿‘ 5 æ¡é”™è¯¯

    // æ€§èƒ½æ•°æ®
    let memoryUsage: String?
    let diskSpace: String?
}
```

### 2.4 åé¦ˆ ViewModel

```swift
@MainActor
class FeedbackViewModel: ObservableObject {
    @Published var category: FeedbackCategory = .other
    @Published var description: String = ""
    @Published var attachments: [FeedbackAttachment] = []
    @Published var contactEmail: String = ""

    @Published var isSubmitting = false
    @Published var showSuccess = false
    @Published var error: Error?

    private let feedbackService = FeedbackService.shared
    private let maxAttachments = 5

    var diagnosticInfo: DiagnosticInfo {
        DiagnosticInfo(
            appVersion: Bundle.main.appVersion,
            buildNumber: Bundle.main.buildNumber,
            iosVersion: UIDevice.current.systemVersion,
            deviceModel: UIDevice.current.modelName,
            locale: Locale.current.identifier,
            timezone: TimeZone.current.identifier,
            userId: AuthManager.shared.currentUserId,
            subscriptionPlan: SubscriptionManager.shared.planType.rawValue,
            subscriptionStatus: SubscriptionManager.shared.status.rawValue,
            currentScreen: NavigationState.shared.currentScreen,
            currentBookId: ReaderState.shared.currentBookId,
            currentBookTitle: ReaderState.shared.currentBookTitle,
            networkType: NetworkMonitor.shared.connectionType.rawValue,
            isOnline: NetworkMonitor.shared.isConnected,
            recentErrors: ErrorLogger.shared.recentErrors(limit: 5),
            memoryUsage: PerformanceMonitor.memoryUsageString,
            diskSpace: PerformanceMonitor.diskSpaceString
        )
    }

    var isValid: Bool {
        !description.trimmingCharacters(in: .whitespacesAndNewlines).isEmpty &&
        description.count >= 10 &&
        (contactEmail.isEmpty || contactEmail.isValidEmail)
    }

    func addAttachment(_ image: UIImage) {
        guard attachments.count < maxAttachments else { return }
        let attachment = FeedbackAttachment(image: image)
        attachments.append(attachment)
    }

    func removeAttachment(_ attachment: FeedbackAttachment) {
        attachments.removeAll { $0.id == attachment.id }
    }

    func submit() async {
        isSubmitting = true
        defer { isSubmitting = false }

        do {
            // 1. ä¸Šä¼ é™„ä»¶
            var attachmentUrls: [String] = []
            for attachment in attachments {
                let url = try await feedbackService.uploadAttachment(attachment)
                attachmentUrls.append(url)
            }

            // 2. æäº¤åé¦ˆ
            let request = CreateFeedbackRequest(
                category: category,
                description: description,
                contactEmail: contactEmail.isEmpty ? nil : contactEmail,
                attachmentUrls: attachmentUrls,
                diagnosticInfo: diagnosticInfo
            )

            try await feedbackService.submitFeedback(request)
            showSuccess = true

        } catch {
            self.error = error
        }
    }
}
```

### 2.5 å¿«é€Ÿåé¦ˆï¼ˆä¸Šä¸‹æ–‡ç›¸å…³ï¼‰

```swift
// é˜…è¯»å™¨å†…çš„å¿«é€Ÿåé¦ˆ
struct QuickFeedbackSheet: View {
    let context: FeedbackContext
    @StateObject private var viewModel: QuickFeedbackViewModel

    init(context: FeedbackContext) {
        self.context = context
        _viewModel = StateObject(wrappedValue: QuickFeedbackViewModel(context: context))
    }

    var body: some View {
        NavigationStack {
            VStack(spacing: 20) {
                // å¿«é€Ÿé€‰é¡¹
                Text("æ‚¨é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ")
                    .font(.headline)

                LazyVGrid(columns: [GridItem(.flexible()), GridItem(.flexible())], spacing: 12) {
                    QuickOptionButton(
                        icon: "text.badge.xmark",
                        title: "å†…å®¹æ˜¾ç¤ºé”™è¯¯",
                        action: { viewModel.selectQuickOption(.displayError) }
                    )
                    QuickOptionButton(
                        icon: "character.book.closed",
                        title: "ç¿»è¯‘æœ‰è¯¯",
                        action: { viewModel.selectQuickOption(.translationError) }
                    )
                    QuickOptionButton(
                        icon: "bubble.left.and.exclamationmark.bubble.right",
                        title: "AI å›ç­”ä¸å¯¹",
                        action: { viewModel.selectQuickOption(.aiError) }
                    )
                    QuickOptionButton(
                        icon: "ellipsis.circle",
                        title: "å…¶ä»–é—®é¢˜",
                        action: { viewModel.selectQuickOption(.other) }
                    )
                }

                // é€‰ä¸­åæ˜¾ç¤ºè¯¦æƒ…è¾“å…¥
                if viewModel.selectedOption != nil {
                    TextEditor(text: $viewModel.additionalInfo)
                        .frame(height: 100)
                        .overlay(
                            RoundedRectangle(cornerRadius: 8)
                                .stroke(Color.secondary.opacity(0.3))
                        )

                    Button("æäº¤åé¦ˆ") {
                        Task { await viewModel.submit() }
                    }
                    .buttonStyle(.borderedProminent)
                    .disabled(viewModel.isSubmitting)
                }

                Spacer()
            }
            .padding()
            .navigationTitle("æŠ¥å‘Šé—®é¢˜")
            .navigationBarTitleDisplayMode(.inline)
        }
    }
}

// åé¦ˆä¸Šä¸‹æ–‡
struct FeedbackContext: Codable {
    let source: FeedbackSource
    let bookId: String?
    let bookTitle: String?
    let chapterId: String?
    let selectedText: String?
    let pageNumber: Int?
    let aiConversationId: String?
    let errorMessage: String?
    let errorStack: String?
}

enum FeedbackSource: String, Codable {
    case reader           // é˜…è¯»å™¨
    case aiChat          // AI å¯¹è¯
    case vocabulary      // è¯æ±‡é¡µ
    case settings        // è®¾ç½®
    case subscription    // è®¢é˜…é¡µ
    case error           // é”™è¯¯å¼¹çª—
    case shake           // æ‘‡ä¸€æ‘‡
}
```

---

## 3. å·¥å•ç³»ç»Ÿè®¾è®¡

### 3.1 å·¥å•ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           å·¥å•çŠ¶æ€æµè½¬                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            ç”¨æˆ·æäº¤åé¦ˆ
                                 â”‚
                                 â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚     NEW       â”‚
                        â”‚   (æ–°å»º)      â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                       â”‚
                    â–¼                       â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  AUTO_REPLIED â”‚       â”‚   ASSIGNED    â”‚
           â”‚ (è‡ªåŠ¨å›å¤)     â”‚       â”‚  (å·²åˆ†é…)     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                       â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚  IN_PROGRESS  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   (å¤„ç†ä¸­)     â”‚                  â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                              â”‚                          â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
              â”‚               â”‚               â”‚         â”‚
              â–¼               â–¼               â–¼         â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    PENDING    â”‚ â”‚   ESCALATED   â”‚ â”‚   ON_HOLD     â”‚
     â”‚ (å¾…ç”¨æˆ·å›å¤)   â”‚ â”‚  (å·²å‡çº§)      â”‚ â”‚  (æš‚åœ)       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                 â”‚                 â”‚
             â”‚                 â”‚                 â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                 â”‚
              â–¼                                 â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   RESOLVED    â”‚                 â”‚    CLOSED     â”‚
     â”‚   (å·²è§£å†³)     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   (å·²å…³é—­)    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   ç”¨æˆ·ç¡®è®¤æˆ–     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         7å¤©æ— å“åº”
```

### 3.2 å·¥å•çŠ¶æ€å®šä¹‰

```typescript
enum TicketStatus {
  // åˆå§‹çŠ¶æ€
  NEW = 'NEW',                    // æ–°å»ºï¼Œå¾…åˆ†é…
  AUTO_REPLIED = 'AUTO_REPLIED',  // å·²è‡ªåŠ¨å›å¤ï¼Œå¾…äººå·¥è·Ÿè¿›

  // å¤„ç†ä¸­çŠ¶æ€
  ASSIGNED = 'ASSIGNED',          // å·²åˆ†é…ç»™å®¢æœ
  IN_PROGRESS = 'IN_PROGRESS',    // å¤„ç†ä¸­
  PENDING = 'PENDING',            // å¾…ç”¨æˆ·å›å¤
  ON_HOLD = 'ON_HOLD',            // æš‚åœï¼ˆç­‰å¾…å…¶ä»–éƒ¨é—¨/å¤–éƒ¨ï¼‰
  ESCALATED = 'ESCALATED',        // å·²å‡çº§ï¼ˆéœ€è¦é«˜çº§æ”¯æŒï¼‰

  // ç»ˆæ­¢çŠ¶æ€
  RESOLVED = 'RESOLVED',          // å·²è§£å†³ï¼ˆå¾…ç¡®è®¤ï¼‰
  CLOSED = 'CLOSED',              // å·²å…³é—­
  SPAM = 'SPAM',                  // åƒåœ¾ä¿¡æ¯
  DUPLICATE = 'DUPLICATE',        // é‡å¤å·¥å•
}

enum TicketPriority {
  LOW = 'LOW',           // ä½ä¼˜å…ˆçº§ï¼šåŠŸèƒ½å»ºè®®ã€ä¸€èˆ¬å’¨è¯¢
  MEDIUM = 'MEDIUM',     // ä¸­ä¼˜å…ˆçº§ï¼šåŠŸèƒ½é—®é¢˜ã€è´¦æˆ·é—®é¢˜
  HIGH = 'HIGH',         // é«˜ä¼˜å…ˆçº§ï¼šæ”¯ä»˜é—®é¢˜ã€æ— æ³•ä½¿ç”¨
  URGENT = 'URGENT',     // ç´§æ€¥ï¼šå¤§è§„æ¨¡æ•…éšœã€å®‰å…¨é—®é¢˜
}

// SLA é…ç½®
const SLA_CONFIG: Record<TicketPriority, SLAConfig> = {
  [TicketPriority.URGENT]: {
    firstResponseTime: 1 * 60,      // 1å°æ—¶
    resolutionTime: 4 * 60,         // 4å°æ—¶
    escalationTime: 2 * 60,         // 2å°æ—¶æœªå“åº”è‡ªåŠ¨å‡çº§
  },
  [TicketPriority.HIGH]: {
    firstResponseTime: 4 * 60,      // 4å°æ—¶
    resolutionTime: 24 * 60,        // 24å°æ—¶
    escalationTime: 8 * 60,         // 8å°æ—¶æœªå“åº”è‡ªåŠ¨å‡çº§
  },
  [TicketPriority.MEDIUM]: {
    firstResponseTime: 24 * 60,     // 24å°æ—¶
    resolutionTime: 72 * 60,        // 72å°æ—¶
    escalationTime: 48 * 60,        // 48å°æ—¶æœªå“åº”è‡ªåŠ¨å‡çº§
  },
  [TicketPriority.LOW]: {
    firstResponseTime: 48 * 60,     // 48å°æ—¶
    resolutionTime: 168 * 60,       // 7å¤©
    escalationTime: null,           // ä¸è‡ªåŠ¨å‡çº§
  },
};
```

### 3.3 å·¥å•åˆ†é…ç­–ç•¥

```typescript
@Injectable()
export class TicketAssignmentService {
  // è‡ªåŠ¨åˆ†é…ç­–ç•¥
  async autoAssign(ticket: Ticket): Promise<string | null> {
    // 1. æŒ‰ç±»åˆ«åˆ†é…åˆ°ä¸“é—¨é˜Ÿåˆ—
    const queue = this.getCategoryQueue(ticket.category);

    // 2. è·å–é˜Ÿåˆ—ä¸­å¯ç”¨çš„å®¢æœ
    const availableAgents = await this.getAvailableAgents(queue);

    if (availableAgents.length === 0) {
      return null; // æ— å¯ç”¨å®¢æœï¼Œè¿›å…¥æœªåˆ†é…é˜Ÿåˆ—
    }

    // 3. è´Ÿè½½å‡è¡¡åˆ†é…
    const agent = this.selectAgent(availableAgents, ticket);

    return agent.id;
  }

  private getCategoryQueue(category: FeedbackCategory): string {
    const queueMapping: Record<FeedbackCategory, string> = {
      [FeedbackCategory.SUBSCRIPTION]: 'billing',
      [FeedbackCategory.PAYMENT]: 'billing',
      [FeedbackCategory.REFUND]: 'billing',
      [FeedbackCategory.BUG]: 'technical',
      [FeedbackCategory.FEATURE_NOT_WORKING]: 'technical',
      [FeedbackCategory.BOOK_CONTENT]: 'content',
      [FeedbackCategory.TRANSLATION]: 'content',
      [FeedbackCategory.AI_RESPONSE]: 'content',
      [FeedbackCategory.ACCOUNT]: 'general',
      [FeedbackCategory.LOGIN]: 'general',
      // ...
    };
    return queueMapping[category] || 'general';
  }

  private selectAgent(agents: Agent[], ticket: Ticket): Agent {
    // åŠ æƒè½®è¯¢ï¼šè€ƒè™‘å½“å‰å·¥å•æ•°ã€æŠ€èƒ½åŒ¹é…ã€å·¥ä½œæ—¶é—´
    const scored = agents.map(agent => ({
      agent,
      score: this.calculateScore(agent, ticket),
    }));

    scored.sort((a, b) => b.score - a.score);
    return scored[0].agent;
  }

  private calculateScore(agent: Agent, ticket: Ticket): number {
    let score = 100;

    // å½“å‰å·¥å•æ•°ï¼ˆè¶Šå°‘åˆ†æ•°è¶Šé«˜ï¼‰
    score -= agent.activeTicketCount * 5;

    // æŠ€èƒ½åŒ¹é…
    if (agent.skills.includes(ticket.category)) {
      score += 20;
    }

    // è¯­è¨€åŒ¹é…
    if (agent.languages.includes(ticket.language)) {
      score += 15;
    }

    // å†å²å¤„ç†åŒç±»å·¥å•çš„è§£å†³ç‡
    score += agent.resolutionRate * 10;

    return score;
  }
}
```

### 3.4 è‡ªåŠ¨å›å¤ä¸æ™ºèƒ½å»ºè®®

```typescript
@Injectable()
export class AutoReplyService {
  // å¸¸è§é—®é¢˜è‡ªåŠ¨å›å¤
  private readonly autoReplies: Record<string, AutoReplyTemplate> = {
    'SUBSCRIPTION.HOW_TO_CANCEL': {
      trigger: ['å–æ¶ˆè®¢é˜…', 'æ€ä¹ˆå–æ¶ˆ', 'å¦‚ä½•å–æ¶ˆ', 'cancel subscription'],
      reply: `
æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼

è¦å–æ¶ˆè®¢é˜…ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š
1. æ‰“å¼€ iPhoneã€Œè®¾ç½®ã€
2. ç‚¹å‡»é¡¶éƒ¨çš„æ‚¨çš„ Apple ID
3. é€‰æ‹©ã€Œè®¢é˜…ã€
4. æ‰¾åˆ° Readmigo å¹¶ç‚¹å‡»
5. é€‰æ‹©ã€Œå–æ¶ˆè®¢é˜…ã€

å–æ¶ˆåï¼Œæ‚¨ä»å¯ä½¿ç”¨ä»˜è´¹åŠŸèƒ½ç›´åˆ°å½“å‰è®¢é˜…æœŸç»“æŸã€‚

å¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·å›å¤æ­¤é‚®ä»¶ï¼Œæˆ‘ä»¬çš„å®¢æœå›¢é˜Ÿä¼šå°½å¿«ä¸ºæ‚¨å¤„ç†ã€‚
      `,
      closeAfterDays: 3,
    },
    'SUBSCRIPTION.RESTORE': {
      trigger: ['æ¢å¤è´­ä¹°', 'è´­ä¹°è®°å½•', 'restore purchase'],
      reply: `
æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼

è¦æ¢å¤è´­ä¹°ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š
1. æ‰“å¼€ Readmigo App
2. è¿›å…¥ã€Œè®¾ç½®ã€â†’ã€Œè®¢é˜…ã€
3. ç‚¹å‡»ã€Œæ¢å¤è´­ä¹°ã€æŒ‰é’®
4. ä½¿ç”¨è´­ä¹°æ—¶çš„ Apple ID éªŒè¯

å¦‚æœæ¢å¤å¤±è´¥ï¼Œè¯·ç¡®ä¿ï¼š
- ä½¿ç”¨çš„æ˜¯è´­ä¹°æ—¶çš„åŒä¸€ Apple ID
- Apple ID å·²ç™»å½•å¹¶å¯æ­£å¸¸ä½¿ç”¨
- ç½‘ç»œè¿æ¥æ­£å¸¸

å¦‚é—®é¢˜ä»æœªè§£å†³ï¼Œè¯·å›å¤æ­¤é‚®ä»¶ï¼Œæˆ‘ä»¬ä¼šä¸ºæ‚¨äººå·¥å¤„ç†ã€‚
      `,
      closeAfterDays: 3,
    },
    // ... æ›´å¤šè‡ªåŠ¨å›å¤æ¨¡æ¿
  };

  async processNewTicket(ticket: Ticket): Promise<AutoReplyResult> {
    // 1. åˆ†æå†…å®¹ï¼ŒåŒ¹é…å…³é”®è¯
    const matchedTemplate = this.matchTemplate(ticket.description);

    if (matchedTemplate) {
      // 2. å‘é€è‡ªåŠ¨å›å¤
      await this.sendAutoReply(ticket, matchedTemplate);

      // 3. æ›´æ–°å·¥å•çŠ¶æ€
      await this.updateTicketStatus(ticket.id, TicketStatus.AUTO_REPLIED);

      // 4. è®¾ç½®è‡ªåŠ¨å…³é—­å®šæ—¶å™¨
      if (matchedTemplate.closeAfterDays) {
        await this.scheduleAutoClose(ticket.id, matchedTemplate.closeAfterDays);
      }

      return { autoReplied: true, template: matchedTemplate.id };
    }

    return { autoReplied: false };
  }

  // AI æ™ºèƒ½å›å¤å»ºè®®ï¼ˆä¾›å®¢æœå‚è€ƒï¼‰
  async generateReplySuggestion(ticket: Ticket): Promise<string[]> {
    const context = {
      category: ticket.category,
      description: ticket.description,
      userPlan: ticket.user.subscription?.planType,
      previousTickets: await this.getUserPreviousTickets(ticket.userId),
    };

    // è°ƒç”¨ AI ç”Ÿæˆå»ºè®®å›å¤
    const suggestions = await this.aiService.generateReplySuggestions(context);

    return suggestions;
  }
}
```

---

## 4. è®¢å•ç³»ç»Ÿè®¾è®¡

### 4.1 è®¢å•æ•°æ®æ¥æº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          è®¢å•æ•°æ®åŒæ­¥                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   Apple App Store Connect                                               â”‚
â”‚        â”‚                                                                â”‚
â”‚        â”œâ”€â”€â”€ Server-to-Server Notifications (å®æ—¶)                       â”‚
â”‚        â”‚    - SUBSCRIBED: æ–°è®¢é˜…                                        â”‚
â”‚        â”‚    - DID_RENEW: ç»­è®¢                                           â”‚
â”‚        â”‚    - REFUND: é€€æ¬¾                                              â”‚
â”‚        â”‚    - ... å…¶ä»–äº‹ä»¶                                               â”‚
â”‚        â”‚                                                                â”‚
â”‚        â””â”€â”€â”€ App Store Connect API (å®šæ—¶åŒæ­¥/æŸ¥è¯¢)                        â”‚
â”‚             - è®¢å•è¯¦æƒ…æŸ¥è¯¢                                               â”‚
â”‚             - äº¤æ˜“å†å²                                                   â”‚
â”‚             - é€€æ¬¾çŠ¶æ€                                                   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Order Service                                  â”‚
â”‚                                                                         â”‚
â”‚   1. è§£æ Apple é€šçŸ¥/å“åº”                                                â”‚
â”‚   2. åˆ›å»º/æ›´æ–° Order è®°å½•                                                â”‚
â”‚   3. åˆ›å»º Transaction è®°å½•                                               â”‚
â”‚   4. åŒæ­¥ Subscription çŠ¶æ€                                              â”‚
â”‚   5. è§¦å‘ç›¸å…³ä¸šåŠ¡é€»è¾‘                                                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è®¢å•çŠ¶æ€

```typescript
enum OrderStatus {
  // æ­£å¸¸çŠ¶æ€
  ACTIVE = 'ACTIVE',              // æœ‰æ•ˆè®¢å•
  COMPLETED = 'COMPLETED',        // å·²å®Œæˆï¼ˆä¸€æ¬¡æ€§è´­ä¹°æˆ–è®¢é˜…ç»“æŸï¼‰

  // é—®é¢˜çŠ¶æ€
  PENDING_PAYMENT = 'PENDING',    // å¾…æ”¯ä»˜ï¼ˆå®½é™æœŸï¼‰
  PAYMENT_FAILED = 'FAILED',      // æ”¯ä»˜å¤±è´¥

  // é€€æ¬¾çŠ¶æ€
  REFUND_REQUESTED = 'REFUND_REQUESTED', // é€€æ¬¾å·²ç”³è¯·
  REFUNDED = 'REFUNDED',                  // å·²é€€æ¬¾
  PARTIALLY_REFUNDED = 'PARTIALLY_REFUNDED', // éƒ¨åˆ†é€€æ¬¾

  // å–æ¶ˆçŠ¶æ€
  CANCELLED = 'CANCELLED',        // å·²å–æ¶ˆ
  REVOKED = 'REVOKED',            // è¢«æ’¤é”€
}

enum TransactionType {
  INITIAL_PURCHASE = 'INITIAL_PURCHASE',   // é¦–æ¬¡è´­ä¹°
  RENEWAL = 'RENEWAL',                      // ç»­è®¢
  UPGRADE = 'UPGRADE',                      // å‡çº§
  DOWNGRADE = 'DOWNGRADE',                  // é™çº§
  REFUND = 'REFUND',                        // é€€æ¬¾
  REVOKE = 'REVOKE',                        // æ’¤é”€
}
```

### 4.3 è®¢å•æœåŠ¡

```typescript
@Injectable()
export class OrderService {
  constructor(
    private prisma: PrismaService,
    private subscriptionService: SubscriptionService,
    private appleService: AppleStoreService,
  ) {}

  // ä» Apple é€šçŸ¥åˆ›å»º/æ›´æ–°è®¢å•
  async processAppleNotification(
    notification: AppleServerNotification,
  ): Promise<void> {
    const { notificationType, data } = notification;
    const transactionInfo = data.signedTransactionInfo;
    const renewalInfo = data.signedRenewalInfo;

    // è§£æäº¤æ˜“ä¿¡æ¯
    const transaction = await this.appleService.decodeTransaction(transactionInfo);

    // æŸ¥æ‰¾æˆ–åˆ›å»ºè®¢å•
    let order = await this.findByOriginalTransactionId(transaction.originalTransactionId);

    if (!order) {
      order = await this.createOrder(transaction);
    }

    // åˆ›å»ºäº¤æ˜“è®°å½•
    const txRecord = await this.createTransaction(order, transaction, notificationType);

    // æ ¹æ®é€šçŸ¥ç±»å‹æ›´æ–°è®¢å•çŠ¶æ€
    switch (notificationType) {
      case 'SUBSCRIBED':
        await this.handleNewSubscription(order, transaction);
        break;

      case 'DID_RENEW':
        await this.handleRenewal(order, transaction);
        break;

      case 'DID_FAIL_TO_RENEW':
        await this.handleRenewalFailure(order, transaction);
        break;

      case 'REFUND':
        await this.handleRefund(order, transaction);
        break;

      case 'REVOKE':
        await this.handleRevoke(order, transaction);
        break;

      // ... å…¶ä»–ç±»å‹
    }
  }

  private async handleRefund(order: Order, transaction: AppleTransaction) {
    // 1. æ›´æ–°è®¢å•çŠ¶æ€
    await this.prisma.order.update({
      where: { id: order.id },
      data: {
        status: OrderStatus.REFUNDED,
        refundedAt: new Date(),
        refundAmount: transaction.price,
      },
    });

    // 2. æ›´æ–°ç”¨æˆ·è®¢é˜…çŠ¶æ€
    await this.subscriptionService.updateStatus(
      order.userId,
      SubscriptionStatus.REFUNDED,
    );

    // 3. åˆ›å»ºå·¥å•ï¼ˆå¦‚æœéœ€è¦è·Ÿè¿›ï¼‰
    await this.ticketService.createSystemTicket({
      userId: order.userId,
      category: 'REFUND_PROCESSED',
      title: 'é€€æ¬¾å·²å¤„ç†',
      description: `è®¢å• ${order.id} å·²é€€æ¬¾ ${transaction.price}`,
      priority: TicketPriority.LOW,
    });

    // 4. å‘é€é€šçŸ¥
    await this.notificationService.sendRefundNotification(order.userId, order);
  }

  // æŸ¥è¯¢ç”¨æˆ·è®¢å•å†å²
  async getUserOrders(userId: string, options: OrderQueryOptions): Promise<PaginatedOrders> {
    const { page = 1, limit = 20, status } = options;

    const where: Prisma.OrderWhereInput = { userId };
    if (status) {
      where.status = status;
    }

    const [orders, total] = await Promise.all([
      this.prisma.order.findMany({
        where,
        include: {
          transactions: {
            orderBy: { createdAt: 'desc' },
          },
        },
        orderBy: { createdAt: 'desc' },
        skip: (page - 1) * limit,
        take: limit,
      }),
      this.prisma.order.count({ where }),
    ]);

    return {
      data: orders,
      pagination: {
        page,
        limit,
        total,
        totalPages: Math.ceil(total / limit),
      },
    };
  }

  // è®¢å•è¯¦æƒ…ï¼ˆåŒ…å«å®Œæ•´äº¤æ˜“å†å²ï¼‰
  async getOrderDetail(orderId: string): Promise<OrderDetail> {
    const order = await this.prisma.order.findUnique({
      where: { id: orderId },
      include: {
        user: {
          select: { id: true, email: true, displayName: true },
        },
        transactions: {
          orderBy: { createdAt: 'desc' },
        },
        subscription: true,
        refundRequests: {
          orderBy: { createdAt: 'desc' },
        },
        relatedTickets: {
          orderBy: { createdAt: 'desc' },
        },
      },
    });

    if (!order) {
      throw new NotFoundException('Order not found');
    }

    return order;
  }
}
```

### 4.4 é€€æ¬¾å¤„ç†æµç¨‹

```typescript
@Injectable()
export class RefundService {
  // å®¢æœå‘èµ·é€€æ¬¾è¯·æ±‚
  async createRefundRequest(
    orderId: string,
    request: CreateRefundRequestDto,
    adminId: string,
  ): Promise<RefundRequest> {
    const order = await this.orderService.getOrderDetail(orderId);

    // éªŒè¯è®¢å•å¯é€€æ¬¾
    this.validateRefundEligibility(order);

    // åˆ›å»ºé€€æ¬¾è¯·æ±‚è®°å½•
    const refundRequest = await this.prisma.refundRequest.create({
      data: {
        orderId,
        userId: order.userId,
        amount: request.amount || order.amount,
        reason: request.reason,
        internalNote: request.internalNote,
        requestedBy: adminId,
        status: RefundRequestStatus.PENDING,
      },
    });

    // æ ¹æ®é€€æ¬¾ç±»å‹å¤„ç†
    if (request.type === 'APPLE_REFUND') {
      // é€šè¿‡ Apple API å‘èµ·é€€æ¬¾
      await this.initiateAppleRefund(order, refundRequest);
    } else if (request.type === 'CREDIT') {
      // è´¦æˆ·ä½™é¢/ç§¯åˆ†è¡¥å¿
      await this.issueCredit(order.userId, request.amount, refundRequest);
    } else if (request.type === 'EXTEND_SUBSCRIPTION') {
      // å»¶é•¿è®¢é˜…æœŸä½œä¸ºè¡¥å¿
      await this.extendSubscription(order.userId, request.extensionDays);
    }

    return refundRequest;
  }

  private async initiateAppleRefund(order: Order, refundRequest: RefundRequest) {
    try {
      // è°ƒç”¨ App Store Connect API
      const result = await this.appleService.requestRefund(
        order.originalTransactionId,
        refundRequest.reason,
      );

      // æ›´æ–°çŠ¶æ€ä¸ºå¤„ç†ä¸­ï¼ˆç­‰å¾… Apple å¤„ç†ï¼‰
      await this.prisma.refundRequest.update({
        where: { id: refundRequest.id },
        data: {
          status: RefundRequestStatus.PROCESSING,
          appleRefundId: result.refundId,
        },
      });

    } catch (error) {
      // è®°å½•å¤±è´¥
      await this.prisma.refundRequest.update({
        where: { id: refundRequest.id },
        data: {
          status: RefundRequestStatus.FAILED,
          failureReason: error.message,
        },
      });
      throw error;
    }
  }

  // å¤„ç† Apple é€€æ¬¾é€šçŸ¥
  async handleAppleRefundNotification(notification: AppleRefundNotification) {
    const refundRequest = await this.prisma.refundRequest.findFirst({
      where: { appleRefundId: notification.refundId },
    });

    if (refundRequest) {
      await this.prisma.refundRequest.update({
        where: { id: refundRequest.id },
        data: {
          status: notification.success
            ? RefundRequestStatus.COMPLETED
            : RefundRequestStatus.REJECTED,
          completedAt: new Date(),
        },
      });
    }
  }
}

enum RefundRequestStatus {
  PENDING = 'PENDING',           // å¾…å¤„ç†
  PROCESSING = 'PROCESSING',     // å¤„ç†ä¸­
  COMPLETED = 'COMPLETED',       // å·²å®Œæˆ
  REJECTED = 'REJECTED',         // è¢«æ‹’ç»
  FAILED = 'FAILED',             // å¤±è´¥
  CANCELLED = 'CANCELLED',       // å·²å–æ¶ˆ
}
```

---

## 5. Dashboard å®¢æœç®¡ç†

### 5.1 Dashboard é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Dashboard å®¢æœæ¨¡å—                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ğŸ“Š æ¦‚è§ˆä»ªè¡¨ç›˜ (/dashboard/support)                                     â”‚
â”‚     â”œâ”€â”€ ä»Šæ—¥ç»Ÿè®¡ï¼ˆæ–°å·¥å•ã€å·²è§£å†³ã€å¾…å¤„ç†ï¼‰                               â”‚
â”‚     â”œâ”€â”€ SLA è¾¾æˆç‡                                                      â”‚
â”‚     â”œâ”€â”€ å®¢æœå·¥ä½œé‡åˆ†å¸ƒ                                                  â”‚
â”‚     â””â”€â”€ ç´§æ€¥å·¥å•æé†’                                                    â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“ å·¥å•ç®¡ç† (/dashboard/tickets)                                       â”‚
â”‚     â”œâ”€â”€ å·¥å•åˆ—è¡¨ï¼ˆç­›é€‰ã€æ’åºã€æœç´¢ï¼‰                                     â”‚
â”‚     â”œâ”€â”€ å·¥å•è¯¦æƒ…é¡µ                                                      â”‚
â”‚     â”œâ”€â”€ æ‰¹é‡æ“ä½œ                                                        â”‚
â”‚     â””â”€â”€ å·¥å•åˆ†é…                                                        â”‚
â”‚                                                                         â”‚
â”‚  ğŸ’¬ åé¦ˆç®¡ç† (/dashboard/feedback)                                      â”‚
â”‚     â”œâ”€â”€ åé¦ˆåˆ—è¡¨                                                        â”‚
â”‚     â”œâ”€â”€ åé¦ˆè¯¦æƒ…                                                        â”‚
â”‚     â””â”€â”€ è½¬å·¥å•æ“ä½œ                                                      â”‚
â”‚                                                                         â”‚
â”‚  ğŸ’³ è®¢å•ç®¡ç† (/dashboard/orders)                                        â”‚
â”‚     â”œâ”€â”€ è®¢å•åˆ—è¡¨                                                        â”‚
â”‚     â”œâ”€â”€ è®¢å•è¯¦æƒ…                                                        â”‚
â”‚     â”œâ”€â”€ é€€æ¬¾ç®¡ç†                                                        â”‚
â”‚     â””â”€â”€ äº¤æ˜“è®°å½•                                                        â”‚
â”‚                                                                         â”‚
â”‚  ğŸ‘¥ ç”¨æˆ·ç®¡ç† (/dashboard/users) [å·²æœ‰]                                  â”‚
â”‚     â””â”€â”€ æ‰©å±•ï¼šè®¢é˜…ç®¡ç†ã€å·¥å•å†å²                                         â”‚
â”‚                                                                         â”‚
â”‚  âš™ï¸ å®¢æœè®¾ç½® (/dashboard/support/settings)                              â”‚
â”‚     â”œâ”€â”€ å¿«æ·å›å¤æ¨¡æ¿                                                    â”‚
â”‚     â”œâ”€â”€ è‡ªåŠ¨å›å¤è§„åˆ™                                                    â”‚
â”‚     â”œâ”€â”€ SLA é…ç½®                                                        â”‚
â”‚     â””â”€â”€ å®¢æœäººå‘˜ç®¡ç†                                                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å·¥å•åˆ—è¡¨é¡µ

```tsx
// apps/dashboard/src/pages/tickets/index.tsx
import {
  List,
  Datagrid,
  TextField,
  DateField,
  ReferenceField,
  FunctionField,
  FilterList,
  FilterListItem,
  SelectInput,
  TextInput,
  useListContext,
  TopToolbar,
  ExportButton,
  BulkActionsToolbar,
  BulkUpdateButton,
} from 'react-admin';
import { Chip, Box, Badge, Card, CardContent, Typography } from '@mui/material';

// å·¥å•åˆ—è¡¨
export const TicketList = () => {
  return (
    <List
      filters={ticketFilters}
      sort={{ field: 'createdAt', order: 'DESC' }}
      aside={<TicketFilterSidebar />}
      actions={<TicketListActions />}
    >
      <Datagrid
        rowClick="show"
        bulkActionButtons={<TicketBulkActions />}
      >
        <TextField source="ticketNumber" label="å·¥å•å·" />

        <FunctionField
          label="ä¼˜å…ˆçº§"
          render={(record: Ticket) => (
            <PriorityBadge priority={record.priority} />
          )}
        />

        <FunctionField
          label="çŠ¶æ€"
          render={(record: Ticket) => (
            <StatusChip status={record.status} />
          )}
        />

        <TextField source="category" label="åˆ†ç±»" />

        <TextField source="subject" label="ä¸»é¢˜" />

        <ReferenceField source="userId" reference="users" label="ç”¨æˆ·">
          <TextField source="email" />
        </ReferenceField>

        <ReferenceField source="assigneeId" reference="admins" label="å¤„ç†äºº">
          <TextField source="name" />
        </ReferenceField>

        <FunctionField
          label="SLA"
          render={(record: Ticket) => (
            <SLAIndicator ticket={record} />
          )}
        />

        <DateField source="createdAt" label="åˆ›å»ºæ—¶é—´" showTime />

        <DateField source="updatedAt" label="æ›´æ–°æ—¶é—´" showTime />
      </Datagrid>
    </List>
  );
};

// å·¥å•ç­›é€‰å™¨
const ticketFilters = [
  <TextInput source="q" label="æœç´¢" alwaysOn />,
  <SelectInput
    source="status"
    label="çŠ¶æ€"
    choices={[
      { id: 'NEW', name: 'æ–°å»º' },
      { id: 'ASSIGNED', name: 'å·²åˆ†é…' },
      { id: 'IN_PROGRESS', name: 'å¤„ç†ä¸­' },
      { id: 'PENDING', name: 'å¾…ç”¨æˆ·å›å¤' },
      { id: 'RESOLVED', name: 'å·²è§£å†³' },
      { id: 'CLOSED', name: 'å·²å…³é—­' },
    ]}
  />,
  <SelectInput
    source="priority"
    label="ä¼˜å…ˆçº§"
    choices={[
      { id: 'URGENT', name: 'ç´§æ€¥' },
      { id: 'HIGH', name: 'é«˜' },
      { id: 'MEDIUM', name: 'ä¸­' },
      { id: 'LOW', name: 'ä½' },
    ]}
  />,
  <SelectInput
    source="category"
    label="åˆ†ç±»"
    choices={categoryChoices}
  />,
];

// ä¾§è¾¹æ å¿«æ·ç­›é€‰
const TicketFilterSidebar = () => (
  <Card sx={{ width: 240, mr: 2 }}>
    <CardContent>
      <FilterList label="æˆ‘çš„å·¥å•" icon={<PersonIcon />}>
        <FilterListItem label="åˆ†é…ç»™æˆ‘" value={{ assigneeId: 'me' }} />
        <FilterListItem label="æˆ‘åˆ›å»ºçš„" value={{ createdBy: 'me' }} />
      </FilterList>

      <FilterList label="å¿«æ·ç­›é€‰" icon={<FilterIcon />}>
        <FilterListItem
          label="æœªåˆ†é…"
          value={{ status: 'NEW', assigneeId: null }}
        />
        <FilterListItem
          label="SLA å³å°†è¶…æ—¶"
          value={{ slaWarning: true }}
        />
        <FilterListItem
          label="ç­‰å¾…å›å¤ >24h"
          value={{ pendingOverdue: true }}
        />
      </FilterList>

      <FilterList label="åˆ†ç±»" icon={<CategoryIcon />}>
        <FilterListItem label="è®¢é˜…é—®é¢˜" value={{ category: 'SUBSCRIPTION' }} />
        <FilterListItem label="æ”¯ä»˜é—®é¢˜" value={{ category: 'PAYMENT' }} />
        <FilterListItem label="æŠ€æœ¯é—®é¢˜" value={{ category: 'BUG' }} />
        <FilterListItem label="åŠŸèƒ½å»ºè®®" value={{ category: 'FEATURE_REQUEST' }} />
      </FilterList>
    </CardContent>
  </Card>
);

// æ‰¹é‡æ“ä½œ
const TicketBulkActions = () => (
  <>
    <BulkUpdateButton
      label="æ‰¹é‡åˆ†é…"
      data={{ assigneeId: 'PROMPT' }}
      icon={<AssignmentIndIcon />}
    />
    <BulkUpdateButton
      label="æ‰¹é‡å…³é—­"
      data={{ status: 'CLOSED' }}
      icon={<CheckIcon />}
    />
    <BulkUpdateButton
      label="æ‰¹é‡æ ‡è®°åƒåœ¾"
      data={{ status: 'SPAM' }}
      icon={<DeleteIcon />}
    />
  </>
);

// SLA æŒ‡ç¤ºå™¨ç»„ä»¶
const SLAIndicator = ({ ticket }: { ticket: Ticket }) => {
  const slaStatus = calculateSLAStatus(ticket);

  const colors = {
    ok: 'success',
    warning: 'warning',
    breached: 'error',
  };

  return (
    <Chip
      size="small"
      label={slaStatus.label}
      color={colors[slaStatus.status]}
      icon={slaStatus.status === 'breached' ? <WarningIcon /> : undefined}
    />
  );
};
```

### 5.3 å·¥å•è¯¦æƒ…é¡µ

```tsx
// apps/dashboard/src/pages/tickets/[id]/show.tsx
export const TicketShow = () => {
  const { record: ticket } = useShowController<Ticket>();

  return (
    <Show>
      <TabbedShowLayout>
        {/* å·¥å•ä¿¡æ¯ Tab */}
        <TabbedShowLayout.Tab label="å·¥å•ä¿¡æ¯">
          <Grid container spacing={3}>
            {/* å·¦ä¾§ï¼šå·¥å•è¯¦æƒ… */}
            <Grid item xs={8}>
              <Card>
                <CardHeader
                  title={ticket?.subject}
                  subheader={`#${ticket?.ticketNumber}`}
                  action={
                    <Box>
                      <PriorityBadge priority={ticket?.priority} />
                      <StatusChip status={ticket?.status} />
                    </Box>
                  }
                />
                <CardContent>
                  {/* å·¥å•æè¿° */}
                  <Typography variant="body1" sx={{ mb: 2 }}>
                    {ticket?.description}
                  </Typography>

                  {/* é™„ä»¶ */}
                  {ticket?.attachments?.length > 0 && (
                    <AttachmentGallery attachments={ticket.attachments} />
                  )}

                  {/* è¯Šæ–­ä¿¡æ¯ */}
                  {ticket?.diagnosticInfo && (
                    <Accordion>
                      <AccordionSummary expandIcon={<ExpandMoreIcon />}>
                        <Typography>è¯Šæ–­ä¿¡æ¯</Typography>
                      </AccordionSummary>
                      <AccordionContent>
                        <DiagnosticInfoDisplay info={ticket.diagnosticInfo} />
                      </AccordionContent>
                    </Accordion>
                  )}
                </CardContent>
              </Card>

              {/* å¯¹è¯è®°å½• */}
              <Card sx={{ mt: 2 }}>
                <CardHeader title="å¯¹è¯è®°å½•" />
                <CardContent>
                  <TicketConversation ticketId={ticket?.id} />
                </CardContent>
              </Card>

              {/* å›å¤æ¡† */}
              <Card sx={{ mt: 2 }}>
                <CardContent>
                  <TicketReplyForm ticketId={ticket?.id} />
                </CardContent>
              </Card>
            </Grid>

            {/* å³ä¾§ï¼šç”¨æˆ·ä¿¡æ¯å’Œæ“ä½œ */}
            <Grid item xs={4}>
              {/* ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ */}
              <UserInfoCard userId={ticket?.userId} />

              {/* è®¢é˜…ä¿¡æ¯ */}
              <SubscriptionInfoCard userId={ticket?.userId} />

              {/* å·¥å•æ“ä½œ */}
              <TicketActionsCard ticket={ticket} />

              {/* å·¥å•å†å² */}
              <TicketHistoryCard ticketId={ticket?.id} />
            </Grid>
          </Grid>
        </TabbedShowLayout.Tab>

        {/* ç”¨æˆ·å†å² Tab */}
        <TabbedShowLayout.Tab label="ç”¨æˆ·å†å²">
          <UserTicketHistory userId={ticket?.userId} />
          <UserOrderHistory userId={ticket?.userId} />
        </TabbedShowLayout.Tab>

        {/* å…³è”è®¢å• Tab */}
        <TabbedShowLayout.Tab label="å…³è”è®¢å•">
          <RelatedOrders userId={ticket?.userId} />
        </TabbedShowLayout.Tab>
      </TabbedShowLayout>
    </Show>
  );
};

// å·¥å•å›å¤è¡¨å•
const TicketReplyForm = ({ ticketId }: { ticketId: string }) => {
  const [reply, setReply] = useState('');
  const [isInternal, setIsInternal] = useState(false);
  const [templates, setTemplates] = useState<ReplyTemplate[]>([]);
  const [suggestions, setSuggestions] = useState<string[]>([]);

  // åŠ è½½ AI å»ºè®®å›å¤
  useEffect(() => {
    loadSuggestions(ticketId).then(setSuggestions);
  }, [ticketId]);

  const handleSubmit = async () => {
    await createTicketMessage({
      ticketId,
      content: reply,
      isInternal,
    });
    setReply('');
  };

  return (
    <Box>
      {/* å¿«æ·å›å¤æ¨¡æ¿ */}
      <Box sx={{ mb: 2 }}>
        <Typography variant="subtitle2">å¿«æ·å›å¤</Typography>
        <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap' }}>
          {templates.map(t => (
            <Chip
              key={t.id}
              label={t.name}
              onClick={() => setReply(t.content)}
              size="small"
            />
          ))}
        </Box>
      </Box>

      {/* AI å»ºè®® */}
      {suggestions.length > 0 && (
        <Box sx={{ mb: 2 }}>
          <Typography variant="subtitle2">AI å»ºè®®å›å¤</Typography>
          {suggestions.map((s, i) => (
            <Card key={i} sx={{ mb: 1, cursor: 'pointer' }} onClick={() => setReply(s)}>
              <CardContent>
                <Typography variant="body2">{s.substring(0, 100)}...</Typography>
              </CardContent>
            </Card>
          ))}
        </Box>
      )}

      {/* å›å¤è¾“å…¥æ¡† */}
      <TextField
        fullWidth
        multiline
        rows={4}
        value={reply}
        onChange={e => setReply(e.target.value)}
        placeholder="è¾“å…¥å›å¤å†…å®¹..."
      />

      <Box sx={{ mt: 2, display: 'flex', justifyContent: 'space-between' }}>
        <FormControlLabel
          control={
            <Switch
              checked={isInternal}
              onChange={e => setIsInternal(e.target.checked)}
            />
          }
          label="å†…éƒ¨å¤‡æ³¨ï¼ˆç”¨æˆ·ä¸å¯è§ï¼‰"
        />

        <Box>
          <Button onClick={handleSubmit} variant="contained">
            å‘é€å›å¤
          </Button>
          <Button
            onClick={() => handleSubmitAndClose()}
            variant="outlined"
            sx={{ ml: 1 }}
          >
            å‘é€å¹¶å…³é—­
          </Button>
        </Box>
      </Box>
    </Box>
  );
};

// å·¥å•æ“ä½œå¡ç‰‡
const TicketActionsCard = ({ ticket }: { ticket: Ticket }) => {
  const [update] = useUpdate();

  return (
    <Card sx={{ mb: 2 }}>
      <CardHeader title="æ“ä½œ" />
      <CardContent>
        {/* çŠ¶æ€å˜æ›´ */}
        <FormControl fullWidth sx={{ mb: 2 }}>
          <InputLabel>çŠ¶æ€</InputLabel>
          <Select
            value={ticket.status}
            onChange={e => update('tickets', {
              id: ticket.id,
              data: { status: e.target.value },
            })}
          >
            {statusOptions.map(s => (
              <MenuItem key={s.id} value={s.id}>{s.name}</MenuItem>
            ))}
          </Select>
        </FormControl>

        {/* ä¼˜å…ˆçº§å˜æ›´ */}
        <FormControl fullWidth sx={{ mb: 2 }}>
          <InputLabel>ä¼˜å…ˆçº§</InputLabel>
          <Select
            value={ticket.priority}
            onChange={e => update('tickets', {
              id: ticket.id,
              data: { priority: e.target.value },
            })}
          >
            {priorityOptions.map(p => (
              <MenuItem key={p.id} value={p.id}>{p.name}</MenuItem>
            ))}
          </Select>
        </FormControl>

        {/* åˆ†é…å®¢æœ */}
        <FormControl fullWidth sx={{ mb: 2 }}>
          <InputLabel>åˆ†é…ç»™</InputLabel>
          <Select
            value={ticket.assigneeId || ''}
            onChange={e => update('tickets', {
              id: ticket.id,
              data: { assigneeId: e.target.value },
            })}
          >
            {agents.map(a => (
              <MenuItem key={a.id} value={a.id}>{a.name}</MenuItem>
            ))}
          </Select>
        </FormControl>

        <Divider sx={{ my: 2 }} />

        {/* å¿«æ·æ“ä½œ */}
        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>
          <Button
            variant="outlined"
            startIcon={<PersonAddIcon />}
            onClick={() => assignToMe(ticket.id)}
          >
            åˆ†é…ç»™æˆ‘
          </Button>

          <Button
            variant="outlined"
            startIcon={<EscalateIcon />}
            onClick={() => escalateTicket(ticket.id)}
          >
            å‡çº§å·¥å•
          </Button>

          <Button
            variant="outlined"
            color="error"
            startIcon={<MergeIcon />}
            onClick={() => mergeTicket(ticket.id)}
          >
            åˆå¹¶å·¥å•
          </Button>
        </Box>
      </CardContent>
    </Card>
  );
};
```

### 5.4 è®¢å•ç®¡ç†é¡µ

```tsx
// apps/dashboard/src/pages/orders/index.tsx
export const OrderList = () => {
  return (
    <List
      filters={orderFilters}
      sort={{ field: 'createdAt', order: 'DESC' }}
    >
      <Datagrid rowClick="show">
        <TextField source="orderNumber" label="è®¢å•å·" />

        <FunctionField
          label="çŠ¶æ€"
          render={(record: Order) => (
            <OrderStatusChip status={record.status} />
          )}
        />

        <ReferenceField source="userId" reference="users" label="ç”¨æˆ·">
          <TextField source="email" />
        </ReferenceField>

        <TextField source="productId" label="äº§å“" />

        <FunctionField
          label="é‡‘é¢"
          render={(record: Order) => (
            <Typography>
              {formatCurrency(record.amount, record.currency)}
            </Typography>
          )}
        />

        <TextField source="source" label="æ¥æº" />

        <DateField source="createdAt" label="åˆ›å»ºæ—¶é—´" showTime />

        <DateField source="expiresAt" label="åˆ°æœŸæ—¶é—´" showTime />
      </Datagrid>
    </List>
  );
};

// è®¢å•è¯¦æƒ…é¡µ
export const OrderShow = () => {
  const { record: order } = useShowController<Order>();

  return (
    <Show>
      <SimpleShowLayout>
        <Grid container spacing={3}>
          {/* è®¢å•åŸºæœ¬ä¿¡æ¯ */}
          <Grid item xs={8}>
            <Card>
              <CardHeader
                title={`è®¢å• #${order?.orderNumber}`}
                action={<OrderStatusChip status={order?.status} />}
              />
              <CardContent>
                <Grid container spacing={2}>
                  <Grid item xs={6}>
                    <LabeledField label="äº§å“">
                      {order?.productId}
                    </LabeledField>
                  </Grid>
                  <Grid item xs={6}>
                    <LabeledField label="é‡‘é¢">
                      {formatCurrency(order?.amount, order?.currency)}
                    </LabeledField>
                  </Grid>
                  <Grid item xs={6}>
                    <LabeledField label="æ¥æº">
                      {order?.source}
                    </LabeledField>
                  </Grid>
                  <Grid item xs={6}>
                    <LabeledField label="åˆ›å»ºæ—¶é—´">
                      {formatDateTime(order?.createdAt)}
                    </LabeledField>
                  </Grid>
                  <Grid item xs={6}>
                    <LabeledField label="å¼€å§‹æ—¶é—´">
                      {formatDateTime(order?.startedAt)}
                    </LabeledField>
                  </Grid>
                  <Grid item xs={6}>
                    <LabeledField label="åˆ°æœŸæ—¶é—´">
                      {formatDateTime(order?.expiresAt)}
                    </LabeledField>
                  </Grid>
                </Grid>

                {/* Apple äº¤æ˜“ä¿¡æ¯ */}
                {order?.appleInfo && (
                  <Accordion sx={{ mt: 2 }}>
                    <AccordionSummary expandIcon={<ExpandMoreIcon />}>
                      <Typography>Apple äº¤æ˜“ä¿¡æ¯</Typography>
                    </AccordionSummary>
                    <AccordionDetails>
                      <AppleTransactionInfo info={order.appleInfo} />
                    </AccordionDetails>
                  </Accordion>
                )}
              </CardContent>
            </Card>

            {/* äº¤æ˜“å†å² */}
            <Card sx={{ mt: 2 }}>
              <CardHeader title="äº¤æ˜“å†å²" />
              <CardContent>
                <TransactionTimeline transactions={order?.transactions} />
              </CardContent>
            </Card>

            {/* é€€æ¬¾è®°å½• */}
            {order?.refundRequests?.length > 0 && (
              <Card sx={{ mt: 2 }}>
                <CardHeader title="é€€æ¬¾è®°å½•" />
                <CardContent>
                  <RefundRequestList requests={order.refundRequests} />
                </CardContent>
              </Card>
            )}
          </Grid>

          {/* å³ä¾§ï¼šç”¨æˆ·ä¿¡æ¯å’Œæ“ä½œ */}
          <Grid item xs={4}>
            <UserInfoCard userId={order?.userId} />

            <SubscriptionInfoCard userId={order?.userId} />

            {/* è®¢å•æ“ä½œ */}
            <OrderActionsCard order={order} />
          </Grid>
        </Grid>
      </SimpleShowLayout>
    </Show>
  );
};

// è®¢å•æ“ä½œå¡ç‰‡
const OrderActionsCard = ({ order }: { order: Order }) => {
  const [showRefundDialog, setShowRefundDialog] = useState(false);
  const [showExtendDialog, setShowExtendDialog] = useState(false);

  return (
    <Card sx={{ mb: 2 }}>
      <CardHeader title="æ“ä½œ" />
      <CardContent>
        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>
          {/* å‘èµ·é€€æ¬¾ */}
          {order.status === 'ACTIVE' && (
            <Button
              variant="outlined"
              color="warning"
              startIcon={<RefundIcon />}
              onClick={() => setShowRefundDialog(true)}
            >
              å‘èµ·é€€æ¬¾
            </Button>
          )}

          {/* å»¶é•¿è®¢é˜… */}
          <Button
            variant="outlined"
            startIcon={<ExtendIcon />}
            onClick={() => setShowExtendDialog(true)}
          >
            å»¶é•¿è®¢é˜…
          </Button>

          {/* åˆ›å»ºå·¥å• */}
          <Button
            variant="outlined"
            startIcon={<TicketIcon />}
            onClick={() => createRelatedTicket(order)}
          >
            åˆ›å»ºå…³è”å·¥å•
          </Button>

          {/* å‘é€æ”¶æ® */}
          <Button
            variant="outlined"
            startIcon={<EmailIcon />}
            onClick={() => resendReceipt(order.id)}
          >
            é‡å‘æ”¶æ®
          </Button>
        </Box>
      </CardContent>

      {/* é€€æ¬¾å¯¹è¯æ¡† */}
      <RefundDialog
        open={showRefundDialog}
        onClose={() => setShowRefundDialog(false)}
        order={order}
      />

      {/* å»¶é•¿è®¢é˜…å¯¹è¯æ¡† */}
      <ExtendSubscriptionDialog
        open={showExtendDialog}
        onClose={() => setShowExtendDialog(false)}
        order={order}
      />
    </Card>
  );
};

// é€€æ¬¾å¯¹è¯æ¡†
const RefundDialog = ({ open, onClose, order }: RefundDialogProps) => {
  const [refundType, setRefundType] = useState<'APPLE_REFUND' | 'CREDIT' | 'EXTEND'>('APPLE_REFUND');
  const [reason, setReason] = useState('');
  const [amount, setAmount] = useState(order.amount);
  const [extensionDays, setExtensionDays] = useState(7);
  const [internalNote, setInternalNote] = useState('');

  const handleSubmit = async () => {
    await createRefundRequest({
      orderId: order.id,
      type: refundType,
      reason,
      amount: refundType === 'APPLE_REFUND' ? amount : undefined,
      extensionDays: refundType === 'EXTEND' ? extensionDays : undefined,
      internalNote,
    });
    onClose();
  };

  return (
    <Dialog open={open} onClose={onClose} maxWidth="sm" fullWidth>
      <DialogTitle>å‘èµ·é€€æ¬¾/è¡¥å¿</DialogTitle>
      <DialogContent>
        <FormControl fullWidth sx={{ mt: 2 }}>
          <InputLabel>å¤„ç†æ–¹å¼</InputLabel>
          <Select value={refundType} onChange={e => setRefundType(e.target.value)}>
            <MenuItem value="APPLE_REFUND">Apple é€€æ¬¾ï¼ˆçœŸå®é€€æ¬¾ï¼‰</MenuItem>
            <MenuItem value="CREDIT">è´¦æˆ·ç§¯åˆ†è¡¥å¿</MenuItem>
            <MenuItem value="EXTEND">å»¶é•¿è®¢é˜…æœŸ</MenuItem>
          </Select>
        </FormControl>

        {refundType === 'APPLE_REFUND' && (
          <TextField
            fullWidth
            label="é€€æ¬¾é‡‘é¢"
            type="number"
            value={amount}
            onChange={e => setAmount(Number(e.target.value))}
            sx={{ mt: 2 }}
            InputProps={{
              startAdornment: <Typography>$</Typography>,
            }}
          />
        )}

        {refundType === 'EXTEND' && (
          <TextField
            fullWidth
            label="å»¶é•¿å¤©æ•°"
            type="number"
            value={extensionDays}
            onChange={e => setExtensionDays(Number(e.target.value))}
            sx={{ mt: 2 }}
          />
        )}

        <TextField
          fullWidth
          label="é€€æ¬¾åŸå› ï¼ˆç”¨æˆ·å¯è§ï¼‰"
          value={reason}
          onChange={e => setReason(e.target.value)}
          sx={{ mt: 2 }}
          multiline
          rows={2}
        />

        <TextField
          fullWidth
          label="å†…éƒ¨å¤‡æ³¨"
          value={internalNote}
          onChange={e => setInternalNote(e.target.value)}
          sx={{ mt: 2 }}
          multiline
          rows={2}
        />
      </DialogContent>
      <DialogActions>
        <Button onClick={onClose}>å–æ¶ˆ</Button>
        <Button onClick={handleSubmit} variant="contained" color="warning">
          ç¡®è®¤
        </Button>
      </DialogActions>
    </Dialog>
  );
};
```

### 5.5 å®¢æœäººå‘˜æƒé™

```typescript
// å®¢æœè§’è‰²å®šä¹‰
enum SupportRole {
  SUPPORT_AGENT = 'SUPPORT_AGENT',     // ä¸€çº¿å®¢æœ
  SUPPORT_LEAD = 'SUPPORT_LEAD',       // å®¢æœä¸»ç®¡
  SUPPORT_ADMIN = 'SUPPORT_ADMIN',     // å®¢æœç®¡ç†å‘˜
}

// æƒé™å®šä¹‰
const supportPermissions: Record<SupportRole, Permission[]> = {
  [SupportRole.SUPPORT_AGENT]: [
    // å·¥å•
    'ticket:read',
    'ticket:reply',
    'ticket:update_status',
    'ticket:assign_self',

    // åé¦ˆ
    'feedback:read',
    'feedback:convert_to_ticket',

    // è®¢å•
    'order:read',

    // ç”¨æˆ·
    'user:read',
    'user:subscription:read',
  ],

  [SupportRole.SUPPORT_LEAD]: [
    // ç»§æ‰¿ AGENT æƒé™
    ...supportPermissions[SupportRole.SUPPORT_AGENT],

    // é¢å¤–æƒé™
    'ticket:assign_others',
    'ticket:escalate',
    'ticket:merge',
    'ticket:bulk_update',

    'order:refund:request',    // å¯ä»¥å‘èµ·é€€æ¬¾è¯·æ±‚
    'order:extend',            // å¯ä»¥å»¶é•¿è®¢é˜…

    'user:subscription:update', // å¯ä»¥ä¿®æ”¹è®¢é˜…

    'report:read',             // å¯ä»¥æŸ¥çœ‹æŠ¥è¡¨
  ],

  [SupportRole.SUPPORT_ADMIN]: [
    // å…¨éƒ¨æƒé™
    'ticket:*',
    'feedback:*',
    'order:*',
    'user:*',
    'report:*',
    'settings:*',

    'admin:manage_agents',     // ç®¡ç†å®¢æœäººå‘˜
    'admin:configure_sla',     // é…ç½® SLA
    'admin:configure_templates', // é…ç½®å›å¤æ¨¡æ¿
  ],
};
```

---

## 6. API æ¥å£è®¾è®¡

### 6.1 åé¦ˆ API

```typescript
// ===== å®¢æˆ·ç«¯ API =====

// æäº¤åé¦ˆ
POST /api/feedback
Request:
{
  category: FeedbackCategory;
  description: string;
  contactEmail?: string;
  attachmentUrls?: string[];
  diagnosticInfo: DiagnosticInfo;
  context?: FeedbackContext;
}
Response:
{
  id: string;
  ticketNumber: string;
  status: 'RECEIVED';
  message: string;
}

// ä¸Šä¼ é™„ä»¶
POST /api/feedback/attachments
Request: FormData { file: File }
Response:
{
  url: string;
  key: string;
}

// è·å–åé¦ˆå†å²
GET /api/feedback/history
Response:
{
  data: Feedback[];
  pagination: Pagination;
}

// ===== Dashboard API =====

// åé¦ˆåˆ—è¡¨
GET /api/admin/feedback
Query: { page, limit, status, category, search }
Response:
{
  data: Feedback[];
  pagination: Pagination;
}

// åé¦ˆè¯¦æƒ…
GET /api/admin/feedback/:id
Response: FeedbackDetail

// è½¬ä¸ºå·¥å•
POST /api/admin/feedback/:id/convert-to-ticket
Request:
{
  priority?: TicketPriority;
  assigneeId?: string;
  additionalNote?: string;
}
Response: Ticket
```

### 6.2 å·¥å• API

```typescript
// ===== Dashboard API =====

// å·¥å•åˆ—è¡¨
GET /api/admin/tickets
Query: {
  page: number;
  limit: number;
  status?: TicketStatus | TicketStatus[];
  priority?: TicketPriority;
  category?: FeedbackCategory;
  assigneeId?: string;
  userId?: string;
  search?: string;
  slaWarning?: boolean;
  createdAfter?: string;
  createdBefore?: string;
}
Response:
{
  data: Ticket[];
  pagination: Pagination;
  stats: {
    total: number;
    byStatus: Record<TicketStatus, number>;
    byPriority: Record<TicketPriority, number>;
  };
}

// å·¥å•è¯¦æƒ…
GET /api/admin/tickets/:id
Response: TicketDetail

// æ›´æ–°å·¥å•
PATCH /api/admin/tickets/:id
Request:
{
  status?: TicketStatus;
  priority?: TicketPriority;
  assigneeId?: string;
  category?: FeedbackCategory;
  tags?: string[];
}

// æ·»åŠ å›å¤
POST /api/admin/tickets/:id/messages
Request:
{
  content: string;
  isInternal: boolean;
  attachments?: string[];
}

// è·å–æ¶ˆæ¯å†å²
GET /api/admin/tickets/:id/messages
Response:
{
  data: TicketMessage[];
}

// åˆ†é…å·¥å•
POST /api/admin/tickets/:id/assign
Request:
{
  assigneeId: string;
  note?: string;
}

// å‡çº§å·¥å•
POST /api/admin/tickets/:id/escalate
Request:
{
  reason: string;
  targetTeam?: string;
}

// åˆå¹¶å·¥å•
POST /api/admin/tickets/:id/merge
Request:
{
  targetTicketId: string;
  reason?: string;
}

// æ‰¹é‡æ›´æ–°
POST /api/admin/tickets/bulk-update
Request:
{
  ticketIds: string[];
  updates: {
    status?: TicketStatus;
    priority?: TicketPriority;
    assigneeId?: string;
  };
}

// è·å– AI å›å¤å»ºè®®
GET /api/admin/tickets/:id/suggestions
Response:
{
  suggestions: string[];
}

// å·¥å•ç»Ÿè®¡
GET /api/admin/tickets/stats
Query: { period: 'day' | 'week' | 'month' }
Response:
{
  overview: {
    totalTickets: number;
    openTickets: number;
    resolvedToday: number;
    avgResolutionTime: number;
    slaComplianceRate: number;
  };
  byCategory: Record<string, number>;
  byPriority: Record<string, number>;
  byAgent: AgentStats[];
  trends: TrendData[];
}
```

### 6.3 è®¢å• API

```typescript
// ===== Dashboard API =====

// è®¢å•åˆ—è¡¨
GET /api/admin/orders
Query: {
  page: number;
  limit: number;
  status?: OrderStatus;
  userId?: string;
  productId?: string;
  source?: SubscriptionSource;
  createdAfter?: string;
  createdBefore?: string;
}
Response:
{
  data: Order[];
  pagination: Pagination;
}

// è®¢å•è¯¦æƒ…
GET /api/admin/orders/:id
Response: OrderDetail

// è·å–ç”¨æˆ·è®¢å•
GET /api/admin/users/:userId/orders
Response:
{
  data: Order[];
  pagination: Pagination;
}

// å‘èµ·é€€æ¬¾
POST /api/admin/orders/:id/refund
Request:
{
  type: 'APPLE_REFUND' | 'CREDIT' | 'EXTEND';
  amount?: number;
  extensionDays?: number;
  reason: string;
  internalNote?: string;
}
Response:
{
  refundRequestId: string;
  status: RefundRequestStatus;
}

// å»¶é•¿è®¢é˜…
POST /api/admin/orders/:id/extend
Request:
{
  days: number;
  reason: string;
}

// é‡å‘æ”¶æ®
POST /api/admin/orders/:id/resend-receipt
Response:
{
  sent: boolean;
}

// é€€æ¬¾è¯·æ±‚åˆ—è¡¨
GET /api/admin/refund-requests
Query: { page, limit, status, orderId }
Response:
{
  data: RefundRequest[];
  pagination: Pagination;
}

// è®¢å•ç»Ÿè®¡
GET /api/admin/orders/stats
Query: { period: 'day' | 'week' | 'month' }
Response:
{
  revenue: {
    total: number;
    recurring: number;
    new: number;
  };
  subscriptions: {
    active: number;
    trial: number;
    cancelled: number;
    churned: number;
  };
  refunds: {
    count: number;
    amount: number;
    rate: number;
  };
  trends: TrendData[];
}
```

---

## 7. æ•°æ®æ¨¡å‹è®¾è®¡

### 7.1 å®Œæ•´æ•°æ®æ¨¡å‹

```prisma
// ===== åé¦ˆæ¨¡å‹ =====
model Feedback {
  id          String   @id @default(uuid())
  userId      String?
  user        User?    @relation(fields: [userId], references: [id])

  // åé¦ˆå†…å®¹
  category    FeedbackCategory
  description String
  contactEmail String?

  // é™„ä»¶
  attachments FeedbackAttachment[]

  // è¯Šæ–­ä¿¡æ¯
  diagnosticInfo Json?

  // ä¸Šä¸‹æ–‡
  context     Json?    // FeedbackContext

  // çŠ¶æ€
  status      FeedbackStatus @default(NEW)

  // è½¬å·¥å•
  convertedToTicketId String?
  convertedToTicket   Ticket? @relation(fields: [convertedToTicketId], references: [id])

  // å¤„ç†
  processedBy   String?
  processedAt   DateTime?
  processorNote String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@index([status])
  @@index([category])
  @@index([createdAt])
}

model FeedbackAttachment {
  id         String   @id @default(uuid())
  feedbackId String
  feedback   Feedback @relation(fields: [feedbackId], references: [id], onDelete: Cascade)

  url        String
  key        String
  filename   String
  mimeType   String
  size       Int

  createdAt  DateTime @default(now())

  @@index([feedbackId])
}

enum FeedbackCategory {
  BUG
  FEATURE_NOT_WORKING
  BOOK_CONTENT
  TRANSLATION
  AI_RESPONSE
  SUBSCRIPTION
  PAYMENT
  REFUND
  ACCOUNT
  LOGIN
  DATA_SYNC
  FEATURE_REQUEST
  IMPROVEMENT
  OTHER
}

enum FeedbackStatus {
  NEW
  PROCESSING
  CONVERTED_TO_TICKET
  RESOLVED
  SPAM
}

// ===== å·¥å•æ¨¡å‹ =====
model Ticket {
  id            String   @id @default(uuid())
  ticketNumber  String   @unique // æ ¼å¼: TK-20241215-0001

  userId        String
  user          User     @relation(fields: [userId], references: [id])

  // å·¥å•å†…å®¹
  subject       String
  description   String
  category      FeedbackCategory

  // çŠ¶æ€
  status        TicketStatus   @default(NEW)
  priority      TicketPriority @default(MEDIUM)

  // åˆ†é…
  assigneeId    String?
  assignee      Admin?   @relation("TicketAssignee", fields: [assigneeId], references: [id])

  // æ¥æº
  source        TicketSource
  sourceFeedbackId String?
  sourceFeedback   Feedback? @relation(fields: [sourceFeedbackId], references: [id])

  // SLA
  firstResponseAt  DateTime?
  firstResponseDue DateTime?
  resolutionDue    DateTime?
  resolvedAt       DateTime?
  closedAt         DateTime?

  // é™„ä»¶å’Œè¯Šæ–­ä¿¡æ¯
  attachments      TicketAttachment[]
  diagnosticInfo   Json?

  // æ¶ˆæ¯
  messages         TicketMessage[]

  // æ ‡ç­¾
  tags             String[]

  // å…³è”è®¢å•
  relatedOrders    Order[]

  // å‡çº§
  escalatedAt      DateTime?
  escalatedTo      String?
  escalationReason String?

  // åˆå¹¶
  mergedIntoId     String?
  mergedInto       Ticket?  @relation("TicketMerge", fields: [mergedIntoId], references: [id])
  mergedTickets    Ticket[] @relation("TicketMerge")

  // å†å²
  history          TicketHistory[]

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([userId])
  @@index([status])
  @@index([priority])
  @@index([assigneeId])
  @@index([createdAt])
  @@index([firstResponseDue])
  @@index([resolutionDue])
}

model TicketMessage {
  id          String   @id @default(uuid())
  ticketId    String
  ticket      Ticket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  // å‘é€è€…
  senderId    String?  // null = ç³»ç»Ÿæ¶ˆæ¯
  senderType  MessageSenderType

  // å†…å®¹
  content     String
  isInternal  Boolean  @default(false) // å†…éƒ¨å¤‡æ³¨

  // é™„ä»¶
  attachments String[] // URLs

  // é€šçŸ¥çŠ¶æ€
  notifiedAt  DateTime?

  createdAt   DateTime @default(now())

  @@index([ticketId])
  @@index([createdAt])
}

model TicketHistory {
  id          String   @id @default(uuid())
  ticketId    String
  ticket      Ticket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  // å˜æ›´ä¿¡æ¯
  action      TicketAction
  field       String?
  oldValue    String?
  newValue    String?

  // æ“ä½œè€…
  actorId     String?
  actorType   ActorType

  createdAt   DateTime @default(now())

  @@index([ticketId])
  @@index([createdAt])
}

model TicketAttachment {
  id         String   @id @default(uuid())
  ticketId   String
  ticket     Ticket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  url        String
  key        String
  filename   String
  mimeType   String
  size       Int

  createdAt  DateTime @default(now())

  @@index([ticketId])
}

enum TicketStatus {
  NEW
  AUTO_REPLIED
  ASSIGNED
  IN_PROGRESS
  PENDING
  ON_HOLD
  ESCALATED
  RESOLVED
  CLOSED
  SPAM
  DUPLICATE
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TicketSource {
  USER_FEEDBACK
  EMAIL
  SYSTEM
  ADMIN
}

enum MessageSenderType {
  USER
  AGENT
  SYSTEM
}

enum TicketAction {
  CREATED
  STATUS_CHANGED
  PRIORITY_CHANGED
  ASSIGNED
  ESCALATED
  MERGED
  MESSAGE_ADDED
  RESOLVED
  CLOSED
  REOPENED
}

enum ActorType {
  USER
  AGENT
  SYSTEM
}

// ===== è®¢å•æ¨¡å‹ =====
model Order {
  id            String   @id @default(uuid())
  orderNumber   String   @unique // æ ¼å¼: ORD-20241215-0001

  userId        String
  user          User     @relation(fields: [userId], references: [id])

  // äº§å“ä¿¡æ¯
  productId     String   // com.readmigo.pro.yearly
  productName   String
  planType      PlanType

  // é‡‘é¢
  amount        Decimal  @db.Decimal(10, 2)
  currency      String   @default("USD")

  // çŠ¶æ€
  status        OrderStatus @default(ACTIVE)

  // æ¥æº
  source        SubscriptionSource

  // æ—¶é—´
  startedAt     DateTime
  expiresAt     DateTime?
  cancelledAt   DateTime?
  refundedAt    DateTime?

  // Apple ä¿¡æ¯
  appleOriginalTransactionId String?
  appleTransactionId         String?
  appleEnvironment           AppleEnvironment?
  appleProductId             String?

  // äº¤æ˜“è®°å½•
  transactions  Transaction[]

  // é€€æ¬¾è¯·æ±‚
  refundRequests RefundRequest[]

  // å…³è”å·¥å•
  relatedTickets Ticket[]

  // å…³è”è®¢é˜…
  subscriptionId String?
  subscription   Subscription? @relation(fields: [subscriptionId], references: [id])

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([userId])
  @@index([status])
  @@index([appleOriginalTransactionId])
  @@index([createdAt])
}

model Transaction {
  id          String   @id @default(uuid())
  orderId     String
  order       Order    @relation(fields: [orderId], references: [id])

  // äº¤æ˜“ç±»å‹
  type        TransactionType

  // é‡‘é¢
  amount      Decimal  @db.Decimal(10, 2)
  currency    String   @default("USD")

  // Apple äº¤æ˜“ ID
  appleTransactionId String?

  // çŠ¶æ€
  status      TransactionStatus @default(COMPLETED)
  failureReason String?

  createdAt   DateTime @default(now())

  @@index([orderId])
  @@index([createdAt])
}

model RefundRequest {
  id          String   @id @default(uuid())
  orderId     String
  order       Order    @relation(fields: [orderId], references: [id])
  userId      String

  // é€€æ¬¾ç±»å‹
  type        RefundType

  // é‡‘é¢/è¡¥å¿
  amount      Decimal? @db.Decimal(10, 2)
  extensionDays Int?

  // åŸå› 
  reason      String
  internalNote String?

  // çŠ¶æ€
  status      RefundRequestStatus @default(PENDING)
  failureReason String?

  // Apple é€€æ¬¾ ID
  appleRefundId String?

  // å¤„ç†ä¿¡æ¯
  requestedBy String   // Admin ID
  processedBy String?
  processedAt DateTime?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([orderId])
  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

enum OrderStatus {
  ACTIVE
  COMPLETED
  PENDING_PAYMENT
  PAYMENT_FAILED
  REFUND_REQUESTED
  REFUNDED
  PARTIALLY_REFUNDED
  CANCELLED
  REVOKED
}

enum TransactionType {
  INITIAL_PURCHASE
  RENEWAL
  UPGRADE
  DOWNGRADE
  REFUND
  REVOKE
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum RefundType {
  APPLE_REFUND
  CREDIT
  EXTEND_SUBSCRIPTION
}

enum RefundRequestStatus {
  PENDING
  PROCESSING
  COMPLETED
  REJECTED
  FAILED
  CANCELLED
}

// ===== å›å¤æ¨¡æ¿ =====
model ReplyTemplate {
  id          String   @id @default(uuid())

  name        String
  category    FeedbackCategory?
  content     String
  variables   String[] // å¯ç”¨å˜é‡: {{user_name}}, {{order_id}} ç­‰

  isActive    Boolean  @default(true)

  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@index([isActive])
}

// ===== å®¢æœäººå‘˜ =====
model Admin {
  id          String   @id @default(uuid())

  email       String   @unique
  name        String
  role        AdminRole

  // å®¢æœä¸“å±å­—æ®µ
  supportRole SupportRole?
  skills      FeedbackCategory[]
  languages   String[]
  maxTickets  Int      @default(20) // æœ€å¤§åŒæ—¶å¤„ç†å·¥å•æ•°

  isActive    Boolean  @default(true)

  // ç»Ÿè®¡
  totalTicketsHandled   Int @default(0)
  avgResolutionTime     Int? // åˆ†é’Ÿ
  customerSatisfaction  Float?

  assignedTickets Ticket[] @relation("TicketAssignee")

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([supportRole])
  @@index([isActive])
}

enum AdminRole {
  SUPER_ADMIN
  ADMIN
  EDITOR
  SUPPORT_ADMIN
  SUPPORT_LEAD
  SUPPORT_AGENT
}

enum SupportRole {
  SUPPORT_AGENT
  SUPPORT_LEAD
  SUPPORT_ADMIN
}
```

---

## 8. é€šçŸ¥ä¸æ²Ÿé€š

### 8.1 é€šçŸ¥æ¸ é“

```typescript
// é€šçŸ¥ç±»å‹å’Œæ¸ é“é…ç½®
const notificationConfig: Record<NotificationType, NotificationChannels> = {
  // å·¥å•ç›¸å…³
  TICKET_CREATED: {
    email: true,       // å‘é€ç¡®è®¤é‚®ä»¶ç»™ç”¨æˆ·
    push: false,
    inApp: true,
  },
  TICKET_REPLIED: {
    email: true,       // å®¢æœå›å¤æ—¶é€šçŸ¥ç”¨æˆ·
    push: true,
    inApp: true,
  },
  TICKET_RESOLVED: {
    email: true,
    push: true,
    inApp: true,
  },
  TICKET_SLA_WARNING: {
    email: false,
    push: false,
    inApp: false,
    slack: true,       // é€šçŸ¥å®¢æœå›¢é˜Ÿ
  },

  // è®¢å•ç›¸å…³
  ORDER_CREATED: {
    email: true,       // å‘é€æ”¶æ®
    push: false,
    inApp: true,
  },
  SUBSCRIPTION_EXPIRING: {
    email: true,
    push: true,
    inApp: true,
  },
  REFUND_PROCESSED: {
    email: true,
    push: true,
    inApp: true,
  },
};

// é‚®ä»¶æ¨¡æ¿
const emailTemplates = {
  TICKET_CREATED: {
    subject: '[Readmigo] æˆ‘ä»¬æ”¶åˆ°äº†æ‚¨çš„åé¦ˆ #{{ticketNumber}}',
    template: 'ticket-created',
  },
  TICKET_REPLIED: {
    subject: '[Readmigo] æ‚¨çš„åé¦ˆæœ‰æ–°å›å¤ #{{ticketNumber}}',
    template: 'ticket-replied',
  },
  TICKET_RESOLVED: {
    subject: '[Readmigo] æ‚¨çš„é—®é¢˜å·²è§£å†³ #{{ticketNumber}}',
    template: 'ticket-resolved',
  },
  REFUND_PROCESSED: {
    subject: '[Readmigo] é€€æ¬¾å¤„ç†é€šçŸ¥',
    template: 'refund-processed',
  },
};
```

### 8.2 é‚®ä»¶æ¨¡æ¿ç¤ºä¾‹

```html
<!-- templates/ticket-replied.html -->
<!DOCTYPE html>
<html>
<head>
  <style>
    /* é‚®ä»¶æ ·å¼ */
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="{{logoUrl}}" alt="Readmigo" />
    </div>

    <div class="content">
      <h2>æ‚¨å¥½ï¼Œ{{userName}}ï¼</h2>

      <p>æ‚¨çš„åé¦ˆ <strong>#{{ticketNumber}}</strong> æœ‰äº†æ–°çš„å›å¤ï¼š</p>

      <div class="message-box">
        <div class="agent-info">
          <img src="{{agentAvatar}}" alt="{{agentName}}" />
          <span>{{agentName}}</span>
          <span class="time">{{replyTime}}</span>
        </div>
        <div class="message-content">
          {{replyContent}}
        </div>
      </div>

      <p>å¦‚æœé—®é¢˜å·²è§£å†³ï¼Œæ‚¨å¯ä»¥å¿½ç•¥æ­¤é‚®ä»¶ã€‚å¦‚éœ€ç»§ç»­æ²Ÿé€šï¼Œè¯·ç›´æ¥å›å¤æ­¤é‚®ä»¶ã€‚</p>

      <a href="{{ticketUrl}}" class="button">æŸ¥çœ‹è¯¦æƒ…</a>
    </div>

    <div class="footer">
      <p>æ­¤é‚®ä»¶ç”± Readmigo è‡ªåŠ¨å‘é€ï¼Œè¯·å‹¿ç›´æ¥å›å¤ã€‚</p>
      <p>å¦‚æœ‰ç–‘é—®ï¼Œè¯·è®¿é—® <a href="{{helpUrl}}">å¸®åŠ©ä¸­å¿ƒ</a></p>
    </div>
  </div>
</body>
</html>
```

---

## 9. è¿è¥ä¸åˆ†æ

### 9.1 å…³é”®æŒ‡æ ‡

```typescript
// å®¢æœå›¢é˜Ÿ KPI
interface SupportMetrics {
  // å“åº”æŒ‡æ ‡
  avgFirstResponseTime: number;     // å¹³å‡é¦–æ¬¡å“åº”æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
  avgResolutionTime: number;        // å¹³å‡è§£å†³æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
  firstResponseSLARate: number;     // é¦–å“ SLA è¾¾æˆç‡
  resolutionSLARate: number;        // è§£å†³ SLA è¾¾æˆç‡

  // å·¥ä½œé‡æŒ‡æ ‡
  ticketsCreated: number;           // æ–°å»ºå·¥å•æ•°
  ticketsResolved: number;          // è§£å†³å·¥å•æ•°
  ticketsReopened: number;          // é‡å¼€å·¥å•æ•°
  backlogSize: number;              // ç§¯å‹å·¥å•æ•°

  // è´¨é‡æŒ‡æ ‡
  customerSatisfaction: number;     // å®¢æˆ·æ»¡æ„åº¦ (CSAT)
  firstContactResolutionRate: number; // ä¸€æ¬¡è§£å†³ç‡
  escalationRate: number;           // å‡çº§ç‡

  // æ•ˆç‡æŒ‡æ ‡
  ticketsPerAgent: number;          // äººå‡å¤„ç†é‡
  avgHandleTime: number;            // å¹³å‡å¤„ç†æ—¶é•¿
}

// è®¢å•æŒ‡æ ‡
interface OrderMetrics {
  // æ”¶å…¥æŒ‡æ ‡
  totalRevenue: number;
  newRevenue: number;
  renewalRevenue: number;
  mrr: number;                      // æœˆåº¦ç»å¸¸æ€§æ”¶å…¥
  arr: number;                      // å¹´åº¦ç»å¸¸æ€§æ”¶å…¥

  // è®¢é˜…æŒ‡æ ‡
  activeSubscriptions: number;
  newSubscriptions: number;
  churnedSubscriptions: number;
  churnRate: number;
  conversionRate: number;

  // é€€æ¬¾æŒ‡æ ‡
  refundCount: number;
  refundAmount: number;
  refundRate: number;
}
```

### 9.2 Dashboard æŠ¥è¡¨

```tsx
// apps/dashboard/src/pages/support/dashboard.tsx
export const SupportDashboard = () => {
  const { data: stats } = useQuery('support-stats');

  return (
    <Box>
      <Typography variant="h5" sx={{ mb: 3 }}>å®¢æœæ¦‚è§ˆ</Typography>

      {/* ä»Šæ—¥æ¦‚è¦ */}
      <Grid container spacing={3}>
        <Grid item xs={3}>
          <StatCard
            title="ä»Šæ—¥æ–°å·¥å•"
            value={stats.todayNewTickets}
            trend={stats.todayNewTicketsTrend}
            icon={<InboxIcon />}
          />
        </Grid>
        <Grid item xs={3}>
          <StatCard
            title="ä»Šæ—¥å·²è§£å†³"
            value={stats.todayResolvedTickets}
            trend={stats.todayResolvedTicketsTrend}
            icon={<CheckCircleIcon />}
            color="success"
          />
        </Grid>
        <Grid item xs={3}>
          <StatCard
            title="å¾…å¤„ç†"
            value={stats.pendingTickets}
            icon={<PendingIcon />}
            color="warning"
          />
        </Grid>
        <Grid item xs={3}>
          <StatCard
            title="SLA è¾¾æˆç‡"
            value={`${stats.slaComplianceRate}%`}
            trend={stats.slaComplianceRateTrend}
            icon={<SpeedIcon />}
            color={stats.slaComplianceRate > 90 ? 'success' : 'error'}
          />
        </Grid>
      </Grid>

      {/* ç´§æ€¥å·¥å• */}
      <Card sx={{ mt: 3 }}>
        <CardHeader
          title="éœ€è¦å…³æ³¨"
          avatar={<WarningIcon color="error" />}
        />
        <CardContent>
          <List>
            {stats.urgentTickets.map(ticket => (
              <ListItem key={ticket.id}>
                <ListItemText
                  primary={`#${ticket.ticketNumber}: ${ticket.subject}`}
                  secondary={`${ticket.slaStatus} - ${ticket.waitingTime}`}
                />
                <Button size="small" onClick={() => goToTicket(ticket.id)}>
                  å¤„ç†
                </Button>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* å›¾è¡¨ */}
      <Grid container spacing={3} sx={{ mt: 1 }}>
        <Grid item xs={6}>
          <Card>
            <CardHeader title="å·¥å•è¶‹åŠ¿" />
            <CardContent>
              <TicketTrendChart data={stats.ticketTrend} />
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={6}>
          <Card>
            <CardHeader title="åˆ†ç±»åˆ†å¸ƒ" />
            <CardContent>
              <CategoryPieChart data={stats.categoryDistribution} />
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* å®¢æœå·¥ä½œé‡ */}
      <Card sx={{ mt: 3 }}>
        <CardHeader title="å›¢é˜Ÿå·¥ä½œé‡" />
        <CardContent>
          <AgentWorkloadTable data={stats.agentWorkload} />
        </CardContent>
      </Card>
    </Box>
  );
};
```

---

## 10. å®æ–½è®¡åˆ’

### Phase 1: åŸºç¡€åé¦ˆç³»ç»Ÿ

**ç›®æ ‡**: ç”¨æˆ·å¯ä»¥åœ¨ App å†…æäº¤åé¦ˆï¼Œåå°å¯ä»¥æŸ¥çœ‹

**ä»»åŠ¡æ¸…å•**:

#### 1.1 æ•°æ®åº“è®¾è®¡
- [ ] åˆ›å»º Feedback æ¨¡å‹
- [ ] åˆ›å»º FeedbackAttachment æ¨¡å‹
- [ ] æ·»åŠ ç›¸å…³æšä¸¾ï¼ˆFeedbackCategory, FeedbackStatusï¼‰
- [ ] è¿è¡Œæ•°æ®åº“è¿ç§»

#### 1.2 åç«¯ API
- [ ] åˆ›å»º FeedbackModule
- [ ] å®ç° FeedbackService
  - [ ] `createFeedback()` - åˆ›å»ºåé¦ˆ
  - [ ] `uploadAttachment()` - ä¸Šä¼ é™„ä»¶åˆ° R2
  - [ ] `getUserFeedbackHistory()` - è·å–ç”¨æˆ·åé¦ˆå†å²
- [ ] å®ç° FeedbackController
  - [ ] `POST /api/feedback` - æäº¤åé¦ˆ
  - [ ] `POST /api/feedback/attachments` - ä¸Šä¼ é™„ä»¶
  - [ ] `GET /api/feedback/history` - è·å–å†å²
- [ ] å®ç° Admin FeedbackController
  - [ ] `GET /api/admin/feedback` - åé¦ˆåˆ—è¡¨
  - [ ] `GET /api/admin/feedback/:id` - åé¦ˆè¯¦æƒ…
  - [ ] `PATCH /api/admin/feedback/:id` - æ›´æ–°çŠ¶æ€

#### 1.3 iOS å®¢æˆ·ç«¯
- [ ] åˆ›å»º FeedbackViewï¼ˆåé¦ˆè¡¨å•ï¼‰
- [ ] åˆ›å»º FeedbackViewModel
- [ ] åˆ›å»º FeedbackService
- [ ] å®ç°è¯Šæ–­ä¿¡æ¯æ”¶é›†ï¼ˆDiagnosticInfoï¼‰
- [ ] å®ç°å›¾ç‰‡é€‰æ‹©å’Œä¸Šä¼ 
- [ ] æ·»åŠ åé¦ˆå…¥å£ï¼ˆè®¾ç½®é¡µã€é˜…è¯»å™¨ã€é”™è¯¯å¼¹çª—ï¼‰
- [ ] æ·»åŠ  QuickFeedbackSheetï¼ˆå¿«é€Ÿåé¦ˆï¼‰

#### 1.4 Dashboard ç®¡ç†
- [ ] åˆ›å»ºåé¦ˆåˆ—è¡¨é¡µ `/feedback`
- [ ] åˆ›å»ºåé¦ˆè¯¦æƒ…é¡µ `/feedback/:id`
- [ ] å®ç°ç­›é€‰å’Œæœç´¢
- [ ] å®ç°çŠ¶æ€æ›´æ–°æ“ä½œ

#### 1.5 é‚®ä»¶é€šçŸ¥
- [ ] é…ç½®é‚®ä»¶æœåŠ¡ï¼ˆSendGrid/Resendï¼‰
- [ ] åˆ›å»ºé‚®ä»¶æ¨¡æ¿ï¼šåé¦ˆå·²æ”¶åˆ°
- [ ] å®ç°è‡ªåŠ¨å‘é€ç¡®è®¤é‚®ä»¶

**éªŒæ”¶æ ‡å‡†**:
- [ ] ç”¨æˆ·å¯ä»¥åœ¨ App å†…é€‰æ‹©ç±»å‹ã€å¡«å†™æè¿°ã€ä¸Šä¼ æˆªå›¾æäº¤åé¦ˆ
- [ ] åé¦ˆè‡ªåŠ¨æ”¶é›†è®¾å¤‡å’Œ App ä¿¡æ¯
- [ ] æäº¤åç”¨æˆ·æ”¶åˆ°ç¡®è®¤é‚®ä»¶
- [ ] ç®¡ç†å‘˜å¯ä»¥åœ¨åå°æŸ¥çœ‹æ‰€æœ‰åé¦ˆ
- [ ] ç®¡ç†å‘˜å¯ä»¥æ ‡è®°åé¦ˆçŠ¶æ€

---

### Phase 2: å·¥å•ç³»ç»Ÿ

**ç›®æ ‡**: å°†åé¦ˆè½¬ä¸ºå·¥å•ï¼Œå®ç°å·¥å•å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†

**ä»»åŠ¡æ¸…å•**:

#### 2.1 æ•°æ®åº“è®¾è®¡
- [ ] åˆ›å»º Ticket æ¨¡å‹
- [ ] åˆ›å»º TicketMessage æ¨¡å‹
- [ ] åˆ›å»º TicketHistory æ¨¡å‹
- [ ] åˆ›å»º TicketAttachment æ¨¡å‹
- [ ] æ·»åŠ ç›¸å…³æšä¸¾
- [ ] è¿è¡Œæ•°æ®åº“è¿ç§»

#### 2.2 åç«¯æœåŠ¡
- [ ] åˆ›å»º TicketModule
- [ ] å®ç° TicketService
  - [ ] `createTicket()` - åˆ›å»ºå·¥å•
  - [ ] `convertFromFeedback()` - ä»åé¦ˆè½¬å·¥å•
  - [ ] `updateTicket()` - æ›´æ–°å·¥å•
  - [ ] `addMessage()` - æ·»åŠ æ¶ˆæ¯/å›å¤
  - [ ] `assignTicket()` - åˆ†é…å·¥å•
  - [ ] `escalateTicket()` - å‡çº§å·¥å•
  - [ ] `mergeTickets()` - åˆå¹¶å·¥å•
  - [ ] `getTicketStats()` - ç»Ÿè®¡æ•°æ®
- [ ] å®ç° TicketNumberGeneratorï¼ˆå·¥å•å·ç”Ÿæˆï¼‰
- [ ] å®ç° TicketHistoryServiceï¼ˆæ“ä½œæ—¥å¿—ï¼‰
- [ ] å®ç° Admin TicketController

#### 2.3 å·¥å•åˆ†é…
- [ ] å®ç° TicketAssignmentService
  - [ ] `autoAssign()` - è‡ªåŠ¨åˆ†é…
  - [ ] `getCategoryQueue()` - åˆ†ç±»é˜Ÿåˆ—
  - [ ] `selectAgent()` - é€‰æ‹©å®¢æœï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
  - [ ] `calculateScore()` - è¯„åˆ†ç®—æ³•

#### 2.4 SLA ç›‘æ§
- [ ] å®ç° SLAService
  - [ ] `calculateDueDates()` - è®¡ç®— SLA æˆªæ­¢æ—¶é—´
  - [ ] `checkSLABreaches()` - æ£€æŸ¥ SLA è¿è§„
  - [ ] `sendSLAWarnings()` - å‘é€é¢„è­¦
- [ ] åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼šæ¯ 5 åˆ†é’Ÿæ£€æŸ¥ SLA
- [ ] å®ç°è‡ªåŠ¨å‡çº§é€»è¾‘

#### 2.5 Dashboard å·¥å•ç®¡ç†
- [ ] åˆ›å»ºå·¥å•åˆ—è¡¨é¡µ `/tickets`
  - [ ] å®ç°å¤šç»´åº¦ç­›é€‰
  - [ ] å®ç°æ‰¹é‡æ“ä½œ
  - [ ] æ˜¾ç¤º SLA çŠ¶æ€
- [ ] åˆ›å»ºå·¥å•è¯¦æƒ…é¡µ `/tickets/:id`
  - [ ] å·¥å•ä¿¡æ¯å±•ç¤º
  - [ ] å¯¹è¯è®°å½•
  - [ ] å›å¤è¡¨å•ï¼ˆæ”¯æŒå¿«æ·å›å¤ã€å†…éƒ¨å¤‡æ³¨ï¼‰
  - [ ] æ“ä½œé¢æ¿ï¼ˆçŠ¶æ€ã€ä¼˜å…ˆçº§ã€åˆ†é…ï¼‰
  - [ ] ç”¨æˆ·ä¿¡æ¯å¡ç‰‡
  - [ ] å·¥å•å†å²

#### 2.6 é‚®ä»¶é€šçŸ¥
- [ ] åˆ›å»ºé‚®ä»¶æ¨¡æ¿ï¼šå®¢æœå·²å›å¤
- [ ] åˆ›å»ºé‚®ä»¶æ¨¡æ¿ï¼šå·¥å•å·²è§£å†³
- [ ] å®ç°å›å¤é€šçŸ¥è‡ªåŠ¨å‘é€

**éªŒæ”¶æ ‡å‡†**:
- [ ] å¯ä»¥å°†åé¦ˆä¸€é”®è½¬ä¸ºå·¥å•
- [ ] å·¥å•è‡ªåŠ¨åˆ†é…ç»™åˆé€‚çš„å®¢æœ
- [ ] å®¢æœå¯ä»¥å›å¤å·¥å•ï¼Œç”¨æˆ·æ”¶åˆ°é‚®ä»¶é€šçŸ¥
- [ ] SLA ç›‘æ§æ­£å¸¸å·¥ä½œï¼Œè¶…æ—¶å·¥å•è‡ªåŠ¨é¢„è­¦
- [ ] æ”¯æŒå·¥å•å‡çº§ã€åˆå¹¶æ“ä½œ

---

### Phase 3: è®¢å•ç®¡ç†ç³»ç»Ÿ

**ç›®æ ‡**: å®¢æœå¯ä»¥æŸ¥çœ‹å’Œç®¡ç†ç”¨æˆ·è®¢å•ï¼Œå¤„ç†é€€æ¬¾

**ä»»åŠ¡æ¸…å•**:

#### 3.1 æ•°æ®åº“è®¾è®¡
- [ ] åˆ›å»º/æ›´æ–° Order æ¨¡å‹ï¼ˆå¦‚å·²æœ‰åˆ™æ‰©å±•ï¼‰
- [ ] åˆ›å»º Transaction æ¨¡å‹
- [ ] åˆ›å»º RefundRequest æ¨¡å‹
- [ ] æ·»åŠ ç›¸å…³æšä¸¾
- [ ] è¿è¡Œæ•°æ®åº“è¿ç§»

#### 3.2 åç«¯æœåŠ¡
- [ ] åˆ›å»º/æ‰©å±• OrderModule
- [ ] å®ç° OrderService
  - [ ] `syncFromApple()` - Apple è®¢å•åŒæ­¥
  - [ ] `getUserOrders()` - ç”¨æˆ·è®¢å•åˆ—è¡¨
  - [ ] `getOrderDetail()` - è®¢å•è¯¦æƒ…
  - [ ] `createTransaction()` - åˆ›å»ºäº¤æ˜“è®°å½•
- [ ] å®ç° RefundService
  - [ ] `createRefundRequest()` - åˆ›å»ºé€€æ¬¾è¯·æ±‚
  - [ ] `initiateAppleRefund()` - å‘èµ· Apple é€€æ¬¾
  - [ ] `issueCredit()` - å‘æ”¾ç§¯åˆ†è¡¥å¿
  - [ ] `extendSubscription()` - å»¶é•¿è®¢é˜…
- [ ] æ‰©å±• Apple Webhook å¤„ç†ï¼ˆREFUND äº‹ä»¶ï¼‰

#### 3.3 Dashboard è®¢å•ç®¡ç†
- [ ] åˆ›å»ºè®¢å•åˆ—è¡¨é¡µ `/orders`
- [ ] åˆ›å»ºè®¢å•è¯¦æƒ…é¡µ `/orders/:id`
  - [ ] è®¢å•åŸºæœ¬ä¿¡æ¯
  - [ ] Apple äº¤æ˜“ä¿¡æ¯
  - [ ] äº¤æ˜“å†å²æ—¶é—´çº¿
  - [ ] é€€æ¬¾è®°å½•
  - [ ] æ“ä½œæŒ‰é’®ï¼ˆé€€æ¬¾ã€å»¶æœŸã€åˆ›å»ºå·¥å•ï¼‰
- [ ] åˆ›å»ºé€€æ¬¾å¯¹è¯æ¡†ç»„ä»¶
- [ ] åˆ›å»ºå»¶é•¿è®¢é˜…å¯¹è¯æ¡†ç»„ä»¶
- [ ] åˆ›å»ºé€€æ¬¾è¯·æ±‚åˆ—è¡¨é¡µ `/refund-requests`

#### 3.4 ç”¨æˆ·è®¢å•å…³è”
- [ ] å·¥å•è¯¦æƒ…é¡µæ˜¾ç¤ºç”¨æˆ·è®¢å•
- [ ] ç”¨æˆ·è¯¦æƒ…é¡µæ˜¾ç¤ºè®¢å•å†å²

**éªŒæ”¶æ ‡å‡†**:
- [ ] å®¢æœå¯ä»¥æŸ¥çœ‹ç”¨æˆ·æ‰€æœ‰è®¢å•å’Œäº¤æ˜“å†å²
- [ ] å®¢æœå¯ä»¥å‘èµ·é€€æ¬¾è¯·æ±‚ï¼ˆApple é€€æ¬¾/ç§¯åˆ†è¡¥å¿/å»¶æœŸï¼‰
- [ ] é€€æ¬¾çŠ¶æ€è‡ªåŠ¨åŒæ­¥
- [ ] å·¥å•ä¸­å¯ä»¥å¿«é€Ÿå…³è”æŸ¥çœ‹ç›¸å…³è®¢å•

---

### Phase 4: å¢å¼ºåŠŸèƒ½

**ç›®æ ‡**: æå‡å®¢æœæ•ˆç‡å’Œç”¨æˆ·æ»¡æ„åº¦

**ä»»åŠ¡æ¸…å•**:

#### 4.1 è‡ªåŠ¨å›å¤ç³»ç»Ÿ
- [ ] åˆ›å»º AutoReplyService
- [ ] å®ç°å…³é”®è¯åŒ¹é…ç®—æ³•
- [ ] åˆ›å»ºå¸¸è§é—®é¢˜å›å¤æ¨¡æ¿åº“ï¼ˆ20+ æ¨¡æ¿ï¼‰
- [ ] å®ç°è‡ªåŠ¨å›å¤è§¦å‘é€»è¾‘
- [ ] å®ç°è‡ªåŠ¨å…³é—­å®šæ—¶å™¨

#### 4.2 AI å›å¤å»ºè®®
- [ ] å®ç° AISuggestionService
- [ ] æ¥å…¥ Claude API ç”Ÿæˆå›å¤å»ºè®®
- [ ] å·¥å•è¯¦æƒ…é¡µæ˜¾ç¤º AI å»ºè®®
- [ ] æ”¯æŒä¸€é”®é‡‡ç”¨ AI å»ºè®®

#### 4.3 å¿«æ·å›å¤æ¨¡æ¿
- [ ] åˆ›å»º ReplyTemplate æ¨¡å‹
- [ ] å®ç°æ¨¡æ¿ CRUD API
- [ ] Dashboard æ¨¡æ¿ç®¡ç†é¡µé¢
- [ ] å·¥å•å›å¤æ—¶æ˜¾ç¤ºæ¨¡æ¿åˆ—è¡¨
- [ ] æ”¯æŒå˜é‡æ›¿æ¢ï¼ˆç”¨æˆ·åã€è®¢å•å·ç­‰ï¼‰

#### 4.4 å®¢æœæƒé™ç®¡ç†
- [ ] æ‰©å±• Admin æ¨¡å‹ï¼ˆæ·»åŠ å®¢æœå­—æ®µï¼‰
- [ ] å®ç°å®¢æœè§’è‰²æƒé™ï¼ˆAgent/Lead/Adminï¼‰
- [ ] Dashboard å®¢æœäººå‘˜ç®¡ç†é¡µé¢
- [ ] å®ç°æƒé™æ£€æŸ¥ä¸­é—´ä»¶

#### 4.5 æŠ¥è¡¨ç»Ÿè®¡
- [ ] å®ç° SupportStatsService
- [ ] åˆ›å»ºå®¢æœæ¦‚è§ˆä»ªè¡¨ç›˜
- [ ] å®ç°å·¥å•è¶‹åŠ¿å›¾è¡¨
- [ ] å®ç°åˆ†ç±»åˆ†å¸ƒå›¾è¡¨
- [ ] å®ç°å®¢æœå·¥ä½œé‡æŠ¥è¡¨
- [ ] å®ç° SLA è¾¾æˆç‡æŠ¥è¡¨

**éªŒæ”¶æ ‡å‡†**:
- [ ] å¸¸è§é—®é¢˜è‡ªåŠ¨å›å¤ï¼Œå‡å°‘å®¢æœå·¥ä½œé‡
- [ ] AI å¯ä»¥ç”Ÿæˆåˆç†çš„å›å¤å»ºè®®
- [ ] å¿«æ·æ¨¡æ¿æå‡å›å¤æ•ˆç‡
- [ ] ä¸åŒè§’è‰²æœ‰ä¸åŒæƒé™
- [ ] ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å®Œæ•´çš„è¿è¥æŠ¥è¡¨

---

### Phase 5: æŒç»­ä¼˜åŒ–

**ç›®æ ‡**: æŒç»­æå‡æœåŠ¡è´¨é‡å’Œç”¨æˆ·ä½“éªŒ

**ä»»åŠ¡æ¸…å•**:

#### 5.1 å®¢æˆ·æ»¡æ„åº¦è°ƒæŸ¥ï¼ˆCSATï¼‰
- [ ] å·¥å•è§£å†³åå‘é€æ»¡æ„åº¦è°ƒæŸ¥é‚®ä»¶
- [ ] åˆ›å»ºæ»¡æ„åº¦è¯„ä»·é¡µé¢ï¼ˆ1-5æ˜Ÿ + è¯„è®ºï¼‰
- [ ] Dashboard æ»¡æ„åº¦ç»Ÿè®¡å’Œè¶‹åŠ¿
- [ ] ä½åˆ†å·¥å•è‡ªåŠ¨æ ‡è®°è·Ÿè¿›

#### 5.2 çŸ¥è¯†åº“é›†æˆ
- [ ] è®¾è®¡çŸ¥è¯†åº“æ•°æ®æ¨¡å‹
- [ ] åˆ›å»ºçŸ¥è¯†åº“æ–‡ç« ç®¡ç†
- [ ] æäº¤åé¦ˆæ—¶æ¨èç›¸å…³æ–‡ç« 
- [ ] AI å›å¤å»ºè®®å¼•ç”¨çŸ¥è¯†åº“

#### 5.3 å¤šæ¸ é“æ•´åˆ
- [ ] é‚®ä»¶å·¥å•åˆ›å»ºï¼ˆè§£æ support@ é‚®ä»¶ï¼‰
- [ ] App Store è¯„è®ºç›‘æ§å’Œå›å¤
- [ ] ç»Ÿä¸€æ”¶ä»¶ç®±è§†å›¾

#### 5.4 è‡ªåŠ¨åŒ–å·¥ä½œæµ
- [ ] åˆ›å»ºå·¥ä½œæµå¼•æ“
- [ ] æ”¯æŒè‡ªå®šä¹‰è§¦å‘æ¡ä»¶å’ŒåŠ¨ä½œ
- [ ] é¢„è®¾å¸¸ç”¨å·¥ä½œæµæ¨¡æ¿
- [ ] Dashboard å·¥ä½œæµç®¡ç†

#### 5.5 æ€§èƒ½ä¼˜åŒ–
- [ ] å·¥å•åˆ—è¡¨åˆ†é¡µä¼˜åŒ–
- [ ] æ·»åŠ  Redis ç¼“å­˜
- [ ] æ¶ˆæ¯å®æ—¶æ¨é€ï¼ˆWebSocketï¼‰
- [ ] ç§»åŠ¨ç«¯å®¢æœ Appï¼ˆå¯é€‰ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- [ ] CSAT ç³»ç»Ÿæ­£å¸¸è¿è¡Œï¼Œæ”¶é›†åˆ°æ»¡æ„åº¦æ•°æ®
- [ ] çŸ¥è¯†åº“å¸®åŠ©ç”¨æˆ·è‡ªåŠ©è§£å†³é—®é¢˜
- [ ] æ”¯æŒé‚®ä»¶åˆ›å»ºå·¥å•
- [ ] è‡ªåŠ¨åŒ–å·¥ä½œæµå‡å°‘é‡å¤æ“ä½œ

---

## 11. å®æ–½è¿›åº¦

### å½“å‰çŠ¶æ€

| é˜¶æ®µ | çŠ¶æ€ | è¿›åº¦ | è¯´æ˜ |
|------|------|------|------|
| Phase 1: åŸºç¡€åé¦ˆç³»ç»Ÿ | ğŸ“ | 0% | è®¾è®¡å®Œæˆï¼Œå¾…å¼€å‘ |
| Phase 2: å·¥å•ç³»ç»Ÿ | ğŸ“ | 0% | è®¾è®¡å®Œæˆï¼Œå¾…å¼€å‘ |
| Phase 3: è®¢å•ç®¡ç†ç³»ç»Ÿ | ğŸ“ | 0% | è®¾è®¡å®Œæˆï¼Œå¾…å¼€å‘ |
| Phase 4: å¢å¼ºåŠŸèƒ½ | ğŸ“ | 0% | è®¾è®¡å®Œæˆï¼Œå¾…å¼€å‘ |
| Phase 5: æŒç»­ä¼˜åŒ– | ğŸ“ | 0% | è®¾è®¡å®Œæˆï¼Œå¾…å¼€å‘ |

### æ€»ä½“è¿›åº¦

- **è®¾è®¡æ–‡æ¡£**: âœ… 100% å®Œæˆ
- **æ•°æ®æ¨¡å‹**: ğŸ“ 0% - å¾…å®æ–½
- **åç«¯ API**: ğŸ“ 0% - å¾…å®æ–½
- **iOS å®¢æˆ·ç«¯**: ğŸ“ 0% - å¾…å®æ–½
- **Dashboard**: ğŸ“ 0% - å¾…å®æ–½
- **æµ‹è¯•**: ğŸ“ 0% - å¾…å®æ–½

### é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | ç›®æ ‡æ—¥æœŸ | å®é™…æ—¥æœŸ | çŠ¶æ€ |
|--------|----------|----------|------|
| è®¾è®¡æ–‡æ¡£å®Œæˆ | - | 2025-12-27 | âœ… |
| Phase 1 å®Œæˆ | TBD | - | ğŸ“ |
| Phase 2 å®Œæˆ | TBD | - | ğŸ“ |
| Phase 3 å®Œæˆ | TBD | - | ğŸ“ |
| Phase 4 å®Œæˆ | TBD | - | ğŸ“ |
| ç”Ÿäº§ç¯å¢ƒä¸Šçº¿ | TBD | - | ğŸ“ |

---

## é™„å½• Aï¼šå¸¸è§é—®é¢˜è‡ªåŠ¨å›å¤åº“

```typescript
const faqAutoReplies: AutoReplyTemplate[] = [
  // ===== è®¢é˜…ç›¸å…³ =====
  {
    id: 'cancel-subscription',
    keywords: ['å–æ¶ˆè®¢é˜…', 'æ€ä¹ˆå–æ¶ˆ', 'ä¸æƒ³ç»­è´¹', 'cancel subscription', 'unsubscribe'],
    category: FeedbackCategory.SUBSCRIPTION,
    priority: 'high',
    response: `
æ‚¨å¥½ï¼

æ„Ÿè°¢æ‚¨ä½¿ç”¨ Readmigoã€‚è¦å–æ¶ˆè®¢é˜…ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. æ‰“å¼€ iPhoneã€Œè®¾ç½®ã€App
2. ç‚¹å‡»é¡¶éƒ¨çš„æ‚¨çš„ Apple IDï¼ˆæ‚¨çš„åå­—ï¼‰
3. é€‰æ‹©ã€Œè®¢é˜…ã€
4. æ‰¾åˆ° Readmigo å¹¶ç‚¹å‡»
5. é€‰æ‹©ã€Œå–æ¶ˆè®¢é˜…ã€

ğŸ“Œ æ³¨æ„ï¼š
- å–æ¶ˆåï¼Œæ‚¨ä»å¯ä½¿ç”¨ä»˜è´¹åŠŸèƒ½ç›´åˆ°å½“å‰è®¢é˜…æœŸç»“æŸ
- è®¢é˜…åˆ°æœŸåï¼Œæ‚¨çš„é˜…è¯»è¿›åº¦å’Œç¬”è®°ä¼šä¿ç•™ï¼Œä½†é«˜çº§åŠŸèƒ½å°†å—é™

å¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·å›å¤æ­¤é‚®ä»¶ï¼Œæˆ‘ä»¬ä¼šå°½å¿«ä¸ºæ‚¨å¤„ç†ã€‚

Readmigo å›¢é˜Ÿ
    `,
    closeAfterDays: 3,
  },

  {
    id: 'restore-purchase',
    keywords: ['æ¢å¤è´­ä¹°', 'è´­ä¹°è®°å½•', 'restore purchase', 'æ¢æ‰‹æœº', 'æ–°è®¾å¤‡'],
    category: FeedbackCategory.SUBSCRIPTION,
    priority: 'high',
    response: `
æ‚¨å¥½ï¼

è¦æ¢å¤æ‚¨ä¹‹å‰çš„è´­ä¹°ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. æ‰“å¼€ Readmigo App
2. è¿›å…¥ã€Œè®¾ç½®ã€â†’ã€Œè®¢é˜…ã€
3. ç‚¹å‡»ã€Œæ¢å¤è´­ä¹°ã€æŒ‰é’®
4. ä½¿ç”¨è´­ä¹°æ—¶çš„ Apple ID éªŒè¯

âš ï¸ å¦‚æœæ¢å¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ï¼š
- ç¡®ä¿ä½¿ç”¨çš„æ˜¯è´­ä¹°æ—¶çš„åŒä¸€ Apple ID
- ç¡®ä¿ Apple ID å·²ç™»å½•ä¸”å¯æ­£å¸¸ä½¿ç”¨
- ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
- å°è¯•é‡å¯ App åå†è¯•

å¦‚æœé—®é¢˜ä»æœªè§£å†³ï¼Œè¯·å›å¤æ­¤é‚®ä»¶å¹¶æä¾›æ‚¨çš„ Apple ID é‚®ç®±ï¼ˆç”¨äºè´­ä¹°çš„é‚®ç®±ï¼‰ï¼Œæˆ‘ä»¬ä¼šä¸ºæ‚¨äººå·¥æ ¸å®å¤„ç†ã€‚

Readmigo å›¢é˜Ÿ
    `,
    closeAfterDays: 3,
  },

  {
    id: 'subscription-not-working',
    keywords: ['è®¢é˜…äº†ä½†æ˜¯', 'ä»˜è´¹äº†æ²¡æœ‰', 'ä¹°äº†ä½†æ˜¯', 'ä¼šå‘˜ä¸ç”Ÿæ•ˆ', 'paid but'],
    category: FeedbackCategory.SUBSCRIPTION,
    priority: 'urgent',
    response: `
æ‚¨å¥½ï¼

éå¸¸æŠ±æ­‰ç»™æ‚¨å¸¦æ¥ä¸ä¾¿ï¼è¯·å°è¯•ä»¥ä¸‹æ­¥éª¤ï¼š

1. **æ¢å¤è´­ä¹°**ï¼šè¿›å…¥ã€Œè®¾ç½®ã€â†’ã€Œè®¢é˜…ã€â†’ã€Œæ¢å¤è´­ä¹°ã€
2. **é‡å¯ App**ï¼šå®Œå…¨å…³é—­ Readmigo åé‡æ–°æ‰“å¼€
3. **æ£€æŸ¥ Apple ID**ï¼šç¡®ä¿å½“å‰ç™»å½•çš„ Apple ID ä¸è´­ä¹°æ—¶ç›¸åŒ

å¦‚æœä»¥ä¸Šæ­¥éª¤æ— æ³•è§£å†³ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¼šä¼˜å…ˆä¸ºæ‚¨å¤„ç†ï¼š
- æ‚¨çš„ Apple ID é‚®ç®±
- è´­ä¹°æ—¶é—´ï¼ˆå¤§çº¦ï¼‰
- è®¢é˜…ç±»å‹ï¼ˆæœˆåº¦/å¹´åº¦ï¼‰

æˆ‘ä»¬ä¼šåœ¨ 24 å°æ—¶å†…ä¸ºæ‚¨æ ¸å®å¹¶è§£å†³ã€‚

Readmigo å›¢é˜Ÿ
    `,
    closeAfterDays: null, // ä¸è‡ªåŠ¨å…³é—­ï¼Œéœ€è¦äººå·¥è·Ÿè¿›
  },

  // ===== é€€æ¬¾ç›¸å…³ =====
  {
    id: 'refund-request',
    keywords: ['é€€æ¬¾', 'è¦æ±‚é€€æ¬¾', 'ç”³è¯·é€€æ¬¾', 'refund', 'é€€é’±'],
    category: FeedbackCategory.REFUND,
    priority: 'high',
    response: `
æ‚¨å¥½ï¼

æ„Ÿè°¢æ‚¨è”ç³»æˆ‘ä»¬ã€‚å…³äºé€€æ¬¾è¯·æ±‚ï¼Œè¯·äº†è§£ä»¥ä¸‹ä¿¡æ¯ï¼š

ğŸ“Œ **App Store é€€æ¬¾æµç¨‹**ï¼š
ç”±äº Readmigo çš„è®¢é˜…æ˜¯é€šè¿‡ Apple App Store å¤„ç†çš„ï¼Œé€€æ¬¾éœ€è¦é€šè¿‡ Apple ç”³è¯·ï¼š

1. è®¿é—® [reportaproblem.apple.com](https://reportaproblem.apple.com)
2. ä½¿ç”¨æ‚¨çš„ Apple ID ç™»å½•
3. æ‰¾åˆ° Readmigo çš„è´­ä¹°è®°å½•
4. ç‚¹å‡»ã€ŒæŠ¥å‘Šé—®é¢˜ã€å¹¶é€‰æ‹©é€€æ¬¾åŸå› 

Apple é€šå¸¸ä¼šåœ¨ 48 å°æ—¶å†…å¤„ç†é€€æ¬¾è¯·æ±‚ã€‚

ğŸ’¡ **æˆ‘ä»¬å¯ä»¥å¸®æ‚¨**ï¼š
- å¦‚æœæ‚¨é‡åˆ°äº† App é—®é¢˜ï¼Œæˆ‘ä»¬å¾ˆä¹æ„å¸®æ‚¨è§£å†³
- å¦‚æœæ‚¨å¯¹åŠŸèƒ½ä¸æ»¡æ„ï¼Œæˆ‘ä»¬æƒ³å¬å¬æ‚¨çš„åé¦ˆæ¥æ”¹è¿›

è¯·å‘Šè¯‰æˆ‘ä»¬æ‚¨ç”³è¯·é€€æ¬¾çš„åŸå› ï¼Œæˆ‘ä»¬ä¼šå°½åŠ›å¸®åŠ©æ‚¨ã€‚

Readmigo å›¢é˜Ÿ
    `,
    closeAfterDays: 5,
  },

  // ===== è´¦æˆ·é—®é¢˜ =====
  {
    id: 'login-issue',
    keywords: ['ç™»å½•ä¸äº†', 'æ— æ³•ç™»å½•', 'ç™»å½•å¤±è´¥', 'cannot login', 'login failed'],
    category: FeedbackCategory.LOGIN,
    priority: 'high',
    response: `
æ‚¨å¥½ï¼

æŠ±æ­‰æ‚¨é‡åˆ°äº†ç™»å½•é—®é¢˜ã€‚è¯·å°è¯•ä»¥ä¸‹æ­¥éª¤ï¼š

1. **æ£€æŸ¥ç½‘ç»œ**ï¼šç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
2. **é‡å¯ App**ï¼šå®Œå…¨å…³é—­ Readmigo åé‡æ–°æ‰“å¼€
3. **æ›´æ–° App**ï¼šç¡®ä¿æ‚¨ä½¿ç”¨çš„æ˜¯æœ€æ–°ç‰ˆæœ¬
4. **é‡æ–°ç™»å½•**ï¼š
   - å¦‚æœä½¿ç”¨ Apple ç™»å½•ï¼šç¡®ä¿ Apple ID æ­£å¸¸
   - å¦‚æœä½¿ç”¨é‚®ç®±ç™»å½•ï¼šå°è¯•ã€Œå¿˜è®°å¯†ç ã€é‡ç½®

âš ï¸ å¸¸è§é—®é¢˜ï¼š
- å¦‚æœæ˜¾ç¤ºã€Œè´¦å·ä¸å­˜åœ¨ã€ï¼šå¯èƒ½ä¹‹å‰ä½¿ç”¨äº†ä¸åŒçš„ç™»å½•æ–¹å¼
- å¦‚æœæ˜¾ç¤ºã€Œå¯†ç é”™è¯¯ã€ï¼šè¯·å°è¯•é‡ç½®å¯†ç 

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ï¼š
- æ‚¨ä½¿ç”¨çš„ç™»å½•æ–¹å¼ï¼ˆApple/é‚®ç®±ï¼‰
- å…·ä½“çš„é”™è¯¯æç¤ºä¿¡æ¯

æˆ‘ä»¬ä¼šå°½å¿«å¸®æ‚¨è§£å†³ã€‚

Readmigo å›¢é˜Ÿ
    `,
    closeAfterDays: 3,
  },

  {
    id: 'delete-account',
    keywords: ['åˆ é™¤è´¦å·', 'æ³¨é”€è´¦æˆ·', 'delete account', 'åˆ å·'],
    category: FeedbackCategory.ACCOUNT,
    priority: 'medium',
    response: `
æ‚¨å¥½ï¼

æˆ‘ä»¬æ”¶åˆ°äº†æ‚¨çš„è´¦å·åˆ é™¤è¯·æ±‚ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œè¯·äº†è§£ï¼š

âš ï¸ **åˆ é™¤è´¦å·å°†**ï¼š
- æ°¸ä¹…åˆ é™¤æ‚¨çš„æ‰€æœ‰æ•°æ®ï¼ˆé˜…è¯»è¿›åº¦ã€ç¬”è®°ã€ç”Ÿè¯æœ¬ç­‰ï¼‰
- å–æ¶ˆä»»ä½•æœ‰æ•ˆè®¢é˜…
- æ­¤æ“ä½œä¸å¯æ’¤é”€

ğŸ“Œ **å¦‚ä½•åˆ é™¤è´¦å·**ï¼š
1. æ‰“å¼€ Readmigo App
2. è¿›å…¥ã€Œè®¾ç½®ã€â†’ã€Œè´¦æˆ·ã€â†’ã€Œåˆ é™¤è´¦å·ã€
3. æŒ‰ç…§æç¤ºç¡®è®¤åˆ é™¤

ğŸ’¡ **å…¶ä»–é€‰æ‹©**ï¼š
- å¦‚æœåªæ˜¯æƒ³æš‚åœä½¿ç”¨ï¼Œå¯ä»¥ç›´æ¥å¸è½½ Appï¼Œæ•°æ®ä¼šä¿ç•™
- å¦‚æœé‡åˆ°é—®é¢˜æƒ³è§£å†³ï¼Œè¯·å‘Šè¯‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬å¾ˆä¹æ„å¸®åŠ©

ç¡®è®¤è¦åˆ é™¤è´¦å·å—ï¼Ÿè¯·å›å¤ã€Œç¡®è®¤åˆ é™¤ã€ï¼Œæˆ‘ä»¬ä¼šä¸ºæ‚¨å¤„ç†ã€‚

Readmigo å›¢é˜Ÿ
    `,
    closeAfterDays: 7,
  },

  // ===== åŠŸèƒ½é—®é¢˜ =====
  {
    id: 'app-crash',
    keywords: ['é—ªé€€', 'å´©æºƒ', 'crash', 'app crash', 'æ‰“ä¸å¼€'],
    category: FeedbackCategory.BUG,
    priority: 'urgent',
    response: `
æ‚¨å¥½ï¼

éå¸¸æŠ±æ­‰ App å‡ºç°äº†é—®é¢˜ï¼è¯·å°è¯•ä»¥ä¸‹æ­¥éª¤ï¼š

1. **é‡å¯ App**ï¼š
   - å®Œå…¨å…³é—­ Readmigoï¼ˆä¸Šæ»‘å…³é—­ï¼‰
   - é‡æ–°æ‰“å¼€

2. **é‡å¯è®¾å¤‡**ï¼š
   - æœ‰æ—¶å€™é‡å¯æ‰‹æœºå¯ä»¥è§£å†³é—®é¢˜

3. **æ›´æ–° App**ï¼š
   - å‰å¾€ App Store æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ–°

4. **é‡æ–°å®‰è£…**ï¼š
   - å¦‚æœä»¥ä¸Šéƒ½æ— æ•ˆï¼Œå°è¯•å¸è½½åé‡æ–°å®‰è£…
   - ç™»å½•åæ‚¨çš„æ•°æ®ä¼šè‡ªåŠ¨åŒæ­¥

ğŸ“Œ ä¸ºäº†å¸®åŠ©æˆ‘ä»¬å®šä½é—®é¢˜ï¼Œè¯·æä¾›ï¼š
- é—ªé€€å‘ç”Ÿåœ¨ä»€ä¹ˆæ“ä½œæ—¶ï¼Ÿ
- æ˜¯å¦æ¯æ¬¡éƒ½ä¼šé—ªé€€ï¼Ÿ
- æ‚¨çš„ iOS ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ

æˆ‘ä»¬çš„æŠ€æœ¯å›¢é˜Ÿä¼šä¼˜å…ˆå¤„ç†æ­¤é—®é¢˜ã€‚

Readmigo å›¢é˜Ÿ
    `,
    closeAfterDays: null,
  },

  {
    id: 'sync-issue',
    keywords: ['åŒæ­¥', 'æ•°æ®ä¸¢å¤±', 'è¿›åº¦æ²¡äº†', 'sync', 'ä¸åŒæ­¥'],
    category: FeedbackCategory.DATA_SYNC,
    priority: 'high',
    response: `
æ‚¨å¥½ï¼

æŠ±æ­‰æ‚¨é‡åˆ°äº†æ•°æ®åŒæ­¥é—®é¢˜ã€‚è¯·å°è¯•ä»¥ä¸‹æ­¥éª¤ï¼š

1. **æ£€æŸ¥ç½‘ç»œ**ï¼šç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
2. **æ‰‹åŠ¨åŒæ­¥**ï¼šè¿›å…¥ã€Œè®¾ç½®ã€â†’ã€ŒåŒæ­¥ã€â†’ã€Œç«‹å³åŒæ­¥ã€
3. **æ£€æŸ¥ç™»å½•çŠ¶æ€**ï¼šç¡®ä¿æ‚¨å·²ç™»å½•è´¦å·

ğŸ“Œ **å…³äºåŒæ­¥æœºåˆ¶**ï¼š
- Readmigo ä¼šè‡ªåŠ¨åŒæ­¥æ‚¨çš„é˜…è¯»è¿›åº¦ã€ç¬”è®°å’Œç”Ÿè¯æœ¬
- åŒæ­¥éœ€è¦ç½‘ç»œè¿æ¥
- åœ¨ä¸åŒè®¾å¤‡ä¸Šéœ€è¦ä½¿ç”¨åŒä¸€è´¦å·ç™»å½•

âš ï¸ **å¦‚æœæ•°æ®ä¸¢å¤±**ï¼š
è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¼šå°è¯•å¸®æ‚¨æ¢å¤ï¼š
- ä¸¢å¤±çš„æ•°æ®ç±»å‹ï¼ˆè¿›åº¦/ç¬”è®°/ç”Ÿè¯ï¼‰
- å¤§çº¦ä»€ä¹ˆæ—¶å€™ä¸¢å¤±çš„
- æ˜¯å¦åœ¨å¤šä¸ªè®¾å¤‡ä½¿ç”¨

æˆ‘ä»¬ä¼šå°½å¿«å¸®æ‚¨å¤„ç†ã€‚

Readmigo å›¢é˜Ÿ
    `,
    closeAfterDays: 3,
  },

  // ===== å†…å®¹é—®é¢˜ =====
  {
    id: 'book-content-error',
    keywords: ['ä¹¦ç±é”™è¯¯', 'å†…å®¹é”™è¯¯', 'æ’ç‰ˆé—®é¢˜', 'æ˜¾ç¤ºé”™è¯¯', 'book error'],
    category: FeedbackCategory.BOOK_CONTENT,
    priority: 'medium',
    response: `
æ‚¨å¥½ï¼

æ„Ÿè°¢æ‚¨æŠ¥å‘Šä¹¦ç±å†…å®¹é—®é¢˜ï¼ä¸ºäº†æ›´å¿«åœ°ä¿®å¤ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

ğŸ“š **è¯·å‘Šè¯‰æˆ‘ä»¬**ï¼š
1. ä¹¦ç±åç§°
2. é—®é¢˜æ‰€åœ¨çš„ç« èŠ‚/ä½ç½®
3. å…·ä½“æ˜¯ä»€ä¹ˆé—®é¢˜ï¼ˆé”™å­—/æ’ç‰ˆ/å†…å®¹ç¼ºå¤±ç­‰ï¼‰
4. å¦‚æœå¯èƒ½ï¼Œè¯·é™„ä¸Šæˆªå›¾

æˆ‘ä»¬çš„å†…å®¹å›¢é˜Ÿä¼šå°½å¿«æ ¸å®å¹¶ä¿®å¤ã€‚æ„Ÿè°¢æ‚¨å¸®åŠ©æˆ‘ä»¬æå‡é˜…è¯»ä½“éªŒï¼

Readmigo å›¢é˜Ÿ
    `,
    closeAfterDays: 7,
  },

  {
    id: 'translation-error',
    keywords: ['ç¿»è¯‘é”™è¯¯', 'ç¿»è¯‘ä¸å¯¹', 'ç¿»è¯‘é—®é¢˜', 'translation error', 'è¯‘æ–‡'],
    category: FeedbackCategory.TRANSLATION,
    priority: 'medium',
    response: `
æ‚¨å¥½ï¼

æ„Ÿè°¢æ‚¨æŠ¥å‘Šç¿»è¯‘é—®é¢˜ï¼è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

ğŸ“ **è¯·å‘Šè¯‰æˆ‘ä»¬**ï¼š
1. ä¹¦ç±åç§°å’Œç« èŠ‚
2. åŸæ–‡å†…å®¹
3. å½“å‰çš„ç¿»è¯‘
4. æ‚¨å»ºè®®çš„ç¿»è¯‘ï¼ˆå¦‚æœæœ‰ï¼‰

æˆ‘ä»¬ä¼šæ ¸å®å¹¶æ›´æ­£ç¿»è¯‘ã€‚æ„Ÿè°¢æ‚¨å¸®åŠ©æˆ‘ä»¬æå‡ç¿»è¯‘è´¨é‡ï¼

Readmigo å›¢é˜Ÿ
    `,
    closeAfterDays: 7,
  },

  // ===== åŠŸèƒ½å»ºè®® =====
  {
    id: 'feature-request',
    keywords: ['å»ºè®®', 'å¸Œæœ›æœ‰', 'èƒ½ä¸èƒ½', 'feature request', 'åŠŸèƒ½å»ºè®®'],
    category: FeedbackCategory.FEATURE_REQUEST,
    priority: 'low',
    response: `
æ‚¨å¥½ï¼

éå¸¸æ„Ÿè°¢æ‚¨çš„å®è´µå»ºè®®ï¼ğŸ™

æˆ‘ä»¬å·²ç»è®°å½•ä¸‹æ‚¨çš„åé¦ˆï¼Œäº§å“å›¢é˜Ÿä¼šè®¤çœŸè¯„ä¼°ã€‚æˆ‘ä»¬ä¸€ç›´åœ¨åŠªåŠ›æ”¹è¿› Readmigoï¼Œæ‚¨çš„å»ºè®®å¯¹æˆ‘ä»¬éå¸¸é‡è¦ã€‚

å¦‚æœæ‚¨æœ‰æ›´å¤šæƒ³æ³•ï¼Œæ¬¢è¿éšæ—¶å‘Šè¯‰æˆ‘ä»¬ï¼

Readmigo å›¢é˜Ÿ
    `,
    closeAfterDays: 14,
  },
];
```

---

## é™„å½• Bï¼šå®¢æˆ·æ»¡æ„åº¦è°ƒæŸ¥ï¼ˆCSATï¼‰è®¾è®¡

### B.1 è°ƒæŸ¥è§¦å‘æ—¶æœº

```typescript
// æ»¡æ„åº¦è°ƒæŸ¥è§¦å‘è§„åˆ™
const csatTriggerRules = {
  // å·¥å•è§£å†³åè§¦å‘
  onTicketResolved: {
    delay: '24h',           // è§£å†³å 24 å°æ—¶å‘é€
    condition: {
      excludeCategories: ['SPAM', 'DUPLICATE'],
      minMessagesCount: 2,  // è‡³å°‘æœ‰ 2 æ¡æ¶ˆæ¯
    },
  },

  // æ’é™¤è§„åˆ™
  excludeUsers: {
    recentSurvey: '30d',    // 30 å¤©å†…å·²å¡«è¿‡è°ƒæŸ¥
    newUsers: '7d',         // æ³¨å†Œ 7 å¤©å†…çš„æ–°ç”¨æˆ·
  },
};
```

### B.2 è°ƒæŸ¥è¡¨å•è®¾è®¡

```swift
// iOS CSAT è°ƒæŸ¥è§†å›¾
struct CSATSurveyView: View {
    let ticketId: String
    @State private var rating: Int = 0
    @State private var feedback: String = ""

    var body: some View {
        VStack(spacing: 24) {
            Text("æ‚¨å¯¹æ­¤æ¬¡æœåŠ¡æ»¡æ„å—ï¼Ÿ")
                .font(.headline)

            // 1-5 æ˜Ÿè¯„åˆ†
            HStack(spacing: 16) {
                ForEach(1...5, id: \.self) { star in
                    Button {
                        rating = star
                    } label: {
                        Image(systemName: star <= rating ? "star.fill" : "star")
                            .font(.title)
                            .foregroundColor(star <= rating ? .yellow : .gray)
                    }
                }
            }

            // è¯„åˆ†è¯´æ˜
            if rating > 0 {
                Text(ratingDescription(rating))
                    .font(.caption)
                    .foregroundColor(.secondary)
            }

            // å¯é€‰åé¦ˆ
            if rating > 0 {
                VStack(alignment: .leading) {
                    Text("æœ‰ä»€ä¹ˆå»ºè®®å—ï¼Ÿï¼ˆå¯é€‰ï¼‰")
                        .font(.subheadline)

                    TextEditor(text: $feedback)
                        .frame(height: 80)
                        .overlay(
                            RoundedRectangle(cornerRadius: 8)
                                .stroke(Color.secondary.opacity(0.3))
                        )
                }
            }

            // æäº¤æŒ‰é’®
            Button("æäº¤") {
                submitSurvey()
            }
            .buttonStyle(.borderedProminent)
            .disabled(rating == 0)
        }
        .padding()
    }

    func ratingDescription(_ rating: Int) -> String {
        switch rating {
        case 1: return "éå¸¸ä¸æ»¡æ„"
        case 2: return "ä¸å¤ªæ»¡æ„"
        case 3: return "ä¸€èˆ¬"
        case 4: return "æ»¡æ„"
        case 5: return "éå¸¸æ»¡æ„"
        default: return ""
        }
    }
}
```

### B.3 æ•°æ®æ¨¡å‹

```prisma
model CSATSurvey {
  id          String   @id @default(uuid())
  ticketId    String   @unique
  ticket      Ticket   @relation(fields: [ticketId], references: [id])
  userId      String

  // è¯„åˆ†
  rating      Int      // 1-5
  feedback    String?  // å¯é€‰æ–‡å­—åé¦ˆ

  // å…ƒæ•°æ®
  sentAt      DateTime @default(now())
  respondedAt DateTime?

  @@index([ticketId])
  @@index([userId])
  @@index([rating])
  @@index([sentAt])
}
```

### B.4 æŠ¥è¡¨æŒ‡æ ‡

```typescript
interface CSATMetrics {
  // æ•´ä½“æŒ‡æ ‡
  overallScore: number;           // å¹³å‡åˆ† (1-5)
  responseRate: number;           // å“åº”ç‡
  totalResponses: number;         // æ€»å“åº”æ•°

  // åˆ†å¸ƒ
  ratingDistribution: {
    1: number;  // éå¸¸ä¸æ»¡æ„
    2: number;  // ä¸å¤ªæ»¡æ„
    3: number;  // ä¸€èˆ¬
    4: number;  // æ»¡æ„
    5: number;  // éå¸¸æ»¡æ„
  };

  // è¶‹åŠ¿
  weeklyTrend: { week: string; score: number }[];

  // æŒ‰ç»´åº¦
  byCategory: Record<FeedbackCategory, number>;
  byAgent: { agentId: string; name: string; score: number }[];

  // ä½åˆ†å·¥å•
  lowRatingTickets: {
    ticketId: string;
    rating: number;
    feedback: string;
    agentName: string;
  }[];
}
```

---

## é™„å½• Cï¼šé‚®ä»¶æ¨¡æ¿ç¤ºä¾‹

### C.1 åé¦ˆç¡®è®¤é‚®ä»¶

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; line-height: 1.6; color: #333; }
    .container { max-width: 600px; margin: 0 auto; padding: 20px; }
    .header { text-align: center; padding: 20px 0; border-bottom: 1px solid #eee; }
    .header img { width: 120px; }
    .content { padding: 30px 0; }
    .ticket-info { background: #f8f9fa; border-radius: 8px; padding: 20px; margin: 20px 0; }
    .ticket-number { font-size: 18px; font-weight: bold; color: #007AFF; }
    .footer { text-align: center; padding: 20px 0; border-top: 1px solid #eee; color: #666; font-size: 14px; }
    .button { display: inline-block; background: #007AFF; color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://readmigo.com/logo.png" alt="Readmigo">
    </div>

    <div class="content">
      <h2>æˆ‘ä»¬æ”¶åˆ°äº†æ‚¨çš„åé¦ˆ</h2>

      <p>æ‚¨å¥½ï¼Œ{{userName}}ï¼</p>

      <p>æ„Ÿè°¢æ‚¨è”ç³» Readmigo å®¢æœå›¢é˜Ÿã€‚æˆ‘ä»¬å·²æ”¶åˆ°æ‚¨çš„åé¦ˆï¼Œä¼šå°½å¿«ä¸ºæ‚¨å¤„ç†ã€‚</p>

      <div class="ticket-info">
        <div class="ticket-number">å·¥å•å·ï¼š#{{ticketNumber}}</div>
        <p><strong>é—®é¢˜ç±»å‹ï¼š</strong>{{category}}</p>
        <p><strong>æäº¤æ—¶é—´ï¼š</strong>{{createdAt}}</p>
      </div>

      <p>æˆ‘ä»¬é€šå¸¸ä¼šåœ¨ 24 å°æ—¶å†…å›å¤æ‚¨çš„é—®é¢˜ã€‚å¦‚æœæ˜¯ç´§æ€¥é—®é¢˜ï¼Œæˆ‘ä»¬ä¼šä¼˜å…ˆå¤„ç†ã€‚</p>

      <p>å¦‚æœ‰è¡¥å……ä¿¡æ¯ï¼Œè¯·ç›´æ¥å›å¤æ­¤é‚®ä»¶ã€‚</p>

      <p>
        Readmigo å›¢é˜Ÿ
      </p>
    </div>

    <div class="footer">
      <p>æ­¤é‚®ä»¶ç”± Readmigo è‡ªåŠ¨å‘é€</p>
      <p>å¦‚æœ‰ç–‘é—®ï¼Œè¯·è®¿é—® <a href="https://readmigo.com/help">å¸®åŠ©ä¸­å¿ƒ</a></p>
    </div>
  </div>
</body>
</html>
```

### C.2 æ»¡æ„åº¦è°ƒæŸ¥é‚®ä»¶

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    /* æ ·å¼åŒä¸Š */
    .rating-buttons { text-align: center; margin: 30px 0; }
    .rating-btn { display: inline-block; width: 50px; height: 50px; line-height: 50px; margin: 0 5px; border-radius: 50%; text-decoration: none; font-size: 20px; }
    .rating-1 { background: #ff6b6b; color: white; }
    .rating-2 { background: #ffa94d; color: white; }
    .rating-3 { background: #ffd43b; color: #333; }
    .rating-4 { background: #69db7c; color: white; }
    .rating-5 { background: #38d9a9; color: white; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://readmigo.com/logo.png" alt="Readmigo">
    </div>

    <div class="content">
      <h2>æ‚¨å¯¹æˆ‘ä»¬çš„æœåŠ¡æ»¡æ„å—ï¼Ÿ</h2>

      <p>æ‚¨å¥½ï¼Œ{{userName}}ï¼</p>

      <p>æ‚¨çš„å·¥å• <strong>#{{ticketNumber}}</strong> å·²è§£å†³ã€‚æˆ‘ä»¬éå¸¸é‡è§†æ‚¨çš„ä½“éªŒï¼Œå¸Œæœ›æ‚¨èƒ½èŠ± 30 ç§’å‘Šè¯‰æˆ‘ä»¬æ‚¨çš„æ„Ÿå—ã€‚</p>

      <div class="rating-buttons">
        <a href="{{ratingUrl}}&rating=1" class="rating-btn rating-1">ğŸ˜ </a>
        <a href="{{ratingUrl}}&rating=2" class="rating-btn rating-2">ğŸ˜•</a>
        <a href="{{ratingUrl}}&rating=3" class="rating-btn rating-3">ğŸ˜</a>
        <a href="{{ratingUrl}}&rating=4" class="rating-btn rating-4">ğŸ˜Š</a>
        <a href="{{ratingUrl}}&rating=5" class="rating-btn rating-5">ğŸ˜</a>
      </div>

      <p style="text-align: center; color: #666;">
        ç‚¹å‡»è¡¨æƒ…å³å¯å®Œæˆè¯„ä»·
      </p>

      <p>æ‚¨çš„åé¦ˆå°†å¸®åŠ©æˆ‘ä»¬ä¸æ–­æ”¹è¿›æœåŠ¡è´¨é‡ã€‚æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼</p>

      <p>
        Readmigo å›¢é˜Ÿ
      </p>
    </div>

    <div class="footer">
      <p>æ­¤é‚®ä»¶ç”± Readmigo è‡ªåŠ¨å‘é€</p>
      <p>å¦‚ä¸æƒ³æ¥æ”¶æ­¤ç±»é‚®ä»¶ï¼Œ<a href="{{unsubscribeUrl}}">ç‚¹å‡»å–æ¶ˆè®¢é˜…</a></p>
    </div>
  </div>
</body>
</html>
```

---

## é™„å½• Dï¼šæŠ€æœ¯ä¾èµ–

### D.1 åç«¯ä¾èµ–

```json
{
  "dependencies": {
    // é‚®ä»¶æœåŠ¡ï¼ˆé€‰å…¶ä¸€ï¼‰
    "@sendgrid/mail": "^8.0.0",
    "resend": "^2.0.0",

    // æ–‡ä»¶ä¸Šä¼ 
    "@aws-sdk/client-s3": "^3.0.0",  // R2 å…¼å®¹ S3 API

    // å®šæ—¶ä»»åŠ¡
    "@nestjs/schedule": "^4.0.0",

    // AI æœåŠ¡
    "@anthropic-ai/sdk": "^0.20.0"
  }
}
```

### D.2 iOS ä¾èµ–

```swift
// Package.swift
dependencies: [
    // æ— é¢å¤–ä¾èµ–ï¼Œä½¿ç”¨åŸç”Ÿç»„ä»¶
]
```

### D.3 Dashboard ä¾èµ–

```json
{
  "dependencies": {
    // å›¾è¡¨
    "recharts": "^2.10.0",

    // æ—¥æœŸå¤„ç†
    "date-fns": "^3.0.0",

    // å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå·¥å•å›å¤ï¼‰
    "@tiptap/react": "^2.0.0"
  }
}
```

---

*æ–‡æ¡£ç‰ˆæœ¬: 2.0 | æœ€åæ›´æ–°: 2025-12-27 | çŠ¶æ€: âœ… è®¾è®¡å®Œæˆ*

# iOS TTS 概念设计

> 从零设计 Readmigo 的语音朗读系统——不只是"读出来"，而是为语言学习而生的听读体验

---

## 一、核心定义

**Readmigo TTS 不是一个"文本转语音"工具，而是一个「听读学习模式」。**

| 普通 TTS | Readmigo 听读模式 |
|---------|-----------------|
| 把文字念出来 | 听的同时看、学、理解 |
| 单一语言朗读 | 原文 + 译文双语切换 |
| 独立于阅读体验 | 与阅读进度、翻译、生词深度联动 |
| 被动听 | 主动学（跟读、暂停查词、标记生词） |

---

## 二、用户场景

### 谁在什么时候用？

| 场景 | 用户行为 | 核心需求 |
|------|---------|---------|
| 通勤路上 | 锁屏听书，偶尔看手机 | 后台播放、锁屏控制、自动续章 |
| 睡前 | 躺着听，设定时间关闭 | 睡眠定时器、低语速 |
| 精读学习 | 边听边看，遇到生词暂停 | 段落同步高亮、点击查词、翻译联动 |
| 跟读练习 | 听一句，跟读一句 | 句子暂停模式、跟读录音（远期） |
| 双语学习 | 先听英文，再听中文 | 双语交替朗读模式 |

### 用户旅程

```
用户在阅读器中

  ┌─ 点击「听」按钮
  │
  ▼
从当前阅读位置开始朗读
  │
  ├── 场景 A: 纯听模式
  │     锁屏 → 后台播放 → 自动翻页翻章
  │     用户通过锁屏/耳机控制 播放/暂停/跳转
  │
  ├── 场景 B: 听读同步模式
  │     屏幕亮着 → 当前段落高亮 → 自动滚动
  │     用户可随时：
  │       · 点击任意段落跳转朗读位置
  │       · 长按单词查词/翻译
  │       · 切换显示该段翻译
  │
  └── 场景 C: 学习模式（远期）
        句子暂停 → 用户跟读 → 继续下一句
        或: 英文一句 → 中文一句 → 下一句
```

---

## 三、功能架构

### 功能全景

```
┌─────────────────────────────────────────────────────────────┐
│                     Readmigo 听读系统                        │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                   朗读模式                             │  │
│  │                                                       │  │
│  │  · 连续朗读（跨章自动续播）                             │  │
│  │  · 单章朗读（章末停止）                                 │  │
│  │  · 选段朗读（选中文本朗读）                             │  │
│  │  · 双语交替（原文句 → 译文句，远期）                     │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                   播放控制                             │  │
│  │                                                       │  │
│  │  · 播放 / 暂停                                        │  │
│  │  · 上一句 / 下一句                                     │  │
│  │  · 上一段 / 下一段                                     │  │
│  │  · 快进 / 快退 15秒                                    │  │
│  │  · 倍速 0.5x ~ 2.0x                                   │  │
│  │  · 睡眠定时器                                          │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                   声音与语言                            │  │
│  │                                                       │  │
│  │  · 系统声音选择（男/女/标准/增强/高级）                  │  │
│  │  · 语速 / 语调 / 音量                                  │  │
│  │  · 句间停顿 / 段间停顿                                 │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                   视觉同步                             │  │
│  │                                                       │  │
│  │  · 当前段落高亮                                        │  │
│  │  · 自动滚动跟随                                        │  │
│  │  · 点击段落跳转朗读位置                                 │  │
│  │  · 高亮粒度可选（段落 / 句子 / 单词）                   │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                   系统集成                             │  │
│  │                                                       │  │
│  │  · 锁屏/控制中心 播放控制                               │  │
│  │  · AirPlay / 蓝牙耳机                                  │  │
│  │  · 后台持续播放                                        │  │
│  │  · 阅读进度与听读进度统一                               │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 四、系统架构

### 分层设计

```
┌─────────────────────────────────────────────────────────────┐
│                        UI 层                                 │
│                                                             │
│  阅读器视图              听读控制面板          锁屏/控制中心   │
│  (段落高亮+滚动)          (播放器界面)         (系统媒体控制)  │
│                                                             │
└───────────────────────────┬─────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      协调层                                   │
│                                                             │
│  听读协调器 (ReadAloudCoordinator)                           │
│                                                             │
│  职责：                                                      │
│  · 管理"听读会话"的完整生命周期                                │
│  · 协调 文本供应 / 语音引擎 / 视觉同步 三者                    │
│  · 处理跨章续播逻辑                                          │
│  · 统一对外暴露状态（当前位置、进度、播放状态）                  │
│                                                             │
└──────┬──────────────────┬────────────────────┬──────────────┘
       │                  │                    │
       ▼                  ▼                    ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────────┐
│   文本供应    │  │   语音引擎    │  │    视觉同步       │
│              │  │              │  │                  │
│ · 纯文本获取  │  │ · 语音合成    │  │ · 段落高亮        │
│ · 段落结构化  │  │ · 句子拆分    │  │ · 自动滚动        │
│ · 缓存管理    │  │ · 播放控制    │  │ · 点击交互        │
│ · 预加载      │  │ · 进度追踪    │  │ · 高亮粒度切换     │
└──────────────┘  └──────────────┘  └──────────────────┘
       │                  │
       ▼                  ▼
┌──────────────┐  ┌──────────────┐
│   数据源      │  │  系统服务     │
│              │  │              │
│ · /text API  │  │ · AVSpeech   │
│ · 翻译缓存   │  │   Synthesizer│
│ · 离线缓存   │  │ · AVAudio    │
│ · HTML 降级  │  │   Session    │
└──────────────┘  │ · MPRemote   │
                  │   Command    │
                  └──────────────┘
```

### 为什么需要"协调层"

| 没有协调层 | 有协调层 |
|-----------|---------|
| UI 直接调用语音引擎 | UI 只跟协调器通信 |
| 跨章续播逻辑散落在 UI 中 | 续播逻辑内聚在协调器 |
| 文本获取、语音、高亮各自为政 | 三者通过协调器同步 |
| 新增模式（双语朗读）需改多处 | 新增模式只扩展协调器 |

---

## 五、文本供应设计

### 核心概念：段落是最小单元

```
一个章节的文本结构：

Chapter
├── Paragraph 0: "He felt the rain on his face as he walked..."
├── Paragraph 1: "The streets were dark and empty. No one else..."
├── Paragraph 2: "He thought about what had led him to this point..."
├── ...
└── Paragraph N: "And so the chapter ended with a quiet resolve."

每个 Paragraph 内部由 语音引擎 按需拆分为 Sentences
```

**设计原则**：段落是 TTS 系统的原子单位。所有导航、进度、高亮都以段落为基础坐标。

### 文本获取优先级

```
请求章节纯文本
      │
      ▼
① 本地缓存命中？ ─── 是 ──→ 返回（零延迟）
      │
      │ 否
      ▼
② 网络可用？
      │
      ├── 是 ──→ 调用 /text API ──→ 缓存 ──→ 返回
      │
      └── 否 ──→ ③ 有离线 HTML？
                       │
                       ├── 是 ──→ 本地剥离 HTML 标签 ──→ 返回（降级）
                       │
                       └── 否 ──→ 提示用户"需要网络或先下载"
```

### 预加载策略

| 时机 | 动作 |
|------|------|
| 开始朗读第 N 章 | 预加载第 N+1 章纯文本 |
| 用户下载书籍离线 | 同步缓存所有章节纯文本 |
| 翻译已缓存的章节 | 直接复用翻译数据中的原文字段（零额外请求） |

---

## 六、语音引擎设计

### 二级朗读结构

```
语音引擎的工作模型：

输入: [Paragraph]  段落数组
                │
                ▼
对当前段落进行句子拆分
                │
                ▼
          [Sentence] 句子数组
                │
                ▼
逐句送入 AVSpeechSynthesizer
                │
                ├── 句子朗读完毕 → 下一句
                │
                ├── 段落所有句子完毕 → 触发 onParagraphEnd
                │     │
                │     ▼
                │   下一段落 → 拆分句子 → 继续朗读
                │
                └── 章节所有段落完毕 → 触发 onChapterEnd
                      │
                      ▼
                协调层决定：续播下一章 or 停止
```

### 导航模型

| 操作 | 粒度 | 行为 |
|------|------|------|
| 短按 ◀ / ▶ | 句子 | 跳到上/下一句 |
| 长按 ◀ / ▶ | 段落 | 跳到上/下一段落开头 |
| 快退/快进 15s | 时间估算 | 按朗读速率估算跳过的句子数 |
| 点击进度条 | 百分比 | 跳到章节对应位置的段落 |
| 点击阅读器段落 | 段落 | 直接跳到该段落开始朗读 |

### 进度模型

```
听读进度的两个维度：

维度 1: 章节内进度
┌──────────────────────────────────────────┐
│ 段落 3 / 42         句子 2 / 5           │
│ ▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░  7%           │
│ 1:23                         -18:45     │
└──────────────────────────────────────────┘

维度 2: 全书进度
┌──────────────────────────────────────────┐
│ 第 5 章 / 共 31 章                       │
│ ▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░  16%          │
└──────────────────────────────────────────┘
```

---

## 七、视觉同步设计

### 同步模型

```
语音引擎                         阅读器视图

段落 2 开始朗读 ───────────→    段落 2 高亮 + 滚动到可见区域

段落 2 句子 3 朗读 ────────→    (可选) 句子 3 额外高亮

段落 3 开始朗读 ───────────→    段落 2 取消高亮
                                段落 3 高亮 + 滚动

用户点击段落 5 ←──────────────  段落 5 被点击

跳转到段落 5 开始朗读 ─────→    段落 5 高亮 + 滚动
```

### 高亮样式

| 粒度 | 视觉效果 | 适用场景 |
|------|---------|---------|
| 段落 | 背景色淡化 + 左侧彩色边条 | 默认模式，通勤/泛听 |
| 句子 | 当前句子底色加深 | 精读模式 |
| 单词 | 当前单词下划线/高亮 | 学习模式（远期） |
| 无 | 不高亮 | 纯听模式（省电） |

### 滚动行为

| 场景 | 滚动策略 |
|------|---------|
| 段落切换 | smooth scroll 到段落顶部居中 |
| 用户手动滚动 | 暂停自动滚动 3 秒后恢复 |
| 用户点击段落 | 立即跳转朗读位置，不触发滚动 |

---

## 八、听读会话生命周期

### 完整生命周期

```
┌─────────┐
│  空闲    │  用户未使用听读功能
└────┬────┘
     │ 用户点击「听」
     ▼
┌─────────┐
│  初始化  │  获取当前章节纯文本 → 初始化语音引擎
└────┬────┘
     │ 文本就绪
     ▼
┌─────────┐
│  朗读中  │  语音合成 + 视觉同步 + 进度更新
└────┬────┘
     │
     ├── 用户暂停 ─────→ ┌─────────┐
     │                   │  暂停   │ ← 语音暂停，高亮保持
     │   用户恢复 ◄───── └─────────┘
     │
     ├── 章节结束 ────→ 连续模式？
     │                    │
     │                    ├── 是 → 加载下一章 → 继续朗读
     │                    └── 否 → 停止
     │
     ├── 睡眠定时到 ──→ 淡出停止
     │
     ├── 用户关闭 ────→ 停止
     │
     └── 全书结束 ────→ ┌──────────┐
                        │ 完成提示  │ → 回到空闲
                        └──────────┘
```

### 中断恢复

| 中断类型 | 恢复行为 |
|---------|---------|
| 来电 | 自动暂停，挂断后自动恢复 |
| 其他 App 播放音频 | 暂停，用户手动恢复 |
| App 进入后台 | 继续后台播放 |
| App 被系统杀死 | 记录最后位置，下次打开可从断点续听 |
| 用户切换章节（手动翻页） | 停止当前朗读，用户可重新启动 |
| 耳机拔出 | 自动暂停 |

### 进度持久化

| 数据 | 存储位置 | 用途 |
|------|---------|------|
| 最后听读位置（章节+段落） | UserDefaults | 断点续听 |
| 听读时长统计 | 与阅读统计合并上报 | 用户数据分析 |
| TTS 偏好设置 | UserDefaults | 声音/语速/模式记忆 |

---

## 九、与 Readmigo 学习体系的融合

### 听读 × 翻译

```
精读模式下的听读 + 翻译联动：

┌──────────────────────────────────────────┐
│                                          │
│  He felt the rain on his face as he      │  ← 当前朗读段落（高亮）
│  walked through the darkened streets.    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │ 他感到雨水打在脸上，                │    │  ← 实时翻译浮层
│  │ 走过昏暗的街道。                    │    │     (该段落的翻译)
│  └──────────────────────────────────┘    │
│                                          │
│  No one else was out at this hour.       │  ← 下一段落
│  The city slept while he wandered.       │
│                                          │
└──────────────────────────────────────────┘
```

| 听读翻译模式 | 行为 | 适用人群 |
|-------------|------|---------|
| 关闭 | 纯英文朗读 | 高级学习者 |
| 段落翻译 | 朗读段落时显示该段翻译 | 中级学习者 |
| 双语交替（远期） | 英文朗读一句 → TTS 朗读中文翻译 → 下一句 | 初级学习者 |

### 听读 × 生词

| 交互 | 行为 |
|------|------|
| 听到不认识的词 | 点击暂停 → 长按单词查词 → 添加生词本 → 恢复朗读 |
| 生词出现在朗读中 | 该词在高亮模式下额外标记（远期） |

---

## 十、音频源升级路径

### TTS → 精品有声书的无缝过渡

```
Phase 1 (当前)                    Phase 4 (未来)

所有书籍:                         有精品音频的书:
  系统 TTS 朗读                     精品音频优先
                                   TTS 作为备选
                        ────→
用户感知:                         用户感知:
  "能听，凑合"                      "音质提升了！"
                                   (同一个入口，自动升级)
```

### 统一入口设计

```
用户点击 🎧

  ┌── 该书有精品有声书？
  │
  ├── 否 ──→ 直接 TTS 朗读（用户无感，就是「听」）
  │
  └── 是 ──→ 默认精品音频
              设置中可切换回 TTS（用于学习场景：TTS 可调速/调语速）
```

**关键设计原则**：用户不需要知道"TTS"和"有声书"是两个东西。对用户来说只有一个动作——「听」。系统自动选择最佳音源。

---

## 十一、远期扩展方向

| 方向 | 说明 | 优先级 |
|------|------|--------|
| 双语交替朗读 | 英文一句 → 中文一句 | P1 |
| 跟读模式 | 听一句 → 暂停 → 用户跟读 → 评分 → 下一句 | P2 |
| 服务端高级 TTS | OpenAI TTS / ElevenLabs 替代系统声音 | P2 |
| 朗读速度自适应 | 根据文本难度自动调整语速 | P3 |
| 生词强调 | 用户生词本中的词朗读时放慢/重复 | P3 |
| CarPlay 支持 | 开车时的听书模式 | P3 |
| 离线高级语音 | 下载高质量语音模型到本地 | P3 |

---

## 十二、成功标准

| 指标 | 目标 | 衡量方式 |
|------|------|---------|
| 听读功能使用率 | >15% 周活用户使用过 | 事件埋点 |
| 平均听读时长 | >10 分钟/次 | 会话时长统计 |
| 听读转化为精读 | >30% 听读用户也进行阅读 | 交叉行为分析 |
| 续听率 | >50% 暂停后 24h 内恢复 | 断点续听统计 |
| 热门书排行 | Top 20 被听最多的书 | 为精品有声书选书提供依据 |

---

*最后更新：2026-02-08*

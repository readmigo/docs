# Android 学习模块

> 词汇管理 + 间隔复习 + 学习统计

---

## 1. 模块概览

```
┌─────────────────────────────────────────────────────────────────┐
│                    学习模块架构                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    LearningScreen                        │    │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌─────────┐ │    │
│  │  │  词汇    │  │   复习   │  │   统计   │  │  设置   │ │    │
│  │  │   List   │  │  Session │  │   Stats  │  │ Config  │ │    │
│  │  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬────┘ │    │
│  └───────┼─────────────┼─────────────┼─────────────┼───────┘    │
│          │             │             │             │             │
│          ▼             ▼             ▼             ▼             │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                 LearningViewModel                        │    │
│  └────────────────────────┬────────────────────────────────┘    │
│                           │                                      │
│                           ▼                                      │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                   Domain Layer                           │    │
│  │  VocabularyUseCase │ ReviewUseCase │ StatsUseCase       │    │
│  └────────────────────────┬────────────────────────────────┘    │
│                           │                                      │
│                           ▼                                      │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │               VocabularyRepository                       │    │
│  │  Local (Room) │ Remote (API) │ SM-2 Algorithm           │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. 核心功能

| 功能 | 说明 |
|------|------|
| 词汇收藏 | 阅读时添加生词 |
| 间隔复习 | SM-2 算法复习 |
| 学习统计 | 学习进度追踪 |
| 复习提醒 | 每日提醒 |

---

## 3. 词汇管理

### 3.1 词汇来源

```
┌─────────────────────────────────────────────────────────────────┐
│                    词汇来源                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  阅读中添加                                                      │
│  ├── 选中单词查词                                                │
│  ├── 点击"添加到词汇本"                                          │
│  └── 保存上下文                                                  │
│                                                                  │
│  手动添加                                                        │
│  ├── 输入单词                                                    │
│  ├── 自动获取释义                                                │
│  └── 可选添加例句                                                │
│                                                                  │
│  批量导入                                                        │
│  ├── CSV 文件导入                                               │
│  └── 其他词汇本导入                                              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 词汇字段

| 字段 | 说明 |
|------|------|
| word | 单词 |
| meaning | 中文释义 |
| pronunciation | 音标 |
| context | 原文上下文 |
| bookId | 来源书籍 |
| createdAt | 添加时间 |

---

## 4. SM-2 算法

### 4.1 算法原理

```
┌─────────────────────────────────────────────────────────────────┐
│                    SM-2 间隔重复                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  核心参数                                                        │
│  ├── EF (Easiness Factor): 难度系数 (1.3 - 2.5)                │
│  ├── n: 复习次数                                                │
│  └── interval: 下次复习间隔天数                                  │
│                                                                  │
│  间隔计算                                                        │
│  ├── n=1: interval = 1 天                                      │
│  ├── n=2: interval = 6 天                                      │
│  └── n>2: interval = interval * EF                             │
│                                                                  │
│  EF 调整                                                        │
│  └── EF' = EF + (0.1 - (5-q) * (0.08 + (5-q) * 0.02))         │
│      q: 回忆质量 (0-5)                                         │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 回忆评分

| 分数 | 含义 | EF 变化 |
|------|------|---------|
| 0 | 完全忘记 | 大幅下降 |
| 1 | 错误后想起 | 下降 |
| 2 | 错误，有印象 | 略下降 |
| 3 | 困难想起 | 不变 |
| 4 | 稍有犹豫 | 略上升 |
| 5 | 轻松想起 | 上升 |

---

## 5. 复习会话

### 5.1 复习流程

```
┌─────────────────────────────────────────────────────────────────┐
│                    复习流程                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  开始复习                                                        │
│       │                                                          │
│       ▼                                                          │
│  获取待复习词汇                                                  │
│       │                                                          │
│       ▼                                                          │
│  显示单词卡片                                                    │
│       │                                                          │
│       ├────────────────────────┐                                │
│       ▼                        ▼                                │
│  显示单词              用户点击显示答案                          │
│  (隐藏释义)                    │                                │
│                               ▼                                 │
│                          显示释义                                │
│                               │                                 │
│                               ▼                                 │
│                          用户评分 (0-5)                         │
│                               │                                 │
│                               ▼                                 │
│                          更新 SM-2 参数                         │
│                               │                                 │
│                               ▼                                 │
│                          下一个词汇                              │
│                               │                                 │
│                          (循环直到完成)                          │
│                               │                                 │
│                               ▼                                 │
│                          显示复习结果                            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 复习模式

| 模式 | 说明 |
|------|------|
| 标准模式 | 单词 → 评分 |
| 听写模式 | 发音 → 拼写 |
| 选择模式 | 单词 → 选释义 |
| 反向模式 | 释义 → 想单词 |

---

## 6. 学习统计

### 6.1 统计指标

```
┌─────────────────────────────────────────────────────────────────┐
│                    学习统计                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  词汇统计                                                        │
│  ├── 总词汇数                                                    │
│  ├── 已掌握数                                                    │
│  ├── 学习中数                                                    │
│  └── 新词数                                                      │
│                                                                  │
│  复习统计                                                        │
│  ├── 今日复习数                                                  │
│  ├── 本周复习数                                                  │
│  ├── 复习正确率                                                  │
│  └── 连续打卡天数                                                │
│                                                                  │
│  趋势分析                                                        │
│  ├── 每日新增词汇                                                │
│  ├── 掌握速度                                                    │
│  └── 遗忘曲线                                                    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2 掌握标准

| 状态 | 条件 |
|------|------|
| 新词 | 从未复习 |
| 学习中 | 复习 < 3 次 或 间隔 < 21 天 |
| 已掌握 | 复习 >= 3 次 且 间隔 >= 21 天 |

---

## 7. 词汇本管理

### 7.1 词汇本类型

```
┌─────────────────────────────────────────────────────────────────┐
│                    词汇本类型                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  默认词汇本                                                      │
│  └── 所有词汇                                                    │
│                                                                  │
│  书籍词汇本                                                      │
│  └── 按书籍自动分类                                              │
│                                                                  │
│  自定义词汇本                                                    │
│  ├── 用户创建                                                    │
│  ├── 手动分类                                                    │
│  └── 可设置复习优先级                                            │
│                                                                  │
│  系统词汇本                                                      │
│  ├── 高频词汇                                                    │
│  ├── 考试词汇                                                    │
│  └── 主题词汇                                                    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 7.2 词汇操作

| 操作 | 说明 |
|------|------|
| 编辑 | 修改释义、例句 |
| 移动 | 移到其他词汇本 |
| 删除 | 从词汇本移除 |
| 重置 | 重置学习进度 |

---

## 8. 复习提醒

### 8.1 提醒设置

```
┌─────────────────────────────────────────────────────────────────┐
│                    复习提醒                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  提醒时间                                                        │
│  ├── 自定义时间                                                  │
│  └── 每日固定时间                                                │
│                                                                  │
│  提醒方式                                                        │
│  ├── 通知                                                        │
│  └── 桌面小部件                                                  │
│                                                                  │
│  提醒内容                                                        │
│  ├── 待复习数量                                                  │
│  ├── 预计用时                                                    │
│  └── 连续打卡天数                                                │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 8.2 通知实现

| 组件 | 说明 |
|------|------|
| AlarmManager | 定时触发 |
| WorkManager | 后台任务 |
| NotificationManager | 通知显示 |

---

## 9. 数据同步

### 9.1 同步内容

| 内容 | 同步频率 |
|------|----------|
| 词汇列表 | 实时 |
| 学习记录 | 实时 |
| 复习进度 | 实时 |
| 统计数据 | 定时 |

### 9.2 离线支持

```
┌─────────────────────────────────────────────────────────────────┐
│                    离线学习                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  支持功能                                                        │
│  ├── 词汇浏览                                                    │
│  ├── 复习会话                                                    │
│  └── 进度记录                                                    │
│                                                                  │
│  同步策略                                                        │
│  ├── 离线操作队列化                                              │
│  ├── 网络恢复后同步                                              │
│  └── 冲突时服务器优先                                            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 10. 相关文档

| 文档 | 说明 |
|------|------|
| [ai.md](./ai.md) | AI 查词 |
| [reader.md](./reader.md) | 阅读器 |
| [../architecture.md](../architecture.md) | 架构设计 |

---

*最后更新: 2025-12-31*

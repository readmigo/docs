# Dashboard 开发指南

## 环境准备

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         开发环境要求                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  系统要求:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  Node.js           >= 18.0.0                                                │
│  npm               >= 9.0.0                                                 │
│  Git               最新版本                                                 │
│                                                                             │
│  推荐工具:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  IDE               VS Code                                                  │
│  浏览器            Chrome (开发者工具)                                       │
│  API 测试          Postman / Insomnia                                       │
│                                                                             │
│  VS Code 扩展:                                                               │
│  ─────────────────────────────────────────────────────────────────          │
│  • ESLint                                                                   │
│  • Prettier                                                                 │
│  • TypeScript Importer                                                      │
│  • ES7+ React snippets                                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 快速开始

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         启动步骤                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. 克隆仓库                                                                 │
│     git clone https://github.com/readmigo/readmigo.git                      │
│     cd readmigo                                                             │
│                                                                             │
│  2. 进入 Dashboard 目录                                                      │
│     cd apps/dashboard                                                       │
│                                                                             │
│  3. 安装依赖                                                                 │
│     npm install                                                             │
│                                                                             │
│  4. 配置环境变量                                                             │
│     cp .env.example .env.local                                              │
│     # 编辑 .env.local 设置必要变量                                          │
│                                                                             │
│  5. 启动开发服务器                                                           │
│     npm run dev                                                             │
│                                                                             │
│  6. 访问 Dashboard                                                          │
│     http://localhost:3001                                                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 环境变量配置

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         环境变量                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  .env.local 配置示例:                                                        │
│  ─────────────────────────────────────────────────────────────────          │
│                                                                             │
│  # 开发模式禁用认证 (可选)                                                   │
│  VITE_AUTH_DISABLED=true                                                    │
│                                                                             │
│  # API 地址配置                                                              │
│  VITE_API_URL=http://localhost:3000                                         │
│  VITE_DEBUG_API_URL=https://readmigo-debug.fly.dev                          │
│  VITE_STAGING_API_URL=https://staging-api.readmigo.com                      │
│  VITE_PRODUCTION_API_URL=https://api.readmigo.com                           │
│                                                                             │
│  变量说明:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  VITE_AUTH_DISABLED    设为 true 跳过登录认证，使用 Mock Admin               │
│  VITE_API_URL          本地开发 API 地址                                    │
│  VITE_*_API_URL        各环境 API 地址                                      │
│                                                                             │
│  注意: 所有 Vite 环境变量需要以 VITE_ 前缀                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## NPM 脚本

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         可用脚本                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  npm run dev                                                                │
│  ─────────────────────────────────────────────────────────────────          │
│  启动开发服务器 (Vite)                                                      │
│  • 端口: 3001                                                               │
│  • 热更新 (HMR)                                                             │
│  • API 代理到 localhost:3000                                                │
│                                                                             │
│  npm run build                                                              │
│  ─────────────────────────────────────────────────────────────────          │
│  生产构建                                                                    │
│  • TypeScript 类型检查                                                       │
│  • Vite 打包优化                                                            │
│  • 输出到 dist/                                                             │
│                                                                             │
│  npm run preview                                                            │
│  ─────────────────────────────────────────────────────────────────          │
│  预览生产构建                                                                │
│  • 本地启动静态服务器                                                        │
│  • 验证构建产物                                                              │
│                                                                             │
│  npm run lint                                                               │
│  ─────────────────────────────────────────────────────────────────          │
│  ESLint 检查                                                                │
│  • TypeScript/React 规则                                                    │
│  • 代码规范验证                                                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 开发工作流

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         添加新资源模块                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. 创建页面组件                                                             │
│     mkdir src/pages/new-resource                                            │
│     touch src/pages/new-resource/index.ts                                   │
│     touch src/pages/new-resource/NewResourceList.tsx                        │
│     touch src/pages/new-resource/NewResourceShow.tsx                        │
│     touch src/pages/new-resource/NewResourceCreate.tsx                      │
│     touch src/pages/new-resource/NewResourceEdit.tsx                        │
│                                                                             │
│  2. 实现列表组件                                                             │
│     // NewResourceList.tsx                                                  │
│     export const NewResourceList = () => (                                  │
│       <List>                                                                │
│         <Datagrid>                                                          │
│           <TextField source="id" />                                         │
│           <TextField source="name" />                                       │
│           <EditButton />                                                    │
│         </Datagrid>                                                         │
│       </List>                                                               │
│     );                                                                      │
│                                                                             │
│  3. 注册资源 (App.tsx)                                                       │
│     <Resource                                                               │
│       name="new-resources"                                                  │
│       list={NewResourceList}                                                │
│       show={NewResourceShow}                                                │
│       create={NewResourceCreate}                                            │
│       edit={NewResourceEdit}                                                │
│     />                                                                      │
│                                                                             │
│  4. 添加菜单项 (CustomMenu.tsx)                                              │
│     <Menu.Item                                                              │
│       to="/new-resources"                                                   │
│       primaryText="New Resources"                                           │
│       leftIcon={<NewResourceIcon />}                                        │
│     />                                                                      │
│                                                                             │
│  5. 添加翻译 (i18n/*.ts)                                                     │
│     newResources: {                                                         │
│       name: 'New Resource |||| New Resources',                              │
│       fields: {                                                             │
│         id: 'ID',                                                           │
│         name: 'Name',                                                       │
│       },                                                                    │
│     },                                                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 调试技巧

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         调试方法                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  React DevTools:                                                            │
│  ─────────────────────────────────────────────────────────────────          │
│  • 安装 Chrome 扩展: React Developer Tools                                  │
│  • 检查组件树和 Props                                                       │
│  • 查看 React Admin 内部状态                                                │
│                                                                             │
│  网络请求调试:                                                               │
│  ─────────────────────────────────────────────────────────────────          │
│  • Chrome DevTools > Network 面板                                           │
│  • 检查 API 请求/响应                                                       │
│  • 验证请求头 (Authorization, X-Content-Filter)                             │
│                                                                             │
│  Console 日志:                                                               │
│  ─────────────────────────────────────────────────────────────────          │
│  • React Admin 自动输出 dataProvider 调用日志                               │
│  • 使用 console.log 调试组件                                                │
│                                                                             │
│  环境切换调试:                                                               │
│  ─────────────────────────────────────────────────────────────────          │
│  • 使用环境选择器切换到 Debug 环境                                          │
│  • Debug 环境有更详细的错误信息                                             │
│                                                                             │
│  Mock 数据:                                                                  │
│  ─────────────────────────────────────────────────────────────────          │
│  • 设置 VITE_AUTH_DISABLED=true 使用 Mock Admin                             │
│  • 可在 dataProvider 中添加 Mock 响应                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 代码规范

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         代码规范                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  TypeScript:                                                                │
│  ─────────────────────────────────────────────────────────────────          │
│  • 启用 strict 模式                                                         │
│  • 所有函数参数和返回值需要类型                                              │
│  • 使用 interface 定义对象类型                                              │
│  • 避免 any 类型                                                            │
│                                                                             │
│  React 组件:                                                                 │
│  ─────────────────────────────────────────────────────────────────          │
│  • 使用函数组件 + Hooks                                                     │
│  • 组件文件名使用 PascalCase                                                │
│  • 每个文件只导出一个组件                                                    │
│  • 使用 React Admin 内置组件                                                │
│                                                                             │
│  导入顺序:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  1. React 和第三方库                                                         │
│  2. React Admin 组件                                                         │
│  3. MUI 组件                                                                 │
│  4. 本地模块 (services, contexts, components)                               │
│  5. 类型定义                                                                 │
│                                                                             │
│  样式:                                                                       │
│  ─────────────────────────────────────────────────────────────────          │
│  • 使用 MUI sx prop 或 styled()                                             │
│  • 遵循 theme.ts 中的设计系统                                               │
│  • 避免内联样式                                                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 常见问题

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         常见问题解决                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  问题: 启动后显示空白页                                                      │
│  ─────────────────────────────────────────────────────────────────          │
│  • 检查浏览器控制台错误                                                      │
│  • 确认 .env.local 配置正确                                                 │
│  • 清除浏览器缓存和 localStorage                                            │
│                                                                             │
│  问题: API 请求 401 错误                                                     │
│  ─────────────────────────────────────────────────────────────────          │
│  • 设置 VITE_AUTH_DISABLED=true 跳过认证                                    │
│  • 或确保后端服务运行中                                                      │
│  • 检查 adminToken 是否存在于 localStorage                                  │
│                                                                             │
│  问题: 类型错误                                                              │
│  ─────────────────────────────────────────────────────────────────          │
│  • 运行 npm run lint 查看详细错误                                           │
│  • 检查 tsconfig.json 配置                                                  │
│  • 确保安装了所有 @types/* 包                                               │
│                                                                             │
│  问题: 热更新不生效                                                          │
│  ─────────────────────────────────────────────────────────────────          │
│  • 检查文件是否在 src/ 目录内                                               │
│  • 尝试重启开发服务器                                                        │
│  • 清除 node_modules/.vite 缓存                                             │
│                                                                             │
│  问题: 环境切换后数据不更新                                                  │
│  ─────────────────────────────────────────────────────────────────          │
│  • 环境切换会触发页面刷新                                                    │
│  • 检查 dataProvider 是否正确读取环境配置                                   │
│  • 清除 React Admin 内部缓存: 刷新页面                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 与后端协作

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         前后端协作                                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  本地开发:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • 后端: localhost:3000                                                     │
│  • 前端: localhost:3001                                                     │
│  • Vite 代理 /api 请求到后端                                                │
│                                                                             │
│  API 契约:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • 列表响应: { items: [...], total: number }                                │
│  • 分页参数: page, limit                                                    │
│  • 排序参数: sort, order                                                    │
│  • 筛选参数: 直接作为查询参数                                                │
│                                                                             │
│  调试后端:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • 切换到 Debug 环境使用远程 Debug API                                      │
│  • 或本地启动后端服务                                                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

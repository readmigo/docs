# 订单管理

## 概述

订单管理模块提供订阅订单的查看和管理功能，包括订单列表、订单详情、支付状态等。

## 路由配置

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         路由信息                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  路径                组件              说明                                  │
│  ─────────────────────────────────────────────────────────────────          │
│  /admin/orders       OrderList         订单列表                              │
│  /admin/orders/:id   OrderShow         订单详情                              │
│                                                                             │
│  权限:                                                                       │
│  ─────────────────────────────────────────────────────────────────          │
│  查看: Super Admin, Operations, Viewer                                      │
│  操作: Super Admin, Operations                                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 列表视图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         订单列表                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  筛选: [订单状态 ▼] [支付渠道 ▼] [时间范围 ▼]  🔍 搜索订单...       │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ 订单ID    │ 用户        │ 产品     │ 金额    │ 状态   │ 时间    │操作│    │
│  │───────────┼─────────────┼──────────┼─────────┼────────┼─────────┼────│    │
│  │ ORD-12345 │ alice@...   │ Monthly  │ $9.99   │ ✅完成 │ 2小时前 │[⋮]│    │
│  │ ORD-12344 │ bob@...     │ Annual   │ $79.99  │ ✅完成 │ 5小时前 │[⋮]│    │
│  │ ORD-12343 │ charlie@... │ Monthly  │ $9.99   │ ⚠️待付 │ 1天前   │[⋮]│    │
│  │ ORD-12342 │ diana@...   │ Annual   │ $79.99  │ ❌取消 │ 2天前   │[⋮]│    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  [< 上一页]  第 1 页，共 56 页  [下一页 >]     每页 25 条                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 筛选条件

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         筛选选项                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  订单状态:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • pending     待支付                                                       │
│  • completed   已完成                                                       │
│  • cancelled   已取消                                                       │
│  • refunded    已退款                                                       │
│  • failed      支付失败                                                     │
│                                                                             │
│  支付渠道:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • appstore    App Store (iOS)                                              │
│  • playstore   Google Play (Android)                                        │
│  • stripe      Stripe (Web)                                                 │
│                                                                             │
│  时间范围:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • today       今天                                                         │
│  • last7days   最近7天                                                      │
│  • last30days  最近30天                                                     │
│  • thisMonth   本月                                                         │
│  • lastMonth   上月                                                         │
│  • custom      自定义日期范围                                               │
│                                                                             │
│  搜索:                                                                       │
│  ─────────────────────────────────────────────────────────────────          │
│  • 支持订单ID、用户邮箱搜索                                                  │
│  • 支持交易ID搜索                                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 订单详情

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         订单详情视图                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  [< 返回列表]                                              [退款]   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  订单 #ORD-12345                           状态: ✅ 已完成          │    │
│  │  ─────────────────────────────────────────────────────────────────  │    │
│  │                                                                      │    │
│  │  订单信息                           用户信息                         │    │
│  │  ────────                           ────────                         │    │
│  │  订单ID: ORD-12345                  用户: alice@test.com            │    │
│  │  创建时间: 2024-12-15 14:30:00      用户ID: USR-10001                │    │
│  │  完成时间: 2024-12-15 14:30:15      设备: iPhone 15 Pro             │    │
│  │  环境: Production                   平台: iOS 17.2                   │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  产品信息                                                            │    │
│  │  ─────────────────────────────────────────────────────────────────  │    │
│  │                                                                      │    │
│  │  产品名称: Premium Monthly Subscription                              │    │
│  │  产品ID: com.readmigo.premium.monthly                                │    │
│  │  订阅周期: 月度                                                      │    │
│  │  原价: $9.99                                                         │    │
│  │  实付: $9.99                                                         │    │
│  │  货币: USD                                                           │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  支付信息                                                            │    │
│  │  ─────────────────────────────────────────────────────────────────  │    │
│  │                                                                      │    │
│  │  支付渠道: App Store                                                 │    │
│  │  交易ID: 1000000123456789                                            │    │
│  │  收据: (点击查看完整收据)                                            │    │
│  │  验证状态: ✅ 已验证                                                 │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  订阅详情                                                            │    │
│  │  ─────────────────────────────────────────────────────────────────  │    │
│  │                                                                      │    │
│  │  订阅开始: 2024-12-15                                                │    │
│  │  订阅到期: 2025-01-15                                                │    │
│  │  自动续费: 是                                                        │    │
│  │  续费价格: $9.99/月                                                  │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 订单数据字段

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         数据字段说明                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  基本信息:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  id                 订单唯一标识                                            │
│  userId             用户ID                                                  │
│  status             订单状态                                                │
│  createdAt          创建时间                                                │
│  completedAt        完成时间                                                │
│  environment        环境标识 (production/staging)                           │
│                                                                             │
│  产品信息:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  productId          产品标识                                                │
│  productName        产品名称                                                │
│  productType        产品类型 (monthly/annual)                               │
│  price              价格                                                    │
│  currency           货币代码                                                │
│                                                                             │
│  支付信息:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  paymentChannel     支付渠道 (appstore/playstore/stripe)                    │
│  transactionId      交易ID                                                  │
│  receipt            支付收据                                                │
│  verificationStatus 验证状态                                                │
│                                                                             │
│  订阅信息:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  subscriptionStart  订阅开始日期                                            │
│  subscriptionEnd    订阅结束日期                                            │
│  autoRenew          是否自动续费                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 订单操作

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         可用操作                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  退款:                                                                       │
│  ─────────────────────────────────────────────────────────────────          │
│  • 对已完成订单发起退款                                                      │
│  • 需要填写退款原因                                                          │
│  • 退款会通过原支付渠道处理                                                  │
│  • 权限: Super Admin                                                        │
│                                                                             │
│  注意事项:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • App Store/Play Store 订单退款需要在各自平台处理                          │
│  • 仅 Stripe 订单可以直接在 Dashboard 退款                                  │
│  • 退款后订阅权限会立即取消                                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 统计概览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         订单统计                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  本月收入概览:                                                               │
│  ─────────────────────────────────────────────────────────────────          │
│                                                                             │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐                           │
│  │ 总收入  │ │ 订单数  │ │新订阅数 │ │ 退款    │                           │
│  │ $12,345 │ │  1,234  │ │   567   │ │ $123    │                           │
│  │ ↑15%    │ │ ↑10%    │ │ ↑8%     │ │ ↓5%     │                           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘                           │
│                                                                             │
│  收入分布:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • 月度订阅: $5,678 (46%)                                                   │
│  • 年度订阅: $6,667 (54%)                                                   │
│                                                                             │
│  渠道分布:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • App Store: $7,890 (64%)                                                  │
│  • Google Play: $3,210 (26%)                                                │
│  • Stripe: $1,245 (10%)                                                     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## API 接口

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         API 端点                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  GET /api/v1/admin/orders                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  参数: page, limit, status, channel, startDate, endDate, q                  │
│  返回: { items: [...], total: number }                                      │
│                                                                             │
│  GET /api/v1/admin/orders/:id                                               │
│  ─────────────────────────────────────────────────────────────────          │
│  返回: 订单完整信息                                                         │
│                                                                             │
│  POST /api/v1/admin/orders/:id/refund                                       │
│  ─────────────────────────────────────────────────────────────────          │
│  Body: { reason: string }                                                   │
│  返回: 退款结果                                                             │
│                                                                             │
│  GET /api/v1/admin/orders/stats                                             │
│  ─────────────────────────────────────────────────────────────────          │
│  参数: startDate, endDate                                                   │
│  返回: 订单统计数据                                                         │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

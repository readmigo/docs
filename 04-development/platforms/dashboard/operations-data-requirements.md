# Dashboard è¿è¥æ•°æ®éœ€æ±‚æ–‡æ¡£

## æ–‡æ¡£ä¿¡æ¯

- **åˆ›å»ºæ—¶é—´**: 2026-01-11
- **æœ€åæ›´æ–°**: 2026-01-11
- **ç‰ˆæœ¬**: v1.0
- **çŠ¶æ€**: Draft
- **ç›¸å…³æ–‡æ¡£**: [operations-analytics-design.md](./operations-analytics-design.md)

---

## ä¸€ã€æ¦‚è¿°

### 1.1 ç›®æ ‡

ä»å•†ä¸šçº§äº§å“è¿è¥è§’åº¦ï¼Œç³»ç»Ÿæ¢³ç† Readmigo Dashboard éœ€è¦è¡¥å……çš„æ•°æ®ç»´åº¦ï¼Œä¸ºè¿è¥å†³ç­–æä¾›å…¨é¢çš„æ•°æ®æ”¯æŒã€‚

### 1.2 è®¾è®¡åŸåˆ™

- **æ•°æ®é©±åŠ¨**: æ‰€æœ‰è¿è¥å†³ç­–åŸºäºçœŸå®æ•°æ®
- **åˆ†å±‚è®¾è®¡**: æŒ‰ä¼˜å…ˆçº§ P0/P1/P2 åˆ†é˜¶æ®µå®ç°
- **å¯è§†åŒ–ä¼˜å…ˆ**: æ•°æ®ä»¥å›¾è¡¨å½¢å¼ç›´è§‚å±•ç¤º
- **äº¤äº’å‹å¥½**: æ”¯æŒæ—¶é—´èŒƒå›´ç­›é€‰ã€ç»´åº¦ä¸‹é’»ã€æ•°æ®å¯¼å‡º
- **æ€§èƒ½ä¼˜åŒ–**: å¤§æ•°æ®é‡ä¸‹ä¿æŒæµç•…ä½“éªŒ

---

## äºŒã€æ•°æ®ç»´åº¦å…¨æ™¯å›¾

### 2.1 æ ¸å¿ƒæ•°æ®åŸŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Readmigo è¿è¥æ•°æ®ä½“ç³»                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  ç”¨æˆ·å¢é•¿ä¸ç•™å­˜  â”‚  â”‚  å†…å®¹è¿è¥åˆ†æ    â”‚  â”‚  å•†ä¸šåŒ–åˆ†æ      â”‚         â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚         â”‚
â”‚  â”‚  Â· DAU/MAU     â”‚  â”‚  Â· é˜…è¯»æ—¶é•¿     â”‚  â”‚  Â· ä»˜è´¹è½¬åŒ–     â”‚         â”‚
â”‚  â”‚  Â· ç•™å­˜ç‡       â”‚  â”‚  Â· ä¹¦ç±å®Œæˆç‡   â”‚  â”‚  Â· ARPU/LTV    â”‚         â”‚
â”‚  â”‚  Â· ç”¨æˆ·åˆ†å±‚     â”‚  â”‚  Â· å†…å®¹äº’åŠ¨     â”‚  â”‚  Â· è®¢å•åˆ†æ     â”‚         â”‚
â”‚  â”‚  Â· ç”¨æˆ·ç”»åƒ     â”‚  â”‚  Â· æ¨èæ•ˆæœ     â”‚  â”‚  Â· æ”¶å…¥é¢„æµ‹     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  åŠŸèƒ½ä½¿ç”¨åˆ†æ    â”‚  â”‚  æ¸ é“ä¸å¢é•¿      â”‚  â”‚  è¿è¥æ´»åŠ¨æ•ˆæœ    â”‚         â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚         â”‚
â”‚  â”‚  Â· æ ¸å¿ƒåŠŸèƒ½     â”‚  â”‚  Â· æ¸ é“æ•ˆæœ     â”‚  â”‚  Â· æ´»åŠ¨å‚ä¸     â”‚         â”‚
â”‚  â”‚  Â· AI ä½¿ç”¨      â”‚  â”‚  Â· è·å®¢æˆæœ¬     â”‚  â”‚  Â· Push æ•ˆæœ    â”‚         â”‚
â”‚  â”‚  Â· ç¤¾äº¤åŠŸèƒ½     â”‚  â”‚  Â· æ¸ é“è´¨é‡     â”‚  â”‚  Â· A/B æµ‹è¯•     â”‚         â”‚
â”‚  â”‚  Â· åŠŸèƒ½æ¼æ–—     â”‚  â”‚  Â· ç—…æ¯’å¢é•¿     â”‚  â”‚  Â· ROI åˆ†æ     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  å†…å®¹åº“å­˜ç®¡ç†    â”‚  â”‚  ç”¨æˆ·åé¦ˆåˆ†æ    â”‚  â”‚  æ€§èƒ½ä¸è´¨é‡      â”‚         â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚         â”‚
â”‚  â”‚  Â· åº“å­˜åˆ†å¸ƒ     â”‚  â”‚  Â· åé¦ˆåˆ†ç±»     â”‚  â”‚  Â· é”™è¯¯ç‡       â”‚         â”‚
â”‚  â”‚  Â· é‡‡è´­å»ºè®®     â”‚  â”‚  Â· é—®é¢˜çƒ­åº¦     â”‚  â”‚  Â· æ€§èƒ½æŒ‡æ ‡     â”‚         â”‚
â”‚  â”‚  Â· å†…å®¹åˆ©ç”¨ç‡   â”‚  â”‚  Â· æ»¡æ„åº¦       â”‚  â”‚  Â· å¥åº·åº¦       â”‚         â”‚
â”‚  â”‚  Â· å†·çƒ­åˆ†æ     â”‚  â”‚  Â· å“åº”æ—¶æ•ˆ     â”‚  â”‚  Â· å‘Šè­¦ç›‘æ§     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€ä¼˜å…ˆçº§åˆ†çº§

### 3.1 P0 ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒå¿…é¡»ï¼‰

**ç›®æ ‡**: æ»¡è¶³åŸºç¡€è¿è¥ç›‘æ§éœ€æ±‚ï¼Œå¿«é€Ÿä¸Šçº¿

| åºå· | åŠŸèƒ½æ¨¡å— | æ ¸å¿ƒæŒ‡æ ‡ | ä¸šåŠ¡ä»·å€¼ |
|------|---------|---------|---------|
| 1 | åŸºç¡€è¿è¥æ•°æ® | DAU/MAU/æ–°å¢ç”¨æˆ·/å¹³å°åˆ†å¸ƒ | äº†è§£äº§å“å¥åº·åº¦ âœ… å·²æœ‰ |
| 2 | **é˜…è¯»æ—¶é•¿åˆ†æ** | ä¹¦ç±/ç”¨æˆ·/åˆ†ç±»/æ—¶æ®µç»´åº¦é˜…è¯»æ—¶é•¿ | **æ ¸å¿ƒå†…å®¹æ¶ˆè´¹æŒ‡æ ‡** ğŸ”¥ |
| 3 | ç•™å­˜ç‡åˆ†æ | æ¬¡æ—¥/7æ—¥/30æ—¥ç•™å­˜æ›²çº¿ | è¡¡é‡äº§å“ç²˜æ€§ |
| 4 | ä»˜è´¹è½¬åŒ–ä¸æ”¶å…¥ | ä»˜è´¹è½¬åŒ–æ¼æ–—/è®¢å•åˆ†æ/æ”¶å…¥è¶‹åŠ¿ | å•†ä¸šåŒ–æ ¸å¿ƒæŒ‡æ ‡ |
| 5 | **ç”¨æˆ·ç”»åƒç»Ÿè®¡** | æ€§åˆ«/å¹´é¾„/åœ°åŒºåˆ†å¸ƒ | **ç²¾å‡†è¿è¥å’Œå¸‚åœºåˆ†æ** ğŸ¯ |

**æ—¶é—´è§„åˆ’**: 3å‘¨å®Œæˆ

---

### 3.2 P1 ä¼˜å…ˆçº§ï¼ˆé‡è¦å¢å¼ºï¼‰

**ç›®æ ‡**: æ·±åŒ–è¿è¥èƒ½åŠ›ï¼Œæ”¯æŒç²¾ç»†åŒ–è¿è¥

| åºå· | åŠŸèƒ½æ¨¡å— | æ ¸å¿ƒæŒ‡æ ‡ | ä¸šåŠ¡ä»·å€¼ |
|------|---------|---------|---------|
| 5 | ç”¨æˆ·åˆ†å±‚ç®¡ç† | æ´»è·ƒ/æˆé•¿/æ²‰é»˜/æµå¤±ç”¨æˆ·ç»Ÿè®¡ | ç²¾å‡†ç”¨æˆ·è¿è¥ |
| 6 | å†…å®¹å®Œæˆç‡ | ä¹¦ç±å®Œæˆç‡åˆ†å¸ƒ/å¼ƒè¯»åˆ†æ | å†…å®¹è´¨é‡ä¼˜åŒ– |
| 7 | åŠŸèƒ½ä½¿ç”¨ç‡ | æ ¸å¿ƒåŠŸèƒ½/AIåŠŸèƒ½ä½¿ç”¨ç»Ÿè®¡ | äº§å“ä¼˜åŒ–æ–¹å‘ |
| 8 | æ¸ é“æ•ˆæœåˆ†æ | å„æ¸ é“è·å®¢è´¨é‡å¯¹æ¯” | æŠ•æ”¾ä¼˜åŒ– |

**æ—¶é—´è§„åˆ’**: 4å‘¨å®Œæˆ

---

### 3.3 P2 ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–å¢å¼ºï¼‰

**ç›®æ ‡**: å®Œå–„è¿è¥ä½“ç³»ï¼Œæ”¯æŒé«˜çº§åˆ†æ

| åºå· | åŠŸèƒ½æ¨¡å— | æ ¸å¿ƒæŒ‡æ ‡ | ä¸šåŠ¡ä»·å€¼ |
|------|---------|---------|---------|
| 9 | æ¨èæ•ˆæœåˆ†æ | æ¨èè½¬åŒ–æ¼æ–—/ä¹¦å•æ•ˆæœ | ç®—æ³•ä¼˜åŒ– |
| 10 | è¿è¥æ´»åŠ¨è¿½è¸ª | æ´»åŠ¨å‚ä¸åº¦/æ•ˆæœåˆ†æ | æ´»åŠ¨ä¼˜åŒ– |
| 11 | A/Bæµ‹è¯•ç»“æœ | å®éªŒæ•°æ®å¯¹æ¯” | ç§‘å­¦å†³ç­– |
| 12 | ç”¨æˆ·åé¦ˆè¶‹åŠ¿ | åé¦ˆçƒ­åº¦/é—®é¢˜åˆ†å¸ƒ | äº§å“è¿­ä»£ |

**æ—¶é—´è§„åˆ’**: 6å‘¨å®Œæˆ

---

## å››ã€P0 ä¼˜å…ˆçº§è¯¦ç»†è®¾è®¡

### 4.1 åŸºç¡€è¿è¥æ•°æ®ï¼ˆå·²æœ‰ï¼‰

**å½“å‰çŠ¶æ€**: âœ… å·²å®ç°
- é¡µé¢: `/operations`
- æ¥å£: `/api/v1/admin/operations/overview`
- åŠŸèƒ½: DAU/MAU/æ–°å¢ç”¨æˆ·/AIäº¤äº’/é˜…è¯»ç»Ÿè®¡/å¹³å°åˆ†å¸ƒ

**å¾…ä¼˜åŒ–**:
- [ ] æ·»åŠ ç¯æ¯”/åŒæ¯”æ•°æ®
- [ ] æ”¯æŒè‡ªå®šä¹‰æ—¶é—´èŒƒå›´ç­›é€‰
- [ ] å¯¼å‡ºæ•°æ®åŠŸèƒ½

---

### 4.2 é˜…è¯»æ—¶é•¿åˆ†æï¼ˆæ ¸å¿ƒéœ€æ±‚ï¼‰

#### 4.2.1 éœ€æ±‚èƒŒæ™¯

é˜…è¯»æ—¶é•¿æ˜¯è¡¡é‡å†…å®¹è´¨é‡å’Œç”¨æˆ·ä»·å€¼çš„æ ¸å¿ƒæŒ‡æ ‡ï¼Œéœ€è¦ä»å¤šä¸ªç»´åº¦è¿›è¡Œæ‹†è§£åˆ†æï¼š

- **ä¹¦ç±ç»´åº¦**: æ‰¾åˆ°æœ€å—æ¬¢è¿å’Œæœ€å†·é—¨çš„å†…å®¹
- **ç”¨æˆ·ç»´åº¦**: è¯†åˆ«é«˜ä»·å€¼ç”¨æˆ·å’Œéœ€è¦æ¿€æ´»çš„ç”¨æˆ·
- **åˆ†ç±»ç»´åº¦**: æŒ‡å¯¼å†…å®¹é‡‡è´­å’Œè¿è¥ç­–ç•¥
- **æ—¶é—´ç»´åº¦**: ä¼˜åŒ–å†…å®¹æ¨èå’Œè¿è¥æ´»åŠ¨æ—¶æœº

#### 4.2.2 æ•°æ®æŒ‡æ ‡

| ç»´åº¦ | æŒ‡æ ‡ | è¯´æ˜ |
|------|------|------|
| **ä¹¦ç±ç»´åº¦** | é˜…è¯»æ—¶é•¿TOPä¹¦ç± | æ€»é˜…è¯»æ—¶é•¿æœ€å¤šçš„ä¹¦ç±ï¼ˆå‰20ï¼‰ |
| | é˜…è¯»æ—¶é•¿BOTTOMä¹¦ç± | æ€»é˜…è¯»æ—¶é•¿æœ€å°‘çš„ä¹¦ç±ï¼ˆæ’é™¤0æ—¶é•¿ï¼Œå20ï¼‰ |
| | å¹³å‡é˜…è¯»æ—¶é•¿TOPä¹¦ç± | äººå‡é˜…è¯»æ—¶é•¿æœ€é•¿çš„ä¹¦ï¼ˆè¡¡é‡æ·±åº¦ï¼‰ |
| | ä¹¦ç±é˜…è¯»è¯¦æƒ… | æ€»æ—¶é•¿/ç‹¬ç«‹è¯»è€…æ•°/ä¼šè¯æ•°/å®Œæˆç‡ |
| **ç”¨æˆ·ç»´åº¦** | é˜…è¯»æ—¶é•¿TOPç”¨æˆ· | ç´¯è®¡é˜…è¯»æ—¶é•¿æœ€é•¿çš„ç”¨æˆ·ï¼ˆå‰50ï¼‰ |
| | ç”¨æˆ·é˜…è¯»åˆ†å¸ƒ | 20%/50%/80%åˆ†ä½æ•° |
| | é‡åº¦ç”¨æˆ·ç”»åƒ | é˜…è¯»åå¥½/æ´»è·ƒæ—¶æ®µ/è®¾å¤‡åå¥½ |
| | ç”¨æˆ·é˜…è¯»è¶‹åŠ¿ | å•ä¸ªç”¨æˆ·çš„é˜…è¯»æ—¶é•¿è¶‹åŠ¿ |
| **åˆ†ç±»ç»´åº¦** | åˆ†ç±»é˜…è¯»æ—¶é•¿å æ¯” | å„åˆ†ç±»æ€»é˜…è¯»æ—¶é•¿å’Œç™¾åˆ†æ¯” |
| | åˆ†ç±»å¹³å‡é˜…è¯»æ—¶é•¿ | å„åˆ†ç±»äººå‡é˜…è¯»æ—¶é•¿ |
| | åˆ†ç±»å¢é•¿è¶‹åŠ¿ | ç¯æ¯”/åŒæ¯”å¢é•¿ç‡ |
| | åˆ†ç±»çƒ­åŠ›å›¾ | æ—¶æ®µÃ—åˆ†ç±»çš„é˜…è¯»çƒ­åŠ›åˆ†å¸ƒ |
| **æ—¶é—´ç»´åº¦** | é˜…è¯»æ—¶é•¿è¶‹åŠ¿ | æ—¥/å‘¨/æœˆè¶‹åŠ¿å›¾ |
| | å°æ—¶çº§çƒ­åŠ›å›¾ | 24å°æ—¶é˜…è¯»é«˜å³°åˆ†æ |
| | å·¥ä½œæ—¥vså‘¨æœ« | å¯¹æ¯”åˆ†æ |
| | å­£èŠ‚æ€§åˆ†æ | è¯†åˆ«å‘¨æœŸæ€§è§„å¾‹ |

#### 4.2.3 é¡µé¢è®¾è®¡

**æ–°å¢é¡µé¢**: `/reading-stats`

**é¡µé¢ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       é˜…è¯»æ—¶é•¿ç»Ÿè®¡                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [æ—¶é—´ç­›é€‰] ä»Šæ—¥ | æœ¬å‘¨ | æœ¬æœˆ | è‡ªå®šä¹‰  [åˆ·æ–°] [å¯¼å‡º]            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ æ€»é˜…è¯»æ—¶é•¿    â”‚ â”‚ æ€»é˜…è¯»ä¼šè¯    â”‚ â”‚ å¹³å‡ä¼šè¯æ—¶é•¿  â”‚            â”‚
â”‚  â”‚ 1,234,567min â”‚ â”‚ 45,678       â”‚ â”‚ 27 min       â”‚            â”‚
â”‚  â”‚ â†‘ 12.5%      â”‚ â”‚ â†‘ 8.3%       â”‚ â”‚ â†‘ 3.2%       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   é˜…è¯»æ—¶é•¿è¶‹åŠ¿                            â”‚  â”‚
â”‚  â”‚  [æŠ˜çº¿å›¾: è¿‡å»30å¤©æ¯æ—¥é˜…è¯»æ—¶é•¿]                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  24å°æ—¶é˜…è¯»çƒ­åŠ›å›¾        â”‚ â”‚  åˆ†ç±»é˜…è¯»æ—¶é•¿åˆ†å¸ƒ            â”‚  â”‚
â”‚  â”‚  [çƒ­åŠ›å›¾: å°æ—¶Ã—æ˜ŸæœŸ]     â”‚ â”‚  [é¥¼å›¾æˆ–æ¡å½¢å›¾]             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ä¹¦ç±é˜…è¯»æ—¶é•¿æ’è¡Œ TOP 20                       â”‚  â”‚
â”‚  â”‚  [è¡¨æ ¼: æ’å/å°é¢/ä¹¦å/ä½œè€…/æ€»æ—¶é•¿/è¯»è€…æ•°/å¹³å‡æ—¶é•¿]       â”‚  â”‚
â”‚  â”‚  æ”¯æŒæ’åº: æ€»æ—¶é•¿â†“/è¯»è€…æ•°/å¹³å‡æ—¶é•¿                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ç”¨æˆ·é˜…è¯»æ—¶é•¿æ’è¡Œ TOP 50                       â”‚  â”‚
â”‚  â”‚  [è¡¨æ ¼: æ’å/ç”¨æˆ·ID/æ€»æ—¶é•¿/ä¼šè¯æ•°/æ´»è·ƒå¤©æ•°/æœ€çˆ±åˆ†ç±»]       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2.4 API è®¾è®¡

**æ–°å¢æ¥å£**:

```typescript
// 1. é˜…è¯»æ—¶é•¿æ¦‚è§ˆ
GET /api/v1/admin/reading-stats/overview
Query: ?startDate=2026-01-01&endDate=2026-01-11
Response: {
  totalReadingMinutes: number;
  totalSessions: number;
  averageSessionMinutes: number;
  uniqueReaders: number;
  change: {
    readingMinutes: number;      // ç¯æ¯”å˜åŒ–
    sessions: number;
    averageSessionMinutes: number;
  };
}

// 2. é˜…è¯»æ—¶é•¿è¶‹åŠ¿
GET /api/v1/admin/reading-stats/trend
Query: ?startDate=2026-01-01&endDate=2026-01-11&granularity=day
Response: Array<{
  date: string;
  totalReadingMinutes: number;
  totalSessions: number;
  averageSessionMinutes: number;
  uniqueReaders: number;
}>

// 3. ä¹¦ç±é˜…è¯»æ—¶é•¿æ’è¡Œ
GET /api/v1/admin/reading-stats/books
Query: ?limit=20&sort=total_desc&startDate=xxx&endDate=xxx
Response: {
  items: Array<{
    rank: number;
    bookId: string;
    title: string;
    author: string;
    coverUrl: string;
    totalReadingMinutes: number;
    uniqueReaders: number;
    totalSessions: number;
    averageMinutesPerReader: number;
    completionRate: number;
  }>;
  total: number;
}

// 4. ç”¨æˆ·é˜…è¯»æ—¶é•¿æ’è¡Œ
GET /api/v1/admin/reading-stats/users
Query: ?limit=50&startDate=xxx&endDate=xxx
Response: {
  items: Array<{
    rank: number;
    userId: string;
    userName: string;
    totalReadingMinutes: number;
    totalSessions: number;
    activeDays: number;
    favoriteCategory: string;
    averageSessionMinutes: number;
  }>;
  distribution: {
    p20: number;  // 20åˆ†ä½æ•°
    p50: number;  // ä¸­ä½æ•°
    p80: number;  // 80åˆ†ä½æ•°
  };
}

// 5. åˆ†ç±»é˜…è¯»æ—¶é•¿ç»Ÿè®¡
GET /api/v1/admin/reading-stats/categories
Query: ?startDate=xxx&endDate=xxx
Response: Array<{
  category: string;
  totalReadingMinutes: number;
  percentage: number;
  uniqueReaders: number;
  averageMinutesPerReader: number;
  change: number;  // ç¯æ¯”å˜åŒ–
}>

// 6. å°æ—¶çº§çƒ­åŠ›å›¾æ•°æ®
GET /api/v1/admin/reading-stats/heatmap
Query: ?startDate=xxx&endDate=xxx
Response: Array<{
  hour: number;        // 0-23
  dayOfWeek: number;   // 0-6 (å‘¨æ—¥åˆ°å‘¨å…­)
  readingMinutes: number;
}>
```

#### 4.2.5 æ•°æ®åº“æŸ¥è¯¢ç¤ºä¾‹

**æ ¸å¿ƒæŸ¥è¯¢é€»è¾‘**:

```sql
-- 1. ä¹¦ç±é˜…è¯»æ—¶é•¿æ’è¡Œï¼ˆåŸºäº ReadingSessionï¼‰
SELECT
  b.id,
  b.title,
  b.author,
  b.cover_thumb_url,
  SUM(rs.duration_minutes) as total_reading_minutes,
  COUNT(DISTINCT rs.user_id) as unique_readers,
  COUNT(rs.id) as total_sessions,
  ROUND(SUM(rs.duration_minutes)::NUMERIC / COUNT(DISTINCT rs.user_id), 2) as avg_minutes_per_reader,
  ROUND(
    COUNT(DISTINCT CASE WHEN ub.status = 'FINISHED' THEN ub.user_id END)::NUMERIC
    / COUNT(DISTINCT rs.user_id) * 100,
    2
  ) as completion_rate
FROM reading_sessions rs
JOIN user_books ub ON rs.user_book_id = ub.id
JOIN books b ON ub.book_id = b.id
WHERE rs.started_at >= '2026-01-01'
  AND rs.started_at < '2026-01-11'
  AND rs.ended_at IS NOT NULL
GROUP BY b.id, b.title, b.author, b.cover_thumb_url
ORDER BY total_reading_minutes DESC
LIMIT 20;

-- 2. ç”¨æˆ·é˜…è¯»æ—¶é•¿æ’è¡Œ
SELECT
  u.id,
  u.name,
  SUM(rs.duration_minutes) as total_reading_minutes,
  COUNT(rs.id) as total_sessions,
  COUNT(DISTINCT DATE(rs.started_at)) as active_days,
  ROUND(AVG(rs.duration_minutes), 2) as avg_session_minutes,
  (
    SELECT b.primary_category
    FROM reading_sessions rs2
    JOIN user_books ub2 ON rs2.user_book_id = ub2.id
    JOIN books b ON ub2.book_id = b.id
    WHERE rs2.user_id = u.id
    GROUP BY b.primary_category
    ORDER BY SUM(rs2.duration_minutes) DESC
    LIMIT 1
  ) as favorite_category
FROM users u
JOIN reading_sessions rs ON u.id = rs.user_id
WHERE rs.started_at >= '2026-01-01'
  AND rs.started_at < '2026-01-11'
  AND rs.ended_at IS NOT NULL
GROUP BY u.id, u.name
ORDER BY total_reading_minutes DESC
LIMIT 50;

-- 3. åˆ†ç±»é˜…è¯»æ—¶é•¿ç»Ÿè®¡
WITH category_stats AS (
  SELECT
    b.primary_category as category,
    SUM(rs.duration_minutes) as total_reading_minutes,
    COUNT(DISTINCT rs.user_id) as unique_readers
  FROM reading_sessions rs
  JOIN user_books ub ON rs.user_book_id = ub.id
  JOIN books b ON ub.book_id = b.id
  WHERE rs.started_at >= '2026-01-01'
    AND rs.started_at < '2026-01-11'
    AND rs.ended_at IS NOT NULL
  GROUP BY b.primary_category
),
total_minutes AS (
  SELECT SUM(total_reading_minutes) as total
  FROM category_stats
)
SELECT
  cs.category,
  cs.total_reading_minutes,
  ROUND(cs.total_reading_minutes::NUMERIC / tm.total * 100, 2) as percentage,
  cs.unique_readers,
  ROUND(cs.total_reading_minutes::NUMERIC / cs.unique_readers, 2) as avg_minutes_per_reader
FROM category_stats cs
CROSS JOIN total_minutes tm
ORDER BY cs.total_reading_minutes DESC;

-- 4. å°æ—¶çº§çƒ­åŠ›å›¾
SELECT
  EXTRACT(HOUR FROM rs.started_at) as hour,
  EXTRACT(DOW FROM rs.started_at) as day_of_week,
  SUM(rs.duration_minutes) as reading_minutes
FROM reading_sessions rs
WHERE rs.started_at >= '2026-01-01'
  AND rs.started_at < '2026-01-11'
  AND rs.ended_at IS NOT NULL
GROUP BY hour, day_of_week
ORDER BY day_of_week, hour;
```

#### 4.2.6 æ€§èƒ½ä¼˜åŒ–

**ç´¢å¼•ä¼˜åŒ–**:
```sql
-- åœ¨ reading_sessions è¡¨æ·»åŠ ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_reading_sessions_started_at
  ON reading_sessions(started_at);

CREATE INDEX IF NOT EXISTS idx_reading_sessions_user_started
  ON reading_sessions(user_id, started_at);

CREATE INDEX IF NOT EXISTS idx_reading_sessions_userbook_started
  ON reading_sessions(user_book_id, started_at);
```

**æ•°æ®é¢„è®¡ç®—**:
- æ¯æ—¥å®šæ—¶ä»»åŠ¡ï¼ˆå‡Œæ™¨2ç‚¹ï¼‰è®¡ç®—å‰ä¸€å¤©çš„é˜…è¯»æ—¶é•¿ç»Ÿè®¡
- å­˜å‚¨åˆ° `operations_daily_stats` è¡¨
- Dashboard ä¼˜å…ˆè¯»å–é¢„è®¡ç®—æ•°æ®ï¼Œé™ä½å®æ—¶æŸ¥è¯¢å‹åŠ›

**ç¼“å­˜ç­–ç•¥**:
- å½“æ—¥æ•°æ®ï¼šç¼“å­˜ 5 åˆ†é’Ÿ
- å†å²æ•°æ®ï¼šç¼“å­˜ 1 å°æ—¶
- ä½¿ç”¨ Redis å­˜å‚¨çƒ­ç‚¹æ•°æ®

---

### 4.3 ç•™å­˜ç‡åˆ†æ

#### 4.3.1 æ•°æ®æŒ‡æ ‡

| æŒ‡æ ‡ | è¯´æ˜ |
|------|------|
| æ¬¡æ—¥ç•™å­˜ç‡ | æ³¨å†Œåç¬¬2å¤©ç»§ç»­ä½¿ç”¨çš„ç”¨æˆ·å æ¯” |
| 7æ—¥ç•™å­˜ç‡ | æ³¨å†Œåç¬¬8å¤©ç»§ç»­ä½¿ç”¨çš„ç”¨æˆ·å æ¯” |
| 30æ—¥ç•™å­˜ç‡ | æ³¨å†Œåç¬¬31å¤©ç»§ç»­ä½¿ç”¨çš„ç”¨æˆ·å æ¯” |
| ç•™å­˜æ›²çº¿ | 1-90å¤©ç•™å­˜ç‡è¶‹åŠ¿ |
| æ¸ é“ç•™å­˜å¯¹æ¯” | ä¸åŒæ¸ é“ç”¨æˆ·çš„ç•™å­˜å·®å¼‚ |

#### 4.3.2 é¡µé¢è®¾è®¡

**æ–°å¢é¡µé¢**: `/user-retention`

**é¡µé¢ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·ç•™å­˜åˆ†æ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [é€‰æ‹©cohort] 2026-01-01 æ³¨å†Œç”¨æˆ· [å¯¹æ¯”å¦ä¸€ä¸ªcohort]            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ æ¬¡æ—¥ç•™å­˜      â”‚ â”‚ 7æ—¥ç•™å­˜       â”‚ â”‚ 30æ—¥ç•™å­˜      â”‚            â”‚
â”‚  â”‚ 45.2%        â”‚ â”‚ 23.8%        â”‚ â”‚ 12.5%        â”‚            â”‚
â”‚  â”‚ â†‘ 3.2pp      â”‚ â”‚ â†‘ 1.5pp      â”‚ â”‚ â†“ 0.8pp      â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  ç•™å­˜æ›²çº¿ï¼ˆ1-90å¤©ï¼‰                        â”‚  â”‚
â”‚  â”‚  [æŠ˜çº¿å›¾: æ˜¾ç¤ºç•™å­˜ç‡éšå¤©æ•°çš„è¡°å‡]                         â”‚  â”‚
â”‚  â”‚  æ”¯æŒå¯¹æ¯”å¤šä¸ª cohort                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  æ¸ é“ç•™å­˜å¯¹æ¯”                              â”‚  â”‚
â”‚  â”‚  [è¡¨æ ¼: æ¸ é“/æ³¨å†Œæ•°/æ¬¡æ—¥ç•™å­˜/7æ—¥ç•™å­˜/30æ—¥ç•™å­˜]            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.3.3 API è®¾è®¡

```typescript
// ç•™å­˜ç‡æ¦‚è§ˆ
GET /api/v1/admin/retention/overview
Query: ?cohortDate=2026-01-01
Response: {
  cohortDate: string;
  cohortSize: number;  // è¯¥æ‰¹æ¬¡æ³¨å†Œç”¨æˆ·æ•°
  retention: {
    day1: number;   // æ¬¡æ—¥ç•™å­˜ç‡
    day7: number;   // 7æ—¥ç•™å­˜ç‡
    day30: number;  // 30æ—¥ç•™å­˜ç‡
  };
  comparison: {     // ä¸ä¸Šä¸€ä¸ªcohortå¯¹æ¯”
    day1: number;
    day7: number;
    day30: number;
  };
}

// ç•™å­˜æ›²çº¿
GET /api/v1/admin/retention/curve
Query: ?cohortDate=2026-01-01&days=90
Response: Array<{
  day: number;
  retentionRate: number;
  activeUsers: number;
}>

// æ¸ é“ç•™å­˜å¯¹æ¯”
GET /api/v1/admin/retention/by-channel
Query: ?startDate=2026-01-01&endDate=2026-01-31
Response: Array<{
  channel: string;
  cohortSize: number;
  day1Retention: number;
  day7Retention: number;
  day30Retention: number;
}>
```

#### 4.3.4 æ•°æ®åº“è®¾è®¡

**æ–°å¢è¡¨**: `user_retention`

```sql
CREATE TABLE user_retention (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  cohort_date DATE NOT NULL,
  channel VARCHAR(50),
  cohort_size INT NOT NULL,
  day1_retained INT DEFAULT 0,
  day7_retained INT DEFAULT 0,
  day30_retained INT DEFAULT 0,
  day1_retention_rate NUMERIC(5,2),
  day7_retention_rate NUMERIC(5,2),
  day30_retention_rate NUMERIC(5,2),
  calculated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(cohort_date, channel)
);

CREATE INDEX idx_user_retention_cohort_date ON user_retention(cohort_date);
CREATE INDEX idx_user_retention_channel ON user_retention(channel);
```

#### 4.3.5 è®¡ç®—é€»è¾‘

**å®šæ—¶ä»»åŠ¡ï¼ˆæ¯æ—¥å‡Œæ™¨3ç‚¹ï¼‰**:

```sql
-- è®¡ç®—å„ cohort çš„ç•™å­˜ç‡
WITH cohorts AS (
  SELECT
    DATE(created_at) as cohort_date,
    channel,
    id as user_id,
    created_at
  FROM users
  WHERE created_at >= CURRENT_DATE - INTERVAL '90 days'
),
retention_calc AS (
  SELECT
    c.cohort_date,
    c.channel,
    COUNT(DISTINCT c.user_id) as cohort_size,
    -- æ¬¡æ—¥ç•™å­˜
    COUNT(DISTINCT CASE
      WHEN u.last_active_at >= c.created_at + INTERVAL '1 day'
        AND u.last_active_at < c.created_at + INTERVAL '2 days'
      THEN c.user_id
    END) as day1_retained,
    -- 7æ—¥ç•™å­˜
    COUNT(DISTINCT CASE
      WHEN u.last_active_at >= c.created_at + INTERVAL '7 days'
        AND u.last_active_at < c.created_at + INTERVAL '8 days'
      THEN c.user_id
    END) as day7_retained,
    -- 30æ—¥ç•™å­˜
    COUNT(DISTINCT CASE
      WHEN u.last_active_at >= c.created_at + INTERVAL '30 days'
        AND u.last_active_at < c.created_at + INTERVAL '31 days'
      THEN c.user_id
    END) as day30_retained
  FROM cohorts c
  JOIN users u ON c.user_id = u.id
  GROUP BY c.cohort_date, c.channel
)
INSERT INTO user_retention (
  cohort_date,
  channel,
  cohort_size,
  day1_retained,
  day7_retained,
  day30_retained,
  day1_retention_rate,
  day7_retention_rate,
  day30_retention_rate
)
SELECT
  cohort_date,
  channel,
  cohort_size,
  day1_retained,
  day7_retained,
  day30_retained,
  ROUND(day1_retained::NUMERIC / cohort_size * 100, 2),
  ROUND(day7_retained::NUMERIC / cohort_size * 100, 2),
  ROUND(day30_retained::NUMERIC / cohort_size * 100, 2)
FROM retention_calc
ON CONFLICT (cohort_date, channel)
DO UPDATE SET
  cohort_size = EXCLUDED.cohort_size,
  day1_retained = EXCLUDED.day1_retained,
  day7_retained = EXCLUDED.day7_retained,
  day30_retained = EXCLUDED.day30_retained,
  day1_retention_rate = EXCLUDED.day1_retention_rate,
  day7_retention_rate = EXCLUDED.day7_retention_rate,
  day30_retention_rate = EXCLUDED.day30_retention_rate,
  calculated_at = NOW();
```

---

### 4.4 è®¢é˜…è½¬åŒ–ä¸æ”¶å…¥åˆ†æ

#### 4.4.1 éœ€æ±‚èƒŒæ™¯

Readmigo é‡‡ç”¨**è®¢é˜…åˆ¶**å•†ä¸šæ¨¡å¼ï¼Œæä¾›æœˆåº¦/å­£åº¦/å¹´åº¦ä¼šå‘˜è®¢é˜…ã€‚éœ€è¦é‡ç‚¹å…³æ³¨è®¢é˜…åˆ¶äº§å“çš„æ ¸å¿ƒæŒ‡æ ‡ï¼Œä¸å•æ¬¡ä»˜è´¹äº§å“æœ‰æœ¬è´¨åŒºåˆ«ã€‚

#### 4.4.2 æ•°æ®æŒ‡æ ‡

**è®¢é˜…å¥åº·åº¦æŒ‡æ ‡**:

| ç»´åº¦ | æŒ‡æ ‡ | è¯´æ˜ | é‡è¦æ€§ |
|------|------|------|-------|
| **æ”¶å…¥æŒ‡æ ‡** | MRRï¼ˆæœˆåº¦ç»å¸¸æ€§æ”¶å…¥ï¼‰ | æ‰€æœ‰æ´»è·ƒè®¢é˜…çš„æœˆåº¦æ”¶å…¥ | â­â­â­â­â­ |
| | ARRï¼ˆå¹´åº¦ç»å¸¸æ€§æ”¶å…¥ï¼‰ | MRR Ã— 12 | â­â­â­â­â­ |
| | æ–°å¢ MRR | æ–°è®¢é˜…å¸¦æ¥çš„ MRR | â­â­â­â­ |
| | æµå¤± MRR | å–æ¶ˆ/åˆ°æœŸè®¢é˜…æŸå¤±çš„ MRR | â­â­â­â­â­ |
| | æ‰©å±• MRR | å‡çº§è®¢é˜…å¸¦æ¥çš„ MRR | â­â­â­ |
| | é™çº§ MRR | é™çº§è®¢é˜…æŸå¤±çš„ MRR | â­â­â­ |
| **ç”¨æˆ·æŒ‡æ ‡** | æ´»è·ƒè®¢é˜…ç”¨æˆ·æ•° | å½“å‰æœ‰æ•ˆè®¢é˜…çš„ç”¨æˆ·æ•° | â­â­â­â­â­ |
| | æ–°å¢è®¢é˜…ç”¨æˆ· | æœ¬æœŸæ–°ä»˜è´¹ç”¨æˆ· | â­â­â­â­ |
| | æµå¤±è®¢é˜…ç”¨æˆ· | æœ¬æœŸå–æ¶ˆ/åˆ°æœŸç”¨æˆ· | â­â­â­â­â­ |
| | ARPU | äººå‡æ”¶å…¥ï¼ˆæ‰€æœ‰ç”¨æˆ·ï¼‰ | â­â­â­â­ |
| | ARPPU | äººå‡æ”¶å…¥ï¼ˆä»…ä»˜è´¹ç”¨æˆ·ï¼‰ | â­â­â­ |
| **è½¬åŒ–æŒ‡æ ‡** | æ³¨å†Œâ†’è¯•ç”¨è½¬åŒ–ç‡ | æ³¨å†Œåå¼€å§‹è¯•ç”¨çš„æ¯”ä¾‹ | â­â­â­â­ |
| | è¯•ç”¨â†’ä»˜è´¹è½¬åŒ–ç‡ | è¯•ç”¨åè½¬ä¸ºä»˜è´¹çš„æ¯”ä¾‹ | â­â­â­â­â­ |
| | æ•´ä½“ä»˜è´¹è½¬åŒ–ç‡ | æ³¨å†Œâ†’ä»˜è´¹çš„æ•´ä½“è½¬åŒ– | â­â­â­â­ |
| **ç•™å­˜æŒ‡æ ‡** | æœˆåº¦æµå¤±ç‡ï¼ˆChurn Rateï¼‰ | å½“æœˆå–æ¶ˆè®¢é˜…çš„æ¯”ä¾‹ | â­â­â­â­â­ |
| | ç»­è´¹ç‡ï¼ˆRenewal Rateï¼‰ | åˆ°æœŸåç»­è´¹çš„æ¯”ä¾‹ | â­â­â­â­â­ |
| | å‡çº§ç‡ | è®¢é˜…å‡çº§çš„æ¯”ä¾‹ | â­â­â­ |
| | é™çº§ç‡ | è®¢é˜…é™çº§çš„æ¯”ä¾‹ | â­â­â­ |
| **è®¢é˜…åˆ†å¸ƒ** | æœˆåº¦ä¼šå‘˜å æ¯” | æœˆåº¦è®¢é˜…ç”¨æˆ·æ•°/æ€»æ•° | â­â­â­ |
| | å­£åº¦ä¼šå‘˜å æ¯” | å­£åº¦è®¢é˜…ç”¨æˆ·æ•°/æ€»æ•° | â­â­â­ |
| | å¹´åº¦ä¼šå‘˜å æ¯” | å¹´åº¦è®¢é˜…ç”¨æˆ·æ•°/æ€»æ•° | â­â­â­ |
| | è¯•ç”¨ç”¨æˆ·å æ¯” | è¯•ç”¨æœŸç”¨æˆ·æ•°/æ€»æ•° | â­â­â­ |
| **ä»·å€¼æŒ‡æ ‡** | LTVï¼ˆç”¨æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼ï¼‰ | å•ä¸ªç”¨æˆ·é¢„æœŸæ€»æ”¶å…¥ | â­â­â­â­â­ |
| | CACï¼ˆè·å®¢æˆæœ¬ï¼‰ | å•ä¸ªç”¨æˆ·è·å–æˆæœ¬ | â­â­â­â­ |
| | LTV/CAC æ¯”ç‡ | æŠ•èµ„å›æŠ¥ç‡ | â­â­â­â­â­ |

#### 4.4.3 é¡µé¢è®¾è®¡

**æ–°å¢é¡µé¢**: `/subscription-analytics`

**é¡µé¢ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       è®¢é˜…ä¸æ”¶å…¥åˆ†æ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [æ—¶é—´ç­›é€‰] æœ¬æœˆ | æœ¬å­£åº¦ | æœ¬å¹´ | è‡ªå®šä¹‰  [åˆ·æ–°] [å¯¼å‡º]        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ MRR          â”‚ â”‚ ARR          â”‚ â”‚ æ´»è·ƒè®¢é˜…      â”‚            â”‚
â”‚  â”‚ $12,345      â”‚ â”‚ $148,140     â”‚ â”‚ 1,234        â”‚            â”‚
â”‚  â”‚ â†‘ 8.5%       â”‚ â”‚ â†‘ 8.5%       â”‚ â”‚ â†‘ 45         â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ æœˆåº¦æµå¤±ç‡    â”‚ â”‚ è¯•ç”¨è½¬åŒ–ç‡    â”‚ â”‚ ç»­è´¹ç‡        â”‚            â”‚
â”‚  â”‚ 4.2%         â”‚ â”‚ 12.5%        â”‚ â”‚ 78.3%        â”‚            â”‚
â”‚  â”‚ â†“ 0.5pp      â”‚ â”‚ â†‘ 1.2pp      â”‚ â”‚ â†‘ 2.1pp      â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   MRR è¶‹åŠ¿ä¸æ„æˆ                           â”‚  â”‚
â”‚  â”‚  [å †å é¢ç§¯å›¾: æ–°å¢MRR/æ‰©å±•MRR/æµå¤±MRR/å‡€MRR]              â”‚  â”‚
â”‚  â”‚  æ˜¾ç¤º MRR å¢é•¿è½¨è¿¹å’Œå„éƒ¨åˆ†è´¡çŒ®                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è®¢é˜…ç±»å‹åˆ†å¸ƒ            â”‚ â”‚  è®¢é˜…è½¬åŒ–æ¼æ–—                â”‚  â”‚
â”‚  â”‚  [é¥¼å›¾]                â”‚ â”‚  [æ¼æ–—å›¾]                    â”‚  â”‚
â”‚  â”‚  Â· æœˆåº¦ 45%            â”‚ â”‚  æ³¨å†Œ (100%)                 â”‚  â”‚
â”‚  â”‚  Â· å­£åº¦ 15%            â”‚ â”‚    â†“                         â”‚  â”‚
â”‚  â”‚  Â· å¹´åº¦ 35%            â”‚ â”‚  å¼€å§‹è¯•ç”¨ (65%)              â”‚  â”‚
â”‚  â”‚  Â· è¯•ç”¨  5%            â”‚ â”‚    â†“                         â”‚  â”‚
â”‚  â”‚                        â”‚ â”‚  è½¬ä¸ºä»˜è´¹ (12.5%)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   è®¢é˜…å¥åº·åº¦æŒ‡æ ‡                           â”‚  â”‚
â”‚  â”‚  [è¡¨æ ¼]                                                   â”‚  â”‚
â”‚  â”‚  æŒ‡æ ‡          | æœ¬æœˆ    | ä¸Šæœˆ    | å˜åŒ–   | è¶‹åŠ¿å›¾      â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚
â”‚  â”‚  æ–°å¢ MRR      | $2,345 | $2,100 | +11.7%| â†—          â”‚  â”‚
â”‚  â”‚  æµå¤± MRR      | $  520 | $  680 | -23.5%| â†˜          â”‚  â”‚
â”‚  â”‚  æ‰©å±• MRR      | $  180 | $  150 | +20.0%| â†—          â”‚  â”‚
â”‚  â”‚  é™çº§ MRR      | $   80 | $   90 | -11.1%| â†˜          â”‚  â”‚
â”‚  â”‚  å‡€å¢ MRR      | $1,925 | $1,480 | +30.1%| â†—          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              è®¢é˜…ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼ï¼ˆLTVï¼‰                   â”‚  â”‚
â”‚  â”‚  [å¡ç‰‡ç»„]                                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚  â”‚  â”‚ æœˆåº¦ä¼šå‘˜LTV  â”‚ â”‚ å­£åº¦ä¼šå‘˜LTV  â”‚ â”‚ å¹´åº¦ä¼šå‘˜LTV  â”‚         â”‚  â”‚
â”‚  â”‚  â”‚ $45.20      â”‚ â”‚ $89.50      â”‚ â”‚ $156.80     â”‚         â”‚  â”‚
â”‚  â”‚  â”‚ (3.2ä¸ªæœˆ)   â”‚ â”‚ (4.5ä¸ªæœˆ)   â”‚ â”‚ (13.2ä¸ªæœˆ)  â”‚         â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   è¿‘æœŸè®¢é˜…åŠ¨æ€                             â”‚  â”‚
â”‚  â”‚  [è¡¨æ ¼: æ—¶é—´/ç”¨æˆ·/ç±»å‹/å¥—é¤/é‡‘é¢/çŠ¶æ€/æ¥æºå¹³å°]           â”‚  â”‚
â”‚  â”‚  æ”¯æŒç­›é€‰: æ–°è®¢é˜…/ç»­è´¹/å‡çº§/é™çº§/å–æ¶ˆ                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.4.4 API è®¾è®¡

**æ–°å¢æ¥å£**:

```typescript
// 1. è®¢é˜…æ¦‚è§ˆ
GET /api/v1/admin/subscription/overview
Query: ?date=2026-01-31  // æŸ¥è¯¢æˆªè‡³æŸæ—¥çš„æ•°æ®
Response: {
  // æ”¶å…¥æŒ‡æ ‡
  mrr: number;                    // æœˆåº¦ç»å¸¸æ€§æ”¶å…¥
  arr: number;                    // å¹´åº¦ç»å¸¸æ€§æ”¶å…¥
  newMrr: number;                 // æ–°å¢ MRR
  churnedMrr: number;             // æµå¤± MRR
  expansionMrr: number;           // æ‰©å±• MRRï¼ˆå‡çº§ï¼‰
  contractionMrr: number;         // é™çº§ MRR
  netNewMrr: number;              // å‡€æ–°å¢ MRR

  // ç”¨æˆ·æŒ‡æ ‡
  activeSubscriptions: number;    // æ´»è·ƒè®¢é˜…æ•°
  newSubscriptions: number;       // æ–°å¢è®¢é˜…
  churnedSubscriptions: number;   // æµå¤±è®¢é˜…
  trialingUsers: number;          // è¯•ç”¨ä¸­ç”¨æˆ·

  // æ¯”ç‡æŒ‡æ ‡
  monthlyChurnRate: number;       // æœˆåº¦æµå¤±ç‡ %
  trialConversionRate: number;    // è¯•ç”¨è½¬åŒ–ç‡ %
  renewalRate: number;            // ç»­è´¹ç‡ %
  upgradeRate: number;            // å‡çº§ç‡ %
  downgradeRate: number;          // é™çº§ç‡ %

  // å¯¹æ¯”æ•°æ®ï¼ˆä¸ä¸ŠæœŸæ¯”è¾ƒï¼‰
  change: {
    mrr: number;                  // MRR ç¯æ¯”å˜åŒ–
    activeSubscriptions: number;  // æ´»è·ƒè®¢é˜…ç¯æ¯”å˜åŒ–
    churnRate: number;            // æµå¤±ç‡ç¯æ¯”å˜åŒ–ï¼ˆç™¾åˆ†ç‚¹ï¼‰
  };
}

// 2. MRR è¶‹åŠ¿
GET /api/v1/admin/subscription/mrr-trend
Query: ?startDate=2026-01-01&endDate=2026-01-31&granularity=day
Response: Array<{
  date: string;
  mrr: number;
  newMrr: number;
  churnedMrr: number;
  expansionMrr: number;
  contractionMrr: number;
  netNewMrr: number;
}>

// 3. è®¢é˜…ç±»å‹åˆ†å¸ƒ
GET /api/v1/admin/subscription/plan-distribution
Query: ?date=2026-01-31
Response: {
  items: Array<{
    planType: 'MONTHLY' | 'QUARTERLY' | 'YEARLY' | 'TRIAL';
    subscriptionCount: number;
    percentage: number;
    mrr: number;
    avgLifetimeMonths: number;
    ltv: number;
  }>;
}

// 4. è®¢é˜…è½¬åŒ–æ¼æ–—
GET /api/v1/admin/subscription/conversion-funnel
Query: ?startDate=2026-01-01&endDate=2026-01-31
Response: {
  stages: [
    {
      name: 'registered';        // æ³¨å†Œç”¨æˆ·
      users: number;
      percentage: 100;
    },
    {
      name: 'trial_started';     // å¼€å§‹è¯•ç”¨
      users: number;
      percentage: number;
      conversionRate: number;    // ä»ä¸Šä¸€é˜¶æ®µçš„è½¬åŒ–ç‡
    },
    {
      name: 'trial_converted';   // è¯•ç”¨è½¬ä»˜è´¹
      users: number;
      percentage: number;
      conversionRate: number;
    }
  ];
}

// 5. è®¢é˜…å¥åº·åº¦æŒ‡æ ‡
GET /api/v1/admin/subscription/health-metrics
Query: ?startDate=2026-01-01&endDate=2026-01-31
Response: {
  // Quick Ratio = (æ–°å¢MRR + æ‰©å±•MRR) / (æµå¤±MRR + é™çº§MRR)
  // å¥åº·æ ‡å‡†ï¼š> 4 ä¼˜ç§€, 2-4 è‰¯å¥½, < 2 éœ€æ”¹è¿›
  quickRatio: number;

  // MRR Churn Rate = æµå¤±MRR / æœˆåˆMRR
  mrrChurnRate: number;

  // Customer Churn Rate = æµå¤±ç”¨æˆ· / æœˆåˆç”¨æˆ·æ•°
  customerChurnRate: number;

  // Net MRR Retention = (æœˆåˆMRR + æ‰©å±•MRR - æµå¤±MRR - é™çº§MRR) / æœˆåˆMRR
  // å¥åº·æ ‡å‡†ï¼š> 100% ä¼˜ç§€ï¼ˆè´Ÿæµå¤±ï¼‰, 90-100% è‰¯å¥½, < 90% éœ€æ”¹è¿›
  netMrrRetention: number;

  // LTV/CAC æ¯”ç‡
  ltvCacRatio: number;

  // å¹³å‡ LTV
  avgLtv: number;

  // å¹³å‡è®¢é˜…æ—¶é•¿ï¼ˆæœˆï¼‰
  avgSubscriptionMonths: number;

  // å¥åº·åº¦è¯„åˆ†ï¼ˆç»¼åˆè¯„åˆ† 0-100ï¼‰
  healthScore: number;
}

// 6. è®¢é˜…åŠ¨æ€åˆ—è¡¨
GET /api/v1/admin/subscription/activity
Query: ?page=1&limit=20&type=all|new|renewal|upgrade|downgrade|cancel&startDate=xxx&endDate=xxx
Response: {
  items: Array<{
    id: string;
    userId: string;
    userName: string;
    type: 'NEW' | 'RENEWAL' | 'UPGRADE' | 'DOWNGRADE' | 'CANCEL';
    planType: 'MONTHLY' | 'QUARTERLY' | 'YEARLY';
    amount: number;
    status: 'ACTIVE' | 'TRIALING' | 'CANCELED' | 'EXPIRED';
    source: 'IOS' | 'ANDROID' | 'WEB';
    startDate: string;
    endDate: string;
    createdAt: string;
  }>;
  total: number;
}

// 7. LTV åˆ†æ
GET /api/v1/admin/subscription/ltv-analysis
Response: {
  byPlanType: Array<{
    planType: 'MONTHLY' | 'QUARTERLY' | 'YEARLY';
    ltv: number;
    avgLifetimeMonths: number;
    churnRate: number;
    sampleSize: number;
  }>;
  overall: {
    avgLtv: number;
    avgLifetimeMonths: number;
  };
}
```

#### 4.4.5 æ•°æ®åº“æŸ¥è¯¢

**æ ¸å¿ƒè¡¨**: `subscriptions` (å·²å­˜åœ¨ï¼ŒåŒ…å«è®¢é˜…ä¿¡æ¯)

**å…³é”®æŸ¥è¯¢ç¤ºä¾‹**:

**1. è®¡ç®— MRRï¼ˆæœˆåº¦ç»å¸¸æ€§æ”¶å…¥ï¼‰**

```sql
-- è®¡ç®—æŒ‡å®šæ—¥æœŸçš„ MRR
-- MRR = æ‰€æœ‰æ´»è·ƒè®¢é˜…çš„æœˆåº¦æ ‡å‡†åŒ–æ”¶å…¥
WITH target_date AS (
  SELECT '2026-01-31'::DATE as date
),
active_subscriptions AS (
  SELECT
    s.id,
    s.user_id,
    s.plan_type,
    s.price_cents,
    s.status,
    s.current_period_start,
    s.current_period_end,
    s.created_at,
    -- æ ‡å‡†åŒ–ä¸ºæœˆåº¦æ”¶å…¥
    CASE
      WHEN s.plan_type = 'MONTHLY' THEN s.price_cents / 100.0
      WHEN s.plan_type = 'QUARTERLY' THEN (s.price_cents / 100.0) / 3
      WHEN s.plan_type = 'YEARLY' THEN (s.price_cents / 100.0) / 12
      ELSE 0
    END as monthly_revenue
  FROM subscriptions s
  CROSS JOIN target_date td
  WHERE s.status IN ('ACTIVE', 'TRIALING')
    AND s.current_period_start <= td.date
    AND s.current_period_end >= td.date
)
SELECT
  SUM(monthly_revenue) as mrr,
  SUM(monthly_revenue) * 12 as arr,
  COUNT(*) as active_subscriptions,
  COUNT(DISTINCT user_id) as active_subscribers
FROM active_subscriptions;
```

**2. è®¡ç®— MRR å˜åŒ–ï¼ˆæ–°å¢/æµå¤±/æ‰©å±•/é™çº§ï¼‰**

```sql
-- è®¡ç®—æœ¬æœˆ MRR å˜åŒ–
WITH month_range AS (
  SELECT
    '2026-01-01'::DATE as month_start,
    '2026-01-31'::DATE as month_end,
    '2025-12-31'::DATE as prev_month_end
),
-- ä¸Šæœˆæœ«çš„ MRR
prev_mrr AS (
  SELECT
    s.user_id,
    s.plan_type,
    CASE
      WHEN s.plan_type = 'MONTHLY' THEN s.price_cents / 100.0
      WHEN s.plan_type = 'QUARTERLY' THEN (s.price_cents / 100.0) / 3
      WHEN s.plan_type = 'YEARLY' THEN (s.price_cents / 100.0) / 12
      ELSE 0
    END as mrr
  FROM subscriptions s
  CROSS JOIN month_range mr
  WHERE s.status IN ('ACTIVE', 'TRIALING')
    AND s.current_period_start <= mr.prev_month_end
    AND s.current_period_end >= mr.prev_month_end
),
-- æœ¬æœˆæœ«çš„ MRR
curr_mrr AS (
  SELECT
    s.user_id,
    s.plan_type,
    CASE
      WHEN s.plan_type = 'MONTHLY' THEN s.price_cents / 100.0
      WHEN s.plan_type = 'QUARTERLY' THEN (s.price_cents / 100.0) / 3
      WHEN s.plan_type = 'YEARLY' THEN (s.price_cents / 100.0) / 12
      ELSE 0
    END as mrr
  FROM subscriptions s
  CROSS JOIN month_range mr
  WHERE s.status IN ('ACTIVE', 'TRIALING')
    AND s.current_period_start <= mr.month_end
    AND s.current_period_end >= mr.month_end
)
SELECT
  -- æ–°å¢ MRRï¼šæœ¬æœˆæœ‰ä½†ä¸Šæœˆæ²¡æœ‰çš„ç”¨æˆ·
  COALESCE(SUM(CASE WHEN p.user_id IS NULL THEN c.mrr ELSE 0 END), 0) as new_mrr,

  -- æµå¤± MRRï¼šä¸Šæœˆæœ‰ä½†æœ¬æœˆæ²¡æœ‰çš„ç”¨æˆ·
  COALESCE(SUM(CASE WHEN c.user_id IS NULL THEN p.mrr ELSE 0 END), 0) as churned_mrr,

  -- æ‰©å±• MRRï¼šä¸¤æœˆéƒ½æœ‰ä¸”æ”¶å…¥å¢åŠ 
  COALESCE(SUM(CASE
    WHEN p.user_id IS NOT NULL AND c.user_id IS NOT NULL AND c.mrr > p.mrr
    THEN c.mrr - p.mrr
    ELSE 0
  END), 0) as expansion_mrr,

  -- é™çº§ MRRï¼šä¸¤æœˆéƒ½æœ‰ä¸”æ”¶å…¥å‡å°‘
  COALESCE(SUM(CASE
    WHEN p.user_id IS NOT NULL AND c.user_id IS NOT NULL AND c.mrr < p.mrr
    THEN p.mrr - c.mrr
    ELSE 0
  END), 0) as contraction_mrr,

  -- å‡€æ–°å¢ MRR
  COALESCE(SUM(CASE WHEN p.user_id IS NULL THEN c.mrr ELSE 0 END), 0) -
  COALESCE(SUM(CASE WHEN c.user_id IS NULL THEN p.mrr ELSE 0 END), 0) +
  COALESCE(SUM(CASE
    WHEN p.user_id IS NOT NULL AND c.user_id IS NOT NULL AND c.mrr > p.mrr
    THEN c.mrr - p.mrr
    ELSE 0
  END), 0) -
  COALESCE(SUM(CASE
    WHEN p.user_id IS NOT NULL AND c.user_id IS NOT NULL AND c.mrr < p.mrr
    THEN p.mrr - c.mrr
    ELSE 0
  END), 0) as net_new_mrr
FROM prev_mrr p
FULL OUTER JOIN curr_mrr c ON p.user_id = c.user_id;
```

**3. è®¡ç®—æµå¤±ç‡å’Œç»­è´¹ç‡**

```sql
-- è®¡ç®—æœ¬æœˆæµå¤±ç‡å’Œç»­è´¹ç‡
WITH month_range AS (
  SELECT
    '2026-01-01'::DATE as month_start,
    '2026-01-31'::DATE as month_end
),
-- æœˆåˆæ´»è·ƒè®¢é˜…æ•°
start_active AS (
  SELECT COUNT(DISTINCT user_id) as count
  FROM subscriptions s
  CROSS JOIN month_range mr
  WHERE s.status IN ('ACTIVE', 'TRIALING')
    AND s.current_period_start < mr.month_start
    AND s.current_period_end >= mr.month_start
),
-- æœ¬æœˆæµå¤±çš„è®¢é˜…ï¼ˆå–æ¶ˆæˆ–åˆ°æœŸæœªç»­è´¹ï¼‰
churned_this_month AS (
  SELECT COUNT(DISTINCT user_id) as count
  FROM subscriptions s
  CROSS JOIN month_range mr
  WHERE s.status IN ('CANCELED', 'EXPIRED')
    AND s.current_period_end >= mr.month_start
    AND s.current_period_end <= mr.month_end
),
-- æœ¬æœˆåˆ°æœŸçš„è®¢é˜…
expired_this_month AS (
  SELECT COUNT(DISTINCT user_id) as count
  FROM subscriptions s
  CROSS JOIN month_range mr
  WHERE s.current_period_end >= mr.month_start
    AND s.current_period_end <= mr.month_end
),
-- æœ¬æœˆç»­è´¹çš„è®¢é˜…ï¼ˆåˆ°æœŸåæœ‰æ–°è®¢é˜…ï¼‰
renewed_this_month AS (
  SELECT COUNT(DISTINCT s1.user_id) as count
  FROM subscriptions s1
  INNER JOIN subscriptions s2 ON s1.user_id = s2.user_id
  CROSS JOIN month_range mr
  WHERE s1.current_period_end >= mr.month_start
    AND s1.current_period_end <= mr.month_end
    AND s2.created_at >= s1.current_period_end
    AND s2.created_at <= s1.current_period_end + INTERVAL '7 days'
)
SELECT
  sa.count as start_active_subscriptions,
  ctm.count as churned_subscriptions,
  etm.count as expired_subscriptions,
  rtm.count as renewed_subscriptions,
  ROUND(ctm.count::NUMERIC / NULLIF(sa.count, 0) * 100, 2) as churn_rate_percent,
  ROUND(rtm.count::NUMERIC / NULLIF(etm.count, 0) * 100, 2) as renewal_rate_percent
FROM start_active sa, churned_this_month ctm, expired_this_month etm, renewed_this_month rtm;
```

**4. è®¢é˜…è½¬åŒ–æ¼æ–—æŸ¥è¯¢**

```sql
-- è®¢é˜…è½¬åŒ–æ¼æ–—ï¼šæ³¨å†Œ â†’ è¯•ç”¨ â†’ ä»˜è´¹
WITH time_range AS (
  SELECT
    '2026-01-01'::DATE as start_date,
    '2026-01-31'::DATE as end_date
),
-- æ³¨å†Œç”¨æˆ·
registered_users AS (
  SELECT COUNT(*) as count
  FROM users u
  CROSS JOIN time_range tr
  WHERE u.created_at >= tr.start_date
    AND u.created_at <= tr.end_date
),
-- å¼€å§‹è¯•ç”¨çš„ç”¨æˆ·
trial_users AS (
  SELECT COUNT(DISTINCT s.user_id) as count
  FROM subscriptions s
  INNER JOIN users u ON s.user_id = u.id
  CROSS JOIN time_range tr
  WHERE u.created_at >= tr.start_date
    AND u.created_at <= tr.end_date
    AND s.status = 'TRIALING'
),
-- è½¬ä¸ºä»˜è´¹çš„ç”¨æˆ·
paid_users AS (
  SELECT COUNT(DISTINCT s.user_id) as count
  FROM subscriptions s
  INNER JOIN users u ON s.user_id = u.id
  CROSS JOIN time_range tr
  WHERE u.created_at >= tr.start_date
    AND u.created_at <= tr.end_date
    AND s.status = 'ACTIVE'
)
SELECT
  ru.count as registered,
  tu.count as trial_started,
  pu.count as trial_converted,
  ROUND(tu.count::NUMERIC / NULLIF(ru.count, 0) * 100, 2) as trial_start_rate,
  ROUND(pu.count::NUMERIC / NULLIF(tu.count, 0) * 100, 2) as trial_conversion_rate,
  ROUND(pu.count::NUMERIC / NULLIF(ru.count, 0) * 100, 2) as overall_conversion_rate
FROM registered_users ru, trial_users tu, paid_users pu;
```

**5. LTVï¼ˆç”¨æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼ï¼‰è®¡ç®—**

```sql
-- æŒ‰è®¢é˜…ç±»å‹è®¡ç®— LTV
-- LTV = ARPU / Churn Rate
-- æˆ– LTV = å¹³å‡è®¢é˜…æ—¶é•¿ï¼ˆæœˆï¼‰Ã— æœˆåº¦ä»·æ ¼
WITH subscription_lifetimes AS (
  SELECT
    s.plan_type,
    s.user_id,
    s.price_cents / 100.0 as price,
    -- è®¡ç®—è®¢é˜…æ—¶é•¿ï¼ˆæœˆï¼‰
    CASE
      WHEN s.status IN ('CANCELED', 'EXPIRED') THEN
        EXTRACT(EPOCH FROM (s.current_period_end - s.created_at)) / 2592000  -- 30å¤©
      ELSE
        EXTRACT(EPOCH FROM (CURRENT_DATE - s.created_at)) / 2592000
    END as lifetime_months,
    -- æœˆåº¦ä»·æ ¼
    CASE
      WHEN s.plan_type = 'MONTHLY' THEN s.price_cents / 100.0
      WHEN s.plan_type = 'QUARTERLY' THEN (s.price_cents / 100.0) / 3
      WHEN s.plan_type = 'YEARLY' THEN (s.price_cents / 100.0) / 12
      ELSE 0
    END as monthly_price
  FROM subscriptions s
  WHERE s.created_at < CURRENT_DATE - INTERVAL '30 days'  -- è‡³å°‘æœ‰1ä¸ªæœˆå†å²
)
SELECT
  plan_type,
  COUNT(*) as sample_size,
  ROUND(AVG(lifetime_months), 2) as avg_lifetime_months,
  ROUND(AVG(monthly_price), 2) as avg_monthly_price,
  ROUND(AVG(lifetime_months * monthly_price), 2) as estimated_ltv,
  ROUND(1.0 / NULLIF(AVG(lifetime_months), 0) * 100, 2) as implied_churn_rate_percent
FROM subscription_lifetimes
GROUP BY plan_type
ORDER BY estimated_ltv DESC;
```

**6. è®¢é˜…å¥åº·åº¦æŒ‡æ ‡æŸ¥è¯¢**

```sql
-- è®¡ç®—è®¢é˜…å¥åº·åº¦ç»¼åˆæŒ‡æ ‡
WITH month_metrics AS (
  -- ä½¿ç”¨å‰é¢çš„æŸ¥è¯¢è·å– MRR å˜åŒ–æ•°æ®
  SELECT
    500.0 as new_mrr,
    100.0 as churned_mrr,
    50.0 as expansion_mrr,
    20.0 as contraction_mrr,
    5000.0 as start_mrr,
    5430.0 as end_mrr
),
churn_metrics AS (
  SELECT
    4.2 as customer_churn_rate,
    2.0 as mrr_churn_rate
),
ltv_metrics AS (
  SELECT
    85.50 as avg_ltv,
    25.00 as avg_cac
)
SELECT
  -- Quick Ratio = (æ–°å¢MRR + æ‰©å±•MRR) / (æµå¤±MRR + é™çº§MRR)
  ROUND((mm.new_mrr + mm.expansion_mrr) / NULLIF(mm.churned_mrr + mm.contraction_mrr, 0), 2) as quick_ratio,

  -- Net MRR Retention = (æœŸåˆMRR + æ‰©å±•MRR - æµå¤±MRR - é™çº§MRR) / æœŸåˆMRR
  ROUND((mm.start_mrr + mm.expansion_mrr - mm.churned_mrr - mm.contraction_mrr) / NULLIF(mm.start_mrr, 0) * 100, 2) as net_mrr_retention_percent,

  -- MRR Churn Rate
  cm.mrr_churn_rate,

  -- Customer Churn Rate
  cm.customer_churn_rate,

  -- LTV/CAC Ratio
  ROUND(lm.avg_ltv / NULLIF(lm.avg_cac, 0), 2) as ltv_cac_ratio,

  -- å¥åº·åº¦è¯„åˆ†ï¼ˆ0-100ï¼‰
  ROUND(
    CASE
      -- Quick Ratio æƒé‡ 30%
      WHEN (mm.new_mrr + mm.expansion_mrr) / NULLIF(mm.churned_mrr + mm.contraction_mrr, 0) > 4 THEN 30
      WHEN (mm.new_mrr + mm.expansion_mrr) / NULLIF(mm.churned_mrr + mm.contraction_mrr, 0) > 2 THEN 20
      ELSE 10
    END +
    -- Churn Rate æƒé‡ 30%
    CASE
      WHEN cm.customer_churn_rate < 3 THEN 30
      WHEN cm.customer_churn_rate < 5 THEN 20
      ELSE 10
    END +
    -- Net MRR Retention æƒé‡ 25%
    CASE
      WHEN (mm.start_mrr + mm.expansion_mrr - mm.churned_mrr - mm.contraction_mrr) / NULLIF(mm.start_mrr, 0) > 1.0 THEN 25
      WHEN (mm.start_mrr + mm.expansion_mrr - mm.churned_mrr - mm.contraction_mrr) / NULLIF(mm.start_mrr, 0) > 0.9 THEN 18
      ELSE 10
    END +
    -- LTV/CAC Ratio æƒé‡ 15%
    CASE
      WHEN lm.avg_ltv / NULLIF(lm.avg_cac, 0) > 3 THEN 15
      WHEN lm.avg_ltv / NULLIF(lm.avg_cac, 0) > 2 THEN 10
      ELSE 5
    END
  , 0) as health_score
FROM month_metrics mm, churn_metrics cm, ltv_metrics lm;
```

#### 4.4.6 æ€§èƒ½ä¼˜åŒ–

**ç´¢å¼•ä¼˜åŒ–**:

```sql
-- subscriptions è¡¨ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_subscriptions_status ON subscriptions(status);
CREATE INDEX IF NOT EXISTS idx_subscriptions_user_status ON subscriptions(user_id, status);
CREATE INDEX IF NOT EXISTS idx_subscriptions_period ON subscriptions(current_period_start, current_period_end);
CREATE INDEX IF NOT EXISTS idx_subscriptions_status_period ON subscriptions(status, current_period_start, current_period_end);
CREATE INDEX IF NOT EXISTS idx_subscriptions_plan_type ON subscriptions(plan_type);
CREATE INDEX IF NOT EXISTS idx_subscriptions_created_at ON subscriptions(created_at);

-- å¤åˆç´¢å¼•ç”¨äºå¸¸è§æŸ¥è¯¢
CREATE INDEX IF NOT EXISTS idx_subscriptions_user_created ON subscriptions(user_id, created_at);
CREATE INDEX IF NOT EXISTS idx_subscriptions_status_created ON subscriptions(status, created_at);
```

**ç¼“å­˜ç­–ç•¥**:
- å½“æ—¥ MRRï¼š5åˆ†é’Ÿç¼“å­˜
- å†å² MRR è¶‹åŠ¿ï¼š1å°æ—¶ç¼“å­˜
- è®¢é˜…å¥åº·åº¦æŒ‡æ ‡ï¼š15åˆ†é’Ÿç¼“å­˜
- è®¢é˜…åŠ¨æ€åˆ—è¡¨ï¼šå®æ—¶æŸ¥è¯¢ï¼ˆæ— ç¼“å­˜ï¼‰

**é¢„è®¡ç®—è¡¨ï¼ˆå¯é€‰ï¼‰**:

```sql
-- åˆ›å»º subscription_daily_stats è¡¨ç”¨äºé¢„è®¡ç®—
CREATE TABLE IF NOT EXISTS subscription_daily_stats (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  date DATE NOT NULL UNIQUE,

  -- MRR æŒ‡æ ‡
  mrr NUMERIC(12, 2) NOT NULL,
  arr NUMERIC(12, 2) NOT NULL,
  new_mrr NUMERIC(12, 2) NOT NULL,
  churned_mrr NUMERIC(12, 2) NOT NULL,
  expansion_mrr NUMERIC(12, 2) NOT NULL,
  contraction_mrr NUMERIC(12, 2) NOT NULL,
  net_new_mrr NUMERIC(12, 2) NOT NULL,

  -- è®¢é˜…æ•°æŒ‡æ ‡
  active_subscriptions INT NOT NULL,
  new_subscriptions INT NOT NULL,
  churned_subscriptions INT NOT NULL,
  trialing_users INT NOT NULL,

  -- æ¯”ç‡æŒ‡æ ‡
  churn_rate NUMERIC(5, 2),
  renewal_rate NUMERIC(5, 2),

  calculated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_subscription_daily_stats_date ON subscription_daily_stats(date);
```

**å®šæ—¶ä»»åŠ¡**:
- æ¯æ—¥å‡Œæ™¨ 3 ç‚¹è®¡ç®—å‰ä¸€å¤©çš„è®¢é˜…ç»Ÿè®¡æ•°æ®
- æ¯æœˆ 1 å·è®¡ç®—ä¸Šæœˆçš„å®Œæ•´æŒ‡æ ‡

#### 4.4.7 å®æ–½è®¡åˆ’

**é¢„è®¡æ—¶é—´**: 3 ä¸ªå·¥ä½œæ—¥

**Day 1: æ•°æ®åº“å‡†å¤‡**
- [ ] ç¡®è®¤ `subscriptions` è¡¨ç»“æ„
- [ ] åˆ›å»ºå¿…è¦çš„ç´¢å¼•
- [ ] ï¼ˆå¯é€‰ï¼‰åˆ›å»º `subscription_daily_stats` é¢„è®¡ç®—è¡¨
- [ ] éªŒè¯æ•°æ®è´¨é‡å’Œå®Œæ•´æ€§

**Day 2: åç«¯å¼€å‘**
- [ ] åˆ›å»º `SubscriptionAnalyticsService`
- [ ] å®ç° 7 ä¸ª API æ¥å£ï¼š
  - `/api/v1/admin/subscription/overview`
  - `/api/v1/admin/subscription/mrr-trend`
  - `/api/v1/admin/subscription/plan-distribution`
  - `/api/v1/admin/subscription/conversion-funnel`
  - `/api/v1/admin/subscription/health-metrics`
  - `/api/v1/admin/subscription/activity`
  - `/api/v1/admin/subscription/ltv-analysis`
- [ ] å®ç° Redis ç¼“å­˜
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•

**Day 3: å‰ç«¯å¼€å‘ä¸æµ‹è¯•**
- [ ] åˆ›å»º `/subscription-analytics` é¡µé¢
- [ ] å®ç° MRR è¶‹åŠ¿å †å é¢ç§¯å›¾
- [ ] å®ç°è®¢é˜…ç±»å‹åˆ†å¸ƒé¥¼å›¾
- [ ] å®ç°è½¬åŒ–æ¼æ–—å›¾
- [ ] å®ç°å¥åº·åº¦æŒ‡æ ‡è¡¨æ ¼
- [ ] å®ç° LTV å¡ç‰‡ç»„
- [ ] å®ç°è®¢é˜…åŠ¨æ€åˆ—è¡¨
- [ ] æ•°æ®éªŒè¯å’Œæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

---

### 4.5 ç”¨æˆ·ç”»åƒç»Ÿè®¡

#### 4.5.1 éœ€æ±‚èƒŒæ™¯

ç”¨æˆ·ç”»åƒæ˜¯ç²¾å‡†è¿è¥çš„åŸºç¡€ï¼Œé€šè¿‡ç»Ÿè®¡ç”¨æˆ·çš„æ€§åˆ«ã€å¹´é¾„ã€åœ°åŒºåˆ†å¸ƒï¼Œå¯ä»¥ï¼š

- **å¸‚åœºåˆ†æ**: äº†è§£ç›®æ ‡ç”¨æˆ·ç¾¤ä½“ç‰¹å¾
- **ç²¾å‡†æŠ•æ”¾**: æ ¹æ®ç”¨æˆ·ç”»åƒä¼˜åŒ–å¹¿å‘ŠæŠ•æ”¾
- **äº§å“ä¼˜åŒ–**: é’ˆå¯¹ä¸»è¦ç”¨æˆ·ç¾¤ä½“ä¼˜åŒ–äº§å“åŠŸèƒ½
- **å†…å®¹ç­–ç•¥**: æ ¹æ®ç”¨æˆ·åå¥½è°ƒæ•´å†…å®¹é‡‡è´­æ–¹å‘

#### 4.5.2 æ•°æ®åº“å­—æ®µè®¾è®¡

**éœ€è¦åœ¨ User è¡¨ä¸­æ–°å¢å­—æ®µ**:

```prisma
model User {
  // ... ç°æœ‰å­—æ®µ ...

  // ç”¨æˆ·ç”»åƒæ‰©å±•
  gender       Gender?   @default(UNKNOWN) // æ€§åˆ«
  birthDate    DateTime? @map("birth_date") @db.Date // å‡ºç”Ÿæ—¥æœŸ
  country      String?   @db.VarChar(50) // å›½å®¶
  region       String?   @db.VarChar(100) // çœä»½/å·
  city         String?   @db.VarChar(100) // åŸå¸‚
  timezone     String?   @db.VarChar(50) // æ—¶åŒº

  // æ•°æ®æ¥æºå’Œéšç§
  profileSource String?  @map("profile_source") @db.VarChar(20) // USER_INPUT, DEVICE, INFERRED
  profileConsent Boolean @default(false) @map("profile_consent") // ç”¨æˆ·æ˜¯å¦åŒæ„ä½¿ç”¨ç”»åƒæ•°æ®

  // ... å…¶ä»–å­—æ®µ ...
}

enum Gender {
  MALE
  FEMALE
  OTHER
  PREFER_NOT_TO_SAY
  UNKNOWN
}
```

**æ•°æ®è¿ç§»è¯´æ˜**:
- æ–°å¢å­—æ®µé»˜è®¤ä¸º NULL æˆ– UNKNOWN
- ä¸å½±å“ç°æœ‰ç”¨æˆ·
- å®¢æˆ·ç«¯é€æ­¥æ”¶é›†ç”¨æˆ·ç”»åƒä¿¡æ¯ï¼ˆæ³¨å†Œæµç¨‹ã€ä¸ªäººè®¾ç½®é¡µï¼‰

#### 4.5.3 æ•°æ®æŒ‡æ ‡

| ç»´åº¦ | æŒ‡æ ‡ | è¯´æ˜ |
|------|------|------|
| **æ€§åˆ«ç»´åº¦** | æ€§åˆ«åˆ†å¸ƒ | ç”·æ€§/å¥³æ€§/å…¶ä»–/æœªè®¾ç½®çš„ç”¨æˆ·æ•°å’Œå æ¯” |
| | æ€§åˆ«æ´»è·ƒåº¦ | å„æ€§åˆ«çš„ DAU/MAU |
| | æ€§åˆ«ä»˜è´¹ç‡ | å„æ€§åˆ«çš„ä»˜è´¹è½¬åŒ–ç‡å’Œ ARPU |
| | æ€§åˆ«é˜…è¯»åå¥½ | å„æ€§åˆ«æœ€å–œæ¬¢çš„ä¹¦ç±åˆ†ç±» |
| **å¹´é¾„ç»´åº¦** | å¹´é¾„æ®µåˆ†å¸ƒ | <18å²/18-24/25-34/35-44/45-54/55+/æœªè®¾ç½® |
| | å¹´é¾„æ®µæ´»è·ƒåº¦ | å„å¹´é¾„æ®µçš„ DAU/MAU |
| | å¹´é¾„æ®µä»˜è´¹ç‡ | å„å¹´é¾„æ®µçš„ä»˜è´¹è½¬åŒ–ç‡å’Œ ARPU |
| | å¹´é¾„æ®µé˜…è¯»åå¥½ | å„å¹´é¾„æ®µæœ€å–œæ¬¢çš„ä¹¦ç±åˆ†ç±» |
| **åœ°åŒºç»´åº¦** | å›½å®¶åˆ†å¸ƒ | TOP 20 å›½å®¶çš„ç”¨æˆ·æ•°å’Œå æ¯” |
| | çœä»½/åŸå¸‚åˆ†å¸ƒ | TOP 50 çœä»½/åŸå¸‚çš„ç”¨æˆ·æ•°ï¼ˆä¸­å›½ï¼‰ |
| | åœ°åŒºæ´»è·ƒåº¦ | å„åœ°åŒºçš„ DAU/MAU |
| | åœ°åŒºä»˜è´¹ç‡ | å„åœ°åŒºçš„ä»˜è´¹è½¬åŒ–ç‡å’Œ ARPU |
| | åœ°åŒºæ—¶æ®µåå¥½ | ä¸åŒåœ°åŒºçš„æ´»è·ƒæ—¶æ®µåˆ†å¸ƒ |

#### 4.5.4 é¡µé¢è®¾è®¡

**æ–°å¢é¡µé¢**: `/user-demographics`

**é¡µé¢ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ç”¨æˆ·ç”»åƒç»Ÿè®¡                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  [æ—¶é—´ç­›é€‰] å…¨éƒ¨ç”¨æˆ· | æ´»è·ƒç”¨æˆ· | ä»˜è´¹ç”¨æˆ·  [åˆ·æ–°] [å¯¼å‡º]        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ ç”»åƒå®Œæ•´åº¦    â”‚ â”‚ æ€§åˆ«åˆ†å¸ƒ      â”‚ â”‚ å¹´é¾„åˆ†å¸ƒ      â”‚            â”‚
â”‚  â”‚ 45.2%        â”‚ â”‚ ç”·52% å¥³38%  â”‚ â”‚ 25-34å²æœ€å¤š   â”‚            â”‚
â”‚  â”‚ (æœ‰ç”»åƒæ•°æ®)  â”‚ â”‚ å…¶ä»–10%      â”‚ â”‚              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ€§åˆ«åˆ†å¸ƒ               â”‚ â”‚  æ€§åˆ«Ã—é˜…è¯»åå¥½               â”‚  â”‚
â”‚  â”‚  [é¥¼å›¾]                â”‚ â”‚  [åˆ†ç»„æ¡å½¢å›¾]               â”‚  â”‚
â”‚  â”‚  Â· ç”·æ€§ 52%            â”‚ â”‚  æ˜¾ç¤ºå„æ€§åˆ«æœ€çˆ±åˆ†ç±»          â”‚  â”‚
â”‚  â”‚  Â· å¥³æ€§ 38%            â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚  Â· å…¶ä»– 2%             â”‚ â”‚                             â”‚  â”‚
â”‚  â”‚  Â· æœªè®¾ç½® 8%           â”‚ â”‚                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å¹´é¾„æ®µåˆ†å¸ƒ             â”‚ â”‚  å¹´é¾„æ®µÃ—ä»˜è´¹ç‡               â”‚  â”‚
â”‚  â”‚  [æŸ±çŠ¶å›¾]              â”‚ â”‚  [æŠ˜çº¿å›¾+æŸ±çŠ¶å›¾ç»„åˆ]         â”‚  â”‚
â”‚  â”‚  <18 | 18-24 | 25-34  â”‚ â”‚  æ˜¾ç¤ºå„å¹´é¾„æ®µä»˜è´¹è½¬åŒ–ç‡      â”‚  â”‚
â”‚  â”‚  35-44 | 45-54 | 55+  â”‚ â”‚                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  åœ°åŒºåˆ†å¸ƒ TOP 20                          â”‚  â”‚
â”‚  â”‚  [åœ°å›¾çƒ­åŠ›å›¾ æˆ– è¡¨æ ¼]                                     â”‚  â”‚
â”‚  â”‚  æ’å | å›½å®¶/åœ°åŒº | ç”¨æˆ·æ•° | å æ¯” | DAU | ä»˜è´¹ç‡ | ARPU  â”‚  â”‚
â”‚  â”‚  1    | ä¸­å›½      | 45,678 | 52% | 12K | 5.2%  | $3.45 â”‚  â”‚
â”‚  â”‚  2    | ç¾å›½      | 8,234  | 9%  | 2.3K| 8.5%  | $9.20 â”‚  â”‚
â”‚  â”‚  ...                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ä¸­å›½çœä»½/åŸå¸‚åˆ†å¸ƒ TOP 20                      â”‚  â”‚
â”‚  â”‚  [è¡¨æ ¼: çœä»½/åŸå¸‚ | ç”¨æˆ·æ•° | å æ¯” | æ´»è·ƒåº¦]               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.5.5 API è®¾è®¡

**æ–°å¢æ¥å£**:

```typescript
// 1. ç”¨æˆ·ç”»åƒæ¦‚è§ˆ
GET /api/v1/admin/demographics/overview
Query: ?userType=all|active|paid  // ç­›é€‰ç”¨æˆ·ç±»å‹
Response: {
  totalUsers: number;
  profileCompleteness: number;  // ç”»åƒå®Œæ•´åº¦ç™¾åˆ†æ¯”
  genderDistribution: {
    male: number;
    female: number;
    other: number;
    preferNotToSay: number;
    unknown: number;
  };
  ageBrackets: {
    under18: number;
    age18to24: number;
    age25to34: number;
    age35to44: number;
    age45to54: number;
    age55plus: number;
    unknown: number;
  };
  topCountries: Array<{
    country: string;
    userCount: number;
    percentage: number;
  }>;
}

// 2. æ€§åˆ«åˆ†æ
GET /api/v1/admin/demographics/gender
Query: ?userType=all|active|paid
Response: {
  distribution: Array<{
    gender: string;
    userCount: number;
    percentage: number;
    dau: number;
    mau: number;
    paidUsers: number;
    conversionRate: number;
    arpu: number;
  }>;
  readingPreferences: Array<{
    gender: string;
    topCategories: Array<{
      category: string;
      readingMinutes: number;
    }>;
  }>;
}

// 3. å¹´é¾„åˆ†æ
GET /api/v1/admin/demographics/age
Query: ?userType=all|active|paid
Response: {
  distribution: Array<{
    ageBracket: string;
    userCount: number;
    percentage: number;
    dau: number;
    mau: number;
    paidUsers: number;
    conversionRate: number;
    arpu: number;
  }>;
  readingPreferences: Array<{
    ageBracket: string;
    topCategories: Array<{
      category: string;
      readingMinutes: number;
    }>;
  }>;
}

// 4. åœ°åŒºåˆ†æ
GET /api/v1/admin/demographics/location
Query: ?level=country|region|city&limit=20&country=CN
Response: {
  items: Array<{
    location: string;
    parentLocation?: string;  // ä¸Šçº§åœ°åŒºï¼ˆå¦‚çœä»½å¯¹åº”çš„å›½å®¶ï¼‰
    userCount: number;
    percentage: number;
    dau: number;
    mau: number;
    paidUsers: number;
    conversionRate: number;
    arpu: number;
    topCategory: string;
  }>;
  total: number;
}

// 5. ç”¨æˆ·ç”»åƒäº¤å‰åˆ†æ
GET /api/v1/admin/demographics/cross-analysis
Query: ?dimension1=gender&dimension2=age
Response: {
  matrix: Array<{
    dimension1Value: string;
    dimension2Value: string;
    userCount: number;
    metrics: {
      dau: number;
      conversionRate: number;
      arpu: number;
    };
  }>;
}
```

#### 4.5.6 SQL æŸ¥è¯¢ç¤ºä¾‹

**æ€§åˆ«åˆ†å¸ƒç»Ÿè®¡**:

```sql
WITH gender_stats AS (
  SELECT
    COALESCE(gender, 'UNKNOWN') as gender,
    COUNT(DISTINCT u.id) as user_count,
    COUNT(DISTINCT CASE WHEN u.last_active_at >= CURRENT_DATE - INTERVAL '1 day' THEN u.id END) as dau,
    COUNT(DISTINCT CASE WHEN u.last_active_at >= CURRENT_DATE - INTERVAL '30 days' THEN u.id END) as mau,
    COUNT(DISTINCT CASE WHEN s.id IS NOT NULL THEN u.id END) as paid_users
  FROM users u
  LEFT JOIN subscriptions s ON u.id = s.user_id AND s.status IN ('ACTIVE', 'TRIALING')
  GROUP BY gender
),
total_users AS (
  SELECT COUNT(id) as total FROM users
)
SELECT
  gs.gender,
  gs.user_count,
  ROUND(gs.user_count::NUMERIC / tu.total * 100, 2) as percentage,
  gs.dau,
  gs.mau,
  gs.paid_users,
  ROUND(gs.paid_users::NUMERIC / gs.user_count * 100, 2) as conversion_rate
FROM gender_stats gs
CROSS JOIN total_users tu
ORDER BY gs.user_count DESC;
```

**å¹´é¾„æ®µåˆ†å¸ƒç»Ÿè®¡**:

```sql
WITH age_brackets AS (
  SELECT
    u.id,
    CASE
      WHEN birth_date IS NULL THEN 'UNKNOWN'
      WHEN EXTRACT(YEAR FROM AGE(birth_date)) < 18 THEN 'UNDER_18'
      WHEN EXTRACT(YEAR FROM AGE(birth_date)) BETWEEN 18 AND 24 THEN '18_24'
      WHEN EXTRACT(YEAR FROM AGE(birth_date)) BETWEEN 25 AND 34 THEN '25_34'
      WHEN EXTRACT(YEAR FROM AGE(birth_date)) BETWEEN 35 AND 44 THEN '35_44'
      WHEN EXTRACT(YEAR FROM AGE(birth_date)) BETWEEN 45 AND 54 THEN '45_54'
      ELSE '55_PLUS'
    END as age_bracket,
    u.last_active_at,
    CASE WHEN s.id IS NOT NULL THEN 1 ELSE 0 END as is_paid
  FROM users u
  LEFT JOIN subscriptions s ON u.id = s.user_id AND s.status IN ('ACTIVE', 'TRIALING')
),
age_stats AS (
  SELECT
    age_bracket,
    COUNT(DISTINCT id) as user_count,
    COUNT(DISTINCT CASE WHEN last_active_at >= CURRENT_DATE - INTERVAL '1 day' THEN id END) as dau,
    COUNT(DISTINCT CASE WHEN last_active_at >= CURRENT_DATE - INTERVAL '30 days' THEN id END) as mau,
    SUM(is_paid) as paid_users
  FROM age_brackets
  GROUP BY age_bracket
),
total_users AS (
  SELECT COUNT(id) as total FROM users
)
SELECT
  age_bracket,
  user_count,
  ROUND(user_count::NUMERIC / tu.total * 100, 2) as percentage,
  dau,
  mau,
  paid_users,
  ROUND(paid_users::NUMERIC / user_count * 100, 2) as conversion_rate
FROM age_stats
CROSS JOIN total_users tu
ORDER BY
  CASE age_bracket
    WHEN 'UNDER_18' THEN 1
    WHEN '18_24' THEN 2
    WHEN '25_34' THEN 3
    WHEN '35_44' THEN 4
    WHEN '45_54' THEN 5
    WHEN '55_PLUS' THEN 6
    ELSE 7
  END;
```

**åœ°åŒºåˆ†å¸ƒç»Ÿè®¡ï¼ˆå›½å®¶çº§åˆ«ï¼‰**:

```sql
WITH location_stats AS (
  SELECT
    COALESCE(country, 'UNKNOWN') as country,
    COUNT(DISTINCT u.id) as user_count,
    COUNT(DISTINCT CASE WHEN u.last_active_at >= CURRENT_DATE - INTERVAL '1 day' THEN u.id END) as dau,
    COUNT(DISTINCT CASE WHEN u.last_active_at >= CURRENT_DATE - INTERVAL '30 days' THEN u.id END) as mau,
    COUNT(DISTINCT CASE WHEN s.id IS NOT NULL THEN u.id END) as paid_users,
    COALESCE(SUM(o.amount_cents) / 100.0, 0) as total_revenue
  FROM users u
  LEFT JOIN subscriptions s ON u.id = s.user_id AND s.status IN ('ACTIVE', 'TRIALING')
  LEFT JOIN orders o ON u.id = o.user_id AND o.status = 'PAID'
  GROUP BY country
),
total_users AS (
  SELECT COUNT(id) as total FROM users
),
top_categories AS (
  SELECT
    u.country,
    b.primary_category,
    SUM(rs.duration_minutes) as reading_minutes,
    ROW_NUMBER() OVER (PARTITION BY u.country ORDER BY SUM(rs.duration_minutes) DESC) as rank
  FROM users u
  JOIN reading_sessions rs ON u.id = rs.user_id
  JOIN user_books ub ON rs.user_book_id = ub.id
  JOIN books b ON ub.book_id = b.id
  WHERE u.country IS NOT NULL
    AND rs.started_at >= CURRENT_DATE - INTERVAL '30 days'
  GROUP BY u.country, b.primary_category
)
SELECT
  ls.country,
  ls.user_count,
  ROUND(ls.user_count::NUMERIC / tu.total * 100, 2) as percentage,
  ls.dau,
  ls.mau,
  ls.paid_users,
  ROUND(ls.paid_users::NUMERIC / ls.user_count * 100, 2) as conversion_rate,
  ROUND(ls.total_revenue / ls.user_count, 2) as arpu,
  tc.primary_category as top_category
FROM location_stats ls
CROSS JOIN total_users tu
LEFT JOIN top_categories tc ON ls.country = tc.country AND tc.rank = 1
WHERE ls.country != 'UNKNOWN'
ORDER BY ls.user_count DESC
LIMIT 20;
```

**æ€§åˆ«Ã—å¹´é¾„äº¤å‰åˆ†æ**:

```sql
WITH user_profiles AS (
  SELECT
    u.id,
    COALESCE(u.gender, 'UNKNOWN') as gender,
    CASE
      WHEN birth_date IS NULL THEN 'UNKNOWN'
      WHEN EXTRACT(YEAR FROM AGE(birth_date)) < 18 THEN 'UNDER_18'
      WHEN EXTRACT(YEAR FROM AGE(birth_date)) BETWEEN 18 AND 24 THEN '18_24'
      WHEN EXTRACT(YEAR FROM AGE(birth_date)) BETWEEN 25 AND 34 THEN '25_34'
      WHEN EXTRACT(YEAR FROM AGE(birth_date)) BETWEEN 35 AND 44 THEN '35_44'
      WHEN EXTRACT(YEAR FROM AGE(birth_date)) BETWEEN 45 AND 54 THEN '45_54'
      ELSE '55_PLUS'
    END as age_bracket,
    CASE WHEN u.last_active_at >= CURRENT_DATE - INTERVAL '1 day' THEN 1 ELSE 0 END as is_active,
    CASE WHEN s.id IS NOT NULL THEN 1 ELSE 0 END as is_paid
  FROM users u
  LEFT JOIN subscriptions s ON u.id = s.user_id AND s.status IN ('ACTIVE', 'TRIALING')
)
SELECT
  gender,
  age_bracket,
  COUNT(id) as user_count,
  SUM(is_active) as dau,
  SUM(is_paid) as paid_users,
  ROUND(SUM(is_paid)::NUMERIC / COUNT(id) * 100, 2) as conversion_rate
FROM user_profiles
GROUP BY gender, age_bracket
ORDER BY gender, age_bracket;
```

#### 4.5.7 æ€§èƒ½ä¼˜åŒ–

**ç´¢å¼•ä¼˜åŒ–**:
```sql
-- åœ¨ users è¡¨æ·»åŠ ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_users_gender ON users(gender) WHERE gender IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_users_birth_date ON users(birth_date) WHERE birth_date IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_users_country ON users(country) WHERE country IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_users_region ON users(region) WHERE region IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_users_city ON users(city) WHERE city IS NOT NULL;

-- å¤åˆç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_users_gender_active ON users(gender, last_active_at);
CREATE INDEX IF NOT EXISTS idx_users_country_active ON users(country, last_active_at);
```

**æ•°æ®é¢„è®¡ç®—**:
- æ¯æ—¥å®šæ—¶ä»»åŠ¡ï¼ˆå‡Œæ™¨3ç‚¹ï¼‰è®¡ç®—ç”¨æˆ·ç”»åƒç»Ÿè®¡
- å­˜å‚¨åˆ°æ–°è¡¨ `user_demographics_stats`
- Dashboard ä¼˜å…ˆè¯»å–é¢„è®¡ç®—æ•°æ®

**ç¼“å­˜ç­–ç•¥**:
- ç”¨æˆ·ç”»åƒæ¦‚è§ˆï¼š1å°æ—¶ç¼“å­˜
- è¯¦ç»†ç»Ÿè®¡æ•°æ®ï¼š30åˆ†é’Ÿç¼“å­˜
- äº¤å‰åˆ†æï¼š15åˆ†é’Ÿç¼“å­˜

#### 4.5.8 éšç§åˆè§„

**GDPR & æ•°æ®éšç§**:

1. **æ•°æ®æ”¶é›†åŸåˆ™**:
   - æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·æ•°æ®ç”¨é€”
   - è·å–ç”¨æˆ·æ˜ç¡®åŒæ„ï¼ˆ`profileConsent` å­—æ®µï¼‰
   - æä¾›é€‰æ‹©ä¸æä¾›ç”»åƒæ•°æ®çš„é€‰é¡¹

2. **æ•°æ®å±•ç¤ºåŸåˆ™**:
   - Dashboard ä¸­ä»…å±•ç¤ºèšåˆæ•°æ®ï¼Œä¸å±•ç¤ºä¸ªäººä¿¡æ¯
   - å¯¼å‡ºæ•°æ®éœ€è¦è„±æ•å¤„ç†
   - è®¿é—®æ—¥å¿—è®°å½•å’Œå®¡è®¡

3. **ç”¨æˆ·æƒåˆ©**:
   - ç”¨æˆ·å¯éšæ—¶ä¿®æ”¹/åˆ é™¤ç”»åƒæ•°æ®
   - æä¾›æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆGDPR Right to Data Portabilityï¼‰
   - æä¾›"è¢«é—å¿˜æƒ"ï¼ˆåˆ é™¤è´¦æˆ·åŒæ—¶åˆ é™¤æ‰€æœ‰ç”»åƒæ•°æ®ï¼‰

4. **æ•°æ®å®‰å…¨**:
   - ç”»åƒæ•°æ®åŠ å¯†å­˜å‚¨
   - API è®¿é—®æƒé™æ§åˆ¶
   - å®šæœŸå®‰å…¨å®¡è®¡

**å®¢æˆ·ç«¯æ•°æ®æ”¶é›†**:

```typescript
// æ³¨å†Œæµç¨‹ï¼ˆå¯é€‰æ­¥éª¤ï¼‰
interface UserProfile {
  gender?: 'MALE' | 'FEMALE' | 'OTHER' | 'PREFER_NOT_TO_SAY';
  birthDate?: Date;
  country?: string;
  region?: string;
  city?: string;
}

// ç”¨æˆ·åŒæ„åè®®
const profileConsent = {
  message: "ä¸ºäº†æä¾›æ›´å¥½çš„ä¸ªæ€§åŒ–æœåŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›æ”¶é›†æ‚¨çš„æ€§åˆ«ã€å¹´é¾„ã€åœ°åŒºç­‰ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯ä»…ç”¨äºäº§å“ä¼˜åŒ–ï¼Œä¸ä¼šè¢«åˆ†äº«ç»™ç¬¬ä¸‰æ–¹ã€‚",
  options: [
    "åŒæ„å¹¶ç»§ç»­",
    "æš‚æ—¶è·³è¿‡"
  ]
};
```

**æ•°æ®æ¨æ–­ï¼ˆå¯é€‰ï¼‰**:

å¦‚æœç”¨æˆ·æœªä¸»åŠ¨æä¾›ç”»åƒä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¨æ–­ï¼ˆéœ€è·å¾—åŒæ„ï¼‰ï¼š

- é€šè¿‡è®¾å¤‡ä¿¡æ¯æ¨æ–­åœ°åŒºï¼ˆIPåœ°å€ã€æ—¶åŒºï¼‰
- é€šè¿‡é˜…è¯»åå¥½æ¨æ–­å¹´é¾„æ®µï¼ˆä»…ä½œä¸ºå‚è€ƒï¼Œä¸ä½œä¸ºç¡®å®šæ•°æ®ï¼‰
- æ ‡è®°æ•°æ®æ¥æºï¼š`profileSource = 'INFERRED'`

#### 4.5.9 å®æ–½æ­¥éª¤

**é˜¶æ®µ1: æ•°æ®åº“å‡†å¤‡ï¼ˆ1å¤©ï¼‰**
- [ ] æ·»åŠ æ–°å­—æ®µåˆ° User è¡¨
- [ ] åˆ›å»ºè¿ç§»æ–‡ä»¶
- [ ] æ·»åŠ ç´¢å¼•
- [ ] éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

**é˜¶æ®µ2: åç«¯å¼€å‘ï¼ˆ2å¤©ï¼‰**
- [ ] åˆ›å»º demographics module
- [ ] å®ç° API æ¥å£
- [ ] ç¼–å†™ SQL æŸ¥è¯¢é€»è¾‘
- [ ] å•å…ƒæµ‹è¯•

**é˜¶æ®µ3: å‰ç«¯å¼€å‘ï¼ˆ2å¤©ï¼‰**
- [ ] åˆ›å»º UserDemographicsDashboard é¡µé¢
- [ ] å®ç°å›¾è¡¨ç»„ä»¶ï¼ˆé¥¼å›¾ã€æŸ±çŠ¶å›¾ã€åœ°å›¾ï¼‰
- [ ] äº¤å‰åˆ†æåŠŸèƒ½
- [ ] æ•°æ®å¯¼å‡ºåŠŸèƒ½

**é˜¶æ®µ4: å®¢æˆ·ç«¯é›†æˆï¼ˆå¹¶è¡Œï¼Œä¸é˜»å¡ Dashboardï¼‰**
- [ ] iOS: æ·»åŠ ç”»åƒæ”¶é›†æµç¨‹
- [ ] Android: æ·»åŠ ç”»åƒæ”¶é›†æµç¨‹
- [ ] Web: æ·»åŠ ç”»åƒæ”¶é›†æµç¨‹
- [ ] æ³¨å†Œæµç¨‹ä¼˜åŒ–

**é˜¶æ®µ5: æµ‹è¯•ä¸å‘å¸ƒï¼ˆ1å¤©ï¼‰**
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] éšç§åˆè§„æ£€æŸ¥
- [ ] éƒ¨ç½²å‘å¸ƒ

**æ€»è®¡**: 6ä¸ªå·¥ä½œæ—¥

---

## äº”ã€å®æ–½è®¡åˆ’

### 5.1 æŠ€æœ¯æ¶æ„

**åç«¯ï¼ˆNestJSï¼‰**:
```
apps/backend/src/modules/admin/
â”œâ”€â”€ operations/              # å·²æœ‰
â”‚   â”œâ”€â”€ operations.controller.ts
â”‚   â””â”€â”€ operations.service.ts
â”œâ”€â”€ reading-stats/           # æ–°å¢
â”‚   â”œâ”€â”€ reading-stats.controller.ts
â”‚   â”œâ”€â”€ reading-stats.service.ts
â”‚   â””â”€â”€ dto/
â”œâ”€â”€ retention/               # æ–°å¢
â”‚   â”œâ”€â”€ retention.controller.ts
â”‚   â”œâ”€â”€ retention.service.ts
â”‚   â””â”€â”€ dto/
â”œâ”€â”€ monetization/            # æ–°å¢
â”‚   â”œâ”€â”€ monetization.controller.ts
â”‚   â”œâ”€â”€ monetization.service.ts
â”‚   â””â”€â”€ dto/
â””â”€â”€ demographics/            # æ–°å¢ï¼ˆç”¨æˆ·ç”»åƒï¼‰
    â”œâ”€â”€ demographics.controller.ts
    â”œâ”€â”€ demographics.service.ts
    â””â”€â”€ dto/
```

**å‰ç«¯ï¼ˆReact Adminï¼‰**:
```
apps/dashboard/src/pages/
â”œâ”€â”€ operations/              # å·²æœ‰
â”‚   â”œâ”€â”€ OperationsDashboard.tsx
â”‚   â””â”€â”€ PerformanceDashboard.tsx
â”œâ”€â”€ reading-stats/           # æ–°å¢
â”‚   â”œâ”€â”€ ReadingStatsDashboard.tsx
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ReadingHeatmap.tsx
â”‚   â”‚   â”œâ”€â”€ BookRankingTable.tsx
â”‚   â”‚   â”œâ”€â”€ UserRankingTable.tsx
â”‚   â”‚   â””â”€â”€ CategoryDistribution.tsx
â”‚   â””â”€â”€ index.tsx
â”œâ”€â”€ retention/               # æ–°å¢
â”‚   â”œâ”€â”€ RetentionDashboard.tsx
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ RetentionCurve.tsx
â”‚   â”‚   â””â”€â”€ ChannelComparison.tsx
â”‚   â””â”€â”€ index.tsx
â”œâ”€â”€ monetization/            # æ–°å¢
â”‚   â”œâ”€â”€ MonetizationDashboard.tsx
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ConversionFunnel.tsx
â”‚   â”‚   â””â”€â”€ RevenueChart.tsx
â”‚   â””â”€â”€ index.tsx
â””â”€â”€ demographics/            # æ–°å¢ï¼ˆç”¨æˆ·ç”»åƒï¼‰
    â”œâ”€â”€ UserDemographicsDashboard.tsx
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ GenderDistribution.tsx
    â”‚   â”œâ”€â”€ AgeDistribution.tsx
    â”‚   â”œâ”€â”€ LocationDistribution.tsx
    â”‚   â””â”€â”€ CrossAnalysis.tsx
    â””â”€â”€ index.tsx
```

**æ•°æ®åº“è¿ç§»**:
```
packages/database/prisma/migrations/
â”œâ”€â”€ xxx_add_retention_table.sql
â””â”€â”€ xxx_add_user_demographics_fields.sql
```

### 5.2 å®æ–½æ­¥éª¤ï¼ˆP0ï¼‰

#### é˜¶æ®µ1: é˜…è¯»æ—¶é•¿åˆ†æï¼ˆ5å¤©ï¼‰
- [ ] Day 1-2: åç«¯APIå¼€å‘
  - å®ç° reading-stats controller/service
  - ç¼–å†™æ•°æ®åº“æŸ¥è¯¢é€»è¾‘
  - æ·»åŠ å¿…è¦ç´¢å¼•
- [ ] Day 3-4: å‰ç«¯é¡µé¢å¼€å‘
  - åˆ›å»º ReadingStatsDashboard
  - å®ç°å„ä¸ªç»„ä»¶ï¼ˆçƒ­åŠ›å›¾ã€æ’è¡Œæ¦œç­‰ï¼‰
- [ ] Day 5: æµ‹è¯•ä¸ä¼˜åŒ–
  - æ€§èƒ½æµ‹è¯•
  - æ•°æ®å‡†ç¡®æ€§éªŒè¯

#### é˜¶æ®µ2: ç•™å­˜ç‡åˆ†æï¼ˆ4å¤©ï¼‰
- [ ] Day 1-2: åç«¯å¼€å‘
  - åˆ›å»º user_retention è¡¨
  - å®ç°ç•™å­˜è®¡ç®—å®šæ—¶ä»»åŠ¡
  - å¼€å‘ retention API
- [ ] Day 3: å‰ç«¯å¼€å‘
  - åˆ›å»º RetentionDashboard
  - å®ç°ç•™å­˜æ›²çº¿å›¾
- [ ] Day 4: æµ‹è¯•ä¸ä¼˜åŒ–

#### é˜¶æ®µ3: ä»˜è´¹è½¬åŒ–åˆ†æï¼ˆ3å¤©ï¼‰
- [ ] Day 1-2: åç«¯å¼€å‘
  - å®ç° monetization API
  - ä¼˜åŒ–è®¢å•æŸ¥è¯¢
- [ ] Day 2-3: å‰ç«¯å¼€å‘
  - åˆ›å»º MonetizationDashboard
  - å®ç°è½¬åŒ–æ¼æ–—å’Œæ”¶å…¥è¶‹åŠ¿å›¾

#### é˜¶æ®µ4: ç”¨æˆ·ç”»åƒç»Ÿè®¡ï¼ˆ6å¤©ï¼‰
- [ ] Day 1: æ•°æ®åº“å‡†å¤‡
  - æ·»åŠ  gender, birthDate, country, region, city ç­‰å­—æ®µåˆ° User è¡¨
  - åˆ›å»ºè¿ç§»æ–‡ä»¶å’Œç´¢å¼•
  - éƒ¨ç½²æ•°æ®åº“å˜æ›´
- [ ] Day 2-3: åç«¯å¼€å‘
  - åˆ›å»º demographics module
  - å®ç° 5ä¸ª API æ¥å£ï¼ˆoverview/gender/age/location/cross-analysisï¼‰
  - ç¼–å†™ SQL æŸ¥è¯¢é€»è¾‘
- [ ] Day 4-5: å‰ç«¯å¼€å‘
  - åˆ›å»º UserDemographicsDashboard é¡µé¢
  - å®ç°å›¾è¡¨ç»„ä»¶ï¼ˆæ€§åˆ«é¥¼å›¾ã€å¹´é¾„æŸ±çŠ¶å›¾ã€åœ°åŒºåˆ†å¸ƒï¼‰
  - å®ç°äº¤å‰åˆ†æåŠŸèƒ½
- [ ] Day 6: æµ‹è¯•ä¸ä¼˜åŒ–
  - åŠŸèƒ½æµ‹è¯•
  - æ€§èƒ½æµ‹è¯•
  - éšç§åˆè§„æ£€æŸ¥

#### é˜¶æ®µ5: é›†æˆä¸å‘å¸ƒï¼ˆ2å¤©ï¼‰
- [ ] æ·»åŠ èœå•å¯¼èˆª
- [ ] æƒé™é…ç½®
- [ ] æ–‡æ¡£ç¼–å†™
- [ ] éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

**æ€»è®¡**: 20ä¸ªå·¥ä½œæ—¥ï¼ˆçº¦4å‘¨ï¼‰

**å¤‡æ³¨**: å®¢æˆ·ç«¯ç”»åƒæ•°æ®æ”¶é›†åŠŸèƒ½ï¼ˆiOS/Android/Webï¼‰å¯ä»¥å¹¶è¡Œå¼€å‘ï¼Œä¸é˜»å¡ Dashboard ä¸Šçº¿ã€‚

---

## å…­ã€æ•°æ®å¯è§†åŒ–æ ‡å‡†

### 6.1 å›¾è¡¨é€‰æ‹©æŒ‡å—

| æ•°æ®ç±»å‹ | æ¨èå›¾è¡¨ | ä½¿ç”¨åœºæ™¯ | åº“/ç»„ä»¶ |
|---------|---------|---------|---------|
| è¶‹åŠ¿æ•°æ® | æŠ˜çº¿å›¾ | DAU/æ”¶å…¥è¶‹åŠ¿ | Recharts Line Chart |
| å æ¯”æ•°æ® | é¥¼å›¾/ç¯å½¢å›¾ | å¹³å°/åˆ†ç±»å æ¯” | Recharts Pie Chart |
| æ’è¡Œæ•°æ® | æ¡å½¢å›¾/è¡¨æ ¼ | ä¹¦ç±/ç”¨æˆ·æ’è¡Œ | MUI Table |
| åˆ†å¸ƒæ•°æ® | ç›´æ–¹å›¾ | ç”¨æˆ·é˜…è¯»æ—¶é•¿åˆ†å¸ƒ | Recharts Bar Chart |
| æ¼æ–—æ•°æ® | æ¼æ–—å›¾ | ä»˜è´¹è½¬åŒ–æµç¨‹ | Recharts Funnel |
| å¯¹æ¯”æ•°æ® | åˆ†ç»„æŸ±çŠ¶å›¾ | æ¸ é“æ•ˆæœå¯¹æ¯” | Recharts Bar Chart |
| æ—¶æ®µæ•°æ® | çƒ­åŠ›å›¾ | 24å°æ—¶é˜…è¯»çƒ­åŠ› | react-calendar-heatmap |
| å…³è”æ•°æ® | æ•£ç‚¹å›¾ | é˜…è¯»æ—¶é•¿vsç•™å­˜ | Recharts Scatter |

### 6.2 é…è‰²æ–¹æ¡ˆ

**ä¸»é¢˜è‰²ï¼ˆéµå¾ª Readmigo å“ç‰Œï¼‰**:
- ä¸»è‰²: `#7C8DF5` (ç´«è“)
- è¾…åŠ©è‰²: `#6ED6A8` (ç»¿)ã€`#FFD36A` (é»„)ã€`#F3A6DC` (ç²‰)
- ä¸­æ€§è‰²: `#9E9E9E` (ç°)

**æ•°æ®å¯è§†åŒ–è‰²æ¿**:
```typescript
export const chartColors = {
  primary: '#7C8DF5',
  success: '#6ED6A8',
  warning: '#FFD36A',
  danger: '#FF6B6B',
  info: '#7BAAFF',
  purple: '#9A8CF2',
  pink: '#F3A6DC',
  orange: '#FFC26A',
};
```

### 6.3 äº¤äº’è§„èŒƒ

- **Tooltip**: é¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†æ•°æ®
- **Legend**: å›¾ä¾‹æ”¯æŒç‚¹å‡»åˆ‡æ¢æ˜¾ç¤º/éšè—
- **Zoom**: å¤§æ•°æ®é‡å›¾è¡¨æ”¯æŒç¼©æ”¾
- **Export**: æ‰€æœ‰å›¾è¡¨æ”¯æŒå¯¼å‡ºä¸º PNG
- **Drill-down**: æ”¯æŒä»æ±‡æ€»æ•°æ®ä¸‹é’»åˆ°è¯¦æƒ…

---

## ä¸ƒã€æ€§èƒ½ä¸ç›‘æ§

### 7.1 æ€§èƒ½ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|-------|------|
| é¡µé¢åŠ è½½æ—¶é—´ | < 2s | é¦–å±æ¸²æŸ“å®Œæˆ |
| APIå“åº”æ—¶é—´ | < 500ms | P95 |
| æ•°æ®åˆ·æ–°é—´éš” | 5min | å½“æ—¥æ•°æ® |
| å¹¶å‘æ”¯æŒ | 50+ | åŒæ—¶åœ¨çº¿è¿è¥äººå‘˜ |

### 7.2 ç›‘æ§å‘Šè­¦

**å…³é”®æŒ‡æ ‡å‘Šè­¦**:
- DAU çªç„¶ä¸‹é™ > 20%
- ä»˜è´¹è½¬åŒ–ç‡ä¸‹é™ > 15%
- API é”™è¯¯ç‡ > 1%
- æŸ¥è¯¢è¶…æ—¶ > 5s

**å‘Šè­¦æ¸ é“**:
- é’‰é’‰/é£ä¹¦é€šçŸ¥
- é‚®ä»¶é€šçŸ¥
- Dashboard çº¢è‰²æ ‡è¯†

---

## å…«ã€æƒé™ä¸å®‰å…¨

### 8.1 è§’è‰²æƒé™

| è§’è‰² | æƒé™èŒƒå›´ |
|------|---------|
| SuperAdmin | æ‰€æœ‰æ•°æ®æŸ¥çœ‹/å¯¼å‡º |
| Operations | è¿è¥æ•°æ®æŸ¥çœ‹/å¯¼å‡º |
| Finance | ä»˜è´¹æ•°æ®æŸ¥çœ‹/å¯¼å‡º |
| Support | åŸºç¡€æ•°æ®æŸ¥çœ‹ |

### 8.2 æ•°æ®å®‰å…¨

- æ•æ„Ÿæ•°æ®è„±æ•ï¼ˆç”¨æˆ·æ‰‹æœºå·ã€é‚®ç®±ç­‰ï¼‰
- æ“ä½œæ—¥å¿—è®°å½•
- æ•°æ®å¯¼å‡ºå®¡è®¡
- è®¿é—®é¢‘ç‡é™åˆ¶

---

## ä¹ã€åç»­è¿­ä»£è®¡åˆ’

### P1 ä¼˜å…ˆçº§ï¼ˆ4å‘¨ï¼‰
- ç”¨æˆ·åˆ†å±‚ç®¡ç†
- å†…å®¹å®Œæˆç‡åˆ†æ
- åŠŸèƒ½ä½¿ç”¨ç‡ç»Ÿè®¡
- æ¸ é“æ•ˆæœåˆ†æ

### P2 ä¼˜å…ˆçº§ï¼ˆ6å‘¨ï¼‰
- æ¨èæ•ˆæœåˆ†æ
- è¿è¥æ´»åŠ¨è¿½è¸ª
- A/Bæµ‹è¯•ç»“æœ
- ç”¨æˆ·åé¦ˆè¶‹åŠ¿

### é•¿æœŸè§„åˆ’
- AI é©±åŠ¨çš„å¼‚å¸¸æ£€æµ‹
- è‡ªåŠ¨åŒ–è¿è¥æŠ¥å‘Šç”Ÿæˆ
- é¢„æµ‹åˆ†æï¼ˆç”¨æˆ·æµå¤±é¢„æµ‹ã€LTVé¢„æµ‹ï¼‰
- å®æ—¶æ•°æ®å¤§å±

---

## åã€å‚è€ƒèµ„æ–™

- [operations-analytics-design.md](./operations-analytics-design.md) - è¿è¥æ•°æ®ç»Ÿè®¡ç³»ç»Ÿè®¾è®¡
- [Dashboard Platform](./dashboard-platform.md) - Dashboard å¹³å°æ¶æ„
- [Database Schema](../../../packages/database/prisma/schema.prisma) - æ•°æ®åº“è®¾è®¡

---

## é™„å½•

### A. æ•°æ®å­—å…¸

è¯¦è§æ•°æ®åº“ schema æ–‡æ¡£ã€‚

### B. API æ–‡æ¡£

è¯¦è§ Swagger æ–‡æ¡£ï¼ˆç”Ÿäº§ç¯å¢ƒä¸å¼€æ”¾ï¼‰ã€‚

### C. å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|---------|------|
| v1.0 | 2026-01-11 | åˆå§‹ç‰ˆæœ¬ | - |

---

**æ–‡æ¡£ç»“æŸ**

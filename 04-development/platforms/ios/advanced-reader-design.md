# iOS 高级阅读器功能设计文档

> 目标：打造集沉浸式阅读、智能朗读、3D可视化、智能注释于一体的下一代阅读体验

---

## 1. 功能概览

### 1.1 核心功能矩阵

| 功能模块 | 子功能 | 优先级 | 复杂度 |
|---------|-------|-------|-------|
| **智能朗读系统** | TTS朗读、人声朗读、高亮同步、自动翻页 | P0 | 高 |
| **划线与标注** | 文本划线、颜色高亮、想法气泡、批注管理 | P0 | 中 |
| **3D可视化** | 地形演示、阵型展示、人物建模、场景渲染 | P1 | 极高 |
| **智能注释** | 生僻词、俚语、双关语、文化背景解释 | P0 | 高 |
| **社交同步** | 热门3D内容同步、注释共享、社区互动 | P2 | 中 |
| **基础阅读器** | 翻页、目录、书签、搜索、设置等 | P0 | 中 |

### 1.2 整体架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        iOS Advanced Reader Architecture                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                         表现层 (Presentation Layer)                     │ │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐  │ │
│  │  │ ReaderView   │ │ AnnotationUI │ │ 3DSceneView  │ │ AudioPlayerUI│  │ │
│  │  │ 阅读主界面   │ │ 划线标注界面 │ │ 3D可视化    │ │ 朗读控制    │  │ │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘  │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                      │                                       │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                         业务逻辑层 (Business Layer)                     │ │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐  │ │
│  │  │ ReadingEngine│ │AnnotationMgr│ │ 3DAssetEngine│ │ AudioEngine  │  │ │
│  │  │ 阅读引擎     │ │ 批注管理器  │ │ 3D资源引擎  │ │ 音频引擎    │  │ │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘  │ │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐                   │ │
│  │  │ SmartAnnotate│ │ SyncManager  │ │ AnalyticsHub │                   │ │
│  │  │ 智能注释引擎 │ │ 同步管理器  │ │ 数据分析中心│                   │ │
│  │  └──────────────┘ └──────────────┘ └──────────────┘                   │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                      │                                       │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                           服务层 (Service Layer)                        │ │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐  │ │
│  │  │ AIService    │ │ TTSService   │ │ 3DGenService │ │ CloudSync    │  │ │
│  │  │ AI服务      │ │ TTS服务     │ │ 3D生成服务  │ │ 云端同步    │  │ │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘  │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                      │                                       │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                           数据层 (Data Layer)                           │ │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐  │ │
│  │  │ LocalStorage │ │ ContentCache │ │ 3DAssetCache │ │ CloudDB      │  │ │
│  │  │ 本地存储     │ │ 内容缓存    │ │ 3D资源缓存  │ │ 云端数据库  │  │ │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘  │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 智能朗读系统

### 2.1 系统架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          智能朗读系统架构                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │                          音频源选择器                                     ││
│  │  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐            ││
│  │  │   TTS 引擎     │  │  人声有声书    │  │   AI 克隆语音   │            ││
│  │  │ AVSpeechSynth │  │  LibriVox     │  │  ElevenLabs   │            ││
│  │  │  即时合成      │  │  预录制音频    │  │   定制音色     │            ││
│  │  └───────┬────────┘  └───────┬────────┘  └───────┬────────┘            ││
│  │          │                   │                   │                      ││
│  │          └───────────────────┼───────────────────┘                      ││
│  │                              ▼                                          ││
│  │  ┌─────────────────────────────────────────────────────────────────┐   ││
│  │  │                    统一音频播放控制器                             │   ││
│  │  │  • 播放/暂停/停止                                                │   ││
│  │  │  • 语速调节 (0.5x - 3.5x)                                       │   ││
│  │  │  • 章节/段落/句子跳转                                            │   ││
│  │  │  • 循环播放模式                                                  │   ││
│  │  └──────────────────────────────┬──────────────────────────────────┘   ││
│  │                                 │                                       ││
│  │                                 ▼                                       ││
│  │  ┌─────────────────────────────────────────────────────────────────┐   ││
│  │  │                      高亮同步引擎                                 │   ││
│  │  │  音频时间戳 ──────► 文本位置定位 ──────► UI高亮渲染              │   ││
│  │  └──────────────────────────────┬──────────────────────────────────┘   ││
│  │                                 │                                       ││
│  │                                 ▼                                       ││
│  │  ┌─────────────────────────────────────────────────────────────────┐   ││
│  │  │                      自动翻页控制器                               │   ││
│  │  │  监测当前页朗读完成 ──────► 触发翻页动画 ──────► 继续朗读        │   ││
│  │  └─────────────────────────────────────────────────────────────────┘   ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 朗读模式对比

| 特性 | TTS朗读 | 人声朗读 (LibriVox) | AI克隆语音 |
|-----|--------|-------------------|-----------|
| **音质** | 机械感 | 专业自然 | 高度自然 |
| **个性化** | 多种语音可选 | 固定朗读者 | 可定制音色 |
| **离线支持** | ✅ 完全支持 | ✅ 需预下载 | ❌ 需联网 |
| **资源消耗** | 低 | 中 (存储空间) | 高 (网络+计算) |
| **适用场景** | 通用阅读 | 经典文学 | 沉浸式体验 |
| **成本** | 免费 | 免费 | 付费 |

### 2.3 高亮跟随机制

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            高亮跟随层级                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Level 1: 单词级高亮                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ "It is a truth [universally] acknowledged, that a single man..."   │   │
│  │                  ▲▲▲▲▲▲▲▲▲▲                                          │   │
│  │              当前朗读单词高亮                                         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  Level 2: 句子级高亮                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓    │   │
│  │ It is a truth universally acknowledged, that a single man in       │   │
│  │ possession of a good fortune, must be in want of a wife.           │   │
│  │ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓    │   │
│  │                   整句高亮背景                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  Level 3: 段落级高亮                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ┌───────────────────────────────────────────────────────────────┐  │   │
│  │ │ It is a truth universally acknowledged, that a single man    │  │   │
│  │ │ in possession of a good fortune, must be in want of a wife.  │  │   │
│  │ │                                                               │  │   │
│  │ │ However little known the feelings or views of such a man may │  │   │
│  │ │ be on his first entering a neighbourhood...                  │  │   │
│  │ └───────────────────────────────────────────────────────────────┘  │   │
│  │                   当前段落边框/背景                                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.4 自动翻页流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          自动翻页状态机                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                          ┌────────────────┐                                  │
│                          │   朗读进行中    │                                  │
│                          └───────┬────────┘                                  │
│                                  │                                           │
│                    监测当前页文本朗读完成                                      │
│                                  │                                           │
│                                  ▼                                           │
│                    ┌─────────────────────────┐                               │
│                    │   检测是否还有下一页    │                               │
│                    └──────────┬──────────────┘                               │
│                               │                                              │
│              ┌────────────────┼────────────────┐                             │
│              ▼                                 ▼                             │
│       ┌──────────────┐                ┌──────────────┐                       │
│       │    有下一页   │                │   章节结束   │                       │
│       └──────┬───────┘                └──────┬───────┘                       │
│              │                               │                               │
│              ▼                               ▼                               │
│   ┌────────────────────┐          ┌────────────────────┐                     │
│   │ 暂停朗读 (100ms)   │          │ 检测下一章设置     │                     │
│   └─────────┬──────────┘          └─────────┬──────────┘                     │
│             │                               │                                │
│             ▼                    ┌──────────┴──────────┐                     │
│   ┌────────────────────┐        │                     │                     │
│   │ 执行翻页动画       │   ┌────────────┐    ┌────────────┐                  │
│   │ (仿真/滑动/无动画) │   │ 自动播放   │    │ 暂停等待   │                  │
│   └─────────┬──────────┘   │ 下一章     │    │ 用户确认   │                  │
│             │              └────────────┘    └────────────┘                  │
│             ▼                                                                │
│   ┌────────────────────┐                                                     │
│   │ 继续朗读新页内容   │                                                     │
│   └────────────────────┘                                                     │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.5 朗读控制界面设计

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           朗读控制面板                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        朗读工具栏 (底部固定)                          │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐│   │
│  │  │  🔊 ───────────●────────────────────────── 🔇                  ││   │
│  │  │           音量控制                                              ││   │
│  │  └─────────────────────────────────────────────────────────────────┘│   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐│   │
│  │  │    ⏮️        ◀️15s      ▶️/⏸️       ▶️15s        ⏭️             ││   │
│  │  │   上一句    快退15秒   播放/暂停   快进15秒    下一句            ││   │
│  │  └─────────────────────────────────────────────────────────────────┘│   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐│   │
│  │  │  🐢 ─────●───────────────────────────────────────────── 🐇      ││   │
│  │  │       0.5x    1.0x    1.5x    2.0x    2.5x    3.0x             ││   │
│  │  │                    语速控制                                      ││   │
│  │  └─────────────────────────────────────────────────────────────────┘│   │
│  │                                                                      │   │
│  │  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐       │   │
│  │  │ 🎙️   │  │ 😴   │  │ ↺    │  │ 📖   │  │ ⚙️   │  │ ✕    │       │   │
│  │  │音源  │  │睡眠  │  │循环  │  │同步  │  │设置  │  │关闭  │       │   │
│  │  └──────┘  └──────┘  └──────┘  └──────┘  └──────┘  └──────┘       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        音源选择面板                                   │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │  ◉ TTS 系统语音                                              │   │   │
│  │  │    └─ 声音: Samantha (美式女声)  ▼                           │   │   │
│  │  │                                                              │   │   │
│  │  │  ○ 人声有声书 (LibriVox)                                     │   │   │
│  │  │    └─ 朗读者: Karen Savage                                   │   │   │
│  │  │                                                              │   │   │
│  │  │  ○ AI 语音 (Premium)    ⭐                                   │   │   │
│  │  │    └─ 选择角色: 沉稳男声 / 温柔女声 / 戏剧化                 │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 划线与标注系统

### 3.1 标注类型矩阵

| 标注类型 | 触发方式 | 视觉呈现 | 功能说明 |
|---------|---------|---------|---------|
| **文本高亮** | 选中文本 | 背景色标记 | 5种颜色可选 |
| **下划线** | 选中文本 | 下划线标记 | 3种样式 (实线/虚线/波浪) |
| **想法气泡** | 长按高亮 | 气泡图标 | 添加个人想法/笔记 |
| **书签** | 点击书签按钮 | 折角标记 | 快速定位 |
| **批注链接** | AI生成 | 超链接样式 | 跳转至注释内容 |

### 3.2 标注交互流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          文本选择与标注流程                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Step 1: 文本选择                                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ "It is a truth [universally acknowledged], that a single man..."   │   │
│  │                  ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲                             │   │
│  │                     用户拖动选择文本                                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                       │
│                                      ▼                                       │
│  Step 2: 快捷操作菜单弹出                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  ┌──────────────────────────────────────────────────────────────┐   │   │
│  │  │ 🟡 🟢 🔵 🟣 🔴 │ ━━ │ 〰️  │ 💭 │ 📋 │ 🔍 │ 🔊 │ ✕ │           │   │   │
│  │  │   颜色选择   │下划│波浪│想法│复制│查词│朗读│关闭│           │   │   │
│  │  └──────────────────────────────────────────────────────────────┘   │   │
│  │                           ▲                                         │   │
│  │                     操作菜单悬浮于选中文本上方                        │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                       │
│                          用户点击「想法」按钮                                 │
│                                      │                                       │
│                                      ▼                                       │
│  Step 3: 想法气泡编辑                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  ┌──────────────────────────────────────────────────────────────┐   │   │
│  │  │  💭 添加想法                                           ✕     │   │   │
│  │  │  ──────────────────────────────────────────────────────────  │   │   │
│  │  │  原文: "universally acknowledged"                            │   │   │
│  │  │  ──────────────────────────────────────────────────────────  │   │   │
│  │  │                                                              │   │   │
│  │  │  ┌──────────────────────────────────────────────────────┐   │   │   │
│  │  │  │ 这个表达很有趣，作者用反讽的语气开篇...                │   │   │   │
│  │  │  │                                                      │   │   │   │
│  │  │  └──────────────────────────────────────────────────────┘   │   │   │
│  │  │                                                              │   │   │
│  │  │              [取消]                    [保存]                │   │   │
│  │  └──────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 标注数据结构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          标注数据模型                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Annotation 标注实体:                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  id              : UUID                                              │   │
│  │  bookId          : UUID                                              │   │
│  │  chapterId       : UUID                                              │   │
│  │  userId          : UUID                                              │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │  type            : HIGHLIGHT | UNDERLINE | NOTE | BOOKMARK           │   │
│  │  color           : #FFE066 | #98FB98 | #87CEEB | #DDA0DD | #FFB6C1   │   │
│  │  style           : SOLID | DASHED | WAVY (仅下划线)                   │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │  selectedText    : String                                            │   │
│  │  noteContent     : String? (想法内容)                                 │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │  startOffset     : Int (文本起始位置)                                 │   │
│  │  endOffset       : Int (文本结束位置)                                 │   │
│  │  cfi             : String? (EPUB CFI定位符)                           │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │  createdAt       : DateTime                                          │   │
│  │  updatedAt       : DateTime                                          │   │
│  │  syncStatus      : SYNCED | PENDING | CONFLICT                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 标注管理界面

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        标注管理侧边栏                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  📑 笔记与标注                                          [筛选 ▼]   │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │                                                                      │   │
│  │  📖 第1章: The Beginning                                            │   │
│  │  ├─ 🟡 "universally acknowledged"                                   │   │
│  │  │     💭 这个表达很有趣，作者用反讽的语气开篇...                    │   │
│  │  │     📅 2024-12-25 10:30                                          │   │
│  │  │                                                                   │   │
│  │  ├─ 🟢 "single man in possession of a good fortune"                 │   │
│  │  │     📅 2024-12-25 10:35                                          │   │
│  │  │                                                                   │   │
│  │  └─ 🔖 书签: 第15页                                                  │   │
│  │        📅 2024-12-25 11:00                                          │   │
│  │                                                                      │   │
│  │  📖 第2章: Mr. Bingley                                              │   │
│  │  ├─ 🔵 "neighbourhood"                                              │   │
│  │  │     💭 注意英式拼写与美式的区别                                   │   │
│  │  │     📅 2024-12-26 09:15                                          │   │
│  │  │                                                                   │   │
│  │  └─ ...                                                              │   │
│  │                                                                      │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │  统计: 15个高亮 · 8个笔记 · 3个书签                                  │   │
│  │  [导出笔记]                              [全部删除]                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 3D可视化系统

### 4.1 可视化类型矩阵

| 场景类型 | 触发文本示例 | 3D呈现形式 | 技术方案 |
|---------|------------|-----------|---------|
| **地理环境** | "战场位于山谷之中，两侧是陡峭的悬崖..." | 3D地形模型 | 程序化地形生成 |
| **排兵布阵** | "步兵居中，骑兵两翼包抄..." | 3D战术动画 | 单位模型+路径动画 |
| **人物外貌** | "他身材魁梧，面容刚毅，一道伤疤..." | 3D人物模型 | AI生成+骨骼绑定 |
| **场景环境** | "古堡矗立在悬崖边，月光洒落..." | 3D场景渲染 | 预制资源+光照 |
| **物品道具** | "这把剑通体漆黑，剑柄镶嵌着红宝石..." | 3D物品模型 | AI生成模型 |

### 4.2 3D内容生成流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         3D可视化生成流程                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                         预处理阶段 (后端)                               │ │
│  │                                                                         │ │
│  │  书籍文本 ──────► 场景识别AI ──────► 场景元数据                         │ │
│  │                        │                                                │ │
│  │                        ▼                                                │ │
│  │              ┌─────────────────────────────────────┐                   │ │
│  │              │  识别结果示例:                       │                   │ │
│  │              │  {                                  │                   │ │
│  │              │    "type": "BATTLEFIELD",           │                   │ │
│  │              │    "terrain": "valley",             │                   │ │
│  │              │    "elements": ["cliff", "river"],  │                   │ │
│  │              │    "armies": [                      │                   │ │
│  │              │      {"side": "A", "units": [...]}, │                   │ │
│  │              │      {"side": "B", "units": [...]}  │                   │ │
│  │              │    ],                               │                   │ │
│  │              │    "textRange": [1234, 1567]        │                   │ │
│  │              │  }                                  │                   │ │
│  │              └─────────────────────────────────────┘                   │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                      │                                       │
│                                      ▼                                       │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                      3D资源生成阶段 (后端/边缘)                         │ │
│  │                                                                         │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │ │
│  │  │ 地形生成器       │  │ 人物生成器      │  │ 场景组装器       │        │ │
│  │  │ (Procedural)    │  │ (AI Model Gen) │  │ (SceneKit)     │        │ │
│  │  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘        │ │
│  │           │                    │                    │                  │ │
│  │           └────────────────────┼────────────────────┘                  │ │
│  │                                ▼                                        │ │
│  │                   ┌─────────────────────────┐                          │ │
│  │                   │   3D资源包 (.glb/.usdz) │                          │ │
│  │                   │   + 动画脚本            │                          │ │
│  │                   │   + 交互配置            │                          │ │
│  │                   └─────────────────────────┘                          │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                      │                                       │
│                            上传至CDN，记录资源URL                            │
│                                      │                                       │
│                                      ▼                                       │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                        客户端渲染阶段 (iOS)                             │ │
│  │                                                                         │ │
│  │  用户点击3D图标 ──► 下载资源包 ──► SceneKit/RealityKit渲染             │ │
│  │                                         │                               │ │
│  │                                         ▼                               │ │
│  │                    ┌──────────────────────────────────────┐            │ │
│  │                    │         3D查看器界面                   │            │ │
│  │                    │  • 旋转/缩放/平移                     │            │ │
│  │                    │  • 播放动画                           │            │ │
│  │                    │  • 点击单位查看信息                   │            │ │
│  │                    │  • AR模式查看                        │            │ │
│  │                    └──────────────────────────────────────┘            │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.3 3D入口交互设计

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        3D可视化入口设计                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  方案A: 内嵌悬浮按钮                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │    The battle took place in a narrow valley. On both sides,         │   │
│  │    steep cliffs rose hundreds of feet into the sky. A small         │   │
│  │    river wound its way through the center, and beyond it, the       │   │
│  │    enemy forces waited in formation.                                │   │
│  │                                                 ┌────┐              │   │
│  │                                                 │🎬3D│◄── 悬浮按钮  │   │
│  │                                                 └────┘              │   │
│  │    The general surveyed the landscape with calculating eyes...      │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  方案B: 段落尾部图标                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │    The battle took place in a narrow valley. On both sides,         │   │
│  │    steep cliffs rose hundreds of feet into the sky. A small         │   │
│  │    river wound its way through the center, and beyond it, the       │   │
│  │    enemy forces waited in formation. [🎬]                           │   │
│  │                                       ▲                              │   │
│  │                               内联图标，点击展开                      │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  方案C: 热区高亮 (推荐)                                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │    The battle took place in a narrow valley. On both sides,         │   │
│  │    ┌─────────────────────────────────────────────────────────────┐ │   │
│  │    │ steep cliffs rose hundreds of feet into the sky. A small   │ │   │
│  │    │ river wound its way through the center, and beyond it,     │ │   │
│  │    │ the enemy forces waited in formation.              [🎬 3D] │ │   │
│  │    └─────────────────────────────────────────────────────────────┘ │   │
│  │    ▲ 微妙的边框+右下角图标，鼠标悬停时显示预览提示                    │   │
│  │                                                                      │   │
│  │    The general surveyed the landscape with calculating eyes...      │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  点击率指示器:                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │    [🎬 3D]  ──► 普通                                                 │   │
│  │    [🔥 3D]  ──► 热门 (>100次查看)                                    │   │
│  │    [⭐ 3D]  ──► 精选 (官方推荐)                                       │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.4 3D查看器界面

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         3D场景查看器                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ← 返回阅读                    峡谷战场                    [AR] [❤️]  │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │                                                                      │   │
│  │                                                                      │   │
│  │                     ╔══════════════════════════╗                    │   │
│  │                     ║                          ║                    │   │
│  │        ╔════╗       ║      3D 场景渲染区       ║       ╔════╗       │   │
│  │        ║ 🏔️ ║       ║                          ║       ║ 🏔️ ║       │   │
│  │        ╚════╝       ║   [旋转/缩放/平移手势]    ║       ╚════╝       │   │
│  │                     ║                          ║                    │   │
│  │                     ║     🏇  🏇  🏇  🏇      ║                    │   │
│  │                     ║     ⚔️  ⚔️  ⚔️  ⚔️      ║                    │   │
│  │                     ║         ～～～          ║                    │   │
│  │                     ║     ⚔️  ⚔️  ⚔️  ⚔️      ║                    │   │
│  │                     ║     🏇  🏇  🏇  🏇      ║                    │   │
│  │                     ║                          ║                    │   │
│  │                     ╚══════════════════════════╝                    │   │
│  │                                                                      │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │                                                                      │   │
│  │  ┌──────────────────────────────────────────────────────────────┐   │   │
│  │  │  📍 场景描述                                                  │   │   │
│  │  │  战斗发生在一个狭窄的峡谷中。两侧是陡峭的悬崖，              │   │   │
│  │  │  一条小河蜿蜒穿过中央...                                      │   │   │
│  │  └──────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐│   │
│  │  │  [🔄 重置视角]  [▶️ 播放动画]  [📸 截图]  [📤 分享]           ││   │
│  │  └─────────────────────────────────────────────────────────────────┘│   │
│  │                                                                      │   │
│  │  👁️ 1,234人查看   ❤️ 89人收藏   💬 12条评论                        │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.5 社交同步机制

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        3D内容社交同步流程                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                         用户A首次查看3D                                 │ │
│  │                                                                         │ │
│  │  用户A点击 ──► 记录查看事件 ──► 累计查看计数器                          │ │
│  │                    │                                                    │ │
│  │                    ▼                                                    │ │
│  │            ┌─────────────────────────────────────┐                     │ │
│  │            │  3DViewEvent:                       │                     │ │
│  │            │  - sceneId: "uuid-xxx"              │                     │ │
│  │            │  - userId: "user-a"                 │                     │ │
│  │            │  - bookId: "book-123"               │                     │ │
│  │            │  - timestamp: 2024-12-25T10:30:00Z  │                     │ │
│  │            │  - duration: 45s                    │                     │ │
│  │            └─────────────────────────────────────┘                     │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                      │                                       │
│                                      ▼                                       │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                         热度计算与推送                                  │ │
│  │                                                                         │ │
│  │  每小时任务:                                                            │ │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │ │
│  │  │  1. 统计各3D场景查看次数                                          │  │ │
│  │  │  2. 计算热度分数 = views × recency_factor × quality_score        │  │ │
│  │  │  3. 更新热门标签 (>100次 → 🔥)                                    │  │ │
│  │  │  4. 推送至其他阅读同一书籍的用户                                   │  │ │
│  │  └─────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                         │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                      │                                       │
│                                      ▼                                       │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                         用户B看到热门提示                               │ │
│  │                                                                         │ │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │ │
│  │  │                                                                   │  │ │
│  │  │    The battle took place in a narrow valley...                   │  │ │
│  │  │                                                  ┌────────────┐  │  │ │
│  │  │                                                  │🔥 3D      │  │  │ │
│  │  │                                                  │ 1.2K views│  │  │ │
│  │  │                                                  └────────────┘  │  │ │
│  │  │                                                                   │  │ │
│  │  └─────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                         │ │
│  │  提示框: "其他读者认为这个场景值得一看！"                                │ │
│  │                                                                         │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 智能注释系统

### 5.1 注释类型分类

| 注释类型 | 触发条件 | 内容示例 | AI处理方式 |
|---------|---------|---------|-----------|
| **生僻词汇** | 词频低于阈值 | "ephemeral" → 短暂的 | 词典+语境释义 |
| **俚语表达** | 匹配俚语库 | "kick the bucket" → 去世 | 文化背景+使用场景 |
| **双关语** | AI检测语义双重性 | "thyme/time" → 时间/百里香 | 解释双重含义 |
| **历史典故** | 匹配典故库 | "Achilles' heel" → 致命弱点 | 典故来源+寓意 |
| **文化背景** | 地域/时代特定表达 | "tuppence" → 两便士 | 货币换算+历史背景 |
| **作者风格** | 特定作家常用表达 | 狄更斯的讽刺语法 | 写作技巧解析 |

### 5.2 预处理流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         智能注释预处理流程                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                      Step 1: 文本分析 (导入时)                          │ │
│  │                                                                         │ │
│  │  书籍原文 ──────► NLP分词 ──────► 词频分析 ──────► 候选词标记           │ │
│  │                                                                         │ │
│  │  输入:                                                                  │ │
│  │  "It is a truth universally acknowledged, that a single man            │ │
│  │   in possession of a good fortune, must be in want of a wife."         │ │
│  │                                                                         │ │
│  │  输出:                                                                  │ │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │ │
│  │  │  候选词:                                                          │  │ │
│  │  │  - "universally" (词频: 中等, 标记: 可能需解释)                   │  │ │
│  │  │  - "acknowledged" (词频: 中等, 标记: 可能需解释)                  │  │ │
│  │  │  - "possession" (词频: 中等, 标记: 可能需解释)                    │  │ │
│  │  └─────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                         │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                      │                                       │
│                                      ▼                                       │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                   Step 2: AI深度分析 (批量处理)                         │ │
│  │                                                                         │ │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │ │
│  │  │  AI Prompt:                                                       │  │ │
│  │  │  分析以下文本，识别对非英语母语读者可能造成理解困难的内容:         │  │ │
│  │  │  - 生僻词汇 (建议:词频低于常用5000词)                             │  │ │
│  │  │  - 俚语/习语                                                      │  │ │
│  │  │  - 双关语/文字游戏                                                │  │ │
│  │  │  - 文化典故/历史背景                                              │  │ │
│  │  │  - 讽刺/反语                                                      │  │ │
│  │  │                                                                   │  │ │
│  │  │  对每个识别项提供:                                                 │  │ │
│  │  │  1. 词/短语位置                                                   │  │ │
│  │  │  2. 难度等级 (1-5)                                               │  │ │
│  │  │  3. 解释内容 (简洁)                                               │  │ │
│  │  │  4. 使用示例                                                      │  │ │
│  │  └─────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                         │ │
│  │  AI输出:                                                                │ │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │ │
│  │  │  {                                                                │  │ │
│  │  │    "annotations": [                                               │  │ │
│  │  │      {                                                            │  │ │
│  │  │        "text": "universally acknowledged",                        │  │ │
│  │  │        "type": "IRONY",                                           │  │ │
│  │  │        "difficulty": 4,                                           │  │ │
│  │  │        "explanation": "这是一个讽刺表达。作者暗示这个'真理'        │  │ │
│  │  │         并非真正普遍认同，而是讽刺当时社会对婚姻的功利态度。",      │  │ │
│  │  │        "offset": [10, 32]                                         │  │ │
│  │  │      },                                                           │  │ │
│  │  │      {                                                            │  │ │
│  │  │        "text": "in possession of a good fortune",                 │  │ │
│  │  │        "type": "IDIOM",                                           │  │ │
│  │  │        "difficulty": 3,                                           │  │ │
│  │  │        "explanation": "拥有大量财富。'fortune'这里指财产，         │  │ │
│  │  │         而非运气。这是19世纪英国常用的表达方式。",                  │  │ │
│  │  │        "offset": [51, 82]                                         │  │ │
│  │  │      }                                                            │  │ │
│  │  │    ]                                                              │  │ │
│  │  │  }                                                                │  │ │
│  │  └─────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                         │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                      │                                       │
│                                      ▼                                       │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                      Step 3: 存储与索引                                 │ │
│  │                                                                         │ │
│  │  ┌───────────────┐    ┌───────────────┐    ┌───────────────┐          │ │
│  │  │  注释数据库    │    │  位置索引     │    │  CDN缓存      │          │ │
│  │  │  PostgreSQL   │    │  Offset Map  │    │  CloudFlare  │          │ │
│  │  └───────────────┘    └───────────────┘    └───────────────┘          │ │
│  │                                                                         │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.3 注释交互设计

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         智能注释交互方式                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  方案A: 下划虚线 + 点击展开                                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  It is a truth universally acknowledged, that a single man          │   │
│  │               ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲                             │   │
│  │  in possession of a good fortune, must be in want of a wife.        │   │
│  │     ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲ ̲                                    │   │
│  │  ▲ 虚线下划线表示有注释                                               │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                       │
│                              点击虚线区域                                     │
│                                      │                                       │
│                                      ▼                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  It is a truth universally acknowledged, that a single man          │   │
│  │               ╔══════════════════════════════════════════════════╗  │   │
│  │               ║ 💡 讽刺表达                                       ║  │   │
│  │               ║                                                   ║  │   │
│  │               ║ 这是一个讽刺表达。作者暗示这个"真理"              ║  │   │
│  │               ║ 并非真正普遍认同，而是讽刺当时社会               ║  │   │
│  │               ║ 对婚姻的功利态度。                               ║  │   │
│  │               ║                                                   ║  │   │
│  │               ║ 📖 相关背景 | 🔊 朗读 | 📋 复制                  ║  │   │
│  │               ╚══════════════════════════════════════════════════╝  │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  方案B: 边栏标记 + 滑动展开                                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  │   It is a truth universally acknowledged, that a single man     │   │
│  │  │💡 in possession of a good fortune, must be in want of a wife.    │   │
│  │  │                                                                   │   │
│  │  │   However little known the feelings or views of such a man       │   │
│  │  │   may be on his first entering a neighbourhood...                │   │
│  │  │                                                                   │   │
│  │  ▲ 边栏图标，表示该段有注释                                          │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  方案C: 悬浮预览 (iPad/Mac优化)                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │  It is a truth universally acknowledged, that a single man          │   │
│  │                    ▲                                                 │   │
│  │              鼠标悬停触发                                             │   │
│  │              ┌──────────────────────────────┐                       │   │
│  │              │ 💡 讽刺表达                   │                       │   │
│  │              │ 作者暗示这个"真理"并非真正...│                       │   │
│  │              │ [查看更多]                   │                       │   │
│  │              └──────────────────────────────┘                       │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.4 注释密度控制

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        注释密度设置                                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  📝 智能注释设置                                                     │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │                                                                      │   │
│  │  注释密度:                                                           │   │
│  │  ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐                            │   │
│  │  │ 关闭 │  │ 精简 │  │ 标准 │  │ 详尽 │                            │   │
│  │  │      │  │  ●   │  │      │  │      │                            │   │
│  │  └──────┘  └──────┘  └──────┘  └──────┘                            │   │
│  │                                                                      │   │
│  │  各模式说明:                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │  关闭: 不显示任何预置注释                                      │   │   │
│  │  │  精简: 仅显示核心难点 (难度4-5)                                │   │   │
│  │  │  标准: 显示中等以上难点 (难度3-5) ← 推荐                       │   │   │
│  │  │  详尽: 显示所有注释，适合深度学习                              │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  │                                                                      │   │
│  │  注释类型筛选:                                                       │   │
│  │  ├── ☑️ 生僻词汇                                                    │   │
│  │  ├── ☑️ 俚语/习语                                                   │   │
│  │  ├── ☑️ 双关语                                                      │   │
│  │  ├── ☑️ 文化典故                                                    │   │
│  │  ├── ☐ 语法分析                                                     │   │
│  │  └── ☐ 写作技巧                                                     │   │
│  │                                                                      │   │
│  │  我的词汇水平:                                                       │   │
│  │  ○ 初级 (5000词以下)                                                │   │
│  │  ● 中级 (5000-10000词)                                              │   │
│  │  ○ 高级 (10000词以上)                                               │   │
│  │  ○ 母语水平                                                         │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.5 注释数据模型

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        智能注释数据结构                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  SmartAnnotation 智能注释实体:                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  id                : UUID                                            │   │
│  │  bookId            : UUID                                            │   │
│  │  chapterId         : UUID                                            │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │  annotationType    : VOCABULARY | IDIOM | PUN | ALLUSION |           │   │
│  │                      CULTURAL | IRONY | GRAMMAR                      │   │
│  │  difficulty        : 1-5 (难度等级)                                   │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │  originalText      : String (原文)                                    │   │
│  │  startOffset       : Int                                             │   │
│  │  endOffset         : Int                                             │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │  explanation       : String (解释)                                    │   │
│  │  translation       : String? (翻译)                                   │   │
│  │  pronunciation     : String? (发音/音标)                              │   │
│  │  examples          : String[]? (例句)                                 │   │
│  │  etymology         : String? (词源)                                   │   │
│  │  culturalContext   : String? (文化背景)                               │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │  aiGenerated       : Boolean                                         │   │
│  │  verified          : Boolean (人工审核)                               │   │
│  │  viewCount         : Int (查看次数)                                   │   │
│  │  helpfulCount      : Int (有帮助数)                                   │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │  createdAt         : DateTime                                        │   │
│  │  updatedAt         : DateTime                                        │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 基础阅读器功能

### 6.1 功能清单

| 功能类别 | 功能项 | 实现状态 | 优先级 |
|---------|-------|---------|-------|
| **翻页导航** | 左右滑动翻页 | ✅ 已实现 | P0 |
| | 点击边缘翻页 | ✅ 已实现 | P0 |
| | 仿真翻页效果 | ⏳ 规划中 | P1 |
| | 垂直滚动模式 | ⏳ 规划中 | P2 |
| **章节导航** | 目录侧边栏 | ✅ 已实现 | P0 |
| | 进度条快速跳转 | ✅ 已实现 | P0 |
| | 搜索章节 | ⏳ 规划中 | P1 |
| **外观设置** | 主题切换 (浅/护眼/深) | ✅ 已实现 | P0 |
| | 字体大小调节 | ✅ 已实现 | P0 |
| | 字体样式选择 | ⏳ 规划中 | P1 |
| | 行距调节 | ⏳ 规划中 | P1 |
| | 边距调节 | ⏳ 规划中 | P2 |
| **阅读辅助** | 全文搜索 | ⏳ 规划中 | P1 |
| | 书签管理 | ⏳ 规划中 | P1 |
| | 阅读统计 | ⏳ 规划中 | P2 |
| | 定时提醒 | ⏳ 规划中 | P2 |
| **系统集成** | 屏幕常亮 | ✅ 已实现 | P0 |
| | 自动亮度调节 | ⏳ 规划中 | P1 |
| | 控制中心集成 | ✅ 已实现 | P0 |

### 6.2 阅读器完整界面

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        阅读器完整界面布局                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  [✕]                Pride and Prejudice                    [⋮]     │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │                          Chapter 1                                   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  ▲ 顶部工具栏 (点击屏幕中央显示/隐藏)                                        │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │       It is a truth universally acknowledged, that a single         │   │
│  │  man in possession of a good fortune, must be in want of a          │   │
│  │  wife.                                                              │   │
│  │                                                                      │   │
│  │       However little known the feelings or views of such a          │   │
│  │  man may be on his first entering a neighbourhood, this truth       │   │
│  │  is so well fixed in the minds of the surrounding families,         │   │
│  │  that he is considered as the rightful property of some one         │   │
│  │  or other of their daughters.                                       │   │
│  │                                                                      │   │
│  │       "My dear Mr. Bennet," said his lady to him one day,           │   │
│  │  "have you heard that Netherfield Park is let at last?"             │   │
│  │                                                                      │   │
│  │       Mr. Bennet replied that he had not.                           │   │
│  │                                                                      │   │
│  │       "But it is," returned she; "for Mrs. Long has just            │   │
│  │  been here, and she told me all about it."                          │   │
│  │                                                                      │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  ▲ 阅读内容区 (支持左右滑动翻页)                                             │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ══════════════●════════════════════════════════════════════════    │   │
│  │  Chapter 1                                           Page 3 of 280  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  ▲ 底部进度条 (点击屏幕中央显示/隐藏)                                        │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  [📑目录]  [Aa设置]  [🔍搜索]  [🔖书签]  [🔊朗读]  [💬AI]           │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  ▲ 底部工具栏 (点击屏幕中央显示/隐藏)                                        │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 6.3 设置面板

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          阅读设置面板                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  Aa 阅读设置                                                  [✕]   │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │                                                                      │   │
│  │  字体大小                                                            │   │
│  │  [ A⁻ ] ═══════════●═════════════════ [ A⁺ ]                        │   │
│  │                    18                                                │   │
│  │                                                                      │   │
│  │  字体样式                                                            │   │
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐            │   │
│  │  │ System │ │Georgia │ │Palatino│ │ Times  │ │Charter │            │   │
│  │  │   ○    │ │   ●    │ │   ○    │ │   ○    │ │   ○    │            │   │
│  │  └────────┘ └────────┘ └────────┘ └────────┘ └────────┘            │   │
│  │                                                                      │   │
│  │  阅读主题                                                            │   │
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐                        │   │
│  │  │  ☀️    │ │  📜    │ │  🌙    │ │  ⬛    │                        │   │
│  │  │ 明亮   │ │ 护眼   │ │ 夜间   │ │ OLED  │                        │   │
│  │  │   ○    │ │   ●    │ │   ○    │ │   ○    │                        │   │
│  │  └────────┘ └────────┘ └────────┘ └────────┘                        │   │
│  │                                                                      │   │
│  │  行距                                                                │   │
│  │  [ ≡ ] ════════════════●════════════ [ ⫾ ]                         │   │
│  │                       1.5                                            │   │
│  │                                                                      │   │
│  │  边距                                                                │   │
│  │  [ ◇ ] ═══════●══════════════════════ [ ◆ ]                         │   │
│  │              窄                                                      │   │
│  │                                                                      │   │
│  │  翻页模式                                                            │   │
│  │  ○ 左右滑动                                                         │   │
│  │  ○ 仿真翻页                                                         │   │
│  │  ● 点击翻页                                                         │   │
│  │  ○ 垂直滚动                                                         │   │
│  │                                                                      │   │
│  │  ──────────────────────────────────────────────────────────────────  │   │
│  │  其他设置                                                            │   │
│  │  ├── ☑️ 屏幕常亮                                                    │   │
│  │  ├── ☑️ 两端对齐                                                    │   │
│  │  ├── ☐ 自动连字符                                                   │   │
│  │  └── ☐ 显示页码                                                     │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. 技术实现方案

### 7.1 技术栈选型

| 模块 | 技术方案 | 理由 |
|-----|---------|-----|
| **渲染引擎** | WKWebView + CSS Multi-Column | 成熟稳定，支持富文本 |
| **TTS引擎** | AVSpeechSynthesizer + 第三方TTS | 系统原生+高质量语音 |
| **音频播放** | AVFoundation | iOS原生，功能完整 |
| **3D渲染** | SceneKit / RealityKit | iOS原生，AR支持 |
| **3D生成** | Point-E / Shap-E + 后端处理 | AI生成3D资源 |
| **AI服务** | DeepSeek / OpenAI / Claude | 多模型支持 |
| **本地存储** | Core Data + SQLite | 持久化+复杂查询 |
| **云同步** | CloudKit + 自建API | 原生同步+自定义逻辑 |
| **动画** | Core Animation + SwiftUI | 流畅动效 |

### 7.2 模块依赖关系

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         模块依赖关系图                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                           ┌─────────────────┐                               │
│                           │   ReaderView    │                               │
│                           │    阅读器主视图  │                               │
│                           └────────┬────────┘                               │
│                                    │                                         │
│          ┌─────────────────────────┼─────────────────────────┐              │
│          ▼                         ▼                         ▼              │
│  ┌───────────────┐       ┌───────────────┐       ┌───────────────┐         │
│  │ AudioModule   │       │ AnnotationMod │       │ 3DVisualMod  │         │
│  │ 音频模块      │       │ 标注模块      │       │ 3D可视化模块 │         │
│  └───────┬───────┘       └───────┬───────┘       └───────┬───────┘         │
│          │                       │                       │                  │
│          ▼                       ▼                       ▼                  │
│  ┌───────────────┐       ┌───────────────┐       ┌───────────────┐         │
│  │ TTSEngine     │       │ SmartAnnotate │       │ 3DAssetLoader │         │
│  │ TTS引擎       │       │ 智能注释引擎  │       │ 3D资源加载器  │         │
│  └───────┬───────┘       └───────┬───────┘       └───────┬───────┘         │
│          │                       │                       │                  │
│          └───────────────────────┼───────────────────────┘                  │
│                                  ▼                                          │
│                       ┌────────────────────┐                                │
│                       │    AIService       │                                │
│                       │    AI服务层        │                                │
│                       └─────────┬──────────┘                                │
│                                 │                                           │
│          ┌──────────────────────┼──────────────────────┐                    │
│          ▼                      ▼                      ▼                    │
│  ┌───────────────┐     ┌───────────────┐     ┌───────────────┐             │
│  │ APIClient     │     │ LocalStorage  │     │ CloudSync     │             │
│  │ API客户端     │     │ 本地存储      │     │ 云端同步      │             │
│  └───────────────┘     └───────────────┘     └───────────────┘             │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 7.3 数据流转图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           阅读器数据流转                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  用户交互                                                                    │
│      │                                                                       │
│      ▼                                                                       │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                         事件分发器                                     │  │
│  │  点击/滑动/长按/选择文本/语音命令                                       │  │
│  └─────────────────────────────┬────────────────────────────────────────┘  │
│                                │                                            │
│           ┌────────────────────┼────────────────────┐                       │
│           ▼                    ▼                    ▼                       │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │
│  │ 页面导航事件    │  │ 内容交互事件    │  │ 工具栏事件      │            │
│  │ • 翻页         │  │ • 文本选择     │  │ • 设置调整     │            │
│  │ • 章节跳转     │  │ • 点击注释     │  │ • 功能开关     │            │
│  │ • 进度条拖动   │  │ • 3D查看       │  │ • 朗读控制     │            │
│  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘            │
│           │                    │                    │                       │
│           ▼                    ▼                    ▼                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                       ReaderViewModel                                │   │
│  │  • 状态管理 (currentPage, annotations, audioState, settings)        │   │
│  │  • 业务逻辑 (loadContent, saveProgress, requestAI, syncData)        │   │
│  └─────────────────────────────┬───────────────────────────────────────┘   │
│                                │                                            │
│              ┌─────────────────┼─────────────────┐                          │
│              ▼                 ▼                 ▼                          │
│     ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐            │
│     │ 本地数据层       │ │ 网络数据层      │ │ 渲染层          │            │
│     │ • Core Data    │ │ • API请求      │ │ • WKWebView    │            │
│     │ • UserDefaults │ │ • WebSocket    │ │ • SceneKit     │            │
│     │ • FileManager  │ │ • CDN资源      │ │ • AVPlayer     │            │
│     └─────────────────┘ └─────────────────┘ └─────────────────┘            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 实施路线图

### 8.1 Phase 1: 核心基础 (P0)

| 任务 | 描述 | 依赖 |
|-----|------|-----|
| 智能朗读-TTS | 集成AVSpeechSynthesizer，实现基础TTS朗读 | - |
| 智能朗读-高亮 | 实现单词/句子级高亮同步 | TTS集成 |
| 智能朗读-翻页 | 实现朗读时自动翻页 | 高亮同步 |
| 划线标注 | 实现文本选择和颜色高亮 | - |
| 想法气泡 | 实现高亮文本添加笔记 | 划线标注 |
| 智能注释-展示 | 实现预置注释的展示交互 | - |
| 基础设置 | 完善字体/主题/行距等设置 | - |

### 8.2 Phase 2: 进阶功能 (P1)

| 任务 | 描述 | 依赖 |
|-----|------|-----|
| 人声有声书 | 集成LibriVox音频播放 | TTS集成 |
| 听读同步 | 实现Whispersync功能 | 人声有声书 |
| 智能注释-生成 | 后端AI预处理生成注释 | - |
| 注释密度控制 | 用户可调节注释展示密度 | 智能注释-展示 |
| 书签管理 | 书签添加/管理/导航 | - |
| 全文搜索 | 章节内容搜索 | - |

### 8.3 Phase 3: 创新功能 (P2)

| 任务 | 描述 | 依赖 |
|-----|------|-----|
| 3D场景识别 | AI识别可视化场景 | - |
| 3D资源生成 | 后端生成3D资源 | 场景识别 |
| 3D查看器 | iOS端3D展示和交互 | 资源生成 |
| 3D社交同步 | 热门3D内容同步 | 3D查看器 |
| AI克隆语音 | 集成ElevenLabs定制语音 | 人声有声书 |
| 跟读评分 | 语音识别+AI评分 | - |

### 8.4 Phase 4: 优化迭代 (P3)

| 任务 | 描述 | 依赖 |
|-----|------|-----|
| AR阅读模式 | RealityKit AR展示 | 3D查看器 |
| CarPlay支持 | 车载有声书播放 | 人声有声书 |
| 双语对照 | 中英文交替朗读 | TTS集成 |
| 学习模式 | 生词暂停+查词一体化 | 智能注释 |
| 阅读统计 | 详细阅读数据分析 | - |

---

## 9. 风险与应对

| 风险 | 影响 | 应对策略 |
|-----|------|---------|
| 3D生成质量不稳定 | 用户体验差 | 设置质量阈值，低于阈值不展示；人工审核热门内容 |
| AI注释准确性 | 误导读者 | 分级展示，高置信度才自动显示；用户反馈机制 |
| 音频同步精度低 | Whispersync体验差 | 先实现章节级同步，逐步提升精度 |
| 3D资源加载慢 | 等待时间长 | 预加载机制；渐进式加载；本地缓存 |
| 移动端性能压力 | 卡顿/发热 | 资源压缩；按需加载；低配设备降级 |

---

## 10. 成功指标

| 指标 | 目标值 | 说明 |
|-----|-------|------|
| 朗读功能使用率 | >40% | 使用TTS/人声朗读的用户比例 |
| 划线标注使用率 | >30% | 使用划线/高亮功能的用户比例 |
| 智能注释点击率 | >20% | 注释展示后的点击率 |
| 3D查看完成率 | >60% | 点击3D后完整查看的比例 |
| 平均阅读时长 | +15% | 相比未使用新功能的用户 |
| 用户满意度 | >4.5⭐ | App Store评分 |

---

*文档版本: v1.0*
*创建日期: 2024-12-31*
*最后更新: 2024-12-31*

# ä¸‹åˆ’çº¿æ ‡æ³¨ç³»ç»Ÿå®ç°æ–‡æ¡£

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 åŠŸèƒ½è¾¹ç•Œ

| åŠŸèƒ½é¡¹ | åŒ…å« | ä¸åŒ…å« |
|--------|------|--------|
| åˆ›å»ºæ–¹å¼ | æ–‡æœ¬é€‰ä¸­åæ‰‹åŠ¨åˆ›å»º | è‡ªåŠ¨ä¸‹åˆ’çº¿ |
| æ ·å¼é€‰é¡¹ | å¤šç§çº¿å‹/é¢œè‰² | è‡ªå®šä¹‰çº¿å‹ |
| å­˜å‚¨èŒƒå›´ | æœ¬åœ°æŒä¹…åŒ–/äº‘åŒæ­¥ | ä¸´æ—¶æ ‡è®° |
| ç¼–è¾‘æ“ä½œ | åˆ›å»º/ä¿®æ”¹æ ·å¼/åˆ é™¤ | åˆå¹¶/æ‹†åˆ† |

### 1.2 ä¸é«˜äº®çš„åŒºåˆ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ ‡æ³¨ç±»å‹å¯¹æ¯”                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        é«˜äº®             â”‚         ä¸‹åˆ’çº¿               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ èƒŒæ™¯è‰²å¡«å……              â”‚ åº•éƒ¨çº¿æ¡                     â”‚
â”‚ é€‚åˆæ ‡è®°é‡è¦æ®µè½        â”‚ é€‚åˆæ ‡è®°å…³é”®è¯/æœ¯è¯­          â”‚
â”‚ è§†è§‰å†²å‡»åŠ›å¼º            â”‚ è§†è§‰å¹²æ‰°å°                   â”‚
â”‚ å•ä¸€é€æ˜åº¦              â”‚ å¤šç§çº¿å‹                     â”‚
â”‚ ä¸å½±å“æ–‡å­—é¢œè‰²          â”‚ å¯é€‰æ³¢æµª/è™šçº¿ç­‰æ ·å¼          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ¨¡å—æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UnderlineManager                             â”‚
â”‚                      (å•ä¾‹æ¨¡å¼)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚SelectionMgr â”‚  â”‚RenderEngine â”‚  â”‚StorageManager           â”‚  â”‚
â”‚  â”‚ (é€‰åŒºç®¡ç†)  â”‚  â”‚ (æ¸²æŸ“å¼•æ“)  â”‚  â”‚ (å­˜å‚¨ç®¡ç†)             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                â”‚                      â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚TextSelectionâ”‚  â”‚SVGRenderer  â”‚  â”‚CoreDataStore          â”‚   â”‚
â”‚  â”‚RangeHandler â”‚  â”‚CSSBorder    â”‚  â”‚CloudKitSync           â”‚   â”‚
â”‚  â”‚MenuPresenterâ”‚  â”‚StyleManager â”‚  â”‚ExportService          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¸²æŸ“æ–¹æ¡ˆå¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ¸²æŸ“æ–¹æ¡ˆé€‰æ‹©                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  æ–¹æ¡ˆA: CSS border-bottom                                       â”‚
â”‚  â”œâ”€â”€ ä¼˜ç‚¹: å®ç°ç®€å•,æ€§èƒ½å¥½                                     â”‚
â”‚  â”œâ”€â”€ ç¼ºç‚¹: æ ·å¼æœ‰é™,æ— æ³•åšæ³¢æµªçº¿                               â”‚
â”‚  â””â”€â”€ é€‚ç”¨: ç›´çº¿ã€è™šçº¿                                          â”‚
â”‚                                                                 â”‚
â”‚  æ–¹æ¡ˆB: CSS text-decoration                                     â”‚
â”‚  â”œâ”€â”€ ä¼˜ç‚¹: åŸç”Ÿæ”¯æŒ,è·¨è¡Œè‡ªåŠ¨å¤„ç†                               â”‚
â”‚  â”œâ”€â”€ ç¼ºç‚¹: éƒ¨åˆ†æµè§ˆå™¨æ ·å¼ä¸ä¸€è‡´                                â”‚
â”‚  â””â”€â”€ é€‚ç”¨: åŸºç¡€ä¸‹åˆ’çº¿                                          â”‚
â”‚                                                                 â”‚
â”‚  æ–¹æ¡ˆC: SVGå åŠ å±‚                                               â”‚
â”‚  â”œâ”€â”€ ä¼˜ç‚¹: å®Œå…¨å¯æ§,å¯åšä»»æ„æ ·å¼                               â”‚
â”‚  â”œâ”€â”€ ç¼ºç‚¹: éœ€è¦è®¡ç®—ä½ç½®,æ€§èƒ½å¼€é”€                               â”‚
â”‚  â””â”€â”€ é€‚ç”¨: æ³¢æµªçº¿ã€è‡ªå®šä¹‰æ ·å¼                                  â”‚
â”‚                                                                 â”‚
â”‚  æ¨è: æ··åˆæ–¹æ¡ˆ                                                 â”‚
â”‚  â”œâ”€â”€ ç›´çº¿/è™šçº¿: CSS text-decoration                            â”‚
â”‚  â””â”€â”€ æ³¢æµªçº¿: SVGå åŠ                                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. æ•°æ®æ¨¡å‹

### 3.1 ä¸‹åˆ’çº¿å®ä½“

```
Underline
â”œâ”€â”€ id: UUID                     // å”¯ä¸€æ ‡è¯†
â”œâ”€â”€ bookId: String               // æ‰€å±ä¹¦ç±ID
â”œâ”€â”€ chapterId: String            // æ‰€å±ç« èŠ‚ID
â”œâ”€â”€ startCFI: String             // èµ·å§‹CFIä½ç½®
â”œâ”€â”€ endCFI: String               // ç»“æŸCFIä½ç½®
â”œâ”€â”€ selectedText: String         // é€‰ä¸­çš„æ–‡æœ¬å†…å®¹
â”œâ”€â”€ style: UnderlineStyle        // ä¸‹åˆ’çº¿æ ·å¼
â”œâ”€â”€ color: UnderlineColor        // ä¸‹åˆ’çº¿é¢œè‰²
â”œâ”€â”€ thickness: CGFloat           // çº¿æ¡ç²—ç»†
â”œâ”€â”€ createdAt: Date              // åˆ›å»ºæ—¶é—´
â”œâ”€â”€ updatedAt: Date              // æ›´æ–°æ—¶é—´
â”œâ”€â”€ syncStatus: SyncStatus       // åŒæ­¥çŠ¶æ€
â””â”€â”€ isDeleted: Bool              // è½¯åˆ é™¤æ ‡è®°

UnderlineStyle
â”œâ”€â”€ solid                        // å®çº¿ â”€â”€â”€â”€â”€â”€â”€
â”œâ”€â”€ dashed                       // è™šçº¿ - - - -
â”œâ”€â”€ dotted                       // ç‚¹çº¿ Â· Â· Â· Â·
â”œâ”€â”€ wavy                         // æ³¢æµª âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿âˆ¿
â””â”€â”€ double                       // åŒçº¿ â•â•â•â•â•â•â•

UnderlineColor
â”œâ”€â”€ red       (#F44336)
â”œâ”€â”€ blue      (#2196F3)
â”œâ”€â”€ green     (#4CAF50)
â”œâ”€â”€ orange    (#FF9800)
â”œâ”€â”€ purple    (#9C27B0)
â””â”€â”€ black     (#212121)
```

### 3.2 æ ·å¼é…ç½®è¡¨

| æ ·å¼ | CSSå®ç° | å¤‡ç”¨æ–¹æ¡ˆ |
|------|---------|----------|
| å®çº¿ | text-decoration: underline solid | border-bottom |
| è™šçº¿ | text-decoration: underline dashed | border-bottom: dashed |
| ç‚¹çº¿ | text-decoration: underline dotted | border-bottom: dotted |
| æ³¢æµª | text-decoration: underline wavy | SVGæ¸²æŸ“ |
| åŒçº¿ | text-decoration: underline double | SVGæ¸²æŸ“ |

### 3.3 çº¿æ¡ç²—ç»†é€‰é¡¹

| ç­‰çº§ | åƒç´ å€¼ | è¯´æ˜ |
|------|--------|------|
| thin | 1px | ç»†çº¿ |
| medium | 2px | æ ‡å‡†(é»˜è®¤) |
| thick | 3px | ç²—çº¿ |

## 4. æ¸²æŸ“å®ç°

### 4.1 CSSæ–¹æ¡ˆå®ç°

```
æ³¨å…¥çš„CSSç±»
â”œâ”€â”€ .ul-base
â”‚   â”œâ”€â”€ text-decoration-skip-ink: none
â”‚   â”œâ”€â”€ text-underline-offset: 2px
â”‚   â””â”€â”€ text-decoration-thickness: from-font
â”‚
â”œâ”€â”€ æ ·å¼ç±»
â”‚   â”œâ”€â”€ .ul-solid  { text-decoration-style: solid; }
â”‚   â”œâ”€â”€ .ul-dashed { text-decoration-style: dashed; }
â”‚   â”œâ”€â”€ .ul-dotted { text-decoration-style: dotted; }
â”‚   â”œâ”€â”€ .ul-wavy   { text-decoration-style: wavy; }
â”‚   â””â”€â”€ .ul-double { text-decoration-style: double; }
â”‚
â”œâ”€â”€ é¢œè‰²ç±»
â”‚   â”œâ”€â”€ .ul-red    { text-decoration-color: #F44336; }
â”‚   â”œâ”€â”€ .ul-blue   { text-decoration-color: #2196F3; }
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ ç²—ç»†ç±»
    â”œâ”€â”€ .ul-thin   { text-decoration-thickness: 1px; }
    â”œâ”€â”€ .ul-medium { text-decoration-thickness: 2px; }
    â””â”€â”€ .ul-thick  { text-decoration-thickness: 3px; }
```

### 4.2 SVGæ³¢æµªçº¿æ¸²æŸ“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SVGæ³¢æµªçº¿æ¸²æŸ“æµç¨‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1. è·å–æ–‡æœ¬è¡Œçš„ä½ç½®ä¿¡æ¯                                â”‚
â”‚     â””â”€â”€ getClientRects() è·å–æ¯è¡ŒçŸ©å½¢                  â”‚
â”‚                                                         â”‚
â”‚  2. ä¸ºæ¯è¡Œåˆ›å»ºSVGè·¯å¾„                                   â”‚
â”‚     â”œâ”€â”€ è®¡ç®—æ³¢æµªè·¯å¾„                                   â”‚
â”‚     â”œâ”€â”€ è®¾ç½®strokeé¢œè‰²/å®½åº¦                            â”‚
â”‚     â””â”€â”€ å®šä½åˆ°æ–‡æœ¬ä¸‹æ–¹                                 â”‚
â”‚                                                         â”‚
â”‚  3. åˆ›å»ºSVGå åŠ å±‚                                       â”‚
â”‚     â”œâ”€â”€ position: absolute                             â”‚
â”‚     â”œâ”€â”€ pointer-events: none                           â”‚
â”‚     â””â”€â”€ z-index: ä½äºæ–‡æœ¬                              â”‚
â”‚                                                         â”‚
â”‚  æ³¢æµªè·¯å¾„å…¬å¼:                                          â”‚
â”‚  M 0,h Q w/4,0 w/2,h T w,h                             â”‚
â”‚  (h=æ³¢é«˜, w=æ³¢å®½)                                      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 å¤šè¡Œä¸‹åˆ’çº¿å¤„ç†

```
é€‰åŒºè·¨è¶Šå¤šè¡Œ
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è·å–æ‰€æœ‰è¡ŒçŸ©å½¢    â”‚
â”‚ getClientRects()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸ºæ¯è¡Œåˆ›å»ºspan    â”‚
â”‚ æˆ–SVGè·¯å¾„         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨ç»Ÿä¸€æ ·å¼      â”‚
â”‚ å…±äº«underline ID  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5. ç”¨æˆ·äº¤äº’

### 5.1 åˆ›å»ºæµç¨‹

```
é€‰ä¸­æ–‡æœ¬ â†’ æ˜¾ç¤ºèœå• â†’ ç‚¹å‡»[ä¸‹åˆ’çº¿]
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä¸‹åˆ’çº¿æ ·å¼é€‰æ‹©é¢æ¿                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                   â”‚
â”‚  çº¿å‹:  [â”€â”€â”€] [- -] [Â·Â·Â·] [âˆ¿âˆ¿] [â•â•â•]            â”‚
â”‚                                                   â”‚
â”‚  é¢œè‰²:  [ğŸ”´] [ğŸ”µ] [ğŸŸ¢] [ğŸŸ ] [ğŸŸ£] [âš«]            â”‚
â”‚                                                   â”‚
â”‚  ç²—ç»†:  â—‹ ç»†  â— æ ‡å‡†  â—‹ ç²—                       â”‚
â”‚                                                   â”‚
â”‚         [å–æ¶ˆ]              [ç¡®å®š]                â”‚
â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ç¼–è¾‘å·²æœ‰ä¸‹åˆ’çº¿

```
ç‚¹å‡»å·²æœ‰ä¸‹åˆ’çº¿
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [æ ·å¼] [é¢œè‰²] [ç²—ç»†]  |  [ğŸ“] [ğŸ—‘ï¸] â”‚
â”‚   ä¿®æ”¹é€‰é¡¹             ç¬”è®°  åˆ é™¤    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 å¿«é€Ÿæ“ä½œ

| æ“ä½œ | æ‰‹åŠ¿ | è¯´æ˜ |
|------|------|------|
| å¿«é€Ÿåˆ›å»º | é€‰ä¸­ååŒå‡»[ä¸‹åˆ’çº¿] | ä½¿ç”¨é»˜è®¤æ ·å¼åˆ›å»º |
| åˆ é™¤ | å·¦æ»‘ä¸‹åˆ’çº¿åŒºåŸŸ | æ˜¾ç¤ºåˆ é™¤æŒ‰é’® |
| åˆ‡æ¢æ ·å¼ | é•¿æŒ‰å·²æœ‰ä¸‹åˆ’çº¿ | ç›´æ¥æ˜¾ç¤ºæ ·å¼é¢æ¿ |

## 6. å­˜å‚¨ä¸åŒæ­¥

### 6.1 Core Dataå®ä½“

```
Core Data Entity: UnderlineEntity
â”œâ”€â”€ Attributes
â”‚   â”œâ”€â”€ id: UUID
â”‚   â”œâ”€â”€ bookId: String
â”‚   â”œâ”€â”€ chapterId: String
â”‚   â”œâ”€â”€ startCFI: String
â”‚   â”œâ”€â”€ endCFI: String
â”‚   â”œâ”€â”€ selectedText: String
â”‚   â”œâ”€â”€ styleName: String
â”‚   â”œâ”€â”€ colorName: String
â”‚   â”œâ”€â”€ thickness: Double
â”‚   â”œâ”€â”€ createdAt: Date
â”‚   â”œâ”€â”€ updatedAt: Date
â”‚   â”œâ”€â”€ syncStatus: Int16
â”‚   â””â”€â”€ isDeleted: Bool
â”‚
â””â”€â”€ Relationships
    â””â”€â”€ book: BookEntity (optional)
```

### 6.2 ä¸é«˜äº®çš„ç»Ÿä¸€å­˜å‚¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ ‡æ³¨ç»Ÿä¸€å­˜å‚¨æ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  AnnotationEntity (çˆ¶ç±»/åè®®)                           â”‚
â”‚       â”‚                                                 â”‚
â”‚       â”œâ”€â”€ HighlightEntity                              â”‚
â”‚       â”‚   â””â”€â”€ ç‰¹æœ‰å±æ€§: color, opacity                 â”‚
â”‚       â”‚                                                 â”‚
â”‚       â”œâ”€â”€ UnderlineEntity                              â”‚
â”‚       â”‚   â””â”€â”€ ç‰¹æœ‰å±æ€§: style, thickness               â”‚
â”‚       â”‚                                                 â”‚
â”‚       â”œâ”€â”€ ThoughtBubbleEntity                          â”‚
â”‚       â”‚   â””â”€â”€ ç‰¹æœ‰å±æ€§: noteText                       â”‚
â”‚       â”‚                                                 â”‚
â”‚       â””â”€â”€ BookmarkEntity                               â”‚
â”‚           â””â”€â”€ ç‰¹æœ‰å±æ€§: title                          â”‚
â”‚                                                         â”‚
â”‚  å…±æœ‰å±æ€§: id, bookId, chapterId, CFIèŒƒå›´, æ—¶é—´æˆ³      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7. é¡µé¢åŠ è½½æ¢å¤

### 7.1 åŠ è½½æµç¨‹

```
ç« èŠ‚åŠ è½½å®Œæˆ
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŸ¥è¯¢ç« èŠ‚ä¸‹åˆ’çº¿    â”‚
â”‚ (æŒ‰åˆ›å»ºæ—¶é—´æ’åº)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ³¨å…¥CSSæ ·å¼ç±»     â”‚
â”‚ (å¦‚æœªæ³¨å…¥)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¹é‡åº”ç”¨ä¸‹åˆ’çº¿    â”‚
â”‚ applyUnderlines() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»‘å®šäº¤äº’äº‹ä»¶      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 JavaScriptæ¥å£

```
applyUnderlines(underlines: [UnderlineData])
â”œâ”€â”€ å‚æ•°
â”‚   â”œâ”€â”€ id: String
â”‚   â”œâ”€â”€ startCFI: String
â”‚   â”œâ”€â”€ endCFI: String
â”‚   â”œâ”€â”€ style: String
â”‚   â”œâ”€â”€ color: String
â”‚   â””â”€â”€ thickness: String
â”‚
â””â”€â”€ æ‰¹é‡åˆ›å»ºä¸‹åˆ’çº¿

removeUnderlines(ids: [String])
â””â”€â”€ æ‰¹é‡ç§»é™¤

updateUnderlineStyle(id: String, style: UnderlineStyleData)
â””â”€â”€ æ›´æ–°æ ·å¼
```

## 8. å›è°ƒä¸äº‹ä»¶

### 8.1 å§”æ‰˜åè®®

```
UnderlineManagerDelegate
â”œâ”€â”€ åˆ›å»ºå›è°ƒ
â”‚   â”œâ”€â”€ didCreateUnderline(underline)     // åˆ›å»ºæˆåŠŸ
â”‚   â””â”€â”€ didFailToCreate(error)            // åˆ›å»ºå¤±è´¥
â”‚
â”œâ”€â”€ ç¼–è¾‘å›è°ƒ
â”‚   â”œâ”€â”€ didUpdateUnderline(underline)     // æ›´æ–°æˆåŠŸ
â”‚   â””â”€â”€ didDeleteUnderline(id)            // åˆ é™¤æˆåŠŸ
â”‚
â”œâ”€â”€ äº¤äº’å›è°ƒ
â”‚   â”œâ”€â”€ didSelectUnderline(underline)     // é€‰ä¸­ä¸‹åˆ’çº¿
â”‚   â””â”€â”€ didShowStylePanel()               // æ˜¾ç¤ºæ ·å¼é¢æ¿
â”‚
â””â”€â”€ åŒæ­¥å›è°ƒ
    â””â”€â”€ didSyncComplete(result)           // åŒæ­¥å®Œæˆ
```

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 ä¼˜åŒ–ç­–ç•¥

| ç­–ç•¥ | å®ç°æ–¹å¼ |
|------|----------|
| CSSä¼˜å…ˆ | ç›´çº¿/è™šçº¿ä½¿ç”¨çº¯CSS |
| SVGå¤ç”¨ | ç›¸åŒæ ·å¼æ³¢æµªçº¿å¤ç”¨SVGå®šä¹‰ |
| æ‰¹é‡æ¸²æŸ“ | é¡µé¢åŠ è½½æ—¶ä¸€æ¬¡æ€§åº”ç”¨ |
| è§†å£ä¼˜åŒ– | ä»…æ¸²æŸ“å¯è§åŒºåŸŸ |

### 9.2 SVGæ€§èƒ½ä¼˜åŒ–

```
SVGä¼˜åŒ–ç­–ç•¥
â”œâ”€â”€ ä½¿ç”¨<defs>å®šä¹‰å¯å¤ç”¨æ³¢æµªpattern
â”œâ”€â”€ è·¯å¾„ç®€åŒ–,å‡å°‘æ§åˆ¶ç‚¹
â”œâ”€â”€ é¿å…é¢‘ç¹DOMæ“ä½œ
â””â”€â”€ æ»šåŠ¨æ—¶æš‚åœéå¯è§åŒºåŸŸæ¸²æŸ“
```

## 10. APIæ¥å£

### 10.1 å¯¹å¤–æä¾›

| æ¥å£ | è¯´æ˜ |
|------|------|
| createUnderline(startCFI:endCFI:style:color:) | åˆ›å»ºä¸‹åˆ’çº¿ |
| updateUnderlineStyle(id:style:color:thickness:) | ä¿®æ”¹æ ·å¼ |
| deleteUnderline(id:) | åˆ é™¤ä¸‹åˆ’çº¿ |
| getUnderlines(bookId:chapterId:) | è·å–ç« èŠ‚ä¸‹åˆ’çº¿ |
| getAllUnderlines(bookId:) | è·å–ä¹¦ç±æ‰€æœ‰ä¸‹åˆ’çº¿ |

### 10.2 å¤–éƒ¨ä¾èµ–

| ä¾èµ–é¡¹ | ç”¨é€” |
|--------|------|
| WebViewBridge | JavaScripté€šä¿¡ |
| CoreDataStack | æœ¬åœ°æŒä¹…åŒ– |
| CloudKitManager | äº‘ç«¯åŒæ­¥ |
| HighlightManager | å…±äº«é€‰åŒºå¤„ç†é€»è¾‘ |

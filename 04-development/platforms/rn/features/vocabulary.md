# 词汇学习功能

## 功能概述

```
┌─────────────────────────────────────────────────────────────────┐
│                  Vocabulary Feature                              │
├─────────────────────────────────────────────────────────────────┤
│  核心功能                                                        │
│  ├── 词汇列表管理                                                │
│  ├── 闪卡复习系统                                                │
│  ├── 间隔重复算法                                                │
│  ├── 掌握度追踪                                                  │
│  └── 词汇统计                                                    │
└─────────────────────────────────────────────────────────────────┘
```

## 词汇列表页面

```
┌─────────────────────────────────────────────────────────────────┐
│                Vocabulary List Screen                            │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  Header                                                  │    │
│  │  Vocabulary      125 words         [ Sort ] [ Filter ]  │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  🔍 Search words...                                      │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  Filter Tabs                                             │    │
│  │  [ All ] [ Learning ] [ Mastered ] [ Difficult ]        │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  Word List                                               │    │
│  │  ┌─────────────────────────────────────────────────┐    │    │
│  │  │  ephemeral                             ●●●○○    │    │    │
│  │  │  /ɪˈfem(ə)rəl/                                  │    │    │
│  │  │  lasting for a very short time          >      │    │    │
│  │  └─────────────────────────────────────────────────┘    │    │
│  │  ┌─────────────────────────────────────────────────┐    │    │
│  │  │  ubiquitous                            ●●●●●    │    │    │
│  │  │  /juːˈbɪkwɪtəs/                                 │    │    │
│  │  │  present everywhere                     >      │    │    │
│  │  └─────────────────────────────────────────────────┘    │    │
│  │  ...                                                     │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │          [ 🎴 Start Review (15 words) ]                 │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 闪卡复习页面

```
┌─────────────────────────────────────────────────────────────────┐
│               Flashcard Review Screen                            │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  Progress: 5 / 15                    [ X Close ]        │    │
│  │  ═══════════●═══════════════════════════════════        │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │                 ┌───────────────────┐                   │    │
│  │                 │                   │                   │    │
│  │                 │                   │                   │    │
│  │                 │   ephemeral       │  Front            │    │
│  │                 │                   │                   │    │
│  │                 │  /ɪˈfem(ə)rəl/    │                   │    │
│  │                 │                   │                   │    │
│  │                 │                   │                   │    │
│  │                 └───────────────────┘                   │    │
│  │                                                          │    │
│  │                    [ 👆 Tap to flip ]                   │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  After Flip (Rating)                                    │    │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐       │    │
│  │  │  Again  │ │  Hard   │ │  Good   │ │  Easy   │       │    │
│  │  │   1m    │ │  10m    │ │   1d    │ │   4d    │       │    │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘       │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 组件结构

```
┌─────────────────────────────────────────────────────────────────┐
│                   Component Structure                            │
├─────────────────────────────────────────────────────────────────┤
│  features/vocabulary/                                            │
│  ├── components/                                                │
│  │   ├── VocabularyList.tsx     # 词汇列表页                    │
│  │   ├── WordCard.tsx           # 词汇卡片                      │
│  │   ├── WordDetail.tsx         # 词汇详情                      │
│  │   ├── FlashcardReview.tsx    # 闪卡复习页                    │
│  │   ├── FlashCard.tsx          # 单个闪卡                      │
│  │   ├── RatingButtons.tsx      # 评分按钮                      │
│  │   ├── ReviewComplete.tsx     # 复习完成页                    │
│  │   ├── MasteryIndicator.tsx   # 掌握度指示器                   │
│  │   └── index.ts                                               │
│  ├── hooks/                                                     │
│  │   ├── useVocabulary.ts       # 词汇 Hook                     │
│  │   └── useFlashcard.ts        # 闪卡 Hook                     │
│  └── types/                                                     │
│      └── index.ts                                               │
└─────────────────────────────────────────────────────────────────┘
```

## 数据结构

```
┌─────────────────────────────────────────────────────────────────┐
│                    Data Structures                               │
├─────────────────────────────────────────────────────────────────┤
│  Word                                                            │
│  {                                                              │
│    id: string,                                                  │
│    word: string,                                                │
│    pronunciation: string,                                       │
│    definition: string,                                          │
│    examples: string[],                                          │
│    context: string,          // 来源上下文                       │
│    bookId: string,           // 来源书籍                        │
│    mastery: number,          // 0-5 掌握度                      │
│    nextReview: Date,         // 下次复习时间                    │
│    reviewCount: number,      // 复习次数                        │
│    createdAt: Date,                                             │
│    lastReviewedAt: Date                                         │
│  }                                                              │
├─────────────────────────────────────────────────────────────────┤
│  ReviewResult                                                    │
│  {                                                              │
│    wordId: string,                                              │
│    rating: 'again' | 'hard' | 'good' | 'easy',                  │
│    reviewedAt: Date                                             │
│  }                                                              │
├─────────────────────────────────────────────────────────────────┤
│  VocabularyStats                                                 │
│  {                                                              │
│    total: number,                                               │
│    learning: number,                                            │
│    mastered: number,                                            │
│    dueForReview: number                                         │
│  }                                                              │
└─────────────────────────────────────────────────────────────────┘
```

## 间隔重复算法 (SM-2)

```
┌─────────────────────────────────────────────────────────────────┐
│                   Spaced Repetition (SM-2)                       │
├─────────────────────────────────────────────────────────────────┤
│  评分等级                                                        │
│  ├── Again (0): 完全不记得 → 1分钟后重复                        │
│  ├── Hard (3): 想起来困难 → 10分钟后                            │
│  ├── Good (4): 正常想起 → 间隔×EF                               │
│  └── Easy (5): 轻松想起 → 间隔×EF×1.3                           │
├─────────────────────────────────────────────────────────────────┤
│  Easy Factor (EF)                                                │
│  ├── 初始值: 2.5                                                │
│  ├── 范围: 1.3 - 2.5                                            │
│  └── 更新: EF' = EF + (0.1 - (5-q) × (0.08 + (5-q) × 0.02))    │
├─────────────────────────────────────────────────────────────────┤
│  间隔计算                                                        │
│  ├── n=1: 1 天                                                  │
│  ├── n=2: 6 天                                                  │
│  └── n>2: interval × EF                                         │
├─────────────────────────────────────────────────────────────────┤
│  掌握度映射                                                      │
│  ├── 0: 新词                                                    │
│  ├── 1-2: 学习中                                                │
│  ├── 3-4: 熟悉                                                  │
│  └── 5: 已掌握                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 闪卡交互

```
┌─────────────────────────────────────────────────────────────────┐
│                   Flashcard Interaction                          │
├─────────────────────────────────────────────────────────────────┤
│  正面显示                                                        │
│  ├── 单词                                                        │
│  └── 音标                                                        │
├─────────────────────────────────────────────────────────────────┤
│  翻转动画                                                        │
│  ├── 3D 翻转效果 (Reanimated)                                   │
│  └── 点击或滑动触发                                              │
├─────────────────────────────────────────────────────────────────┤
│  背面显示                                                        │
│  ├── 释义                                                        │
│  ├── 例句                                                        │
│  └── 来源上下文                                                  │
├─────────────────────────────────────────────────────────────────┤
│  评分后                                                          │
│  ├── 自动切换下一张                                              │
│  ├── 更新掌握度                                                  │
│  └── 计算下次复习时间                                            │
└─────────────────────────────────────────────────────────────────┘
```

## 词汇筛选

```
┌─────────────────────────────────────────────────────────────────┐
│                   Word Filtering                                 │
├─────────────────────────────────────────────────────────────────┤
│  状态筛选                                                        │
│  ├── All: 所有词汇                                              │
│  ├── Learning: mastery < 3                                      │
│  ├── Mastered: mastery >= 4                                     │
│  └── Difficult: 多次标记 Hard/Again                             │
├─────────────────────────────────────────────────────────────────┤
│  排序选项                                                        │
│  ├── Recently Added (默认)                                      │
│  ├── Alphabetical (A-Z)                                         │
│  ├── Mastery Level                                              │
│  └── Next Review Date                                           │
├─────────────────────────────────────────────────────────────────┤
│  搜索                                                            │
│  ├── 词汇名称                                                    │
│  └── 释义内容                                                    │
└─────────────────────────────────────────────────────────────────┘
```

## 词汇添加来源

```
┌─────────────────────────────────────────────────────────────────┐
│                   Word Sources                                   │
├─────────────────────────────────────────────────────────────────┤
│  阅读器选择                                                      │
│  1. 长按选择单词                                                 │
│  2. 点击"保存"                                                   │
│  3. 自动获取 AI 解释                                            │
│  4. 添加到词汇本                                                 │
├─────────────────────────────────────────────────────────────────┤
│  AI 解释面板                                                     │
│  1. 查看 AI 解释                                                │
│  2. 点击"保存单词"                                               │
│  3. 添加到词汇本                                                 │
├─────────────────────────────────────────────────────────────────┤
│  保存数据                                                        │
│  ├── word: 选中文本                                             │
│  ├── definition: AI 解释                                        │
│  ├── context: 原文上下文                                        │
│  └── bookId: 当前书籍                                           │
└─────────────────────────────────────────────────────────────────┘
```

## 复习完成

```
┌─────────────────────────────────────────────────────────────────┐
│                   Review Complete                                │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │                     🎉                                   │    │
│  │                                                          │    │
│  │              Review Complete!                            │    │
│  │                                                          │    │
│  │          You reviewed 15 words today                     │    │
│  │                                                          │    │
│  │    ┌─────────────────────────────────────────────┐      │    │
│  │    │  Remembered: 12                              │      │    │
│  │    │  Need Practice: 3                            │      │    │
│  │    │  Accuracy: 80%                               │      │    │
│  │    └─────────────────────────────────────────────┘      │    │
│  │                                                          │    │
│  │    Next review: Tomorrow (8 words due)                   │    │
│  │                                                          │    │
│  │              [ Continue Reading ]                        │    │
│  │              [ Back to Learning ]                        │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## API 接口

```
┌─────────────────────────────────────────────────────────────────┐
│                   Vocabulary API                                 │
├─────────────────────────────────────────────────────────────────┤
│  POST /vocabulary/words                                         │
│  ├── Request: { word, definition, context?, bookId? }           │
│  └── Response: { word }                                         │
├─────────────────────────────────────────────────────────────────┤
│  GET /vocabulary/words                                          │
│  ├── Query: { status?, sortBy?, page?, limit? }                 │
│  └── Response: { words[], pagination }                          │
├─────────────────────────────────────────────────────────────────┤
│  DELETE /vocabulary/words/:id                                   │
│  └── Response: { success: true }                                │
├─────────────────────────────────────────────────────────────────┤
│  GET /vocabulary/review                                         │
│  ├── Query: { limit? }                                          │
│  └── Response: { words[] }  // 待复习词汇                       │
├─────────────────────────────────────────────────────────────────┤
│  PUT /vocabulary/words/:id/review                               │
│  ├── Request: { rating: 'again'|'hard'|'good'|'easy' }          │
│  └── Response: { word, nextReview }                             │
├─────────────────────────────────────────────────────────────────┤
│  GET /vocabulary/stats                                          │
│  └── Response: { total, learning, mastered, dueForReview }      │
└─────────────────────────────────────────────────────────────────┘
```

## 本地缓存

```
┌─────────────────────────────────────────────────────────────────┐
│                   Local Cache                                    │
├─────────────────────────────────────────────────────────────────┤
│  React Query 缓存                                                │
│  ├── 词汇列表: staleTime 5min                                   │
│  ├── 待复习: staleTime 1min                                     │
│  └── 统计数据: staleTime 1min                                   │
├─────────────────────────────────────────────────────────────────┤
│  乐观更新                                                        │
│  ├── 添加词汇: 立即显示                                         │
│  ├── 删除词汇: 立即移除                                         │
│  └── 更新掌握度: 立即更新                                        │
├─────────────────────────────────────────────────────────────────┤
│  离线支持                                                        │
│  ├── SQLite 本地存储                                            │
│  └── 联网时同步                                                  │
└─────────────────────────────────────────────────────────────────┘
```

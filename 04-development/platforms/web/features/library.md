# Web 书架模块

> 书籍管理、分类整理、阅读记录

---

## 1. 模块概述

```
┌─────────────────────────────────────────────────────────────────┐
│                      书架模块架构                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  features/library/                                              │
│  ├── components/                                                │
│  │   ├── Library.tsx          书架主页                          │
│  │   ├── BookGrid.tsx         网格视图                          │
│  │   ├── BookList.tsx         列表视图                          │
│  │   ├── BookCard.tsx         书籍卡片                          │
│  │   ├── BookDetail.tsx       书籍详情                          │
│  │   ├── ShelfSelector.tsx    书架选择                          │
│  │   └── ImportDialog.tsx     导入对话框                        │
│  ├── hooks/                                                     │
│  │   ├── useLibrary.ts        书架主 Hook                       │
│  │   ├── useBooks.ts          书籍列表                          │
│  │   ├── useShelves.ts        书架管理                          │
│  │   └── useImport.ts         书籍导入                          │
│  ├── stores/                                                    │
│  │   └── libraryStore.ts      书架状态                          │
│  └── actions/                                                   │
│      ├── getBooks.ts          获取书籍                          │
│      └── importBook.ts        导入书籍                          │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. 功能概览

### 2.1 核心功能

| 功能 | 说明 |
|------|------|
| 书籍展示 | 网格/列表视图切换 |
| 分类管理 | 自定义书架分类 |
| 书籍导入 | 本地文件上传 |
| 阅读记录 | 进度、时长统计 |
| 批量操作 | 移动、删除、导出 |

### 2.2 视图模式

```
┌─────────────────────────────────────────────────────────────────┐
│                    视图模式对比                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  网格视图 (默认)                                                 │
│  ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐                       │
│  │       │ │       │ │       │ │       │                       │
│  │  封面 │ │  封面 │ │  封面 │ │  封面 │                       │
│  │       │ │       │ │       │ │       │                       │
│  ├───────┤ ├───────┤ ├───────┤ ├───────┤                       │
│  │ 书名  │ │ 书名  │ │ 书名  │ │ 书名  │                       │
│  │ 进度  │ │ 进度  │ │ 进度  │ │ 进度  │                       │
│  └───────┘ └───────┘ └───────┘ └───────┘                       │
│                                                                  │
│  列表视图                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ [封面] 书名          作者        进度   最近阅读       │    │
│  ├─────────────────────────────────────────────────────────┤    │
│  │ [封面] Pride...     J. Austen   45%    2小时前         │    │
│  │ [封面] 1984         G. Orwell   100%   昨天            │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 书架管理

### 3.1 默认书架

| 书架 | 说明 | 可删除 |
|------|------|--------|
| 全部 | 所有书籍 | 否 |
| 在读 | 进度 > 0 且 < 100% | 否 |
| 已读 | 进度 = 100% | 否 |
| 收藏 | 用户收藏 | 否 |
| 稍后阅读 | 待读列表 | 否 |

### 3.2 自定义书架

```
┌─────────────────────────────────────────────────────────────────┐
│                    书架操作                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  创建书架                                                        │
│  ├── 输入书架名称                                                │
│  ├── 选择图标/颜色                                               │
│  └── 设置排序方式                                                │
│                                                                  │
│  编辑书架                                                        │
│  ├── 修改名称                                                    │
│  ├── 修改图标/颜色                                               │
│  └── 调整排序                                                    │
│                                                                  │
│  删除书架                                                        │
│  ├── 确认对话框                                                  │
│  └── 书籍移回"全部"                                              │
│                                                                  │
│  书架排序                                                        │
│  └── 拖拽调整顺序                                                │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. 书籍操作

### 4.1 单本操作

| 操作 | 入口 |
|------|------|
| 开始阅读 | 点击封面/阅读按钮 |
| 查看详情 | 长按/右键 |
| 移动书架 | 详情菜单 |
| 删除书籍 | 详情菜单 |
| 下载/管理 | 详情菜单 |
| 分享 | 详情菜单 |

### 4.2 批量操作

```
┌─────────────────────────────────────────────────────────────────┐
│                    批量操作模式                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  进入批量模式                                                    │
│  └── 长按任意书籍 / 点击"编辑"                                   │
│                                                                  │
│  选择书籍                                                        │
│  ├── 点击选中/取消                                               │
│  └── 全选/全不选                                                 │
│                                                                  │
│  批量操作                                                        │
│  ├── 移动到书架                                                  │
│  ├── 批量下载                                                    │
│  ├── 批量删除                                                    │
│  └── 导出                                                        │
│                                                                  │
│  退出批量模式                                                    │
│  └── 点击"完成" / 点击空白区域                                   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 5. 书籍导入

### 5.1 导入方式

| 方式 | 说明 |
|------|------|
| 本地上传 | 拖拽/选择文件 |
| URL 导入 | 输入书籍链接 |
| 云端同步 | 从其他设备同步 |

### 5.2 导入流程

```
┌─────────────────────────────────────────────────────────────────┐
│                    书籍导入流程                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  选择文件                                                        │
│       │                                                          │
│       ▼                                                          │
│  格式验证                                                        │
│       │                                                          │
│  ┌────┴────┐                                                    │
│  │         │                                                    │
│  ▼         ▼                                                    │
│ 支持      不支持                                                 │
│  │         │                                                    │
│  │         ▼                                                    │
│  │    显示错误提示                                               │
│  │                                                              │
│  ▼                                                              │
│  上传到云存储                                                    │
│       │                                                          │
│       ▼                                                          │
│  解析元数据                                                      │
│  ├── 书名、作者                                                  │
│  ├── 封面提取                                                    │
│  └── 目录解析                                                    │
│       │                                                          │
│       ▼                                                          │
│  确认/编辑元数据                                                 │
│       │                                                          │
│       ▼                                                          │
│  保存到书架                                                      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 5.3 文件限制

| 限制项 | 值 |
|--------|-----|
| 单文件大小 | 50MB |
| 支持格式 | EPUB, PDF, MOBI, TXT |
| 免费用户上传 | 5 本 |
| 订阅用户上传 | 无限制 |

---

## 6. 排序与筛选

### 6.1 排序选项

| 排序方式 | 说明 |
|----------|------|
| 最近阅读 | 按阅读时间倒序 |
| 添加时间 | 按导入时间倒序 |
| 书名 | 按字母顺序 |
| 作者 | 按作者名排序 |
| 阅读进度 | 按进度排序 |

### 6.2 筛选选项

```
┌─────────────────────────────────────────────────────────────────┐
│                    筛选面板                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  格式筛选                                                        │
│  └── [ ] EPUB  [ ] PDF  [ ] MOBI  [ ] TXT                      │
│                                                                  │
│  状态筛选                                                        │
│  └── [ ] 未读  [ ] 在读  [ ] 已读                               │
│                                                                  │
│  来源筛选                                                        │
│  └── [ ] 书城  [ ] 本地导入  [ ] 公版书                         │
│                                                                  │
│  下载状态                                                        │
│  └── [ ] 已下载  [ ] 未下载                                     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 7. 阅读统计

### 7.1 统计数据

| 指标 | 说明 |
|------|------|
| 总阅读时长 | 所有书籍累计 |
| 本周阅读 | 近 7 天时长 |
| 已读书籍 | 完成数量 |
| 在读书籍 | 进行中数量 |
| 阅读天数 | 连续阅读天数 |

### 7.2 统计展示

```
┌─────────────────────────────────────────────────────────────────┐
│                    阅读统计卡片                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  本周阅读                          已读 / 在读          │    │
│  │  ████████░░  3.5h / 目标5h         12本 / 5本           │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  阅读趋势 (近7天)                                       │    │
│  │                                                          │    │
│  │   ▁▃▅█▃▂▁                                               │    │
│  │   一 二 三 四 五 六 日                                   │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 8. 相关文档

| 文档 | 说明 |
|------|------|
| [reader.md](./reader.md) | 阅读器 |
| [offline.md](./offline.md) | 离线下载 |
| [../state-management.md](../state-management.md) | 状态管理 |

---

*最后更新: 2025-12-31*

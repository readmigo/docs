# 数据分析与追踪

## 概述

```
┌─────────────────────────────────────────────────────────────────┐
│                   Analytics & Tracking                           │
├─────────────────────────────────────────────────────────────────┤
│  核心功能                                                        │
│  ├── 用户行为追踪                                               │
│  ├── 事件记录                                                   │
│  ├── 性能监控                                                   │
│  └── 错误追踪                                                   │
└─────────────────────────────────────────────────────────────────┘
```

## 分析架构

```
┌─────────────────────────────────────────────────────────────────┐
│                   Analytics Architecture                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                      Client Apps                         │    │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐    │    │
│  │  │   iOS   │  │ Android │  │   Web   │  │  Mobile │    │    │
│  │  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘    │    │
│  └───────┼────────────┼────────────┼────────────┼──────────┘    │
│          │            │            │            │                │
│          └────────────┴────────────┴────────────┘                │
│                              │                                   │
│                              ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                   Analytics SDK                          │    │
│  │  ├── Event Batching                                     │    │
│  │  ├── Offline Queue                                      │    │
│  │  └── User Identification                                │    │
│  └─────────────────────────────────────────────────────────┘    │
│                              │                                   │
│          ┌───────────────────┼───────────────────┐              │
│          │                   │                   │              │
│          ▼                   ▼                   ▼              │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │   Backend   │    │   Sentry    │    │  RevenueCat │         │
│  │  Analytics  │    │   (Errors)  │    │ (Revenue)   │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 事件分类

```
┌─────────────────────────────────────────────────────────────────┐
│                     Event Categories                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  用户生命周期事件                                                │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  事件名称                     触发时机                   │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  app_launched                 应用启动                   │    │
│  │  user_signed_up               用户注册                   │    │
│  │  user_logged_in               用户登录                   │    │
│  │  user_logged_out              用户登出                   │    │
│  │  onboarding_started           开始引导                   │    │
│  │  onboarding_completed         完成引导                   │    │
│  │  profile_updated              更新个人资料               │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  阅读相关事件                                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  事件名称                     触发时机                   │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  book_viewed                  查看书籍详情               │    │
│  │  book_added_to_library        添加到书架                 │    │
│  │  book_removed_from_library    从书架移除                 │    │
│  │  reading_session_started      开始阅读会话               │    │
│  │  reading_session_ended        结束阅读会话               │    │
│  │  chapter_completed            完成章节                   │    │
│  │  book_completed               完成全书                   │    │
│  │  bookmark_added               添加书签                   │    │
│  │  highlight_created            创建高亮                   │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  学习相关事件                                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  事件名称                     触发时机                   │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  word_looked_up               查询单词                   │    │
│  │  word_saved                   保存单词                   │    │
│  │  word_reviewed                复习单词                   │    │
│  │  ai_explain_used              使用 AI 解释               │    │
│  │  ai_translate_used            使用 AI 翻译               │    │
│  │  ai_simplify_used             使用 AI 简化               │    │
│  │  review_session_started       开始复习会话               │    │
│  │  review_session_completed     完成复习会话               │    │
│  │  daily_goal_achieved          达成每日目标               │    │
│  │  streak_updated               连续天数更新               │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  订阅相关事件                                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  事件名称                     触发时机                   │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  paywall_viewed               查看付费墙                 │    │
│  │  paywall_dismissed            关闭付费墙                 │    │
│  │  subscription_started         开始订阅                   │    │
│  │  subscription_renewed         续订成功                   │    │
│  │  subscription_cancelled       取消订阅                   │    │
│  │  trial_started                开始试用                   │    │
│  │  trial_converted              试用转正                   │    │
│  │  trial_expired                试用过期                   │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  导航与交互事件                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  事件名称                     触发时机                   │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  screen_viewed                页面查看                   │    │
│  │  tab_switched                 切换标签页                 │    │
│  │  search_performed             执行搜索                   │    │
│  │  filter_applied               应用筛选                   │    │
│  │  settings_changed             更改设置                   │    │
│  │  share_clicked                点击分享                   │    │
│  │  notification_opened          打开通知                   │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 事件属性

```
┌─────────────────────────────────────────────────────────────────┐
│                     Event Properties                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  通用属性 (所有事件)                                             │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  属性名称              类型        说明                  │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  timestamp             DateTime    事件时间              │    │
│  │  user_id               String?     用户 ID (登录后)      │    │
│  │  session_id            String      会话 ID               │    │
│  │  platform              String      ios/android/web/mobile│    │
│  │  app_version           String      应用版本              │    │
│  │  os_version            String      系统版本              │    │
│  │  device_model          String      设备型号              │    │
│  │  language              String      用户语言              │    │
│  │  subscription_tier     String      订阅等级              │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  阅读事件属性                                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  属性名称              类型        说明                  │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  book_id               String      书籍 ID               │    │
│  │  book_title            String      书籍标题              │    │
│  │  book_category         String      书籍分类              │    │
│  │  book_difficulty       Number      难度分数              │    │
│  │  chapter_index         Number      章节索引              │    │
│  │  reading_progress      Number      阅读进度 (%)          │    │
│  │  duration_seconds      Number      时长 (秒)             │    │
│  │  words_read            Number      阅读词数              │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  学习事件属性                                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  属性名称              类型        说明                  │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  word                  String      单词                  │    │
│  │  word_source           String      来源 (book/search)    │    │
│  │  book_id               String?     来源书籍              │    │
│  │  review_quality        Number      复习质量 (1-5)        │    │
│  │  mastery_level         Number      掌握程度              │    │
│  │  words_reviewed        Number      复习词数              │    │
│  │  correct_count         Number      正确数                │    │
│  │  ai_feature            String      AI 功能类型           │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  订阅事件属性                                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  属性名称              类型        说明                  │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  product_id            String      产品 ID               │    │
│  │  price                 Number      价格 (分)             │    │
│  │  currency              String      货币                  │    │
│  │  plan_type             String      套餐类型              │    │
│  │  paywall_trigger       String      付费墙触发原因        │    │
│  │  trial_length_days     Number      试用天数              │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 用户属性

```
┌─────────────────────────────────────────────────────────────────┐
│                     User Properties                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  用户标识                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  属性名称              说明                              │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  user_id               用户唯一 ID                       │    │
│  │  anonymous_id          匿名 ID (登录前)                  │    │
│  │  device_id             设备 ID                           │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  用户画像                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  属性名称              类型        更新时机              │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  signup_date           Date        注册时                │    │
│  │  signup_method         String      注册时                │    │
│  │  english_level         String      设置更新时            │    │
│  │  native_language       String      设置更新时            │    │
│  │  subscription_status   String      订阅变更时            │    │
│  │  total_reading_minutes Number      定期更新              │    │
│  │  total_words_learned   Number      定期更新              │    │
│  │  total_books_completed Number      定期更新              │    │
│  │  current_streak        Number      每日更新              │    │
│  │  longest_streak        Number      记录打破时            │    │
│  │  last_active_date      Date        每次活动时            │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  用户分群                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  分群名称              条件                              │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  New Users             注册 < 7 天                       │    │
│  │  Active Users          最近 7 天有活动                   │    │
│  │  Power Users           周阅读 > 120 分钟                 │    │
│  │  Churned Users         30 天无活动                       │    │
│  │  Premium Users         订阅用户                          │    │
│  │  Free Users            非订阅用户                        │    │
│  │  High Streak Users     连续 > 30 天                      │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 屏幕追踪

```
┌─────────────────────────────────────────────────────────────────┐
│                     Screen Tracking                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  主要页面                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  页面名称              路由                              │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  Home                  /home, /(tabs)                    │    │
│  │  Library               /library, /(tabs)/library         │    │
│  │  Discover              /discover, /(tabs)/discover       │    │
│  │  Vocabulary            /vocabulary, /(tabs)/vocabulary   │    │
│  │  Profile               /profile, /(tabs)/profile         │    │
│  │  BookDetail            /book/:id                         │    │
│  │  Reader                /reader/:bookId                   │    │
│  │  Review                /review                           │    │
│  │  Settings              /settings                         │    │
│  │  Subscription          /subscription                     │    │
│  │  Paywall               /paywall                          │    │
│  │  Login                 /login, /(auth)/login             │    │
│  │  Register              /register, /(auth)/register       │    │
│  │  Onboarding            /onboarding                       │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 错误追踪

```
┌─────────────────────────────────────────────────────────────────┐
│                     Error Tracking                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Sentry 集成                                                     │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  功能                                                    │    │
│  │  ├── 崩溃报告自动上报                                    │    │
│  │  ├── 未处理异常捕获                                      │    │
│  │  ├── API 错误追踪                                        │    │
│  │  ├── 性能监控                                            │    │
│  │  └── 用户反馈关联                                        │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  错误上下文                                                      │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  信息类型              内容                              │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  User                  user_id, email (脱敏)             │    │
│  │  Device                model, os_version                 │    │
│  │  App                   version, build                    │    │
│  │  Breadcrumbs           最近用户操作                      │    │
│  │  Tags                  feature, screen                   │    │
│  │  Extra                 相关数据                          │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  错误分级                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  级别        说明                    通知方式            │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  Fatal       应用崩溃                Slack 即时通知       │    │
│  │  Error       功能异常                定期汇总             │    │
│  │  Warning     潜在问题                周报汇总             │    │
│  │  Info        信息记录                无通知               │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 性能监控

```
┌─────────────────────────────────────────────────────────────────┐
│                   Performance Monitoring                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  监控指标                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  应用性能                                                │    │
│  │  ├── 应用启动时间 (Cold Start / Warm Start)              │    │
│  │  ├── 页面加载时间                                        │    │
│  │  ├── API 响应时间                                        │    │
│  │  └── 帧率 (FPS)                                          │    │
│  │                                                          │    │
│  │  阅读器性能                                              │    │
│  │  ├── 章节加载时间                                        │    │
│  │  ├── 翻页流畅度                                          │    │
│  │  └── 搜索响应时间                                        │    │
│  │                                                          │    │
│  │  网络性能                                                │    │
│  │  ├── API 调用成功率                                      │    │
│  │  ├── 平均响应时间                                        │    │
│  │  └── 超时率                                              │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  性能目标                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  指标                  目标值        告警阈值            │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  Cold Start            < 2s          > 3s               │    │
│  │  Screen Load           < 500ms       > 1s               │    │
│  │  API Response          < 300ms       > 1s               │    │
│  │  API Success Rate      > 99%         < 98%              │    │
│  │  Chapter Load          < 1s          > 2s               │    │
│  │  FPS                   > 55          < 50               │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 漏斗分析

```
┌─────────────────────────────────────────────────────────────────┐
│                    Funnel Analysis                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  新用户注册漏斗                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  ┌─────────────────────────────────────────────────┐    │    │
│  │  │ 1. app_launched                          100%   │    │    │
│  │  └─────────────────────────────────────────────────┘    │    │
│  │              │                                           │    │
│  │              ▼                                           │    │
│  │  ┌────────────────────────────────────────────┐         │    │
│  │  │ 2. onboarding_started                  70%  │         │    │
│  │  └────────────────────────────────────────────┘         │    │
│  │              │                                           │    │
│  │              ▼                                           │    │
│  │  ┌───────────────────────────────────┐                  │    │
│  │  │ 3. onboarding_completed        50% │                  │    │
│  │  └───────────────────────────────────┘                  │    │
│  │              │                                           │    │
│  │              ▼                                           │    │
│  │  ┌─────────────────────────────┐                        │    │
│  │  │ 4. user_signed_up       30%  │                        │    │
│  │  └─────────────────────────────┘                        │    │
│  │              │                                           │    │
│  │              ▼                                           │    │
│  │  ┌───────────────────────┐                              │    │
│  │  │ 5. first_book_read 20% │                              │    │
│  │  └───────────────────────┘                              │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  订阅转化漏斗                                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  ┌─────────────────────────────────────────────────┐    │    │
│  │  │ 1. paywall_viewed                        100%   │    │    │
│  │  └─────────────────────────────────────────────────┘    │    │
│  │              │                                           │    │
│  │              ▼                                           │    │
│  │  ┌────────────────────────────────────────────┐         │    │
│  │  │ 2. trial_started                       25%  │         │    │
│  │  └────────────────────────────────────────────┘         │    │
│  │              │                                           │    │
│  │              ▼                                           │    │
│  │  ┌───────────────────────────────────┐                  │    │
│  │  │ 3. trial_converted             10% │                  │    │
│  │  └───────────────────────────────────┘                  │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 关键指标 (KPIs)

```
┌─────────────────────────────────────────────────────────────────┐
│                    Key Performance Indicators                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  用户指标                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  指标名称              计算方式                          │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  DAU                   日活跃用户数                      │    │
│  │  WAU                   周活跃用户数                      │    │
│  │  MAU                   月活跃用户数                      │    │
│  │  Stickiness            DAU/MAU                          │    │
│  │  D1/D7/D30 Retention   次日/七日/月留存率               │    │
│  │  Churn Rate            流失率                            │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  参与度指标                                                      │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  指标名称              计算方式                          │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  Avg Reading Time      平均每日阅读时长                  │    │
│  │  Words Learned/Day     每日新学单词数                    │    │
│  │  Session Duration      平均会话时长                      │    │
│  │  Sessions/Day          每日会话次数                      │    │
│  │  Books Started         开始阅读的书籍数                  │    │
│  │  Books Completed       完成阅读的书籍数                  │    │
│  │  Streak Users          保持连续的用户比例                │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  商业指标                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  指标名称              计算方式                          │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  Conversion Rate       付费用户/总用户                   │    │
│  │  Trial Conversion      试用转付费率                      │    │
│  │  MRR                   月度经常性收入                    │    │
│  │  ARR                   年度经常性收入                    │    │
│  │  ARPU                  每用户平均收入                    │    │
│  │  LTV                   用户生命周期价值                  │    │
│  │  Churn Revenue         流失收入                          │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 隐私合规

```
┌─────────────────────────────────────────────────────────────────┐
│                    Privacy Compliance                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  数据收集原则                                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  ├── 最小化收集: 只收集必要数据                          │    │
│  │  ├── 匿名化处理: 敏感数据脱敏                            │    │
│  │  ├── 用户同意: 明确告知并获取同意                        │    │
│  │  └── 数据安全: 传输和存储加密                            │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  用户控制                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  ├── 追踪开关: 用户可关闭分析追踪                        │    │
│  │  ├── 数据导出: 支持用户数据导出                          │    │
│  │  ├── 数据删除: 支持用户数据删除请求                      │    │
│  │  └── 隐私政策: 清晰说明数据用途                          │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  合规要求                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  GDPR (欧盟)                                             │    │
│  │  ├── 明确同意机制                                        │    │
│  │  ├── 数据可移植性                                        │    │
│  │  └── 被遗忘权                                            │    │
│  │                                                          │    │
│  │  CCPA (加州)                                             │    │
│  │  ├── 数据销售选择退出                                    │    │
│  │  └── 数据访问请求                                        │    │
│  │                                                          │    │
│  │  ATT (Apple)                                             │    │
│  │  ├── App Tracking Transparency                           │    │
│  │  └── 追踪权限请求                                        │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

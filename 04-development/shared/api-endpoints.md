# API 端点参考

## 概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    API Endpoints Reference                       │
├─────────────────────────────────────────────────────────────────┤
│  基础 URL: https://api.readmigo.app/api/v1                      │
│  调试 URL: https://readmigo-debug.fly.dev/api/v1                │
└─────────────────────────────────────────────────────────────────┘
```

## 认证模块 (Auth)

```
┌─────────────────────────────────────────────────────────────────┐
│                    Auth Endpoints                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /auth/register                                       │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 邮箱注册新用户                                      │ │
│  │  认证: 无需                                                │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── email: string (必填)                                  │ │
│  │  ├── password: string (必填, 最少 8 字符)                  │ │
│  │  └── displayName: string (可选)                            │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── accessToken: string                                   │ │
│  │  ├── refreshToken: string                                  │ │
│  │  └── user: User                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /auth/login                                          │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 邮箱密码登录                                        │ │
│  │  认证: 无需                                                │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── email: string                                         │ │
│  │  └── password: string                                      │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── accessToken: string                                   │ │
│  │  ├── refreshToken: string                                  │ │
│  │  └── user: User                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /auth/social/apple                                   │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: Apple Sign In 登录                                  │ │
│  │  认证: 无需                                                │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── identityToken: string (Apple 返回的 JWT)              │ │
│  │  ├── authorizationCode: string                             │ │
│  │  └── user: { email?, fullName? } (首次登录时)              │ │
│  │                                                            │ │
│  │  响应: 同 /auth/login                                      │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /auth/social/google                                  │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: Google Sign In 登录                                 │ │
│  │  认证: 无需                                                │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  └── idToken: string (Google 返回的 ID Token)              │ │
│  │                                                            │ │
│  │  响应: 同 /auth/login                                      │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /auth/refresh                                        │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 刷新 Access Token                                   │ │
│  │  认证: 无需                                                │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  └── refreshToken: string                                  │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── accessToken: string                                   │ │
│  │  └── refreshToken: string (新的)                           │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /auth/logout                                         │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 登出当前设备                                        │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应: 204 No Content                                      │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /auth/profile                                         │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取当前用户信息                                    │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应: User                                                │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  PATCH /auth/profile                                       │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 更新用户信息                                        │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── displayName: string (可选)                            │ │
│  │  ├── avatarUrl: string (可选)                              │ │
│  │  ├── englishLevel: EnglishLevel (可选)                     │ │
│  │  └── dailyGoalMinutes: number (可选)                       │ │
│  │                                                            │ │
│  │  响应: User                                                │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 书籍模块 (Books)

```
┌─────────────────────────────────────────────────────────────────┐
│                    Books Endpoints                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /books                                                │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取书籍列表                                        │ │
│  │  认证: 可选                                                │ │
│  │                                                            │ │
│  │  查询参数:                                                 │ │
│  │  ├── page: number (默认 1)                                 │ │
│  │  ├── pageSize: number (默认 20, 最大 100)                  │ │
│  │  ├── category: string (分类筛选)                           │ │
│  │  ├── difficulty: string (难度范围, 如 "30-60")             │ │
│  │  ├── language: string (语言代码)                           │ │
│  │  └── sort: string (排序: popular, newest, difficulty)     │ │
│  │                                                            │ │
│  │  响应: PaginatedResponse<Book[]>                           │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /books/:id                                            │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取书籍详情                                        │ │
│  │  认证: 可选                                                │ │
│  │                                                            │ │
│  │  响应: Book (包含完整信息)                                 │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /books/:id/chapters                                   │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取书籍章节列表                                    │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  └── chapters: [{ id, title, index, wordCount }]           │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /books/:id/chapters/:chapterId/content                │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取章节内容                                        │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── content: string (HTML 内容)                           │ │
│  │  ├── wordCount: number                                     │ │
│  │  └── nextChapterId: string?                                │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /books/search                                         │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 搜索书籍                                            │ │
│  │  认证: 可选                                                │ │
│  │                                                            │ │
│  │  查询参数:                                                 │ │
│  │  ├── q: string (搜索关键词)                                │ │
│  │  ├── page: number                                          │ │
│  │  └── pageSize: number                                      │ │
│  │                                                            │ │
│  │  响应: PaginatedResponse<Book[]>                           │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /books/categories                                     │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取书籍分类列表                                    │ │
│  │  认证: 无需                                                │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  └── categories: [{ id, name, bookCount }]                 │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /books/recommendations                                │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取个性化推荐书籍                                  │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应: Book[]                                              │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 用户书架模块 (Library)

```
┌─────────────────────────────────────────────────────────────────┐
│                    Library Endpoints                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /user/library                                         │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取用户书架                                        │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  查询参数:                                                 │ │
│  │  ├── status: string (reading / completed / all)            │ │
│  │  └── sort: string (recent / progress / title)              │ │
│  │                                                            │ │
│  │  响应: UserBook[] (包含阅读进度)                           │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /user/library/:bookId                                │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 添加书籍到书架                                      │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应: UserBook                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  DELETE /user/library/:bookId                              │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 从书架移除书籍                                      │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应: 204 No Content                                      │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /user/library/:bookId/progress                        │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取阅读进度                                        │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应: ReadingProgress                                     │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  PUT /user/library/:bookId/progress                        │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 更新阅读进度                                        │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── currentChapterId: string                              │ │
│  │  ├── currentChapterIndex: number                           │ │
│  │  ├── chapterProgress: number (0-1)                         │ │
│  │  ├── overallProgress: number (0-100)                       │ │
│  │  └── cfiPath: string (EPUB CFI)                            │ │
│  │                                                            │ │
│  │  响应: ReadingProgress                                     │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## AI 模块

```
┌─────────────────────────────────────────────────────────────────┐
│                      AI Endpoints                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /ai/explain                                          │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: AI 词汇解释                                         │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── text: string (要解释的词/短语)                        │ │
│  │  ├── context: string (上下文, 可选)                        │ │
│  │  └── bookId: string (来源书籍, 可选)                       │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── word: string                                          │ │
│  │  ├── pronunciation: string (IPA)                           │ │
│  │  ├── definition: string                                    │ │
│  │  ├── partOfSpeech: string                                  │ │
│  │  ├── examples: string[]                                    │ │
│  │  ├── synonyms: string[]                                    │ │
│  │  └── contextualMeaning: string                             │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /ai/translate                                        │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: AI 翻译                                             │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── text: string (要翻译的文本)                           │ │
│  │  └── targetLanguage: string (目标语言代码)                 │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── translation: string                                   │ │
│  │  └── sourceLanguage: string                                │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /ai/simplify                                         │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: AI 简化文本                                         │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── text: string (要简化的文本)                           │ │
│  │  └── targetLevel: string (beginner/intermediate/advanced)  │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── simplified: string                                    │ │
│  │  └── changes: [{ original, simplified }]                   │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /ai/quota                                             │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取 AI 功能配额                                    │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── explain: { used, limit }                              │ │
│  │  ├── translate: { used, limit }                            │ │
│  │  ├── simplify: { used, limit }                             │ │
│  │  └── resetAt: DateTime                                     │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 词汇模块 (Vocabulary)

```
┌─────────────────────────────────────────────────────────────────┐
│                  Vocabulary Endpoints                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /vocabulary                                           │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取用户词汇列表                                    │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  查询参数:                                                 │ │
│  │  ├── page: number                                          │ │
│  │  ├── pageSize: number                                      │ │
│  │  ├── sort: string (recent / mastery / alphabetical)        │ │
│  │  └── masteryLevel: string (new / learning / mastered)      │ │
│  │                                                            │ │
│  │  响应: PaginatedResponse<Vocabulary[]>                     │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /vocabulary                                          │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 添加新词汇                                          │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── word: string                                          │ │
│  │  ├── definition: string                                    │ │
│  │  ├── pronunciation: string (可选)                          │ │
│  │  ├── examples: string[] (可选)                             │ │
│  │  ├── context: string (可选)                                │ │
│  │  └── bookId: string (可选)                                 │ │
│  │                                                            │ │
│  │  响应: Vocabulary                                          │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  DELETE /vocabulary/:id                                    │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 删除词汇                                            │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应: 204 No Content                                      │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /vocabulary/review                                    │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取待复习词汇                                      │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  查询参数:                                                 │ │
│  │  └── limit: number (默认 20)                               │ │
│  │                                                            │ │
│  │  响应: Vocabulary[] (按 nextReviewAt 排序)                 │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /vocabulary/:id/review                               │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 提交复习结果                                        │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  └── quality: number (1-5, 回答质量)                       │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── vocabulary: Vocabulary (更新后)                       │ │
│  │  └── nextReviewAt: DateTime                                │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 学习统计模块 (Learning)

```
┌─────────────────────────────────────────────────────────────────┐
│                   Learning Endpoints                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /learning/stats/today                                 │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取今日学习统计                                    │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── readingMinutes: number                                │ │
│  │  ├── pagesRead: number                                     │ │
│  │  ├── wordsLearned: number                                  │ │
│  │  ├── wordsReviewed: number                                 │ │
│  │  ├── goalProgress: number (0-100)                          │ │
│  │  └── goalAchieved: boolean                                 │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /learning/stats/weekly                                │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取本周学习统计                                    │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── dailyStats: DailyStats[] (7天)                        │ │
│  │  ├── totalReadingMinutes: number                           │ │
│  │  ├── totalWordsLearned: number                             │ │
│  │  ├── activeDays: number                                    │ │
│  │  └── averageMinutesPerDay: number                          │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /learning/stats/monthly                               │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取本月学习统计                                    │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应: 同周统计，范围为整月                                │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /learning/streak                                      │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取连续学习天数                                    │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── currentStreak: number                                 │ │
│  │  ├── longestStreak: number                                 │ │
│  │  └── lastActiveDate: Date                                  │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /learning/sessions                                   │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 记录阅读会话                                        │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── bookId: string                                        │ │
│  │  ├── startTime: DateTime                                   │ │
│  │  ├── endTime: DateTime                                     │ │
│  │  ├── startChapter: number                                  │ │
│  │  ├── endChapter: number                                    │ │
│  │  └── wordsRead: number                                     │ │
│  │                                                            │ │
│  │  响应: ReadingSession                                      │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /learning/goals                                       │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取学习目标                                        │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── dailyReadingMinutes: number                           │ │
│  │  └── dailyWordsTarget: number                              │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  PUT /learning/goals                                       │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 更新学习目标                                        │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── dailyReadingMinutes: number                           │ │
│  │  └── dailyWordsTarget: number                              │ │
│  │                                                            │ │
│  │  响应: Goals                                               │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 订阅模块 (Subscriptions)

```
┌─────────────────────────────────────────────────────────────────┐
│                 Subscription Endpoints                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /subscriptions/status                                 │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取订阅状态                                        │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应:                                                     │ │
│  │  ├── planType: string (FREE/PREMIUM_MONTHLY/PREMIUM_ANNUAL)│ │
│  │  ├── status: string (ACTIVE/EXPIRED/CANCELLED)             │ │
│  │  ├── expiresAt: DateTime?                                  │ │
│  │  ├── trialEndsAt: DateTime?                                │ │
│  │  └── features: string[]                                    │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /subscriptions/verify-receipt                        │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 验证购买收据                                        │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── receipt: string (Base64 编码收据)                     │ │
│  │  └── platform: string (apple/google)                       │ │
│  │                                                            │ │
│  │  响应: Subscription                                        │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /subscriptions/webhook/apple                         │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: Apple Server Notification 回调                      │ │
│  │  认证: Apple 签名验证                                      │ │
│  │                                                            │ │
│  │  请求体: Apple JWS Payload                                 │ │
│  │                                                            │ │
│  │  响应: 200 OK                                              │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 书签与标注模块 (Annotations)

```
┌─────────────────────────────────────────────────────────────────┐
│                  Annotation Endpoints                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /books/:bookId/bookmarks                              │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取书籍的所有书签                                  │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应: Bookmark[]                                          │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /books/:bookId/bookmarks                             │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 添加书签                                            │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── chapterId: string                                     │ │
│  │  ├── cfiPath: string                                       │ │
│  │  ├── title: string (可选)                                  │ │
│  │  └── note: string (可选)                                   │ │
│  │                                                            │ │
│  │  响应: Bookmark                                            │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  GET /books/:bookId/annotations                            │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 获取书籍的所有标注                                  │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  响应: Annotation[]                                        │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  POST /books/:bookId/annotations                           │ │
│  │  ────────────────────────────────────────────────────────  │ │
│  │  描述: 添加标注/高亮                                       │ │
│  │  认证: Bearer Token                                        │ │
│  │                                                            │ │
│  │  请求体:                                                   │ │
│  │  ├── chapterId: string                                     │ │
│  │  ├── cfiRange: string                                      │ │
│  │  ├── selectedText: string                                  │ │
│  │  ├── color: string                                         │ │
│  │  └── note: string (可选)                                   │ │
│  │                                                            │ │
│  │  响应: Annotation                                          │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

# 国际化指南

## 概述

```
┌─────────────────────────────────────────────────────────────────┐
│                   Internationalization (i18n)                    │
├─────────────────────────────────────────────────────────────────┤
│  支持语言                                                        │
│  ├── English (en)                                               │
│  ├── 简体中文 (zh-Hans)                                         │
│  ├── 繁体中文 (zh-Hant)                                         │
│  ├── 日本語 (ja)                                                │
│  └── 한국어 (ko)                                                │
└─────────────────────────────────────────────────────────────────┘
```

## 国际化架构

```
┌─────────────────────────────────────────────────────────────────┐
│                  i18n Architecture                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                      Client Apps                         │    │
│  │                                                          │    │
│  │  ┌─────────────────────────────────────────────────┐    │    │
│  │  │                 UI Strings                       │    │    │
│  │  │  ├── iOS: Localizable.strings                   │    │    │
│  │  │  ├── Android: strings.xml                       │    │    │
│  │  │  ├── RN: i18n/locales/*.json                    │    │    │
│  │  │  └── Web: messages/*.json                       │    │    │
│  │  └─────────────────────────────────────────────────┘    │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                              │                                   │
│                              │ Accept-Language Header            │
│                              ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                      Backend API                         │    │
│  │                                                          │    │
│  │  ┌─────────────────────────────────────────────────┐    │    │
│  │  │                Server Content                    │    │    │
│  │  │  ├── 书籍标题/描述 (预翻译存储)                 │    │    │
│  │  │  ├── 分类名称 (预翻译存储)                      │    │    │
│  │  │  ├── 错误消息 (后端翻译)                        │    │    │
│  │  │  └── 通知内容 (后端翻译)                        │    │    │
│  │  └─────────────────────────────────────────────────┘    │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 语言检测

```
┌─────────────────────────────────────────────────────────────────┐
│                   Language Detection                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  检测优先级                                                      │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  1. 用户设置 (App 内选择)                                │    │
│  │     │                                                    │    │
│  │     ├── 如果有 → 使用该语言                              │    │
│  │     │                                                    │    │
│  │     ▼                                                    │    │
│  │  2. 系统语言 (设备语言设置)                              │    │
│  │     │                                                    │    │
│  │     ├── 如果支持 → 使用该语言                            │    │
│  │     │                                                    │    │
│  │     ▼                                                    │    │
│  │  3. 默认语言                                             │    │
│  │     │                                                    │    │
│  │     └── 英语 (en)                                        │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  语言代码映射                                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  系统语言代码          映射到                            │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  en, en-US, en-GB      en                                │    │
│  │  zh, zh-CN, zh-Hans    zh-Hans                           │    │
│  │  zh-TW, zh-HK, zh-Hant zh-Hant                           │    │
│  │  ja, ja-JP             ja                                │    │
│  │  ko, ko-KR             ko                                │    │
│  │  其他                  en (回退)                         │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 翻译字符串组织

```
┌─────────────────────────────────────────────────────────────────┐
│                 Translation String Organization                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  命名空间 (Namespace)                                            │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  common                     通用文本                     │    │
│  │  ├── cancel                 取消                         │    │
│  │  ├── confirm                确认                         │    │
│  │  ├── save                   保存                         │    │
│  │  ├── delete                 删除                         │    │
│  │  ├── loading                加载中...                    │    │
│  │  └── retry                  重试                         │    │
│  │                                                          │    │
│  │  auth                       认证相关                     │    │
│  │  ├── login                  登录                         │    │
│  │  ├── register               注册                         │    │
│  │  ├── logout                 登出                         │    │
│  │  ├── email                  邮箱                         │    │
│  │  └── password               密码                         │    │
│  │                                                          │    │
│  │  reader                     阅读器                       │    │
│  │  ├── chapter                章节                         │    │
│  │  ├── progress               进度                         │    │
│  │  ├── bookmark               书签                         │    │
│  │  └── highlight              高亮                         │    │
│  │                                                          │    │
│  │  library                    书架                         │    │
│  │  ├── myBooks                我的书籍                     │    │
│  │  ├── reading                正在阅读                     │    │
│  │  └── completed              已完成                       │    │
│  │                                                          │    │
│  │  vocabulary                 词汇                         │    │
│  │  ├── words                  单词                         │    │
│  │  ├── review                 复习                         │    │
│  │  └── mastery                掌握度                       │    │
│  │                                                          │    │
│  │  learning                   学习                         │    │
│  │  ├── streak                 连续天数                     │    │
│  │  ├── goal                   目标                         │    │
│  │  └── stats                  统计                         │    │
│  │                                                          │    │
│  │  settings                   设置                         │    │
│  │  ├── language               语言                         │    │
│  │  ├── theme                  主题                         │    │
│  │  └── account                账户                         │    │
│  │                                                          │    │
│  │  subscription               订阅                         │    │
│  │  ├── free                   免费版                       │    │
│  │  ├── premium                高级版                       │    │
│  │  └── upgrade                升级                         │    │
│  │                                                          │    │
│  │  errors                     错误消息                     │    │
│  │  ├── network                网络错误                     │    │
│  │  ├── server                 服务器错误                   │    │
│  │  └── auth                   认证错误                     │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 平台实现

```
┌─────────────────────────────────────────────────────────────────┐
│                Platform Implementations                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  iOS (Swift)                                                     │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  框架: Foundation + SwiftUI 原生本地化                   │    │
│  │                                                          │    │
│  │  文件结构:                                               │    │
│  │  ├── en.lproj/Localizable.strings                        │    │
│  │  ├── zh-Hans.lproj/Localizable.strings                   │    │
│  │  ├── zh-Hant.lproj/Localizable.strings                   │    │
│  │  ├── ja.lproj/Localizable.strings                        │    │
│  │  └── ko.lproj/Localizable.strings                        │    │
│  │                                                          │    │
│  │  使用方式:                                               │    │
│  │  └── String(localized: "key")                           │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  Android (Kotlin)                                                │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  框架: Android Resources                                 │    │
│  │                                                          │    │
│  │  文件结构:                                               │    │
│  │  ├── values/strings.xml           (en, 默认)            │    │
│  │  ├── values-zh-rCN/strings.xml    (zh-Hans)             │    │
│  │  ├── values-zh-rTW/strings.xml    (zh-Hant)             │    │
│  │  ├── values-ja/strings.xml        (ja)                  │    │
│  │  └── values-ko/strings.xml        (ko)                  │    │
│  │                                                          │    │
│  │  使用方式:                                               │    │
│  │  ├── getString(R.string.key)                            │    │
│  │  └── Compose: stringResource(R.string.key)              │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  React Native                                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  框架: i18next + react-i18next                           │    │
│  │                                                          │    │
│  │  文件结构:                                               │    │
│  │  src/i18n/                                               │    │
│  │  ├── index.ts           (i18n 配置)                     │    │
│  │  └── locales/                                            │    │
│  │      ├── en.json                                         │    │
│  │      ├── zh-Hans.json                                    │    │
│  │      ├── zh-Hant.json                                    │    │
│  │      ├── ja.json                                         │    │
│  │      └── ko.json                                         │    │
│  │                                                          │    │
│  │  使用方式:                                               │    │
│  │  └── const { t } = useTranslation();                    │    │
│  │      t('namespace:key')                                 │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  Web (Next.js)                                                   │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  框架: next-intl                                         │    │
│  │                                                          │    │
│  │  文件结构:                                               │    │
│  │  messages/                                               │    │
│  │  ├── en.json                                             │    │
│  │  ├── zh-Hans.json                                        │    │
│  │  ├── zh-Hant.json                                        │    │
│  │  ├── ja.json                                             │    │
│  │  └── ko.json                                             │    │
│  │                                                          │    │
│  │  使用方式:                                               │    │
│  │  └── const t = useTranslations('namespace');            │    │
│  │      t('key')                                           │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 动态内容本地化

```
┌─────────────────────────────────────────────────────────────────┐
│                Dynamic Content Localization                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  服务端本地化内容                                                │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  书籍数据                                                │    │
│  │  ├── title: 多语言存储 (title_en, title_zh, etc.)       │    │
│  │  ├── description: 多语言存储                             │    │
│  │  └── API 根据 Accept-Language 返回对应语言               │    │
│  │                                                          │    │
│  │  分类数据                                                │    │
│  │  ├── name: 多语言存储                                    │    │
│  │  └── API 根据 Accept-Language 返回对应语言               │    │
│  │                                                          │    │
│  │  错误消息                                                │    │
│  │  └── 后端根据 Accept-Language 返回本地化消息             │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  请求示例                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  GET /books                                              │    │
│  │  Headers:                                                │    │
│  │    Accept-Language: zh-Hans                              │    │
│  │                                                          │    │
│  │  Response:                                               │    │
│  │  {                                                       │    │
│  │    "title": "小王子",           // 中文标题              │    │
│  │    "description": "..."         // 中文描述              │    │
│  │  }                                                       │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 复数形式

```
┌─────────────────────────────────────────────────────────────────┐
│                      Pluralization                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  复数规则                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  英语 (en)                                               │    │
│  │  ├── one: "1 book"                                       │    │
│  │  └── other: "{{count}} books"                           │    │
│  │                                                          │    │
│  │  中文 (zh)                                               │    │
│  │  └── other: "{{count}} 本书"    (无复数变化)            │    │
│  │                                                          │    │
│  │  日语 (ja)                                               │    │
│  │  └── other: "{{count}} 冊"      (无复数变化)            │    │
│  │                                                          │    │
│  │  韩语 (ko)                                               │    │
│  │  └── other: "{{count}} 권"      (无复数变化)            │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  i18next 复数配置示例                                            │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  // en.json                                              │    │
│  │  {                                                       │    │
│  │    "book": "{{count}} book",                            │    │
│  │    "book_plural": "{{count}} books",                    │    │
│  │    "word": "{{count}} word",                            │    │
│  │    "word_plural": "{{count}} words"                     │    │
│  │  }                                                       │    │
│  │                                                          │    │
│  │  // zh-Hans.json                                         │    │
│  │  {                                                       │    │
│  │    "book": "{{count}} 本书",                            │    │
│  │    "word": "{{count}} 个单词"                           │    │
│  │  }                                                       │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 日期时间格式

```
┌─────────────────────────────────────────────────────────────────┐
│                  Date/Time Formatting                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  日期格式                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  语言        短日期           长日期                     │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  en          12/31/2024       December 31, 2024         │    │
│  │  zh-Hans     2024/12/31       2024年12月31日            │    │
│  │  zh-Hant     2024/12/31       2024年12月31日            │    │
│  │  ja          2024/12/31       2024年12月31日            │    │
│  │  ko          2024. 12. 31.    2024년 12월 31일          │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  时间格式                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  语言        短时间           长时间                     │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  en          2:30 PM          2:30:45 PM                │    │
│  │  zh-Hans     14:30            14:30:45                  │    │
│  │  zh-Hant     下午 2:30        下午 2:30:45              │    │
│  │  ja          14:30            14:30:45                  │    │
│  │  ko          오후 2:30        오후 2:30:45              │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  相对时间                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  语言        刚刚        5分钟前      昨天              │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  en          just now    5 min ago    yesterday         │    │
│  │  zh-Hans     刚刚        5分钟前      昨天              │    │
│  │  zh-Hant     剛剛        5分鐘前      昨天              │    │
│  │  ja          たった今    5分前        昨日              │    │
│  │  ko          방금        5분 전       어제              │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 数字格式

```
┌─────────────────────────────────────────────────────────────────┐
│                    Number Formatting                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  数字格式化                                                      │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  语言        千位分隔        小数点      货币            │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  en          1,234.56        .           $1,234.56      │    │
│  │  zh-Hans     1,234.56        .           ¥1,234.56      │    │
│  │  zh-Hant     1,234.56        .           NT$1,234      │    │
│  │  ja          1,234.56        .           ¥1,234        │    │
│  │  ko          1,234.56        .           ₩1,234        │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  百分比格式                                                      │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  语言        格式                                        │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  en          75%                                         │    │
│  │  zh-Hans     75%                                         │    │
│  │  ja          75％                                        │    │
│  │  ko          75%                                         │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## RTL 支持

```
┌─────────────────────────────────────────────────────────────────┐
│                     RTL Support                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  当前状态                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  目前不支持 RTL (Right-to-Left) 语言                     │    │
│  │  所有支持的语言都是 LTR (Left-to-Right)                  │    │
│  │                                                          │    │
│  │  未来如需支持:                                           │    │
│  │  ├── Arabic (ar)                                         │    │
│  │  └── Hebrew (he)                                         │    │
│  │                                                          │    │
│  │  需要考虑:                                               │    │
│  │  ├── 布局镜像                                            │    │
│  │  ├── 文本对齐                                            │    │
│  │  ├── 图标方向                                            │    │
│  │  └── 滑动手势方向                                        │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 翻译工作流

```
┌─────────────────────────────────────────────────────────────────┐
│                  Translation Workflow                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  工作流程                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  ┌───────────────┐                                      │    │
│  │  │ 1. 开发新功能 │                                      │    │
│  │  │    添加英文 key│                                      │    │
│  │  └───────┬───────┘                                      │    │
│  │          │                                               │    │
│  │          ▼                                               │    │
│  │  ┌───────────────────────────────────────────────┐      │    │
│  │  │ 2. 提取待翻译字符串                            │      │    │
│  │  │    比较各语言文件，找出缺失的 key              │      │    │
│  │  └───────────────────────────────────────────────┘      │    │
│  │          │                                               │    │
│  │          ▼                                               │    │
│  │  ┌───────────────────────────────────────────────┐      │    │
│  │  │ 3. 翻译                                        │      │    │
│  │  │    ├── 内部翻译                               │      │    │
│  │  │    └── 外部翻译服务                           │      │    │
│  │  └───────────────────────────────────────────────┘      │    │
│  │          │                                               │    │
│  │          ▼                                               │    │
│  │  ┌───────────────────────────────────────────────┐      │    │
│  │  │ 4. 审核                                        │      │    │
│  │  │    母语人士检查翻译质量                        │      │    │
│  │  └───────────────────────────────────────────────┘      │    │
│  │          │                                               │    │
│  │          ▼                                               │    │
│  │  ┌───────────────────────────────────────────────┐      │    │
│  │  │ 5. 合并到代码库                                │      │    │
│  │  └───────────────────────────────────────────────┘      │    │
│  │          │                                               │    │
│  │          ▼                                               │    │
│  │  ┌───────────────────────────────────────────────┐      │    │
│  │  │ 6. 测试验证                                    │      │    │
│  │  │    ├── 文本显示正确                           │      │    │
│  │  │    ├── 布局不溢出                             │      │    │
│  │  │    └── 上下文正确                             │      │    │
│  │  └───────────────────────────────────────────────┘      │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 最佳实践

```
┌─────────────────────────────────────────────────────────────────┐
│                     Best Practices                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  字符串编写                                                      │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  ✓ 使用语义化的 key                                      │    │
│  │    "auth.login.button" 而非 "button1"                   │    │
│  │                                                          │    │
│  │  ✓ 避免拼接字符串                                        │    │
│  │    "Welcome {{name}}" 而非 "Welcome " + name            │    │
│  │                                                          │    │
│  │  ✓ 提供上下文注释                                        │    │
│  │    便于翻译者理解使用场景                                │    │
│  │                                                          │    │
│  │  ✓ 预留空间                                              │    │
│  │    德语等语言文本长度可能是英语的 1.3-1.5 倍            │    │
│  │                                                          │    │
│  │  ✗ 不要硬编码文本                                        │    │
│  │    所有用户可见文本都应本地化                            │    │
│  │                                                          │    │
│  │  ✗ 不要在代码中做语法假设                                │    │
│  │    不同语言语法结构不同                                  │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  测试检查项                                                      │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │  ├── 切换语言后 UI 正确显示                              │    │
│  │  ├── 长文本不会截断或溢出                                │    │
│  │  ├── 日期时间格式正确                                    │    │
│  │  ├── 数字格式正确                                        │    │
│  │  ├── 复数形式正确                                        │    │
│  │  └── 动态内容正确本地化                                  │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

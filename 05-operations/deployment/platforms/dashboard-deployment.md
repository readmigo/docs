# Dashboard 部署指南

## 部署架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         部署架构                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                        ┌─────────────────┐                                  │
│                        │     GitHub      │                                  │
│                        │   (main branch) │                                  │
│                        └────────┬────────┘                                  │
│                                 │                                           │
│                                 │ Push                                      │
│                                 ▼                                           │
│                        ┌─────────────────┐                                  │
│                        │     Vercel      │                                  │
│                        │     CI/CD       │                                  │
│                        └────────┬────────┘                                  │
│                                 │                                           │
│                                 │ Build & Deploy                            │
│                                 ▼                                           │
│                        ┌─────────────────┐                                  │
│                        │     Vercel      │                                  │
│                        │      Edge       │                                  │
│                        └────────┬────────┘                                  │
│                                 │                                           │
│                                 │ Static Files                              │
│                                 ▼                                           │
│                    ┌────────────────────────┐                               │
│                    │  dashboard.readmigo.com │                               │
│                    └────────────────────────┘                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Vercel 配置

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         vercel.json                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  {                                                                          │
│    "buildCommand": "npm run build",                                         │
│    "outputDirectory": "dist",                                               │
│    "framework": "vite",                                                     │
│    "rewrites": [                                                            │
│      { "source": "/(.*)", "destination": "/index.html" }                    │
│    ]                                                                        │
│  }                                                                          │
│                                                                             │
│  配置说明:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  buildCommand      构建命令                                                 │
│  outputDirectory   构建输出目录                                             │
│  framework         框架类型 (Vite)                                          │
│  rewrites          SPA 路由重写 (所有路径指向 index.html)                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 部署流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         自动部署流程                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. 代码推送                                                                 │
│     git push origin main                                                    │
│                                                                             │
│  2. Vercel 触发构建                                                         │
│     • 检测到 main 分支更新                                                  │
│     • 拉取最新代码                                                          │
│                                                                             │
│  3. 安装依赖                                                                 │
│     npm install                                                             │
│                                                                             │
│  4. 执行构建                                                                 │
│     npm run build                                                           │
│     • TypeScript 类型检查                                                   │
│     • Vite 生产构建                                                         │
│                                                                             │
│  5. 部署到边缘网络                                                           │
│     • 静态文件分发到全球 CDN                                                │
│     • 更新 DNS 指向                                                         │
│                                                                             │
│  6. 部署完成                                                                 │
│     • 访问 dashboard.readmigo.com 验证                                      │
│     • Vercel 发送部署通知                                                   │
│                                                                             │
│  总耗时: 约 1-2 分钟                                                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 环境变量管理

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Vercel 环境变量                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  设置位置:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  Vercel Dashboard > Project Settings > Environment Variables                │
│                                                                             │
│  生产环境变量:                                                               │
│  ─────────────────────────────────────────────────────────────────          │
│  VITE_API_URL               http://localhost:3000 (仅开发)                  │
│  VITE_DEBUG_API_URL         https://readmigo-debug.fly.dev                  │
│  VITE_STAGING_API_URL       https://staging-api.readmigo.com                │
│  VITE_PRODUCTION_API_URL    https://api.readmigo.com                        │
│                                                                             │
│  注意事项:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • 生产环境 VITE_AUTH_DISABLED 必须为 false 或不设置                        │
│  • 环境变量修改后需要重新部署                                                │
│  • 敏感信息不要提交到代码库                                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 域名配置

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         域名设置                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  主域名:                                                                     │
│  ─────────────────────────────────────────────────────────────────          │
│  dashboard.readmigo.com                                                     │
│                                                                             │
│  DNS 配置:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  类型      名称           值                                                │
│  CNAME     dashboard      cname.vercel-dns.com                              │
│                                                                             │
│  SSL 证书:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • Vercel 自动配置 Let's Encrypt 证书                                       │
│  • 自动续期                                                                  │
│  • 强制 HTTPS                                                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 预览部署

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Preview Deployments                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  触发条件:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • 创建 Pull Request                                                        │
│  • 推送到非 main 分支                                                       │
│                                                                             │
│  预览 URL 格式:                                                              │
│  ─────────────────────────────────────────────────────────────────          │
│  https://readmigo-dashboard-<branch>-<hash>.vercel.app                      │
│                                                                             │
│  用途:                                                                       │
│  ─────────────────────────────────────────────────────────────────          │
│  • PR 代码审查                                                               │
│  • 功能测试                                                                  │
│  • 验收测试                                                                  │
│                                                                             │
│  自动评论:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • Vercel Bot 自动在 PR 中评论预览链接                                      │
│  • 每次推送更新预览                                                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 回滚策略

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         回滚方法                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  方法 1: Vercel Dashboard 回滚                                              │
│  ─────────────────────────────────────────────────────────────────          │
│  1. 访问 Vercel Dashboard                                                   │
│  2. 选择 Deployments                                                        │
│  3. 找到要回滚的版本                                                         │
│  4. 点击 "Promote to Production"                                            │
│                                                                             │
│  方法 2: Git 回滚                                                           │
│  ─────────────────────────────────────────────────────────────────          │
│  git revert HEAD                                                            │
│  git push origin main                                                       │
│  # 触发新的部署                                                              │
│                                                                             │
│  方法 3: 重新部署特定提交                                                    │
│  ─────────────────────────────────────────────────────────────────          │
│  # 在 Vercel Dashboard 中选择特定提交重新部署                               │
│                                                                             │
│  回滚时间: < 1 分钟                                                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 监控与告警

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         部署监控                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Vercel Analytics:                                                          │
│  ─────────────────────────────────────────────────────────────────          │
│  • 页面性能指标 (Core Web Vitals)                                           │
│  • 访问统计                                                                  │
│  • 地理分布                                                                  │
│                                                                             │
│  构建日志:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • Vercel Dashboard > Deployments > Build Logs                              │
│  • 查看构建错误和警告                                                        │
│                                                                             │
│  部署通知:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  • Vercel 集成 Slack/Email 通知                                             │
│  • 部署成功/失败通知                                                         │
│                                                                             │
│  错误监控 (可选):                                                            │
│  ─────────────────────────────────────────────────────────────────          │
│  • 集成 Sentry 错误追踪                                                     │
│  • 前端错误实时告警                                                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 部署检查清单

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         部署前检查                                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  代码检查:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  ☐ npm run lint 无错误                                                      │
│  ☐ npm run build 构建成功                                                   │
│  ☐ TypeScript 类型检查通过                                                  │
│                                                                             │
│  功能检查:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  ☐ 本地 npm run preview 测试通过                                            │
│  ☐ 核心功能正常                                                              │
│  ☐ 多环境切换正常                                                            │
│                                                                             │
│  配置检查:                                                                   │
│  ─────────────────────────────────────────────────────────────────          │
│  ☐ 环境变量配置正确                                                          │
│  ☐ API 地址配置正确                                                          │
│  ☐ 生产环境认证已启用                                                        │
│                                                                             │
│  部署后验证:                                                                 │
│  ─────────────────────────────────────────────────────────────────          │
│  ☐ 访问生产 URL 正常                                                        │
│  ☐ 登录功能正常                                                              │
│  ☐ 环境切换功能正常                                                          │
│  ☐ 核心页面加载正常                                                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

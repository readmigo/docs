# 书籍难度预览 (Book Readiness Preview)

> "试试你是否适合读这本书" — 在开始阅读前，了解这本书的语言特点和挑战

## 功能概述

| 项目 | 说明 |
|------|------|
| 定位 | 阅读前的"小笔记"，而非考试测验 |
| 目标 | 帮助读者了解书籍难度，自行判断是否适合阅读 |
| 数据依赖 | 已处理的双语书籍 (当前7本，持续扩展) |
| 核心价值 | 降低选书盲目性，提升阅读完成率 |

---

## 核心理念

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   不是"考试"，而是"预习笔记"                                      │
│                                                                 │
│   • 告诉你这本书有什么特点                                        │
│   • 提前认识核心词汇                                             │
│   • 预览难点句式                                                 │
│   • 了解文化背景                                                 │
│   • 你来判断自己是否准备好                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 功能模块设计

### 模块一：核心词汇 (Key Vocabulary)

这本书的高频重点词汇，按主题/难度分组展示。

```
┌─────────────────────────────────────────────────────────────────┐
│  🔑 核心词汇 — 读懂这本书需要认识的词                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  高频词汇 TOP 10                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 1. melancholy (n.) 忧郁          出现 47 次   难度: B2   │   │
│  │ 2. wretched (adj.) 可怜的        出现 35 次   难度: B2   │   │
│  │ 3. countenance (n.) 面容         出现 28 次   难度: C1   │   │
│  │ 4. ardent (adj.) 热烈的          出现 24 次   难度: C1   │   │
│  │ 5. disposition (n.) 性情         出现 22 次   难度: B2   │   │
│  │ ...                                                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  主题词汇                                                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 💕 情感类: affection, esteem, regard, sentiment...       │   │
│  │ 🏠 社会类: estate, fortune, connexion, acquaintance...   │   │
│  │ 💬 交际类: discourse, civility, propriety, decorum...    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [展开查看全部 156 个核心词汇]                                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 模块二：难句预览 (Complex Sentences)

展示书中的典型难句，帮助读者提前适应作者的写作风格。

```
┌─────────────────────────────────────────────────────────────────┐
│  📝 难句预览 — 这本书的句子有点长                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  句子特征                                                        │
│  • 平均句长: 28 词/句 (中等偏长)                                  │
│  • 最长句子: 87 词                                               │
│  • 从句嵌套: 平均 2.3 层                                         │
│                                                                 │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  典型难句示例                                                    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ "It is a truth universally acknowledged, that a single  │   │
│  │  man in possession of a good fortune, must be in want   │   │
│  │  of a wife."                                            │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 这是一条举世公认的真理：凡是有钱的单身汉，总想娶位太太。     │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 💡 难点解析:                                             │   │
│  │ • "universally acknowledged" — 被动语态的强调用法        │   │
│  │ • "in possession of" — 正式书面表达，= "who has"         │   │
│  │ • "must be in want of" — 反讽语气，实际是讽刺            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [查看更多难句 (共 15 句)]                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 模块三：语法特点 (Grammar Patterns)

这本书中常见的语法现象，特别是非现代英语的用法。

```
┌─────────────────────────────────────────────────────────────────┐
│  📖 语法特点 — 19世纪英语的独特用法                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ⚠️ 特殊语法现象                                                 │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 1. 倒装句 (Inversion)                                    │   │
│  │    出现频率: 高                                          │   │
│  │    示例: "Little did she know..."                        │   │
│  │    现代说法: "She didn't know at all..."                 │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 2. 虚拟语气 (Subjunctive)                                │   │
│  │    出现频率: 中                                          │   │
│  │    示例: "If he were to come..."                         │   │
│  │    说明: 表示假设或愿望                                   │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 3. 古旧用词 (Archaic Words)                              │   │
│  │    出现频率: 中                                          │   │
│  │    示例: "hitherto" = "until now"                        │   │
│  │          "forthwith" = "immediately"                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 模块四：文化背景 (Cultural Context)

理解这本书需要的文化知识。

```
┌─────────────────────────────────────────────────────────────────┐
│  🌍 文化背景 — 读懂这本书的隐藏知识                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  📍 时代背景: 摄政时期英国 (1811-1820)                           │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 💷 经济概念                                              │   │
│  │                                                          │   │
│  │ "£10,000 a year"                                         │   │
│  │ 在当时相当于今天的 £100万+ 年收入，是巨额财富的象征。       │   │
│  │ 书中频繁提到金钱，因为婚姻与财产继承紧密相关。              │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 👗 社会礼仪                                              │   │
│  │                                                          │   │
│  │ "coming out" / "out in society"                          │   │
│  │ 指年轻女性正式进入社交界，开始寻找婚配对象。               │   │
│  │ 这是当时上流社会的重要仪式。                               │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ 🏛️ 阶级制度                                              │   │
│  │                                                          │   │
│  │ "trade" vs "gentleman"                                   │   │
│  │ 从事贸易被认为地位较低，即使很富有也被贵族阶层轻视。        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [展开完整文化指南]                                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 模块五：能力木桶图 (Skill Bucket Visualization)

用"木桶理论"展示阅读这本书需要的各项能力，帮助读者直观了解挑战在哪里。

> 木桶理论：一个木桶能装多少水，取决于最短的那块木板。

```
┌─────────────────────────────────────────────────────────────────┐
│  🪣 阅读能力木桶 — 你的短板在哪里？                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  这本书对各项能力的要求:                                         │
│                                                                 │
│           词汇    语法    句式    文化    整体                   │
│            │      │      │      │      │                       │
│     ┌──────┴──────┴──────┴──────┴──────┴──────┐                │
│     │  ████  ████  ████  ████               │ ← 水位线          │
│     │  ████  ████  ████  ████               │   (阅读门槛)      │
│     │  ████  ████  ████  ████  ████         │                   │
│     │  ████  ████  ████  ████  ████         │                   │
│     │  ████  ████  ████  ████  ████         │                   │
│     │  ████  ████  ████  ████  ████         │                   │
│     │  ████  ████  ████  ████  ████         │                   │
│     └───┬─────┬─────┬─────┬─────┬───────────┘                   │
│         │     │     │     │     │                               │
│        B2    B1    B2    C1   B2                                │
│                                                                 │
│  📊 各维度说明                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 词汇量  │ B2 │ 需认识约 3,800 个不同词汇                  │   │
│  │ 语法    │ B1 │ 基础语法即可，少量复杂结构                  │   │
│  │ 句式    │ B2 │ 平均句长 28 词，需适应长句                  │   │
│  │ 文化    │ C1 │ 需了解19世纪英国社会背景 ⚠️ 最大挑战        │   │
│  │ 整体    │ B2 │ 适合中高级英语学习者                        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  💡 提示: 文化背景是这本书的最大挑战，建议先阅读上方的            │
│     "文化背景"部分，了解必要的历史知识。                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 木桶图设计说明

```
┌──────────────────────────────────────────────────────────────────┐
│                       木桶理论可视化设计                          │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  核心概念:                                                        │
│  • 每块木板代表一项阅读能力维度                                    │
│  • 木板高度表示这本书对该能力的要求                                │
│  • 最短的木板 = 最大的挑战点                                       │
│  • 水位线 = 流畅阅读的门槛                                         │
│                                                                  │
│  五个维度:                                                        │
│  ┌────────────┬────────────────────────────────────────────┐     │
│  │ 维度       │ 说明                                        │     │
│  ├────────────┼────────────────────────────────────────────┤     │
│  │ 词汇量     │ 需要认识的词汇数量和难度                     │     │
│  │ 语法       │ 语法结构的复杂程度                           │     │
│  │ 句式       │ 句子长度和从句嵌套深度                       │     │
│  │ 文化背景   │ 需要了解的历史/社会/文化知识                 │     │
│  │ 整体难度   │ 综合评估 (CEFR 等级)                         │     │
│  └────────────┴────────────────────────────────────────────┘     │
│                                                                  │
│  CEFR 等级对应:                                                   │
│  • A1-A2: 初级 (木板较矮)                                         │
│  • B1-B2: 中级 (木板中等)                                         │
│  • C1-C2: 高级 (木板较高)                                         │
│                                                                  │
│  交互设计:                                                        │
│  • 点击任意木板 → 展开该维度的详细说明                             │
│  • 最短木板高亮显示 → 提示"这是你最大的挑战"                       │
│  • 提供针对短板的学习建议                                          │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

---

## iOS 入口设计

### 书籍详情页入口

```
┌─────────────────────────────────────────┐
│  📖 Pride and Prejudice                 │
│  Jane Austen                            │
│                                         │
│  ┌─────────────────────────────────┐    │
│  │  🎯 试试你是否适合读这本书        │    │
│  │                                  │    │
│  │  了解这本书的词汇难度、句式特点、  │    │
│  │  文化背景，判断是否适合自己。      │    │
│  │                                  │    │
│  │  [查看详情 →]                     │    │
│  └─────────────────────────────────┘    │
│                                         │
│  [加入书架]  [开始阅读]                  │
└─────────────────────────────────────────┘
```

### 预览页面结构

```
┌─────────────────────────────────────────┐
│  ← 返回                                 │
│                                         │
│  Pride and Prejudice                    │
│  阅读难度预览                            │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  [🪣 能力木桶图]                         │
│  ┌─────────────────────────────────┐    │
│  │     (木桶可视化)                 │    │
│  │     最大挑战: 文化背景 (C1)       │    │
│  └─────────────────────────────────┘    │
│                                         │
│  ─────────────────────────────────────  │
│                                         │
│  [🔑 核心词汇]                           │
│  156 个重点词汇，TOP 10 展示             │
│                                         │
│  [📝 难句预览]                           │
│  15 个典型难句，含翻译和解析              │
│                                         │
│  [📖 语法特点]                           │
│  3 种主要语法现象                        │
│                                         │
│  [🌍 文化背景]                           │
│  摄政时期英国社会背景                     │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  [预习核心词汇]  [开始阅读]              │
│                                         │
└─────────────────────────────────────────┘
```

---

## 数据来源与处理

### 利用现有数据

| 数据源 | 用途 |
|--------|------|
| ParagraphToken | 词汇提取、词频统计 |
| Vocabulary (CEFR) | 难度分级 |
| BilingualParagraph | 难句提取、翻译对照 |

### 需要预处理的数据

| 数据项 | 处理方式 | 存储位置 |
|--------|----------|----------|
| 书籍词汇统计 | 离线处理，按书聚合 | BookReadinessData |
| 难句标注 | AI + 人工审核 | BookReadinessData |
| 语法特点 | AI 分析 + 规则提取 | BookReadinessData |
| 文化背景 | AI 生成 + 人工编辑 | BookReadinessData |
| 能力维度评估 | 规则计算 + AI辅助 | BookReadinessData |

---

## 数据库设计

### 新增表: BookReadinessData

| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| bookId | UUID | 书籍ID (唯一) |
| totalWords | Int | 总词数 |
| uniqueWords | Int | 独特词汇数 |
| avgSentenceLength | Float | 平均句长 |
| maxSentenceLength | Int | 最长句子词数 |
| avgClauseDepth | Float | 平均从句嵌套深度 |
| keyVocabulary | JSON | 核心词汇列表 |
| vocabularyThemes | JSON | 主题词汇分组 |
| complexSentences | JSON | 难句列表 (含翻译和解析) |
| grammarPatterns | JSON | 语法特点 |
| culturalContext | JSON | 文化背景 |
| skillRequirements | JSON | 能力维度要求 (木桶图数据) |
| suggestedLevel | String | 建议等级 (如 B1-B2) |
| createdAt | DateTime | 创建时间 |
| updatedAt | DateTime | 更新时间 |

**索引:** bookId 唯一

### skillRequirements JSON 结构

| 维度 | 字段 | 说明 |
|------|------|------|
| vocabulary | level, description | 词汇量要求 |
| grammar | level, description | 语法要求 |
| sentence | level, description | 句式要求 |
| culture | level, description | 文化背景要求 |
| overall | level, description | 整体难度 |
| shortestBoard | dimension | 最大挑战维度 |
| tip | text | 针对短板的建议 |

---

## API 设计

### GET `/books/:bookId/readiness`

获取书籍的难度预览数据。

**响应内容:**

| 字段 | 类型 | 说明 |
|------|------|------|
| keyVocabulary | Array | 核心词汇 (word, pos, meaning, frequency, level) |
| vocabularyThemes | Array | 主题词汇分组 |
| complexSentences | Array | 难句 (original, translation, analysis) |
| grammarPatterns | Array | 语法特点 (pattern, frequency, example, modernEquivalent) |
| culturalContext | Array | 文化背景 (topic, explanation, examples) |
| skillRequirements | Object | 能力维度要求 (木桶图数据) |
| suggestedLevel | String | 建议等级 |
| statistics | Object | 统计数据 (totalWords, uniqueWords, avgSentenceLength) |

---

## 数据预处理流程

```
┌──────────────────────────────────────────────────────────────────┐
│                    Book Readiness Pipeline                        │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 词汇分析                                                      │
│     ParagraphToken → 词频统计 → CEFR分布 → 主题聚类               │
│                                                                  │
│  2. 句子分析                                                      │
│     BilingualParagraph → 句长统计 → 从句深度 → 难句提取           │
│                                                                  │
│  3. 语法分析 (AI)                                                 │
│     提取文本样本 → Claude分析 → 语法模式识别 → 人工审核            │
│                                                                  │
│  4. 文化分析 (AI)                                                 │
│     书籍元数据 + 文本 → Claude分析 → 文化背景生成 → 人工审核       │
│                                                                  │
│  5. 能力评估                                                      │
│     综合各维度 → 计算 CEFR 等级 → 识别最短木板 → 生成建议          │
│                                                                  │
│  6. 结果存储                                                      │
│     → BookReadinessData 表                                       │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

### 触发时机

- 双语管线完成后自动触发
- 也可手动触发重新生成

---

## 文件清单

### 新建文件

**后端:**

| 文件 | 描述 |
|------|------|
| `modules/readiness/readiness.module.ts` | Readiness 模块定义 |
| `modules/readiness/readiness.controller.ts` | API 端点 |
| `modules/readiness/readiness.service.ts` | 业务逻辑 |
| `modules/readiness/dto/book-readiness.dto.ts` | DTO 定义 |
| `scripts/generate-book-readiness.ts` | 预处理脚本 |

**移动端:**

| 文件 | 描述 |
|------|------|
| `app/book/[id]/readiness.tsx` | 主屏幕路由 |
| `features/readiness/components/BookReadinessScreen.tsx` | 主屏幕组件 |
| `features/readiness/components/SkillBucketChart.tsx` | 能力木桶图 |
| `features/readiness/components/KeyVocabularyList.tsx` | 核心词汇列表 |
| `features/readiness/components/ComplexSentenceCard.tsx` | 难句卡片 |
| `features/readiness/components/GrammarPatternCard.tsx` | 语法卡片 |
| `features/readiness/components/CulturalContextCard.tsx` | 文化背景卡片 |
| `features/readiness/hooks/useBookReadiness.ts` | 数据 Hook |
| `services/api/readiness.ts` | API 客户端 |

**数据库:**

| 文件 | 描述 |
|------|------|
| `prisma/migrations/xxx_add_book_readiness.sql` | 新表迁移 |

### 修改文件

| 文件 | 变更 |
|------|------|
| `packages/database/prisma/schema.prisma` | 添加 BookReadinessData |
| `apps/backend/src/app.module.ts` | 注册 ReadinessModule |
| `apps/mobile/app/book/[id].tsx` | 添加入口卡片 |

---

## 实现计划

### Phase 1: 基础设施
- [ ] 添加数据库表迁移
- [ ] 创建 `ReadinessModule`
- [ ] 实现基础 API 端点

### Phase 2: 数据处理
- [ ] 实现词汇统计脚本
- [ ] 实现句子分析脚本
- [ ] 实现 AI 语法/文化分析
- [ ] 实现能力维度评估算法
- [ ] 为现有7本书生成数据

### Phase 3: iOS 界面
- [ ] 创建主屏幕
- [ ] 实现能力木桶图组件
- [ ] 实现核心词汇列表
- [ ] 实现难句预览模块
- [ ] 实现语法/文化模块
- [ ] 集成到书籍详情页

---

## 设计原则

```
┌──────────────────────────────────────────────────────────────────┐
│                         设计原则                                  │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 信息展示，而非测验                                            │
│     • 只呈现客观数据，不做主观评判                                 │
│     • 用户自行判断是否适合阅读                                     │
│                                                                  │
│  2. 预习笔记的感觉                                                │
│     • 像学习资料，而非考试题                                       │
│     • 帮助读者做好心理和知识准备                                   │
│                                                                  │
│  3. 视觉化呈现                                                    │
│     • 木桶图直观展示能力要求                                       │
│     • 减少文字堆砌，突出重点                                       │
│                                                                  │
│  4. 可操作性                                                      │
│     • 核心词汇可直接加入学习                                       │
│     • 难句解析帮助理解                                             │
│     • 文化背景提供阅读支撑                                         │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

# Readmigo 社交媒体与手机号绑定设计文档

> Version: 1.0.0
> Status: Draft - Pending Review
> Author: System Architect
> Date: 2025-12-23

---

## 1. 概述

### 1.1 设计目标

构建一个灵活、安全的多身份绑定系统，支持：

| 目标 | 说明 |
|------|------|
| **多登录方式** | 支持 Apple、Google、微信、手机号等多种登录 |
| **身份聚合** | 同一用户可绑定多个社交账号和手机号 |
| **无缝切换** | 用户可使用任意已绑定方式登录同一账号 |
| **安全验证** | 绑定过程需要严格的身份验证 |
| **解绑支持** | 支持解除绑定，但需保留至少一种登录方式 |
| **隐私保护** | 符合各平台隐私政策和法规要求 |

### 1.2 支持的身份提供者

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       Supported Identity Providers                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                     First-Party (高优先级)                          │    │
│  │                                                                      │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │    │
│  │  │   Apple     │  │   Google    │  │   Phone     │                 │    │
│  │  │   Sign In   │  │   Sign In   │  │   Number    │                 │    │
│  │  │             │  │             │  │             │                 │    │
│  │  │  iOS 必选   │  │  跨平台     │  │  中国市场   │                 │    │
│  │  │  App Store  │  │  Android    │  │  SMS验证    │                 │    │
│  │  │  政策要求   │  │  用户首选   │  │  实名要求   │                 │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                 │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                     Third-Party (中优先级)                          │    │
│  │                                                                      │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │    │
│  │  │   WeChat    │  │   Weibo     │  │   QQ        │                 │    │
│  │  │             │  │             │  │             │                 │    │
│  │  │  中国市场   │  │  中国市场   │  │  中国市场   │                 │    │
│  │  │  10亿+ 用户 │  │  社交分享   │  │  年轻用户   │                 │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                 │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                     Future (低优先级 - 预留)                        │    │
│  │                                                                      │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │    │
│  │  │   Email     │  │   Facebook  │  │   Twitter/X │                 │    │
│  │  │   Password  │  │             │  │             │                 │    │
│  │  │             │  │  海外市场   │  │  海外市场   │                 │    │
│  │  │  传统方式   │  │             │  │             │                 │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                 │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.3 市场策略

| 市场 | 主要登录方式 | 备选方式 |
|------|-------------|---------|
| **中国大陆** | 手机号 + 微信 | Apple (iOS)、QQ |
| **港澳台** | Apple + Google | 手机号 |
| **国际市场** | Apple + Google | Email |

---

## 2. 数据模型设计

### 2.1 核心实体关系

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Identity Binding ERD                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                          ┌──────────────────┐                               │
│                          │     Account      │                               │
│                          │                  │                               │
│                          │  usr_reg_xxx     │                               │
│                          │                  │                               │
│                          └────────┬─────────┘                               │
│                                   │                                          │
│                                   │ 1:N                                      │
│                                   │                                          │
│                          ┌────────▼─────────┐                               │
│                          │    Identity      │                               │
│                          │                  │                               │
│                          │ provider         │                               │
│                          │ providerId       │                               │
│                          │ isPrimary        │                               │
│                          │ isVerified       │                               │
│                          └────────┬─────────┘                               │
│                                   │                                          │
│              ┌────────────────────┼────────────────────┐                    │
│              │                    │                    │                    │
│              ▼                    ▼                    ▼                    │
│    ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐          │
│    │  AppleIdentity   │ │  PhoneIdentity   │ │  WeChatIdentity  │          │
│    │                  │ │                  │ │                  │          │
│    │  Apple User ID   │ │  +86 138****8888 │ │  OpenID / UnionID│          │
│    │  email (隐藏)    │ │  verified: true  │ │  nickname        │          │
│    └──────────────────┘ └──────────────────┘ └──────────────────┘          │
│                                                                              │
│                          ┌──────────────────┐                               │
│                          │ VerificationLog  │                               │
│                          │                  │                               │
│                          │ SMS发送记录       │                               │
│                          │ 验证尝试记录      │                               │
│                          │ 安全审计         │                               │
│                          └──────────────────┘                               │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 Prisma Schema

---

## 3. 身份绑定流程

### 3.1 手机号绑定流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Phone Number Binding Flow                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   Client                  Backend                 SMS Service   Database     │
│      │                       │                        │            │         │
│      │  1. POST /auth/phone/send-code                │            │         │
│      │   { phone: "+8613812345678" }                 │            │         │
│      │─────────────────────►│                        │            │         │
│      │                      │                        │            │         │
│      │                      │  2. 验证手机号格式      │            │         │
│      │                      │     检查绑定状态        │            │         │
│      │                      │     检查发送频率限制    │            │         │
│      │                      │────────────────────────────────────►│         │
│      │                      │                        │            │         │
│      │                      │  3. 生成6位验证码       │            │         │
│      │                      │     有效期5分钟         │            │         │
│      │                      │────────────────────────────────────►│         │
│      │                      │                        │            │         │
│      │                      │  4. 发送短信            │            │         │
│      │                      │────────────────────────►│            │         │
│      │                      │                        │            │         │
│      │  5. { success, expiresIn: 300 }              │            │         │
│      │◄─────────────────────│                        │            │         │
│      │                      │                        │            │         │
│      │  6. POST /auth/phone/verify                   │            │         │
│      │   { phone, code: "123456" }                   │            │         │
│      │─────────────────────►│                        │            │         │
│      │                      │                        │            │         │
│      │                      │  7. 验证码校验          │            │         │
│      │                      │────────────────────────────────────►│         │
│      │                      │                        │            │         │
│      │                      │  8. 创建/更新 Identity  │            │         │
│      │                      │────────────────────────────────────►│         │
│      │                      │                        │            │         │
│      │                      │  9. 记录绑定历史        │            │         │
│      │                      │────────────────────────────────────►│         │
│      │                      │                        │            │         │
│      │  10. { success, identity }                    │            │         │
│      │◄─────────────────────│                        │            │         │
│      │                      │                        │            │         │
│                                                                              │
│  Rate Limiting:                                                              │
│  • 同一手机号: 60秒内1条, 24小时内10条                                       │
│  • 同一IP: 1小时内20条                                                       │
│  • 同一设备: 1小时内10条                                                     │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 微信绑定流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          WeChat Binding Flow                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   App              WeChat SDK         Backend          WeChat API            │
│    │                   │                 │                  │                │
│    │  1. 点击微信绑定   │                 │                  │                │
│    │──────────────────►│                 │                  │                │
│    │                   │                 │                  │                │
│    │                   │  2. 调起微信授权  │                  │                │
│    │                   │  (scope: snsapi_userinfo)          │                │
│    │                   │─────────────────────────────────────►               │
│    │                   │                 │                  │                │
│    │                   │  3. 用户在微信中授权                 │                │
│    │                   │◄─────────────────────────────────────               │
│    │                   │                 │                  │                │
│    │  4. 回调: code    │                 │                  │                │
│    │◄──────────────────│                 │                  │                │
│    │                   │                 │                  │                │
│    │  5. POST /auth/wechat/bind         │                  │                │
│    │   { code: "xxx" }                  │                  │                │
│    │────────────────────────────────────►                  │                │
│    │                   │                 │                  │                │
│    │                   │                 │  6. 换取 access_token             │
│    │                   │                 │─────────────────►│                │
│    │                   │                 │                  │                │
│    │                   │                 │  7. 获取用户信息  │                │
│    │                   │                 │   (openid, unionid, nickname)    │
│    │                   │                 │◄─────────────────│                │
│    │                   │                 │                  │                │
│    │                   │                 │  8. 检查 unionid 是否已绑定       │
│    │                   │                 │                  │                │
│    │                   │                 │  9. 创建 Identity │                │
│    │                   │                 │                  │                │
│    │  10. { success, identity }         │                  │                │
│    │◄────────────────────────────────────                  │                │
│    │                   │                 │                  │                │
│                                                                              │
│  微信特殊处理:                                                               │
│  • 使用 UnionID 作为 providerId（跨应用统一）                                │
│  • 存储 OpenID 用于消息推送                                                  │
│  • 处理用户取消授权场景                                                      │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Apple/Google 绑定流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       Apple/Google Binding Flow                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   App                 AuthServices          Backend          Provider API    │
│    │                      │                    │                  │          │
│    │  1. 发起绑定请求      │                    │                  │          │
│    │─────────────────────►│                    │                  │          │
│    │                      │                    │                  │          │
│    │                      │  2. 系统授权弹窗    │                  │          │
│    │                      │  (Face ID/指纹)    │                  │          │
│    │                      │                    │                  │          │
│    │  3. 授权成功          │                    │                  │          │
│    │   identityToken      │                    │                  │          │
│    │   authorizationCode  │                    │                  │          │
│    │◄─────────────────────│                    │                  │          │
│    │                      │                    │                  │          │
│    │  4. POST /auth/apple/bind (或 /google/bind)                 │          │
│    │   { identityToken, authorizationCode }    │                  │          │
│    │───────────────────────────────────────────►                  │          │
│    │                      │                    │                  │          │
│    │                      │                    │  5. 验证 Token   │          │
│    │                      │                    │─────────────────►│          │
│    │                      │                    │                  │          │
│    │                      │                    │  6. 获取用户信息  │          │
│    │                      │                    │◄─────────────────│          │
│    │                      │                    │                  │          │
│    │                      │                    │  7. 检查身份是否已存在      │
│    │                      │                    │     - 已存在且属于当前账号: OK  │
│    │                      │                    │     - 已存在且属于其他账号: 提示合并│
│    │                      │                    │     - 不存在: 创建新 Identity  │
│    │                      │                    │                  │          │
│    │  8. { success, identity, needMerge? }     │                  │          │
│    │◄───────────────────────────────────────────                  │          │
│    │                      │                    │                  │          │
│                                                                              │
│  Apple Sign In 特殊处理:                                                     │
│  • 首次授权时获取 email，后续可能隐藏                                        │
│  • 使用 userIdentifier 作为 providerId                                      │
│  • 需要处理 Apple 的 privaterelay 邮箱                                      │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 解除绑定流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Unbinding Flow                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   Client                            Backend                     Database     │
│      │                                 │                            │        │
│      │  1. DELETE /auth/identity/:id    │                            │        │
│      │─────────────────────────────────►│                            │        │
│      │                                 │                            │        │
│      │                                 │  2. 检查业务规则:           │        │
│      │                                 │     a) 是否是最后一个身份?  │        │
│      │                                 │     b) 是否是主要登录方式?  │        │
│      │                                 │     c) 是否需要二次验证?    │        │
│      │                                 │                            │        │
│      │  3. 如果需要验证               │                            │        │
│      │     { requireVerification: true }                            │        │
│      │◄─────────────────────────────────│                            │        │
│      │                                 │                            │        │
│      │  4. 用户完成验证 (另一个身份)    │                            │        │
│      │─────────────────────────────────►│                            │        │
│      │                                 │                            │        │
│      │                                 │  5. 软删除 Identity        │        │
│      │                                 │     设置 unboundAt         │        │
│      │                                 │─────────────────────────────►       │
│      │                                 │                            │        │
│      │                                 │  6. 记录解绑历史           │        │
│      │                                 │─────────────────────────────►       │
│      │                                 │                            │        │
│      │                                 │  7. 如果解绑的是主要身份    │        │
│      │                                 │     自动设置新的主要身份   │        │
│      │                                 │─────────────────────────────►       │
│      │                                 │                            │        │
│      │  8. { success }                 │                            │        │
│      │◄─────────────────────────────────│                            │        │
│      │                                 │                            │        │
│                                                                              │
│  解绑规则:                                                                   │
│  • 必须保留至少一个已验证的登录方式                                          │
│  • 解绑主要身份需要验证另一个身份                                            │
│  • 解绑后30天内可恢复                                                        │
│  • 30天后永久删除                                                            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 服务层实现

### 4.1 身份绑定服务

### 4.2 SMS 服务

---

## 5. iOS 客户端实现

### 5.1 身份管理视图

### 5.2 手机号绑定视图

### 5.3 第三方登录绑定

---

## 6. API 设计

### 6.1 手机号相关 API

### 6.2 Apple/Google 绑定 API

### 6.3 微信绑定 API

### 6.4 身份管理 API

---

## 7. 安全设计

### 7.1 验证码安全

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     Verification Code Security                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  1. 验证码生成                                                               │
│     ─────────────                                                            │
│     • 使用 crypto.randomInt() 生成 6 位数字                                 │
│     • 不使用可预测的算法（如时间戳）                                         │
│     • 验证码有效期 5 分钟                                                   │
│                                                                              │
│  2. 存储安全                                                                 │
│     ─────────────                                                            │
│     • 验证码使用 bcrypt 哈希后存储                                          │
│     • 不以明文形式记录日志                                                  │
│     • 验证成功后立即标记为已使用                                            │
│                                                                              │
│  3. 防暴力破解                                                               │
│     ─────────────                                                            │
│     • 单个验证码最多尝试 5 次                                               │
│     • 超过次数后验证码失效                                                  │
│     • 连续失败后增加冷却时间                                                │
│                                                                              │
│  4. 频率限制                                                                 │
│     ─────────────                                                            │
│     • 同一手机号: 60秒/1次, 24小时/10次                                     │
│     • 同一IP: 1小时/20次                                                    │
│     • 同一设备: 1小时/10次                                                  │
│                                                                              │
│  5. 防短信轰炸                                                               │
│     ─────────────                                                            │
│     • 前端图形验证码（频繁请求时）                                          │
│     • 后端异常行为检测                                                      │
│     • 黑名单机制                                                            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 7.2 OAuth 安全

### 7.3 绑定安全规则

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       Binding Security Rules                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  1. 必须保留登录方式                                                         │
│     ─────────────────────                                                    │
│     • 账号必须至少保留一个已验证的登录方式                                   │
│     • 解绑最后一个身份时拒绝操作                                             │
│                                                                              │
│  2. 解绑主要身份需验证                                                       │
│     ─────────────────────                                                    │
│     • 解绑主要登录方式前，需通过另一种方式验证身份                           │
│     • 支持手机验证码或重新登录验证                                           │
│                                                                              │
│  3. 防止身份盗用                                                             │
│     ─────────────────────                                                    │
│     • 同一第三方身份只能绑定一个账号                                         │
│     • 发现冲突时提示用户选择合并或取消                                       │
│                                                                              │
│  4. 敏感操作日志                                                             │
│     ─────────────────────                                                    │
│     • 所有绑定/解绑操作记录完整日志                                          │
│     • 包含 IP、设备、时间等信息                                              │
│     • 异常操作触发告警                                                       │
│                                                                              │
│  5. 冷却期保护                                                               │
│     ─────────────────────                                                    │
│     • 解绑后 30 天内可恢复                                                  │
│     • 30 天后永久删除绑定信息                                               │
│     • 恢复需要重新验证身份                                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 异常处理

### 8.1 账号冲突处理

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      Account Conflict Handling                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  场景: 用户尝试绑定的社交账号已关联到另一个 Readmigo 账号                   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                                                                      │    │
│  │   当前账号 (A)              已存在账号 (B)                          │    │
│  │   usr_reg_aaa               usr_reg_bbb                             │    │
│  │                                                                      │    │
│  │   ┌─────────────┐           ┌─────────────┐                        │    │
│  │   │ 手机号绑定  │           │ Apple ID    │                        │    │
│  │   │ 138****5678 │           │ xxx@icloud  │                        │    │
│  │   └─────────────┘           └─────────────┘                        │    │
│  │         │                          │                                │    │
│  │         │    用户尝试绑定          │                                │    │
│  │         │    同一个 Apple ID       │                                │    │
│  │         └──────────────────────────┘                                │    │
│  │                     │                                               │    │
│  │                     ▼                                               │    │
│  │   ┌──────────────────────────────────────────────────────────┐     │    │
│  │   │                   用户选择                                │     │    │
│  │   │                                                           │     │    │
│  │   │   1. 合并账号 (A ← B)                                    │     │    │
│  │   │      • 将 B 的数据迁移到 A                               │     │    │
│  │   │      • 解除 B 与 Apple ID 的绑定                         │     │    │
│  │   │      • 将 Apple ID 绑定到 A                              │     │    │
│  │   │      • 标记 B 为已合并                                   │     │    │
│  │   │                                                           │     │    │
│  │   │   2. 切换账号                                             │     │    │
│  │   │      • 登出当前账号 A                                    │     │    │
│  │   │      • 登录账号 B                                        │     │    │
│  │   │      • 保持两个账号独立                                  │     │    │
│  │   │                                                           │     │    │
│  │   │   3. 取消操作                                             │     │    │
│  │   │      • 不进行任何变更                                    │     │    │
│  │   │                                                           │     │    │
│  │   └──────────────────────────────────────────────────────────┘     │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 8.2 错误码定义

---

## 9. 实施计划

### Phase 1: 基础绑定功能 (优先级: 高)

- [ ] 实现 Identity Binding Service
- [ ] 实现手机号验证码发送/验证
- [ ] 实现 Apple Sign In 绑定
- [ ] 实现 Google Sign In 绑定
- [ ] iOS 客户端绑定界面

### Phase 2: 微信与其他平台 (优先级: 中)

- [ ] 实现微信授权绑定
- [ ] 实现 QQ 授权绑定（预留）
- [ ] 实现微博授权绑定（预留）

### Phase 3: 安全与监控 (优先级: 高)

- [ ] 实现完整的频率限制
- [ ] 实现异常行为检测
- [ ] 添加绑定操作监控
- [ ] 完善日志记录

### Phase 4: 高级功能 (优先级: 低)

- [ ] 账号合并流程
- [ ] 解绑恢复功能
- [ ] 多设备同步通知

---

## 10. 开放问题

1. **微信 UnionID**: 是否需要申请微信开放平台的 UnionID 权限？
2. **短信服务商**: 国内使用阿里云还是腾讯云？
3. **邮箱登录**: 是否需要支持传统的邮箱密码登录？
4. **海外手机号**: 是否需要支持国际手机号验证？

---

## 11. 附录

### A. 各平台 SDK 集成文档

| 平台 | 文档链接 |
|------|---------|
| Apple Sign In | https://developer.apple.com/sign-in-with-apple/ |
| Google Sign In | https://developers.google.com/identity |
| 微信开放平台 | https://developers.weixin.qq.com/doc/oplatform/ |
| 阿里云 SMS | https://help.aliyun.com/product/44282.html |
| 腾讯云 SMS | https://cloud.tencent.com/product/sms |

### B. E.164 手机号格式

```
格式: +[国家代码][用户号码]

示例:
+8613812345678    (中国大陆)
+85212345678      (香港)
+886912345678     (台湾)
+14155551234      (美国)
+447123456789     (英国)
```

---

**Document Status**: Ready for Review
**Next Steps**: 请 review 后提出修改意见

---

## 实施进度

| 版本 | 状态 | 完成度 | 更新日期 | 说明 |
|------|------|--------|----------|------|
| v1.0 | 📝 已规划 | 10% | 2025-12-23 | 设计文档完成，代码实现待开发 |

### 已完成 ✅
- [x] 社交绑定系统整体架构设计
- [x] 5种身份类型支持设计（手机/Apple/Google/微信/邮箱）
- [x] Prisma Schema 设计
  - [x] AccountIdentity 模型
  - [x] IdentityType 枚举
- [x] 绑定流程设计（5个步骤）
- [x] 解绑流程设计
- [x] 手机号验证流程设计
- [x] OAuth集成设计（Apple/Google/微信）
- [x] 安全策略设计（频率限制/异常检测）
- [x] 错误处理设计

### 进行中 🚧
- [ ] 无

### 待开发 📝

**Phase 1: 基础绑定功能 (优先级: 高)**
- [ ] 实现 Identity Binding Service (Backend)
  - [ ] bindIdentity（绑定身份）
  - [ ] unbindIdentity（解绑身份）
  - [ ] checkDuplicate（重复检测）
  - [ ] validateBinding（绑定验证）
- [ ] 实现手机号验证
  - [ ] SMS 服务集成（阿里云/腾讯云）
  - [ ] 验证码生成和发送
  - [ ] 验证码验证
  - [ ] 验证码频率限制
- [ ] 实现 Apple Sign In 绑定
  - [ ] Apple OAuth 流程
  - [ ] identityToken 验证
  - [ ] 绑定状态管理
- [ ] 实现 Google Sign In 绑定
  - [ ] Google OAuth 流程
  - [ ] idToken 验证
  - [ ] 绑定状态管理
- [ ] iOS 客户端绑定界面
  - [ ] 账号设置页面
  - [ ] 手机号绑定界面
  - [ ] 社交账号绑定界面
  - [ ] 解绑确认弹窗

**Phase 2: 微信与其他平台 (优先级: 中)**
- [ ] 实现微信授权绑定
  - [ ] 微信 SDK 集成
  - [ ] UnionID 获取
  - [ ] 绑定流程
- [ ] 实现 QQ 授权绑定（预留）
- [ ] 实现微博授权绑定（预留）
- [ ] 邮箱绑定（如需要）
  - [ ] 邮箱验证码发送
  - [ ] 邮箱验证流程

**Phase 3: 安全与监控 (优先级: 高)**
- [ ] 实现频率限制
  - [ ] 验证码发送限制（60秒/次）
  - [ ] 绑定操作限制（5次/小时）
  - [ ] IP限制
- [ ] 实现异常行为检测
  - [ ] 批量绑定检测
  - [ ] 异常IP检测
  - [ ] 可疑行为告警
- [ ] 添加绑定操作监控
  - [ ] 绑定成功率监控
  - [ ] 验证码发送量监控
  - [ ] 错误率监控
- [ ] 完善日志记录
  - [ ] 绑定操作日志
  - [ ] 安全事件日志
  - [ ] 审计日志

**Phase 4: 高级功能 (优先级: 低)**
- [ ] 账号合并流程
  - [ ] 合并确认界面
  - [ ] 数据合并逻辑
  - [ ] 冲突解决策略
- [ ] 解绑恢复功能
  - [ ] 解绑冷静期（24小时）
  - [ ] 恢复请求处理
- [ ] 多设备同步通知
  - [ ] 绑定/解绑推送通知
  - [ ] 安全事件通知

### 依赖项
- ✅ Account 模型已存在
- ✅ Apple Sign In 已集成（登录功能）
- 📝 需要短信服务商（阿里云SMS/腾讯云SMS）
- 📝 需要微信开放平台账号（如需微信绑定）
- 📝 需要 Google Cloud Console 配置
- 📝 需要账号设置页面UI设计

### 技术债务
- 缺少账号合并的详细实现
- 缺少邮箱绑定的完整流程
- 缺少国际手机号支持
- 缺少绑定操作的E2E测试
- 验证码防刷机制需要加强

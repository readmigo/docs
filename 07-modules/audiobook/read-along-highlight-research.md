# 边读边听（音频高亮同步）功能调研报告

> 目标：实现"打开阅读器 → 打开听书功能 → 听书时每一句话都会被高亮"

---

## 1. 功能定义

### 1.1 目标体验

```
┌─────────────────────────────────────────────────────────────┐
│                    阅读器界面                                 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  It is a truth universally acknowledged, that a single      │
│  man in possession of a good fortune, must be in want       │
│  of a wife.                                                 │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ However little known the feelings or views of such  │   │
│  │ a man may be on his first entering a neighbourhood, │ ← │
│  │ this truth is so well fixed in the minds of the     │   │
│  │ surrounding families...                             │   │
│  └─────────────────────────────────────────────────────┘   │
│       ↑ 当前正在朗读的句子高亮显示                           │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐│
│ │ 🎧 Chapter 1 · 02:34 / 45:21   ⏮  ▶️  ⏭    1.0x      ││
│ └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

### 1.2 核心需求

| 需求 | 描述 |
|------|------|
| **实时高亮** | 音频播放时，当前朗读的句子/段落实时高亮 |
| **自动滚动** | 高亮内容始终保持在可视区域 |
| **双向同步** | 点击文本可跳转到对应音频位置 |
| **多粒度** | 支持单词/句子/段落级别高亮 |

---

## 2. 现状分析

### 2.1 当前技术栈

```
┌─────────────────────────────────────────────────────────────┐
│                      现有技术栈                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  音频来源                                                    │
│  ────────                                                   │
│  ✅ TTS (AVSpeechSynthesizer)     - iOS原生语音合成          │
│  🔄 LibriVox 真人有声书            - 20,000+公版有声书        │
│                                                             │
│  阅读器                                                      │
│  ────────                                                   │
│  ✅ EPUB 阅读器 (WKWebView)        - JavaScript桥接          │
│  ✅ 文本高亮基础设施               - CSS/JS注入支持           │
│                                                             │
│  数据模型                                                    │
│  ────────                                                   │
│  ✅ Audiobook/AudiobookChapter    - Prisma模型已设计         │
│  ❌ timestamps 字段                - 时间戳数据未填充         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 功能实现对比

| 功能 | TTS 场景 | 真人有声书场景 |
|------|----------|---------------|
| **高亮实现** | ✅ 已实现 | ❌ 未实现 |
| **技术方案** | 实时回调 | 需预处理时间戳 |
| **精确度** | 单词级 | 需生成对齐数据 |
| **工作量** | 已完成 | 需全栈开发 |

### 2.3 差距总结

```
目标功能: 有声书 + 电子书 边读边听高亮

┌───────────────────────────────────────────────────────────┐
│                    功能差距分析                             │
├───────────────────────────────────────────────────────────┤
│                                                           │
│  ✅ 已具备                                                 │
│  ─────────                                                │
│  • TTS 高亮跟随功能                                        │
│  • EPUB 阅读器文本高亮能力                                  │
│  • LibriVox 数据源访问能力                                  │
│  • 音频播放基础设施                                         │
│  • 数据模型设计                                             │
│                                                           │
│  ❌ 缺失组件                                                │
│  ─────────                                                │
│  • 音频-文本时间戳对齐数据                                   │
│  • 时间戳生成流水线（Whisper + 对齐算法）                     │
│  • 有声书章节与电子书章节精确映射                            │
│  • 前端高亮组件（针对真人有声书）                             │
│  • 进度同步服务（Whispersync）                              │
│                                                           │
└───────────────────────────────────────────────────────────┘
```

---

## 3. 技术方案

### 3.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                 边读边听系统架构                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                      ┌─────────────┐                        │
│                      │   用户界面   │                        │
│                      │  (阅读器)    │                        │
│                      └──────┬──────┘                        │
│                             │                               │
│              ┌──────────────┴──────────────┐                │
│              ▼                             ▼                │
│     ┌────────────────┐           ┌────────────────┐         │
│     │   音频播放器    │ ◄───────► │   高亮引擎      │         │
│     │ AudioPlayer    │   同步    │ HighlightEngine│         │
│     └────────────────┘           └────────────────┘         │
│              │                             │                │
│              ▼                             ▼                │
│     ┌────────────────┐           ┌────────────────┐         │
│     │   时间戳数据    │           │   文本定位      │         │
│     │  Timestamps    │ ◄───────► │ TextLocator    │         │
│     └────────────────┘           └────────────────┘         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 核心数据结构

```
时间戳数据格式（存储于 AudiobookChapter.timestamps）
────────────────────────────────────────────────────────────

{
  "version": "1.0",
  "granularity": "sentence",      // word | sentence | paragraph
  "segments": [
    {
      "id": "s001",
      "start": 0.0,               // 开始时间（秒）
      "end": 4.52,                // 结束时间（秒）
      "text": "It is a truth universally acknowledged,",
      "textOffset": {
        "start": 0,               // 文本起始字符位置
        "end": 42
      },
      "confidence": 0.95          // 对齐置信度
    },
    {
      "id": "s002",
      "start": 4.52,
      "end": 8.31,
      "text": "that a single man in possession of a good fortune,",
      "textOffset": {
        "start": 43,
        "end": 93
      },
      "confidence": 0.92
    }
    // ... 更多片段
  ]
}
```

### 3.3 时间戳生成流水线

```
┌─────────────────────────────────────────────────────────────┐
│               时间戳生成流水线（离线处理）                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Step 1: 语音识别（ASR）                                     │
│  ───────────────────────                                    │
│  输入: LibriVox MP3 音频文件                                 │
│  工具: OpenAI Whisper (large-v3)                            │
│  输出: 带时间戳的转录文本                                    │
│                                                             │
│       ┌────────────────────────────────────────────┐        │
│       │ Audio ──► Whisper ──► Transcript + Timings │        │
│       └────────────────────────────────────────────┘        │
│                                                             │
│  Step 2: 文本对齐（Forced Alignment）                        │
│  ─────────────────────────────────                          │
│  输入: Whisper转录 + 电子书原文                              │
│  工具: DTW算法 / Aeneas / gentle                            │
│  输出: 原文与音频的精确对齐                                   │
│                                                             │
│       ┌──────────────────────────────────────────────┐      │
│       │ Transcript ──┐                               │      │
│       │              ├──► Alignment ──► Timestamps   │      │
│       │ Ebook Text ──┘                               │      │
│       └──────────────────────────────────────────────┘      │
│                                                             │
│  Step 3: 质量校验                                            │
│  ─────────────────────────────────                          │
│  • 置信度低于阈值的片段标记                                  │
│  • 长静音检测                                                │
│  • 文本缺失检测                                              │
│                                                             │
│  Step 4: 存储入库                                            │
│  ─────────────────────────────────                          │
│  • 写入 AudiobookChapter.timestamps                         │
│  • 建立章节映射关系                                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. 技术选型

### 4.1 语音识别（ASR）

| 方案 | 优点 | 缺点 | 推荐度 |
|------|------|------|--------|
| **OpenAI Whisper** | 精度高、支持时间戳、开源免费 | 需要GPU算力 | ⭐⭐⭐⭐⭐ |
| **Azure Speech** | 云服务、易集成 | 成本高、按量计费 | ⭐⭐⭐ |
| **Google Speech-to-Text** | 精度高 | 成本高 | ⭐⭐⭐ |
| **AssemblyAI** | API友好 | 成本中等 | ⭐⭐⭐⭐ |

**推荐：OpenAI Whisper large-v3**
- 离线批量处理，无API成本
- 单词级时间戳输出
- 支持多语言

### 4.2 文本对齐

| 方案 | 优点 | 缺点 | 推荐度 |
|------|------|------|--------|
| **Aeneas** | 专为有声书设计、Python库 | 依赖eSpeak | ⭐⭐⭐⭐⭐ |
| **gentle** | 精确度高 | 设置复杂 | ⭐⭐⭐⭐ |
| **DTW 自实现** | 灵活可控 | 开发成本高 | ⭐⭐⭐ |
| **WhisperX** | Whisper增强版、含对齐 | 新项目、稳定性待验证 | ⭐⭐⭐⭐ |

**推荐：Aeneas + Whisper 组合**

### 4.3 音频播放器

| 平台 | 方案 | 说明 |
|------|------|------|
| **iOS** | AVPlayer | 原生高性能播放器 |
| **Android** | ExoPlayer | Google推荐的媒体播放器 |
| **Web** | Howler.js / HTML5 Audio | 跨浏览器兼容 |
| **React Native** | react-native-track-player | 后台播放支持 |

### 4.4 自建 TTS 系统（AI 语音合成）

#### 应用场景

```text
┌─────────────────────────────────────────────────────────────┐
│                   自建 TTS 应用场景                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  场景 1: 补充缺失内容                                        │
│  ──────────────────────────                                 │
│  • 无 LibriVox 有声书的电子书（~40% 书籍）                   │
│  • LibriVox 录音质量较差的书籍                              │
│  • 新增书籍的快速有声化                                      │
│                                                             │
│  场景 2: 个性化体验                                          │
│  ──────────────────────────                                 │
│  • 用户选择偏好的声音风格                                    │
│  • 不同性别/年龄/口音的声音选项                              │
│  • 语速/音调自定义调节                                       │
│                                                             │
│  场景 3: 多角色对话                                          │
│  ──────────────────────────                                 │
│  • 小说对话场景自动识别角色                                  │
│  • 不同角色使用不同声音                                      │
│  • 旁白/对话区分朗读                                         │
│                                                             │
│  场景 4: 多语言支持                                          │
│  ──────────────────────────                                 │
│  • 双语对照朗读（英文原文 + 中文翻译）                       │
│  • 原文发音示范                                              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### TTS 服务对比

| 服务商 | 音质 | 价格 | 多角色 | 情感控制 | 推荐度 |
|--------|------|------|--------|----------|--------|
| **ElevenLabs** | 顶级 | $0.30/1K字符 | ✅ 支持 | ✅ 强 | 高质量首选 |
| **OpenAI TTS** | 优秀 | $0.015/1K字符 | ✅ 6声音 | ❌ 弱 | 性价比之选 |
| **Azure Neural TTS** | 优秀 | $0.016/1K字符 | ✅ 400+声音 | ✅ SSML | 企业级 |
| **Google Cloud TTS** | 良好 | $0.016/1K字符 | ✅ 多声音 | ✅ SSML | 多语言强 |
| **Fish Audio** | 优秀 | $0.015/1K字符 | ✅ 克隆 | ✅ 支持 | 中文优秀 |
| **Coqui TTS** | 良好 | 开源免费 | ✅ 克隆 | ❌ 弱 | 自部署 |

#### 推荐方案

```text
┌─────────────────────────────────────────────────────────────┐
│                   TTS 分层策略                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Layer 1: 基础 TTS（已实现）                                 │
│  ──────────────────────────────                             │
│  • iOS: AVSpeechSynthesizer（免费、实时）                    │
│  • 用途: 实时朗读、快速预览                                  │
│  • 限制: 音质一般、无情感                                    │
│                                                             │
│  Layer 2: 高质量 TTS（推荐新增）                             │
│  ──────────────────────────────                             │
│  • 服务: OpenAI TTS（性价比）+ ElevenLabs（高质量）          │
│  • 用途: 预生成有声书、重要内容                              │
│  • 特点: 自然语调、情感表达                                  │
│                                                             │
│  Layer 3: 多角色 TTS（进阶功能）                             │
│  ──────────────────────────────                             │
│  • 服务: ElevenLabs Projects / Azure SSML                   │
│  • 用途: 小说对话、戏剧作品                                  │
│  • 特点: 角色识别、声音切换                                  │
│                                                             │
│  Layer 4: 个性化声音（差异化功能）                           │
│  ──────────────────────────────                             │
│  • 服务: ElevenLabs Voice Clone / Fish Audio                │
│  • 用途: 用户自定义声音、名人声音                            │
│  • 特点: 声音克隆、风格定制                                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 多角色对话实现

```text
输入文本（自动角色识别）
────────────────────────────────────────────────────────────

"Good morning, Miss Bennet," said Mr. Darcy with a slight bow.

Elizabeth smiled. "Good morning, Mr. Darcy. I trust you
slept well?"

"Tolerably," he replied, his expression unchanged.

                    ▼ AI 角色识别

输出结构
────────────────────────────────────────────────────────────
[
  { "type": "narration", "text": "said Mr. Darcy with a slight bow.", "voice": "narrator" },
  { "type": "dialogue", "speaker": "Mr. Darcy", "text": "Good morning, Miss Bennet,", "voice": "male_british_formal" },
  { "type": "narration", "text": "Elizabeth smiled.", "voice": "narrator" },
  { "type": "dialogue", "speaker": "Elizabeth", "text": "Good morning, Mr. Darcy. I trust you slept well?", "voice": "female_british_warm" },
  { "type": "dialogue", "speaker": "Mr. Darcy", "text": "Tolerably,", "voice": "male_british_formal" },
  { "type": "narration", "text": "he replied, his expression unchanged.", "voice": "narrator" }
]
```

#### 成本估算

| 场景 | 文本量 | OpenAI TTS | ElevenLabs |
|------|--------|------------|------------|
| 单本书（10万字） | 100K 字符 | ~$1.50 | ~$30 |
| 50本核心书籍 | 5M 字符 | ~$75 | ~$1,500 |
| 300本书籍 | 30M 字符 | ~$450 | ~$9,000 |

> 推荐：批量用 OpenAI TTS（性价比），精品用 ElevenLabs（高质量）

#### 技术架构

```text
┌─────────────────────────────────────────────────────────────┐
│                   TTS 生成流水线                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐              │
│  │ 电子书    │───►│ 文本预处理 │───►│ 角色识别  │              │
│  │ EPUB     │    │ 分段/清洗 │    │ AI标注   │              │
│  └──────────┘    └──────────┘    └──────────┘              │
│                                        │                    │
│                                        ▼                    │
│                              ┌──────────────────┐           │
│                              │   TTS 合成引擎    │           │
│                              │ OpenAI/ElevenLabs│           │
│                              └──────────────────┘           │
│                                        │                    │
│                                        ▼                    │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐              │
│  │ 音频存储  │◄───│ 时间戳生成 │◄───│ 音频拼接  │              │
│  │ R2/CDN   │    │ 自动对齐  │    │ 多段合并  │              │
│  └──────────┘    └──────────┘    └──────────┘              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### TTS vs LibriVox 对比

| 维度 | LibriVox 真人朗读 | 自建 TTS |
|------|-------------------|----------|
| **音质自然度** | ⭐⭐⭐⭐⭐ 最自然 | ⭐⭐⭐⭐ 接近自然 |
| **情感表达** | ⭐⭐⭐⭐ 因人而异 | ⭐⭐⭐ 可控但有限 |
| **覆盖范围** | ⭐⭐⭐ ~60% 书籍 | ⭐⭐⭐⭐⭐ 100% |
| **生成成本** | ⭐⭐⭐⭐⭐ 免费 | ⭐⭐⭐ 按量付费 |
| **一致性** | ⭐⭐ 朗读者差异大 | ⭐⭐⭐⭐⭐ 完全一致 |
| **个性化** | ❌ 不支持 | ✅ 声音可选 |
| **多角色** | ⭐⭐ 部分支持 | ✅ 完全可控 |
| **更新速度** | ⭐⭐ 依赖志愿者 | ⭐⭐⭐⭐⭐ 即时生成 |

> 最佳策略：LibriVox 优先（免费+自然），TTS 补充（覆盖+个性化）

---

## 5. 实现计划

### 5.1 模块分解

```
┌─────────────────────────────────────────────────────────────┐
│                      模块依赖关系                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Layer 1: 数据层（优先实现）                                  │
│  ──────────────────────────                                 │
│  ┌─────────────────┐  ┌─────────────────┐                   │
│  │ 时间戳生成脚本   │  │ 章节映射服务     │                   │
│  │ timestamp-gen   │  │ chapter-mapper  │                   │
│  └─────────────────┘  └─────────────────┘                   │
│           │                    │                            │
│           └────────┬───────────┘                            │
│                    ▼                                        │
│  Layer 2: 服务层                                             │
│  ──────────────────────────                                 │
│  ┌─────────────────┐  ┌─────────────────┐                   │
│  │ 同步进度服务     │  │ 时间戳查询API   │                   │
│  │ sync-service    │  │ timestamp-api   │                   │
│  └─────────────────┘  └─────────────────┘                   │
│           │                    │                            │
│           └────────┬───────────┘                            │
│                    ▼                                        │
│  Layer 3: 客户端层                                           │
│  ──────────────────────────                                 │
│  ┌─────────────────┐  ┌─────────────────┐                   │
│  │ 高亮引擎        │  │ 音频播放器       │                   │
│  │ highlight-eng   │◄─┤ audio-player    │                   │
│  └─────────────────┘  └─────────────────┘                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 分阶段实施

#### Phase 1: 数据基础设施

| 任务 | 说明 | 技术栈 |
|------|------|--------|
| Whisper 转录脚本 | 批量处理 LibriVox 音频 | Python + Whisper |
| Aeneas 对齐脚本 | 生成精确时间戳 | Python + Aeneas |
| 数据存储 | 时间戳写入数据库 | PostgreSQL + Prisma |
| 处理流水线 | 自动化处理队列 | Bull Queue / Worker |

#### Phase 2: 后端 API

| 任务 | 说明 | 技术栈 |
|------|------|--------|
| 时间戳查询 API | 返回章节时间戳数据 | NestJS |
| 进度同步 API | 统一读/听进度 | NestJS |
| 章节映射 API | 音频章节↔电子书章节 | NestJS |

#### Phase 3: 客户端实现

| 任务 | 说明 | 技术栈 |
|------|------|--------|
| iOS 高亮引擎 | WebView JS 注入高亮 | Swift + JavaScript |
| iOS 音频播放器增强 | 真人有声书播放 | AVPlayer |
| Android 高亮引擎 | WebView 高亮 | Kotlin + JavaScript |
| Web 高亮引擎 | React 组件 | React + TypeScript |

---

## 6. 技术挑战与解决方案

### 6.1 挑战一：时间戳精度

```
问题描述
────────────────────────────────────────────────────────────
LibriVox 是志愿者朗读，存在：
• 朗读速度不一致
• 口音/发音差异
• 录音质量参差
• 与原文可能有微小出入（跳过/改动）

解决方案
────────────────────────────────────────────────────────────
1. 使用 Whisper large-v3 获得最佳识别精度
2. 强制对齐（Forced Alignment）修正偏差
3. 置信度评分，低于阈值的片段降级处理
4. 人工校验热门书籍的对齐质量
5. 容错机制：对齐失败时回退到段落级高亮
```

### 6.2 挑战二：章节匹配

```
问题描述
────────────────────────────────────────────────────────────
LibriVox 章节划分可能与电子书不一致：
• 有声书可能合并/拆分章节
• 章节标题可能不同
• 序言/附录处理不同

解决方案
────────────────────────────────────────────────────────────
1. 基于文本内容相似度匹配章节
2. 建立 audiobook_chapter → book_chapter 映射表
3. 支持 1:N 和 N:1 章节映射
4. 未匹配章节提供手动关联工具
```

### 6.3 挑战三：性能优化

```
问题描述
────────────────────────────────────────────────────────────
时间戳数据可能很大：
• 一本书可能有数万个时间戳片段
• 实时查找当前位置需要高效

解决方案
────────────────────────────────────────────────────────────
1. 按章节分片存储，按需加载
2. 时间戳索引使用二分查找
3. 前端缓存当前章节时间戳
4. 预加载下一章节数据
```

### 6.4 挑战四：多平台一致性

```
问题描述
────────────────────────────────────────────────────────────
需要在 iOS/Android/Web 保持一致体验：
• 不同平台的 WebView 实现不同
• 音频播放 API 差异
• 时间同步精度差异

解决方案
────────────────────────────────────────────────────────────
1. 统一的高亮 JavaScript 库
2. 抽象音频播放器接口
3. 定义跨平台协议标准
4. 共享核心业务逻辑（TypeScript）
```

---

## 7. 资源评估

### 7.1 计算资源

| 资源 | 用途 | 规格建议 |
|------|------|----------|
| **GPU 服务器** | Whisper 转录 | NVIDIA A10G / RTX 3090 |
| **Worker 服务** | 批量处理队列 | Fly.io worker 实例 |
| **存储** | 时间戳数据 | PostgreSQL (现有) |

### 7.2 云 GPU 服务推荐

#### 服务商对比

| 服务商 | GPU 类型 | 价格（小时） | 优势 | 推荐度 |
|--------|----------|-------------|------|--------|
| **Replicate** | A40/A100 | ~$0.14/分钟音频 | 直接运行 Whisper API，零配置 | 验证首选 |
| **RunPod** | RTX 3090/A6000 | $0.39-0.74/h | 性价比最高，按需付费 | 批量首选 |
| **Vast.ai** | 多种 | $0.20-0.50/h | 最便宜，社区 GPU | 预算敏感 |
| **Lambda Labs** | A10G/A100 | $0.60-1.10/h | 稳定可靠，ML 专用 | 企业级 |
| **Modal** | A10G/A100 | 按秒计费 | Serverless，自动扩缩容 | 生产首选 |

#### 分阶段推荐方案

```text
┌─────────────────────────────────────────────────────────────┐
│                    GPU 服务选择策略                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Phase 1: 验证阶段（5本书）                                  │
│  ──────────────────────────────                             │
│  推荐：Replicate                                             │
│  原因：零配置，直接调 API，立即可用                          │
│  成本：< $10                                                │
│  用法：pip install replicate && replicate run whisper       │
│                                                             │
│  Phase 2: MVP 阶段（50本书）                                 │
│  ──────────────────────────────                             │
│  推荐：RunPod                                                │
│  原因：性价比最高，500小时音频约 $80                         │
│  用法：启动 GPU Pod → 批量处理 → 关闭                       │
│                                                             │
│  Phase 3: 生产阶段（300+本书）                               │
│  ──────────────────────────────                             │
│  推荐：Modal                                                 │
│  原因：Serverless 自动化，增量处理无闲置成本                 │
│  用法：Python 代码即部署，定时任务触发                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 快速开始示例

**Replicate（最快验证）**

```bash
# 安装
pip install replicate

# 单文件转录
replicate run openai/whisper:large-v3 \
  --audio="https://archive.org/download/pride_prejudice/chapter1.mp3" \
  --model=large-v3 \
  --word_timestamps=true
```

**Modal（生产推荐）**

```python
import modal

app = modal.App("whisper-processor")

@app.function(gpu="A10G", timeout=3600)
def transcribe(audio_url: str):
    import whisper
    model = whisper.load_model("large-v3")
    result = model.transcribe(audio_url, word_timestamps=True)
    return result

# 部署: modal deploy whisper_app.py
# 调用: modal run whisper_app.py::transcribe --audio-url="..."
```

**RunPod（批量处理）**

```bash
# 1. 在 RunPod 创建 GPU Pod (RTX 3090, $0.39/h)
# 2. SSH 连接后运行批量脚本
python batch_transcribe.py --input-dir /audiobooks --output-dir /timestamps
# 3. 处理完成后关闭 Pod
```

#### 成本对比（300本书 / 3000小时音频）

| 方案 | 计算方式 | 预估成本 |
|------|----------|----------|
| **Replicate** | 3000h × 60min × $0.003/min | ~$540 |
| **RunPod** | 600h GPU × $0.39/h | ~$234 |
| **Modal** | 按秒计费，含闲置优化 | ~$400 |
| **Vast.ai** | 600h GPU × $0.25/h | ~$150 |

> 推荐：验证用 Replicate，批量用 RunPod，生产用 Modal

### 7.3 时间戳生成成本估算

```
处理能力估算（使用 Whisper large-v3）
────────────────────────────────────────────────────────────

单本书处理时间：
• 10小时有声书 → ~30分钟 Whisper 转录 (A10G GPU)
• + 10分钟 Aeneas 对齐
• 总计 ~40分钟/本

批量处理（300本核心书籍）：
• 总时长：~3000小时音频
• GPU时间：~150小时
• 成本（云GPU）：~$300-500

增量处理（新增书籍）：
• 每本：~$1-2
```

### 7.4 开发工时估算

| 模块 | 工时 |
|------|------|
| **时间戳生成流水线** | 40h |
| **后端 API** | 24h |
| **iOS 高亮引擎** | 40h |
| **Android 高亮引擎** | 40h |
| **Web 高亮引擎** | 32h |
| **测试与调优** | 40h |
| **总计** | ~220h |

---

## 8. MVP 范围

### 8.1 MVP 功能定义

```
MVP 核心功能（建议首发）
────────────────────────────────────────────────────────────

✅ 包含：
• 句子级高亮（最常用粒度）
• 自动滚动跟随
• 基础播放控制（播放/暂停/进度条）
• 热门 Top 50 书籍支持
• iOS 平台优先

❌ 不包含（后续迭代）：
• 单词级高亮
• 双向跳转（点击文本跳转音频）
• Android/Web 平台
• 跟读评分功能
• 学习模式
```

### 8.2 MVP 书籍选择

| 优先级 | 书籍 | 原因 |
|--------|------|------|
| P0 | Pride and Prejudice | 最热门、多版本可选 |
| P0 | Alice in Wonderland | 热门、较短、适合测试 |
| P0 | Sherlock Holmes 短篇 | 高人气、章节独立 |
| P1 | Jane Eyre | 经典文学 |
| P1 | A Christmas Carol | 节日热门 |

---

## 9. 风险与缓解

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| Whisper 识别精度不足 | 高亮错位 | 选择高质量录音版本；人工校验 |
| 章节无法匹配 | 功能不可用 | 降级到章节级同步；手动关联 |
| 性能问题 | 卡顿 | 分片加载；前端缓存 |
| 跨平台一致性 | 体验差异 | 统一 JS 高亮库 |

---

## 10. 结论与建议

### 10.1 可行性评估

```
┌─────────────────────────────────────────────────────────────┐
│                    可行性评估结果                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  技术可行性: ✅ 高                                           │
│  ─────────────────────                                      │
│  • 核心技术（Whisper、Aeneas）成熟可用                       │
│  • 现有 TTS 高亮实现可复用                                   │
│  • 数据模型已设计完成                                        │
│                                                             │
│  资源可行性: ✅ 中高                                         │
│  ─────────────────────                                      │
│  • GPU 成本可控（~$500 完成核心书籍）                        │
│  • 开发工时合理（~220h）                                    │
│  • 无需引入新技术栈                                          │
│                                                             │
│  产品价值: ✅ 高                                             │
│  ─────────────────────                                      │
│  • 差异化竞争力（竞品少有）                                  │
│  • 用户场景扩展（通勤/运动/睡前）                            │
│  • 学习效果提升（多感官输入）                                │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 10.2 推荐路径

```
推荐实施路径
────────────────────────────────────────────────────────────

Phase 1: 验证阶段
├── 选择 5 本热门书籍
├── 手动生成时间戳
├── iOS 单平台实现
└── 验证用户接受度

Phase 2: 扩展阶段
├── 自动化时间戳生成流水线
├── 扩展到 50-100 本书籍
├── 优化高亮精度
└── 增加 Android 支持

Phase 3: 完善阶段
├── 全平台覆盖（Web）
├── 高级功能（跟读评分）
├── 500+ 书籍覆盖
└── 持续质量优化
```

### 10.3 关键依赖

| 依赖项 | 状态 | 说明 |
|--------|------|------|
| LibriVox 有声书导入 | 🔄 进行中 | 需完成基础导入 |
| 电子书-有声书关联 | 🔄 进行中 | 基于 PG ID 匹配 |
| GPU 计算资源 | ✅ 已选型 | 验证用 Replicate，批量用 RunPod，生产用 Modal |
| Whisper 部署 | ✅ 已选型 | 云端 API 调用，无需本地部署 |

---

## 11. 参考资料

### 核心技术

| 资源 | 说明 |
|------|------|
| [OpenAI Whisper](https://github.com/openai/whisper) | 语音识别模型 |
| [Aeneas](https://github.com/readbeyond/aeneas) | 音频-文本对齐工具 |
| [WhisperX](https://github.com/m-bain/whisperX) | Whisper 增强版 |
| [Audible Whispersync](https://www.audible.com/ep/whispersync-for-voice) | 竞品参考 |

### 云 GPU 服务

| 服务 | 说明 |
|------|------|
| [Replicate](https://replicate.com/openai/whisper) | Whisper API 托管服务 |
| [RunPod](https://www.runpod.io/) | 按需 GPU 云服务 |
| [Modal](https://modal.com/) | Serverless GPU 平台 |
| [Vast.ai](https://vast.ai/) | 社区 GPU 市场 |
| [Lambda Labs](https://lambdalabs.com/service/gpu-cloud) | ML 专用 GPU 云 |

### TTS 语音合成服务

| 服务 | 说明 |
|------|------|
| [ElevenLabs](https://elevenlabs.io/) | 顶级 AI 语音合成，支持声音克隆 |
| [OpenAI TTS](https://platform.openai.com/docs/guides/text-to-speech) | 高性价比 TTS API |
| [Azure Neural TTS](https://azure.microsoft.com/en-us/products/ai-services/text-to-speech) | 企业级 400+ 声音 |
| [Fish Audio](https://fish.audio/) | 中文优秀，支持声音克隆 |
| [Coqui TTS](https://github.com/coqui-ai/TTS) | 开源 TTS 框架 |

---

*文档创建日期: 2025-12-30*
*最后更新: 2025-12-30*
*状态: 调研完成，GPU 服务已选型*
*下一步: 使用 Replicate 验证 5 本书 → MVP 实现*

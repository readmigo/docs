# è‡ªå»º TTS ç³»ç»Ÿè¯¦ç»†è®¾è®¡æ–‡æ¡£

> ç›®æ ‡ï¼šæ„å»ºæ”¯æŒå¤šéŸ³è‰²ã€è¾¹è¯»è¾¹å¬ã€äº¤äº’å¼è·³è½¬çš„é«˜è´¨é‡ TTS æœ—è¯»ç³»ç»Ÿ

---

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 æ ¸å¿ƒåŠŸèƒ½çŸ©é˜µ

| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| **å¤šéŸ³è‰²æ”¯æŒ** | ç”¨æˆ·å¯é€‰æ‹©ä¸åŒå£°éŸ³é£æ ¼æœ—è¯» | P0 |
| **æ–‡æœ¬æœ—è¯»** | å°†ç”µå­ä¹¦æ–‡æœ¬è½¬ä¸ºè¯­éŸ³æ’­æ”¾ | P0 |
| **è¾¹çœ‹è¾¹è¯»** | æœ—è¯»æ—¶å®æ—¶é«˜äº®å½“å‰å¥å­/æ®µè½ | P0 |
| **ç‚¹å‡»è·³è½¬** | ç‚¹å‡»ä»»æ„æ–‡æœ¬ä½ç½®å¼€å§‹æœ—è¯» | P0 |
| **æ–‡æœ¬å¿«è¿›** | é€‰æ‹©æ–‡æœ¬å†…å®¹ç›´æ¥è·³è½¬åˆ°è¯¥ä½ç½® | P1 |
| **å¤šè§’è‰²æœ—è¯»** | å¯¹è¯åœºæ™¯è‡ªåŠ¨åˆ‡æ¢ä¸åŒå£°éŸ³ | P2 |
| **ä¸ªæ€§åŒ–å£°éŸ³** | ç”¨æˆ·è‡ªå®šä¹‰/å…‹éš†å£°éŸ³ | P3 |

### 1.2 ç›®æ ‡ä½“éªŒ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      é˜…è¯»å™¨ç•Œé¢                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Chapter 1: A Long-expected Party                           â”‚
â”‚                                                             â”‚
â”‚  When Mr. Bilbo Baggins of Bag End announced that he        â”‚
â”‚  would shortly be celebrating his eleventy-first birthday   â”‚
â”‚  with a party of special magnificence, there was much       â”‚
â”‚  talk and excitement in Hobbiton.                           â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Bilbo was very rich and very peculiar, and had been â”‚   â”‚
â”‚  â”‚ the wonder of the Shire for sixty years, ever since â”‚ â—„â”€â”¤ å½“å‰æœ—è¯»é«˜äº®
â”‚  â”‚ his remarkable disappearance and unexpected return. â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  The riches he had brought back from his travels had        â”‚
â”‚  now become a local legend...                    [ç‚¹å‡»è·³è½¬] â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ§ TTS æœ—è¯»ä¸­                                        â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  ğŸ”Š Emma (British Female)  â–¼    âš¡ 1.0x  â–¼          â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  â® ä¸Šå¥    â¸ æš‚åœ    â­ ä¸‹å¥    ğŸ“ è·³è½¬é€‰ä¸­æ–‡æœ¬    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TTS ç³»ç»Ÿæ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      å®¢æˆ·ç«¯å±‚ (Client)                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚   â”‚
â”‚  â”‚  â”‚    iOS    â”‚  â”‚  Android  â”‚  â”‚    Web    â”‚                â”‚   â”‚
â”‚  â”‚  â”‚  Reader   â”‚  â”‚  Reader   â”‚  â”‚  Reader   â”‚                â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                â”‚   â”‚
â”‚  â”‚        â”‚              â”‚              â”‚                       â”‚   â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚   â”‚
â”‚  â”‚                       â–¼                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚              TTS æ’­æ”¾å¼•æ“ (TTSEngine)                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ éŸ³é¢‘æ’­æ”¾æ§åˆ¶    â€¢ é«˜äº®åŒæ­¥ç®¡ç†                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ æ–‡æœ¬åˆ†æ®µå¤„ç†    â€¢ äº¤äº’äº‹ä»¶å¤„ç†                      â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                â”‚                                    â”‚
â”‚                                â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      æœåŠ¡ç«¯å±‚ (Server)                        â”‚   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚  TTS API    â”‚  â”‚  éŸ³è‰²ç®¡ç†   â”‚  â”‚  ç¼“å­˜æœåŠ¡   â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  Gateway    â”‚  â”‚  Service    â”‚  â”‚  Cache      â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚         â”‚                â”‚                â”‚                  â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â”‚                          â–¼                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚              TTS æä¾›å•†é€‚é…å±‚ (Adapters)              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ OpenAI  â”‚  â”‚ Eleven  â”‚  â”‚  Azure  â”‚  â”‚  Fish   â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   TTS   â”‚  â”‚  Labs   â”‚  â”‚   TTS   â”‚  â”‚  Audio  â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                â”‚                                    â”‚
â”‚                                â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      å­˜å‚¨å±‚ (Storage)                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚ PostgreSQL  â”‚  â”‚    Redis    â”‚  â”‚ Cloudflare  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  å…ƒæ•°æ®     â”‚  â”‚   çƒ­ç¼“å­˜    â”‚  â”‚  R2 éŸ³é¢‘    â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒæ¨¡å—è¯´æ˜

| æ¨¡å— | èŒè´£ | æŠ€æœ¯é€‰å‹ |
|------|------|----------|
| **TTSEngine** | å®¢æˆ·ç«¯æ’­æ”¾å¼•æ“ï¼Œç®¡ç†éŸ³é¢‘æ’­æ”¾å’Œé«˜äº®åŒæ­¥ | Swift/Kotlin/TypeScript |
| **TTS Gateway** | ç»Ÿä¸€ API å…¥å£ï¼Œè·¯ç”±åˆ°ä¸åŒ TTS æä¾›å•† | NestJS |
| **Voice Service** | éŸ³è‰²ç®¡ç†ï¼Œå£°éŸ³é…ç½®å’Œæƒé™æ§åˆ¶ | NestJS |
| **Cache Service** | éŸ³é¢‘ç¼“å­˜ï¼Œé¿å…é‡å¤ç”Ÿæˆ | Redis + R2 |
| **TTS Adapters** | å¯¹æ¥å„ TTS æœåŠ¡å•†çš„é€‚é…å™¨ | NestJS |

---

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 æ•°æ®åº“æ¨¡å‹

```prisma
// éŸ³è‰²é…ç½®
model Voice {
  id            String      @id @default(uuid()) @db.Uuid

  // åŸºç¡€ä¿¡æ¯
  name          String      @db.VarChar(100)      // æ˜¾ç¤ºåç§°: "Emma"
  displayName   String      @map("display_name") @db.VarChar(200)  // "Emma (British Female)"
  description   String?     @db.Text              // å£°éŸ³æè¿°

  // æä¾›å•†ä¿¡æ¯
  provider      TTSProvider                       // OPENAI | ELEVENLABS | AZURE | FISH
  providerVoiceId String    @map("provider_voice_id") @db.VarChar(100) // æä¾›å•†å£°éŸ³ID

  // å£°éŸ³ç‰¹å¾
  gender        VoiceGender                       // MALE | FEMALE | NEUTRAL
  ageGroup      VoiceAgeGroup @map("age_group")   // CHILD | YOUNG | ADULT | SENIOR
  accent        String?     @db.VarChar(50)       // british | american | australian
  style         String?     @db.VarChar(50)       // narrative | conversational | dramatic

  // è¯­è¨€æ”¯æŒ
  language      String      @default("en") @db.VarChar(10)

  // é…ç½®
  isDefault     Boolean     @default(false) @map("is_default")
  isPublic      Boolean     @default(true) @map("is_public")
  isPremium     Boolean     @default(false) @map("is_premium")

  // é¢„è§ˆ
  previewUrl    String?     @map("preview_url") @db.VarChar(500)

  // çŠ¶æ€
  status        VoiceStatus @default(ACTIVE)

  // æ—¶é—´æˆ³
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")

  // å…³è”
  userPreferences UserVoicePreference[]
  ttsSegments     TTSSegment[]

  @@index([provider])
  @@index([language])
  @@index([isPublic, status])
  @@map("voices")
}

// ç”¨æˆ·éŸ³è‰²åå¥½
model UserVoicePreference {
  id          String    @id @default(uuid()) @db.Uuid
  userId      String    @map("user_id") @db.Uuid
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  // åå¥½è®¾ç½®
  defaultVoiceId  String?   @map("default_voice_id") @db.Uuid
  defaultVoice    Voice?    @relation(fields: [defaultVoiceId], references: [id])

  // æœ—è¯»è®¾ç½®
  speed           Float     @default(1.0)           // 0.5 - 2.0
  pitch           Float     @default(1.0)           // 0.5 - 2.0

  // é«˜äº®è®¾ç½®
  highlightMode   HighlightMode @default(SENTENCE) @map("highlight_mode")
  autoScroll      Boolean   @default(true) @map("auto_scroll")

  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@unique([userId])
  @@map("user_voice_preferences")
}

// TTS ç¼“å­˜ç‰‡æ®µ
model TTSSegment {
  id            String    @id @default(uuid()) @db.Uuid

  // å†…å®¹æ ‡è¯†
  bookId        String    @map("book_id") @db.Uuid
  chapterId     String    @map("chapter_id") @db.Uuid
  segmentIndex  Int       @map("segment_index")     // ç‰‡æ®µåºå·

  // æ–‡æœ¬ä¿¡æ¯
  textHash      String    @map("text_hash") @db.VarChar(64)  // SHA256
  textContent   String    @map("text_content") @db.Text
  textStart     Int       @map("text_start")        // æ–‡æœ¬èµ·å§‹ä½ç½®
  textEnd       Int       @map("text_end")          // æ–‡æœ¬ç»“æŸä½ç½®

  // éŸ³é¢‘ä¿¡æ¯
  voiceId       String    @map("voice_id") @db.Uuid
  voice         Voice     @relation(fields: [voiceId], references: [id])
  speed         Float     @default(1.0)

  // ç”Ÿæˆçš„éŸ³é¢‘
  audioUrl      String?   @map("audio_url") @db.VarChar(500)
  audioDuration Float?    @map("audio_duration")    // ç§’
  audioSize     Int?      @map("audio_size")        // å­—èŠ‚

  // æ—¶é—´æˆ³æ˜ å°„ (ç”¨äºé«˜äº®åŒæ­¥)
  timestamps    Json?     // [{time: 0.0, charOffset: 0}, ...]

  // çŠ¶æ€
  status        SegmentStatus @default(PENDING)

  createdAt     DateTime  @default(now()) @map("created_at")

  @@unique([bookId, chapterId, segmentIndex, voiceId, speed])
  @@index([textHash, voiceId])
  @@index([bookId, chapterId])
  @@map("tts_segments")
}

// æšä¸¾å®šä¹‰
enum TTSProvider {
  OPENAI
  ELEVENLABS
  AZURE
  GOOGLE
  FISH
  COQUI
}

enum VoiceGender {
  MALE
  FEMALE
  NEUTRAL
}

enum VoiceAgeGroup {
  CHILD
  YOUNG
  ADULT
  SENIOR
}

enum VoiceStatus {
  ACTIVE
  INACTIVE
  DEPRECATED
}

enum HighlightMode {
  WORD        // å•è¯çº§é«˜äº®
  SENTENCE    // å¥å­çº§é«˜äº®
  PARAGRAPH   // æ®µè½çº§é«˜äº®
}

enum SegmentStatus {
  PENDING     // ç­‰å¾…ç”Ÿæˆ
  GENERATING  // ç”Ÿæˆä¸­
  READY       // å·²å°±ç»ª
  FAILED      // ç”Ÿæˆå¤±è´¥
}
```

### 3.2 æ—¶é—´æˆ³æ•°æ®ç»“æ„

```typescript
// TTS ç‰‡æ®µæ—¶é—´æˆ³æ ¼å¼
interface TTSTimestamp {
  // éŸ³é¢‘æ—¶é—´ç‚¹ï¼ˆç§’ï¼‰
  time: number;
  // å¯¹åº”æ–‡æœ¬å­—ç¬¦ä½ç½®
  charOffset: number;
  // å¯¹åº”å•è¯ï¼ˆå¯é€‰ï¼‰
  word?: string;
  // ç½®ä¿¡åº¦
  confidence?: number;
}

// å®Œæ•´ç‰‡æ®µæ•°æ®
interface TTSSegmentData {
  id: string;
  segmentIndex: number;

  // æ–‡æœ¬
  text: string;
  textStart: number;
  textEnd: number;

  // éŸ³é¢‘
  audioUrl: string;
  duration: number;

  // æ—¶é—´æˆ³æ˜ å°„
  timestamps: TTSTimestamp[];
}

// ç« èŠ‚ TTS æ•°æ®
interface ChapterTTSData {
  chapterId: string;
  voiceId: string;
  speed: number;
  segments: TTSSegmentData[];
  totalDuration: number;
}
```

---

## 4. å¤šéŸ³è‰²ç³»ç»Ÿè®¾è®¡

### 4.1 é¢„ç½®éŸ³è‰²åº“

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      é¢„ç½®éŸ³è‰²åº“                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  è‹±è¯­éŸ³è‰² (English Voices)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å¥³å£° (Female)                                        â”‚   â”‚
â”‚  â”‚ â€¢ Emma      - British, Warm, Narrative              â”‚   â”‚
â”‚  â”‚ â€¢ Olivia    - American, Clear, Professional         â”‚   â”‚
â”‚  â”‚ â€¢ Sophie    - Australian, Friendly, Casual          â”‚   â”‚
â”‚  â”‚ â€¢ Charlotte - British, Elegant, Classic             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç”·å£° (Male)                                          â”‚   â”‚
â”‚  â”‚ â€¢ James     - British, Deep, Authoritative          â”‚   â”‚
â”‚  â”‚ â€¢ Michael   - American, Warm, Conversational        â”‚   â”‚
â”‚  â”‚ â€¢ Daniel    - British, Young, Energetic             â”‚   â”‚
â”‚  â”‚ â€¢ William   - British, Classic, Dramatic            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  ä¸­æ–‡éŸ³è‰² (Chinese Voices)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ æ™“æ™“      - å¥³å£°, æ¸©æŸ”, å™è¿°                        â”‚   â”‚
â”‚  â”‚ â€¢ äº‘æ‰¬      - ç”·å£°, æµ‘åš, ä¸“ä¸š                        â”‚   â”‚
â”‚  â”‚ â€¢ æ™“è±      - å¥³å£°, æ´»æ³¼, å¹´è½»                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  ç‰¹è‰²éŸ³è‰² (Special Voices)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ Storyteller  - æ•…äº‹è®²è¿°è€…é£æ ¼                       â”‚   â”‚
â”‚  â”‚ â€¢ Dramatic     - æˆå‰§æœ—è¯»é£æ ¼                         â”‚   â”‚
â”‚  â”‚ â€¢ Meditation   - å†¥æƒ³/èˆ’ç¼“é£æ ¼                        â”‚   â”‚
â”‚  â”‚ â€¢ Children     - å„¿ç«¥æ•…äº‹é£æ ¼                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 éŸ³è‰²é€‰æ‹©å™¨ UI

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é€‰æ‹©æœ—è¯»éŸ³è‰²                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  å½“å‰: Emma (British Female)                       [â–¶ è¯•å¬] â”‚
â”‚                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                             â”‚
â”‚  æ¨èéŸ³è‰²                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  ğŸ‘© Emma â”‚  â”‚ ğŸ‘¨ James â”‚  â”‚ğŸ‘© Oliviaâ”‚  â”‚ğŸ‘¨ Michaelâ”‚       â”‚
â”‚  â”‚ British â”‚  â”‚ British â”‚  â”‚American â”‚  â”‚American â”‚       â”‚
â”‚  â”‚  â–¶ è¯•å¬ â”‚  â”‚  â–¶ è¯•å¬ â”‚  â”‚  â–¶ è¯•å¬ â”‚  â”‚  â–¶ è¯•å¬ â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                             â”‚
â”‚  å…¨éƒ¨éŸ³è‰²                                          ç­›é€‰ â–¼   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â—‹ Emma        British Female, Warm         â–¶ è¯•å¬  â”‚   â”‚
â”‚  â”‚ â— James       British Male, Deep           â–¶ è¯•å¬  â”‚   â”‚
â”‚  â”‚ â—‹ Olivia      American Female, Clear       â–¶ è¯•å¬  â”‚   â”‚
â”‚  â”‚ â—‹ Michael     American Male, Warm          â–¶ è¯•å¬  â”‚   â”‚
â”‚  â”‚ â—‹ Storyteller Special, Narrative           â–¶ è¯•å¬  â”‚   â”‚
â”‚  â”‚ ...                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  è¯­é€Ÿè°ƒèŠ‚                                                    â”‚
â”‚  ğŸ¢ â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ğŸ‡                            â”‚
â”‚              1.0x                                           â”‚
â”‚                                                             â”‚
â”‚                              [ å–æ¶ˆ ]  [ ç¡®è®¤é€‰æ‹© ]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 éŸ³è‰²æ˜ å°„é…ç½®ï¼ˆå¤šè§’è‰²ï¼‰

```typescript
// ä¹¦ç±çº§åˆ«çš„éŸ³è‰²é…ç½®
interface BookVoiceConfig {
  bookId: string;

  // é»˜è®¤éŸ³è‰²
  defaultVoice: string;  // voiceId

  // è§’è‰²éŸ³è‰²æ˜ å°„
  characterVoices: {
    [characterName: string]: {
      voiceId: string;
      description?: string;  // "Elizabeth Bennet - å¥³ä¸»è§’"
    };
  };

  // ç‰¹æ®Šæ–‡æœ¬ç±»å‹éŸ³è‰²
  narratorVoice?: string;     // æ—ç™½éŸ³è‰²
  dialogueVoice?: string;     // å¯¹è¯é»˜è®¤éŸ³è‰²
  thoughtVoice?: string;      // å†…å¿ƒç‹¬ç™½éŸ³è‰²
}

// ç¤ºä¾‹ï¼šå‚²æ…¢ä¸åè§
const prideAndPrejudiceConfig: BookVoiceConfig = {
  bookId: "pride-and-prejudice",
  defaultVoice: "emma-british-female",
  characterVoices: {
    "Elizabeth": { voiceId: "charlotte-elegant", description: "Elizabeth Bennet" },
    "Mr. Darcy": { voiceId: "james-british-deep", description: "Fitzwilliam Darcy" },
    "Jane": { voiceId: "sophie-friendly", description: "Jane Bennet" },
    "Mr. Bingley": { voiceId: "daniel-young", description: "Charles Bingley" },
    "Mrs. Bennet": { voiceId: "olivia-dramatic", description: "Mrs. Bennet" },
  },
  narratorVoice: "emma-british-female",
};
```

---

## 5. è¾¹çœ‹è¾¹è¯»å®ç°

### 5.1 é«˜äº®åŒæ­¥æµç¨‹

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é«˜äº®åŒæ­¥æµç¨‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  éŸ³é¢‘æ’­æ”¾å™¨   â”‚                                           â”‚
â”‚  â”‚  AudioPlayer â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚         â”‚ currentTime (æ¯ 50ms æ›´æ–°)                        â”‚
â”‚         â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               æ—¶é—´æˆ³æŸ¥æ‰¾å™¨ (TimestampFinder)           â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  è¾“å…¥: currentTime = 12.34s                          â”‚  â”‚
â”‚  â”‚  æŸ¥æ‰¾: äºŒåˆ†æœç´¢ timestamps æ•°ç»„                       â”‚  â”‚
â”‚  â”‚  è¾“å‡º: charOffset = 1234                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               å¥å­å®šä½å™¨ (SentenceLocator)            â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  è¾“å…¥: charOffset = 1234                             â”‚  â”‚
â”‚  â”‚  è®¡ç®—: æ‰¾åˆ°åŒ…å«è¯¥ä½ç½®çš„å¥å­è¾¹ç•Œ                       â”‚  â”‚
â”‚  â”‚  è¾“å‡º: sentenceStart = 1200, sentenceEnd = 1280      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               é«˜äº®æ¸²æŸ“å™¨ (HighlightRenderer)          â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  è¾“å…¥: range = {start: 1200, end: 1280}              â”‚  â”‚
â”‚  â”‚  åŠ¨ä½œ: 1. ç§»é™¤æ—§é«˜äº®                                  â”‚  â”‚
â”‚  â”‚        2. æ·»åŠ æ–°é«˜äº® CSS ç±»                          â”‚  â”‚
â”‚  â”‚        3. æ»šåŠ¨åˆ°å¯è§†åŒºåŸŸ                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 é«˜äº®æ¨¡å¼é€‰é¡¹

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      é«˜äº®æ¨¡å¼å¯¹æ¯”                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æ¨¡å¼ 1: å•è¯çº§é«˜äº® (Word)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  "It is a [truth] universally acknowledged..."              â”‚
â”‚           â–²                                                 â”‚
â”‚        å½“å‰å•è¯                                              â”‚
â”‚  ä¼˜ç‚¹: ç²¾ç¡®è·Ÿè¸ª                                              â”‚
â”‚  ç¼ºç‚¹: è§†è§‰å¹²æ‰°å¤§ï¼Œéœ€è¦ç²¾ç¡®æ—¶é—´æˆ³                            â”‚
â”‚                                                             â”‚
â”‚  æ¨¡å¼ 2: å¥å­çº§é«˜äº® (Sentence) â† æ¨èé»˜è®¤                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ It is a truth universally acknowledged, that a      â”‚   â”‚
â”‚  â”‚ single man in possession of a good fortune, must    â”‚   â”‚
â”‚  â”‚ be in want of a wife.                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ä¼˜ç‚¹: é˜…è¯»ä½“éªŒå¥½ï¼Œå®ç°ç®€å•                                  â”‚
â”‚  ç¼ºç‚¹: é•¿å¥å­æ—¶å®šä½ä¸å¤Ÿç²¾ç¡®                                  â”‚
â”‚                                                             â”‚
â”‚  æ¨¡å¼ 3: æ®µè½çº§é«˜äº® (Paragraph)                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [æ•´ä¸ªæ®µè½é«˜äº®...]                                    â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ä¼˜ç‚¹: æœ€ç®€å•ï¼Œè§†è§‰å¹²æ‰°æœ€å°                                  â”‚
â”‚  ç¼ºç‚¹: å®šä½ç²—ç³™                                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 é«˜äº®åŒæ­¥ä»£ç ç¤ºä¾‹

```typescript
// iOS Swift ç¤ºä¾‹
class TTSHighlightManager {
    private var audioPlayer: AVPlayer
    private var timestamps: [TTSTimestamp] = []
    private var highlightMode: HighlightMode = .sentence
    private var timeObserver: Any?

    // å¯åŠ¨é«˜äº®åŒæ­¥
    func startHighlightSync() {
        // æ¯ 50ms æ›´æ–°é«˜äº®
        let interval = CMTime(seconds: 0.05, preferredTimescale: CMTimeScale(NSEC_PER_SEC))
        timeObserver = audioPlayer.addPeriodicTimeObserver(
            forInterval: interval,
            queue: .main
        ) { [weak self] time in
            self?.updateHighlight(at: time.seconds)
        }
    }

    // æ›´æ–°é«˜äº®ä½ç½®
    private func updateHighlight(at time: Double) {
        // 1. äºŒåˆ†æŸ¥æ‰¾å½“å‰å­—ç¬¦ä½ç½®
        let charOffset = findCharOffset(at: time)

        // 2. è®¡ç®—é«˜äº®èŒƒå›´
        let range = calculateHighlightRange(charOffset: charOffset)

        // 3. é€šçŸ¥ WebView æ›´æ–°é«˜äº®
        webView.evaluateJavaScript("""
            window.ttsHighlight.update(\(range.start), \(range.end));
        """)
    }

    // äºŒåˆ†æŸ¥æ‰¾å­—ç¬¦ä½ç½®
    private func findCharOffset(at time: Double) -> Int {
        var left = 0
        var right = timestamps.count - 1

        while left < right {
            let mid = (left + right + 1) / 2
            if timestamps[mid].time <= time {
                left = mid
            } else {
                right = mid - 1
            }
        }

        return timestamps[left].charOffset
    }
}
```

```javascript
// WebView æ³¨å…¥çš„é«˜äº®è„šæœ¬
window.ttsHighlight = {
    currentRange: null,

    // æ›´æ–°é«˜äº®
    update: function(start, end) {
        // ç§»é™¤æ—§é«˜äº®
        this.clearHighlight();

        // æ·»åŠ æ–°é«˜äº®
        const range = document.createRange();
        const textNode = this.findTextNode(start);
        const endNode = this.findTextNode(end);

        range.setStart(textNode.node, textNode.offset);
        range.setEnd(endNode.node, endNode.offset);

        const highlight = document.createElement('span');
        highlight.className = 'tts-highlight';
        range.surroundContents(highlight);

        this.currentRange = { start, end, element: highlight };

        // æ»šåŠ¨åˆ°å¯è§†åŒºåŸŸ
        highlight.scrollIntoView({ behavior: 'smooth', block: 'center' });
    },

    // æ¸…é™¤é«˜äº®
    clearHighlight: function() {
        const existing = document.querySelector('.tts-highlight');
        if (existing) {
            const parent = existing.parentNode;
            while (existing.firstChild) {
                parent.insertBefore(existing.firstChild, existing);
            }
            parent.removeChild(existing);
        }
    }
};
```

---

## 6. äº¤äº’å¼è·³è½¬å®ç°

### 6.1 ç‚¹å‡»æ–‡æœ¬è·³è½¬

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç‚¹å‡»è·³è½¬äº¤äº’æµç¨‹                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ç”¨æˆ·æ“ä½œ                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚  1. ç”¨æˆ·ç‚¹å‡»æ–‡æœ¬ "The riches he had brought back..."        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         ç‚¹å‡»ä½ç½®                                     â”‚   â”‚
â”‚  â”‚             â–¼                                       â”‚   â”‚
â”‚  â”‚  The riches he had brought back from his travels    â”‚   â”‚
â”‚  â”‚  had now become a local legend...                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  ç³»ç»Ÿå¤„ç†                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚  2. è·å–ç‚¹å‡»ä½ç½®çš„å­—ç¬¦åç§»é‡ charOffset = 2456              â”‚
â”‚  3. å®šä½åˆ°åŒ…å«è¯¥ä½ç½®çš„å¥å­èµ·å§‹ sentenceStart = 2420         â”‚
â”‚  4. æŸ¥æ‰¾å¥å­èµ·å§‹å¯¹åº”çš„æ—¶é—´æˆ³ time = 45.6s                   â”‚
â”‚  5. è·³è½¬éŸ³é¢‘åˆ°è¯¥æ—¶é—´ç‚¹ audioPlayer.seek(45.6)               â”‚
â”‚  6. æ›´æ–°é«˜äº®åˆ°è¯¥å¥å­                                        â”‚
â”‚                                                             â”‚
â”‚  ç»“æœ                                                        â”‚
â”‚  â”€â”€â”€â”€                                                       â”‚
â”‚  ä»ç‚¹å‡»ä½ç½®çš„å¥å­å¼€å§‹æœ—è¯»                                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 é€‰æ‹©æ–‡æœ¬å¿«è¿›

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é€‰æ‹©æ–‡æœ¬å¿«è¿›äº¤äº’                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ç”¨æˆ·æ“ä½œ                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚  1. ç”¨æˆ·é•¿æŒ‰å¹¶é€‰æ‹©ä¸€æ®µæ–‡æœ¬                                   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ...talk and excitement in Hobbiton.                â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Bilbo was very rich and very peculiar, and    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ had been the wonder of the Shire for sixty    â”‚ â”‚   â”‚ â† é€‰ä¸­
â”‚  â”‚  â”‚ years, ever since his remarkable              â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  disappearance and unexpected return.               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  2. æ˜¾ç¤ºå¿«æ·èœå•                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  ğŸ“– æŸ¥è¯  â”‚  ğŸ“ è·³è½¬æœ—è¯»  â”‚  ğŸ“‹ å¤åˆ¶  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                             â”‚
â”‚  3. ç‚¹å‡»"è·³è½¬æœ—è¯»"                                          â”‚
â”‚                                                             â”‚
â”‚  ç³»ç»Ÿå¤„ç†                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚  â€¢ è·å–é€‰ä¸­æ–‡æœ¬èµ·å§‹ä½ç½® selectionStart = 1580               â”‚
â”‚  â€¢ æŸ¥æ‰¾å¯¹åº”æ—¶é—´æˆ³ time = 32.1s                              â”‚
â”‚  â€¢ éŸ³é¢‘è·³è½¬åˆ°è¯¥æ—¶é—´ç‚¹                                        â”‚
â”‚  â€¢ å¼€å§‹æœ—è¯»                                                  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 å¿«è¿›äº¤äº’ä»£ç 

```typescript
// æ–‡æœ¬ç‚¹å‡»å¤„ç†
interface TextTapEvent {
  charOffset: number;      // ç‚¹å‡»ä½ç½®çš„å­—ç¬¦åç§»
  sentenceIndex: number;   // æ‰€åœ¨å¥å­ç´¢å¼•
  paragraphIndex: number;  // æ‰€åœ¨æ®µè½ç´¢å¼•
}

// æ–‡æœ¬é€‰æ‹©å¤„ç†
interface TextSelectionEvent {
  startOffset: number;     // é€‰æ‹©èµ·å§‹ä½ç½®
  endOffset: number;       // é€‰æ‹©ç»“æŸä½ç½®
  selectedText: string;    // é€‰ä¸­çš„æ–‡æœ¬
}

class TTSInteractionManager {
    private ttsEngine: TTSEngine;
    private timestamps: TTSTimestamp[];

    // å¤„ç†ç‚¹å‡»è·³è½¬
    handleTextTap(event: TextTapEvent): void {
        // æ‰¾åˆ°å¥å­èµ·å§‹ä½ç½®
        const sentenceStart = this.findSentenceStart(event.charOffset);

        // æŸ¥æ‰¾å¯¹åº”çš„éŸ³é¢‘æ—¶é—´
        const audioTime = this.findAudioTime(sentenceStart);

        // è·³è½¬å¹¶æ’­æ”¾
        this.ttsEngine.seekAndPlay(audioTime);
    }

    // å¤„ç†é€‰æ‹©æ–‡æœ¬å¿«è¿›
    handleTextSelection(event: TextSelectionEvent): void {
        // è·å–é€‰æ‹©èµ·å§‹ä½ç½®å¯¹åº”çš„æ—¶é—´
        const audioTime = this.findAudioTime(event.startOffset);

        // è·³è½¬å¹¶æ’­æ”¾
        this.ttsEngine.seekAndPlay(audioTime);
    }

    // æŸ¥æ‰¾å­—ç¬¦ä½ç½®å¯¹åº”çš„éŸ³é¢‘æ—¶é—´
    private findAudioTime(charOffset: number): number {
        // äºŒåˆ†æŸ¥æ‰¾
        let left = 0;
        let right = this.timestamps.length - 1;

        while (left < right) {
            const mid = Math.floor((left + right) / 2);
            if (this.timestamps[mid].charOffset < charOffset) {
                left = mid + 1;
            } else {
                right = mid;
            }
        }

        return this.timestamps[left].time;
    }

    // æŸ¥æ‰¾å¥å­èµ·å§‹ä½ç½®
    private findSentenceStart(charOffset: number): number {
        // å‘å‰æŸ¥æ‰¾å¥å­ç»“æŸç¬¦
        const text = this.getCurrentText();
        let pos = charOffset;

        while (pos > 0 && !this.isSentenceEnd(text[pos - 1])) {
            pos--;
        }

        return pos;
    }

    private isSentenceEnd(char: string): boolean {
        return ['.', '!', '?', 'ã€‚', 'ï¼', 'ï¼Ÿ'].includes(char);
    }
}
```

---

## 7. API è®¾è®¡

### 7.1 TTS ç”Ÿæˆ API

```typescript
// POST /api/tts/generate
interface GenerateTTSRequest {
  bookId: string;
  chapterId: string;
  voiceId: string;
  speed?: number;           // é»˜è®¤ 1.0

  // å¯é€‰ï¼šæŒ‡å®šç”ŸæˆèŒƒå›´
  segmentRange?: {
    start: number;          // èµ·å§‹ç‰‡æ®µç´¢å¼•
    end: number;            // ç»“æŸç‰‡æ®µç´¢å¼•
  };
}

interface GenerateTTSResponse {
  jobId: string;            // å¼‚æ­¥ä»»åŠ¡ID
  status: 'queued' | 'processing' | 'completed' | 'failed';
  estimatedTime?: number;   // é¢„è®¡å®Œæˆæ—¶é—´ï¼ˆç§’ï¼‰
}

// GET /api/tts/status/:jobId
interface TTSJobStatus {
  jobId: string;
  status: 'queued' | 'processing' | 'completed' | 'failed';
  progress: number;         // 0-100
  result?: {
    segments: TTSSegmentData[];
    totalDuration: number;
  };
  error?: string;
}
```

### 7.2 éŸ³é¢‘æµå¼æ’­æ”¾ API

```typescript
// GET /api/tts/stream/:bookId/:chapterId
// Query: voiceId, speed, startSegment
// Response: Audio stream (chunked)

// GET /api/tts/segments/:bookId/:chapterId
interface GetSegmentsRequest {
  voiceId: string;
  speed?: number;
}

interface GetSegmentsResponse {
  chapterId: string;
  voiceId: string;
  speed: number;
  totalDuration: number;
  segments: Array<{
    index: number;
    audioUrl: string;
    duration: number;
    textStart: number;
    textEnd: number;
    timestamps: TTSTimestamp[];
  }>;
}
```

### 7.3 éŸ³è‰²ç®¡ç† API

```typescript
// GET /api/voices
interface GetVoicesResponse {
  voices: Array<{
    id: string;
    name: string;
    displayName: string;
    gender: 'MALE' | 'FEMALE' | 'NEUTRAL';
    accent: string;
    style: string;
    previewUrl: string;
    isPremium: boolean;
  }>;
}

// GET /api/voices/:id/preview
// Response: Audio file (MP3)

// POST /api/user/voice-preference
interface SetVoicePreferenceRequest {
  defaultVoiceId: string;
  speed: number;
  highlightMode: 'WORD' | 'SENTENCE' | 'PARAGRAPH';
  autoScroll: boolean;
}
```

---

## 8. å®¢æˆ·ç«¯å®ç°

### 8.1 iOS TTSEngine æ ¸å¿ƒç±»

```swift
import AVFoundation
import Combine

class TTSEngine: ObservableObject {
    // MARK: - Published State
    @Published var isPlaying: Bool = false
    @Published var currentSegmentIndex: Int = 0
    @Published var currentTime: TimeInterval = 0
    @Published var duration: TimeInterval = 0
    @Published var currentHighlightRange: NSRange?

    // MARK: - Configuration
    @Published var selectedVoice: Voice?
    @Published var speed: Float = 1.0
    @Published var highlightMode: HighlightMode = .sentence

    // MARK: - Private
    private var audioPlayer: AVQueuePlayer?
    private var segments: [TTSSegmentData] = []
    private var timeObserver: Any?
    private var cancellables = Set<AnyCancellable>()

    // MARK: - Initialization
    func loadChapter(bookId: String, chapterId: String, voiceId: String) async throws {
        // 1. è·å–ç« èŠ‚ TTS æ•°æ®
        let data = try await TTSService.shared.getSegments(
            bookId: bookId,
            chapterId: chapterId,
            voiceId: voiceId,
            speed: speed
        )

        // 2. è®¾ç½®ç‰‡æ®µæ•°æ®
        self.segments = data.segments
        self.duration = data.totalDuration

        // 3. åˆ›å»ºæ’­æ”¾é˜Ÿåˆ—
        let items = segments.compactMap { segment -> AVPlayerItem? in
            guard let url = URL(string: segment.audioUrl) else { return nil }
            return AVPlayerItem(url: url)
        }

        self.audioPlayer = AVQueuePlayer(items: items)
        self.audioPlayer?.rate = speed

        // 4. è®¾ç½®æ—¶é—´è§‚å¯Ÿ
        setupTimeObserver()
    }

    // MARK: - Playback Control
    func play() {
        audioPlayer?.play()
        isPlaying = true
    }

    func pause() {
        audioPlayer?.pause()
        isPlaying = false
    }

    func seekToSegment(_ index: Int) {
        guard index >= 0 && index < segments.count else { return }

        // é‡å»ºæ’­æ”¾é˜Ÿåˆ—ä»æŒ‡å®šä½ç½®å¼€å§‹
        let remainingSegments = Array(segments[index...])
        let items = remainingSegments.compactMap { segment -> AVPlayerItem? in
            guard let url = URL(string: segment.audioUrl) else { return nil }
            return AVPlayerItem(url: url)
        }

        audioPlayer?.removeAllItems()
        items.forEach { audioPlayer?.insert($0, after: nil) }

        currentSegmentIndex = index
        play()
    }

    func seekToCharOffset(_ charOffset: Int) {
        // æ‰¾åˆ°åŒ…å«è¯¥ä½ç½®çš„ç‰‡æ®µ
        guard let segmentIndex = segments.firstIndex(where: {
            charOffset >= $0.textStart && charOffset < $0.textEnd
        }) else { return }

        // è®¡ç®—ç‰‡æ®µå†…çš„æ—¶é—´åç§»
        let segment = segments[segmentIndex]
        let timeOffset = findTimeForCharOffset(charOffset, in: segment)

        // è·³è½¬åˆ°ç‰‡æ®µå¹¶ seek åˆ°å…·ä½“æ—¶é—´
        seekToSegment(segmentIndex)

        // ç­‰å¾…åŠ è½½å seek åˆ°å…·ä½“ä½ç½®
        DispatchQueue.main.asyncAfter(deadline: .now() + 0.1) {
            self.audioPlayer?.seek(to: CMTime(seconds: timeOffset, preferredTimescale: 1000))
        }
    }

    // MARK: - Highlight Sync
    private func setupTimeObserver() {
        let interval = CMTime(seconds: 0.05, preferredTimescale: CMTimeScale(NSEC_PER_SEC))
        timeObserver = audioPlayer?.addPeriodicTimeObserver(
            forInterval: interval,
            queue: .main
        ) { [weak self] time in
            self?.handleTimeUpdate(time.seconds)
        }
    }

    private func handleTimeUpdate(_ time: TimeInterval) {
        currentTime = time

        guard currentSegmentIndex < segments.count else { return }
        let segment = segments[currentSegmentIndex]

        // æŸ¥æ‰¾å½“å‰å­—ç¬¦ä½ç½®
        let charOffset = findCharOffsetForTime(time, in: segment)

        // æ ¹æ®é«˜äº®æ¨¡å¼è®¡ç®—èŒƒå›´
        let range = calculateHighlightRange(charOffset: charOffset, in: segment)

        // æ›´æ–°é«˜äº®
        if range != currentHighlightRange {
            currentHighlightRange = range
        }
    }

    private func findCharOffsetForTime(_ time: TimeInterval, in segment: TTSSegmentData) -> Int {
        let timestamps = segment.timestamps

        // äºŒåˆ†æŸ¥æ‰¾
        var left = 0
        var right = timestamps.count - 1

        while left < right {
            let mid = (left + right + 1) / 2
            if timestamps[mid].time <= time {
                left = mid
            } else {
                right = mid - 1
            }
        }

        return timestamps[left].charOffset + segment.textStart
    }

    private func calculateHighlightRange(charOffset: Int, in segment: TTSSegmentData) -> NSRange {
        switch highlightMode {
        case .word:
            return findWordRange(at: charOffset, in: segment)
        case .sentence:
            return findSentenceRange(at: charOffset, in: segment)
        case .paragraph:
            return NSRange(location: segment.textStart, length: segment.textEnd - segment.textStart)
        }
    }
}
```

### 8.2 é«˜äº®æ¸²æŸ“ç»„ä»¶

```swift
// SwiftUI é«˜äº®æ–‡æœ¬è§†å›¾
struct HighlightableTextView: UIViewRepresentable {
    let attributedText: NSAttributedString
    let highlightRange: NSRange?
    let onTap: (Int) -> Void  // ç‚¹å‡»ä½ç½®çš„å­—ç¬¦åç§»
    let onSelection: (Int, Int) -> Void  // é€‰æ‹©èŒƒå›´

    func makeUIView(context: Context) -> UITextView {
        let textView = UITextView()
        textView.isEditable = false
        textView.isSelectable = true
        textView.delegate = context.coordinator

        // æ·»åŠ ç‚¹å‡»æ‰‹åŠ¿
        let tapGesture = UITapGestureRecognizer(
            target: context.coordinator,
            action: #selector(Coordinator.handleTap(_:))
        )
        textView.addGestureRecognizer(tapGesture)

        return textView
    }

    func updateUIView(_ textView: UITextView, context: Context) {
        // æ›´æ–°æ–‡æœ¬
        let mutableAttr = NSMutableAttributedString(attributedString: attributedText)

        // åº”ç”¨é«˜äº®
        if let range = highlightRange {
            mutableAttr.addAttributes([
                .backgroundColor: UIColor.systemYellow.withAlphaComponent(0.3),
                .foregroundColor: UIColor.label
            ], range: range)
        }

        textView.attributedText = mutableAttr

        // æ»šåŠ¨åˆ°é«˜äº®ä½ç½®
        if let range = highlightRange {
            textView.scrollRangeToVisible(range)
        }
    }

    class Coordinator: NSObject, UITextViewDelegate {
        let parent: HighlightableTextView

        init(_ parent: HighlightableTextView) {
            self.parent = parent
        }

        @objc func handleTap(_ gesture: UITapGestureRecognizer) {
            guard let textView = gesture.view as? UITextView else { return }

            let location = gesture.location(in: textView)
            let position = textView.closestPosition(to: location)

            if let position = position {
                let offset = textView.offset(from: textView.beginningOfDocument, to: position)
                parent.onTap(offset)
            }
        }

        func textViewDidChangeSelection(_ textView: UITextView) {
            let range = textView.selectedRange
            if range.length > 0 {
                parent.onSelection(range.location, range.location + range.length)
            }
        }
    }
}
```

---

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 éŸ³é¢‘é¢„åŠ è½½ç­–ç•¥

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    éŸ³é¢‘é¢„åŠ è½½ç­–ç•¥                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ç­–ç•¥ 1: åˆ†ç‰‡é¢„åŠ è½½                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚                                                             â”‚
â”‚  å½“å‰æ’­æ”¾: Segment 5                                         â”‚
â”‚           â–¼                                                 â”‚
â”‚  [1][2][3][4][5][6][7][8][9][10]...                        â”‚
â”‚              â””â”€â”€â”¬â”€â”€â”˜                                        â”‚
â”‚           å·²ç¼“å­˜ Segment 6-7                                 â”‚
â”‚                                                             â”‚
â”‚  è§„åˆ™:                                                       â”‚
â”‚  â€¢ é¢„åŠ è½½å½“å‰ç‰‡æ®µå 2 ä¸ªç‰‡æ®µ                                 â”‚
â”‚  â€¢ é‡Šæ”¾å½“å‰ç‰‡æ®µå‰ 3 ä¸ªç‰‡æ®µçš„ç¼“å­˜                            â”‚
â”‚  â€¢ ä¿æŒå†…å­˜å ç”¨ < 50MB                                       â”‚
â”‚                                                             â”‚
â”‚  ç­–ç•¥ 2: ç« èŠ‚é¢„ç”Ÿæˆ                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚                                                             â”‚
â”‚  ç”¨æˆ·æ‰“å¼€ä¹¦ç±æ—¶:                                             â”‚
â”‚  â€¢ åå°é˜Ÿåˆ—ç”Ÿæˆå½“å‰ç« èŠ‚ TTS                                  â”‚
â”‚  â€¢ ä¼˜å…ˆç”Ÿæˆç”¨æˆ·æœ€å¯èƒ½é˜…è¯»çš„ç« èŠ‚                              â”‚
â”‚  â€¢ ä½¿ç”¨ç”¨æˆ·é»˜è®¤éŸ³è‰²é¢„ç”Ÿæˆ                                    â”‚
â”‚                                                             â”‚
â”‚  ç­–ç•¥ 3: ç¼“å­˜å¤ç”¨                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚                                                             â”‚
â”‚  ç¼“å­˜ Key: hash(bookId + chapterId + segmentIndex +         â”‚
â”‚                 voiceId + speed + textHash)                 â”‚
â”‚                                                             â”‚
â”‚  â€¢ ç›¸åŒå†…å®¹ + ç›¸åŒé…ç½® = å¤ç”¨å·²ç”ŸæˆéŸ³é¢‘                     â”‚
â”‚  â€¢ çƒ­é—¨ä¹¦ç±é¢„ç”Ÿæˆå¤šç§éŸ³è‰²ç‰ˆæœ¬                                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 æ—¶é—´æˆ³ç´¢å¼•ä¼˜åŒ–

```typescript
// ä¼˜åŒ–çš„æ—¶é—´æˆ³ç´¢å¼•ç»“æ„
class TimestampIndex {
    // åŸå§‹æ—¶é—´æˆ³æ•°ç»„
    private timestamps: TTSTimestamp[];

    // åˆ†å—ç´¢å¼• (æ¯ 100 ä¸ªæ—¶é—´æˆ³ä¸€ä¸ªç´¢å¼•ç‚¹)
    private blockIndex: Array<{
        startTime: number;
        endTime: number;
        startIdx: number;
        endIdx: number;
    }>;

    constructor(timestamps: TTSTimestamp[]) {
        this.timestamps = timestamps;
        this.buildBlockIndex();
    }

    private buildBlockIndex() {
        const BLOCK_SIZE = 100;
        this.blockIndex = [];

        for (let i = 0; i < this.timestamps.length; i += BLOCK_SIZE) {
            const endIdx = Math.min(i + BLOCK_SIZE - 1, this.timestamps.length - 1);
            this.blockIndex.push({
                startTime: this.timestamps[i].time,
                endTime: this.timestamps[endIdx].time,
                startIdx: i,
                endIdx: endIdx
            });
        }
    }

    // O(log(n/100) + log(100)) â‰ˆ O(log n) ä½†å¸¸æ•°æ›´å°
    findCharOffset(time: number): number {
        // 1. å…ˆæ‰¾åˆ°æ‰€åœ¨å—
        const block = this.findBlock(time);
        if (!block) return this.timestamps[0].charOffset;

        // 2. åœ¨å—å†…äºŒåˆ†æŸ¥æ‰¾
        return this.binarySearchInBlock(time, block.startIdx, block.endIdx);
    }

    private findBlock(time: number) {
        // äºŒåˆ†æŸ¥æ‰¾å—
        let left = 0;
        let right = this.blockIndex.length - 1;

        while (left <= right) {
            const mid = Math.floor((left + right) / 2);
            const block = this.blockIndex[mid];

            if (time >= block.startTime && time <= block.endTime) {
                return block;
            } else if (time < block.startTime) {
                right = mid - 1;
            } else {
                left = mid + 1;
            }
        }

        return null;
    }

    private binarySearchInBlock(time: number, startIdx: number, endIdx: number): number {
        let left = startIdx;
        let right = endIdx;

        while (left < right) {
            const mid = Math.floor((left + right + 1) / 2);
            if (this.timestamps[mid].time <= time) {
                left = mid;
            } else {
                right = mid - 1;
            }
        }

        return this.timestamps[left].charOffset;
    }
}
```

---

## 10. æˆæœ¬æ§åˆ¶

### 10.1 TTS ç”Ÿæˆæˆæœ¬ä¼˜åŒ–

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æˆæœ¬ä¼˜åŒ–ç­–ç•¥                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ç­–ç•¥ 1: æŒ‰éœ€ç”Ÿæˆ                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ ç”¨æˆ·é¦–æ¬¡æ’­æ”¾ç« èŠ‚æ—¶æ‰ç”Ÿæˆ TTS                              â”‚
â”‚  â€¢ ä¸é¢„ç”Ÿæˆæ‰€æœ‰ä¹¦ç±çš„æ‰€æœ‰ç« èŠ‚                                â”‚
â”‚  â€¢ çƒ­é—¨ä¹¦ç±é™¤å¤–ï¼ˆé¢„ç”Ÿæˆæå‡ä½“éªŒï¼‰                            â”‚
â”‚                                                             â”‚
â”‚  ç­–ç•¥ 2: åˆ†å±‚æœåŠ¡å•†                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚                                                             â”‚
â”‚  å…è´¹ç”¨æˆ·:                                                   â”‚
â”‚  â”œâ”€â”€ ä½¿ç”¨ OpenAI TTS ($0.015/1Kå­—ç¬¦)                        â”‚
â”‚  â””â”€â”€ é™åˆ¶å¯é€‰éŸ³è‰²æ•°é‡ (3ä¸ª)                                 â”‚
â”‚                                                             â”‚
â”‚  ä»˜è´¹ç”¨æˆ·:                                                   â”‚
â”‚  â”œâ”€â”€ å¯é€‰ ElevenLabs é«˜è´¨é‡éŸ³è‰²                             â”‚
â”‚  â”œâ”€â”€ è§£é”æ‰€æœ‰é¢„ç½®éŸ³è‰²                                        â”‚
â”‚  â””â”€â”€ æ”¯æŒä¸ªæ€§åŒ–å£°éŸ³å…‹éš†                                      â”‚
â”‚                                                             â”‚
â”‚  ç­–ç•¥ 3: ç¼“å­˜å¤ç”¨                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ ç›¸åŒæ–‡æœ¬ + ç›¸åŒé…ç½® = 100% å¤ç”¨                          â”‚
â”‚  â€¢ çƒ­é—¨ç« èŠ‚é¢„ç”Ÿæˆï¼ŒæœåŠ¡æ‰€æœ‰ç”¨æˆ·                              â”‚
â”‚  â€¢ ç¼“å­˜å‘½ä¸­ç‡ç›®æ ‡: > 60%                                    â”‚
â”‚                                                             â”‚
â”‚  ç­–ç•¥ 4: æ–‡æœ¬ä¼˜åŒ–                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ å»é™¤é‡å¤ç©ºç™½å­—ç¬¦                                          â”‚
â”‚  â€¢ æ ‡ç‚¹ç¬¦å·ä¸è®¡è´¹å¤„ç†                                        â”‚
â”‚  â€¢ é•¿é™éŸ³æ®µè½è·³è¿‡                                            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 æˆæœ¬ä¼°ç®—æ¨¡å‹

```typescript
interface CostEstimate {
    perBookChars: number;      // å¹³å‡æ¯æœ¬ä¹¦å­—ç¬¦æ•°
    openaiCostPer1K: number;   // OpenAI æ¯ 1K å­—ç¬¦æˆæœ¬
    elevenCostPer1K: number;   // ElevenLabs æ¯ 1K å­—ç¬¦æˆæœ¬
    cacheHitRate: number;      // ç¼“å­˜å‘½ä¸­ç‡
}

function estimateMonthlyCost(
    monthlyActiveBooks: number,
    config: CostEstimate
): { openai: number; eleven: number; blended: number } {
    const totalChars = monthlyActiveBooks * config.perBookChars;
    const effectiveChars = totalChars * (1 - config.cacheHitRate);

    return {
        openai: (effectiveChars / 1000) * config.openaiCostPer1K,
        eleven: (effectiveChars / 1000) * config.elevenCostPer1K,
        // å‡è®¾ 80% ç”¨ OpenAI, 20% ç”¨ ElevenLabs
        blended: (effectiveChars / 1000) * (
            config.openaiCostPer1K * 0.8 +
            config.elevenCostPer1K * 0.2
        )
    };
}

// ç¤ºä¾‹ä¼°ç®—
const estimate = estimateMonthlyCost(1000, {
    perBookChars: 100000,     // 10ä¸‡å­—/æœ¬
    openaiCostPer1K: 0.015,
    elevenCostPer1K: 0.30,
    cacheHitRate: 0.6         // 60% ç¼“å­˜å‘½ä¸­
});

// ç»“æœ:
// - çº¯ OpenAI: $600/æœˆ
// - çº¯ ElevenLabs: $12,000/æœˆ
// - æ··åˆç­–ç•¥: $2,880/æœˆ
```

---

## 11. å®æ–½è®¡åˆ’

### 11.1 åˆ†é˜¶æ®µå®æ–½

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®æ–½è·¯çº¿å›¾                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Phase 1: åŸºç¡€ TTS æ’­æ”¾                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚  â€¢ é›†æˆ OpenAI TTS API                                      â”‚
â”‚  â€¢ å®ç°æ–‡æœ¬åˆ†æ®µå’ŒéŸ³é¢‘ç”Ÿæˆ                                    â”‚
â”‚  â€¢ åŸºç¡€æ’­æ”¾æ§åˆ¶ (æ’­æ”¾/æš‚åœ/è¯­é€Ÿ)                            â”‚
â”‚  â€¢ å¥å­çº§é«˜äº®åŒæ­¥                                            â”‚
â”‚                                                             â”‚
â”‚  Phase 2: å¤šéŸ³è‰²æ”¯æŒ                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  â€¢ éŸ³è‰²ç®¡ç†ç³»ç»Ÿ                                              â”‚
â”‚  â€¢ ç”¨æˆ·éŸ³è‰²åå¥½                                              â”‚
â”‚  â€¢ éŸ³è‰²é¢„è§ˆåŠŸèƒ½                                              â”‚
â”‚  â€¢ é›†æˆ ElevenLabs (Premium)                                â”‚
â”‚                                                             â”‚
â”‚  Phase 3: äº¤äº’å¼è·³è½¬                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  â€¢ ç‚¹å‡»æ–‡æœ¬è·³è½¬æœ—è¯»                                          â”‚
â”‚  â€¢ é€‰æ‹©æ–‡æœ¬å¿«è¿›                                              â”‚
â”‚  â€¢ å•è¯çº§é«˜äº®æ”¯æŒ                                            â”‚
â”‚  â€¢ æ€§èƒ½ä¼˜åŒ–                                                  â”‚
â”‚                                                             â”‚
â”‚  Phase 4: é«˜çº§åŠŸèƒ½                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ å¤šè§’è‰²å¯¹è¯æœ—è¯»                                            â”‚
â”‚  â€¢ ä¸ªæ€§åŒ–å£°éŸ³å…‹éš†                                            â”‚
â”‚  â€¢ ç¦»çº¿ TTS æ”¯æŒ                                             â”‚
â”‚  â€¢ Android/Web å¹³å°æ”¯æŒ                                      â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 å¼€å‘å·¥æ—¶ä¼°ç®—

| æ¨¡å— | ä»»åŠ¡ | å·¥æ—¶ |
|------|------|------|
| **åç«¯** | TTS Gateway + Adapters | 24h |
| **åç«¯** | éŸ³è‰²ç®¡ç†æœåŠ¡ | 16h |
| **åç«¯** | ç¼“å­˜æœåŠ¡ | 12h |
| **iOS** | TTSEngine æ ¸å¿ƒ | 32h |
| **iOS** | é«˜äº®åŒæ­¥ç»„ä»¶ | 24h |
| **iOS** | äº¤äº’è·³è½¬åŠŸèƒ½ | 16h |
| **iOS** | éŸ³è‰²é€‰æ‹© UI | 12h |
| **æµ‹è¯•** | å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• | 24h |
| **æ€»è®¡** | | ~160h |

---

## 12. å‚è€ƒèµ„æ–™

| èµ„æº | è¯´æ˜ |
|------|------|
| [OpenAI TTS API](https://platform.openai.com/docs/guides/text-to-speech) | å®˜æ–¹æ–‡æ¡£ |
| [ElevenLabs API](https://docs.elevenlabs.io/) | é«˜è´¨é‡ TTS |
| [Azure Speech Service](https://learn.microsoft.com/en-us/azure/ai-services/speech-service/) | ä¼ä¸šçº§ TTS |
| [AVFoundation](https://developer.apple.com/av-foundation/) | iOS éŸ³é¢‘æ¡†æ¶ |
| [Web Speech API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API) | æµè§ˆå™¨ TTS |

---

*æ–‡æ¡£åˆ›å»ºæ—¥æœŸ: 2025-12-31*
*ç‰ˆæœ¬: v1.0*
*çŠ¶æ€: è®¾è®¡å®Œæˆ*

# "æ­£åœ¨é˜…è¯»" æ•°æ®æµæ–‡æ¡£

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    æ•°æ®å­˜å‚¨æ¶æ„                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                              iOS App                                                 â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚   â”‚  â”‚   æ­£åœ¨é˜…è¯»          â”‚    â”‚   æœ€è¿‘æµè§ˆ          â”‚    â”‚   æ”¶è—ä¹¦ç±          â”‚         â”‚  â”‚
â”‚   â”‚  â”‚   (æœ¬åœ°å­˜å‚¨)        â”‚    â”‚   (æœåŠ¡å™¨)          â”‚    â”‚   (æœåŠ¡å™¨)          â”‚         â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚   â”‚            â”‚                         â”‚                         â”‚                     â”‚  â”‚
â”‚   â”‚            â–¼                         â–¼                         â–¼                     â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  â”‚
â”‚   â”‚  â”‚  Core Data         â”‚    â”‚              Backend API                   â”‚           â”‚  â”‚
â”‚   â”‚  â”‚  (æœ¬åœ°æ•°æ®åº“)       â”‚    â”‚  GET /history/books                        â”‚           â”‚  â”‚
â”‚   â”‚  â”‚                    â”‚    â”‚  GET /favorites                            â”‚           â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. æ•°æ®å­˜å‚¨åˆ†ç±»

| æ•°æ®ç±»å‹ | å­˜å‚¨ä½ç½® | è¯´æ˜ |
|----------|----------|------|
| æ­£åœ¨é˜…è¯» | ğŸ“± æœ¬åœ° (Core Data) | åªå­˜å‚¨ä¸€æœ¬ä¹¦ï¼Œæ–°é˜…è¯»ä¼šæ›¿æ¢æ—§çš„ |
| é˜…è¯»è¿›åº¦ | ğŸ“± æœ¬åœ° (Core Data) | æ‰€æœ‰ä¹¦ç±çš„é˜…è¯»ä½ç½®éƒ½åœ¨æœ¬åœ° |
| æœ€è¿‘æµè§ˆ | â˜ï¸ æœåŠ¡å™¨ | `GET /history/books` |
| æ”¶è—ä¹¦ç± | â˜ï¸ æœåŠ¡å™¨ | `GET /favorites` |

---

## 2. ç°æœ‰åŸºç¡€è®¾æ–½

| ç»„ä»¶ | æ–‡ä»¶ | è¯´æ˜ |
|-----|------|-----|
| BookmarkManager | `Core/Services/BookmarkManager.swift` | å·²æœ‰ UserDefaults å­˜å‚¨æœºåˆ¶ |
| ReadingPosition | `Core/Models/Bookmark.swift` | å·²å®šä¹‰ä½ç½®æ¨¡å‹ |
| ReaderViewModel | `Features/Reader/ReaderViewModel.swift` | é˜…è¯»å™¨çŠ¶æ€ç®¡ç† |

---

## 3. æœ¬åœ°å­˜å‚¨: æ­£åœ¨é˜…è¯» + é˜…è¯»è¿›åº¦

### æ•°æ®ç»“æ„

```
CurrentlyReading (Core Data Entity)
â”œâ”€â”€ bookId: String
â”œâ”€â”€ bookJson: Data           // Book å¯¹è±¡åºåˆ—åŒ–å­˜å‚¨
â”œâ”€â”€ currentChapter: Int
â”œâ”€â”€ scrollPosition: Double   // 0.0 - 1.0
â””â”€â”€ lastReadAt: Date

BookReadingProgress (Core Data Entity)
â”œâ”€â”€ bookId: String (Primary Key)
â”œâ”€â”€ chapterId: String
â”œâ”€â”€ currentChapter: Int
â”œâ”€â”€ scrollPosition: Double   // 0.0 - 1.0
â”œâ”€â”€ currentPage: Int
â”œâ”€â”€ totalPages: Int
â””â”€â”€ lastReadAt: Date
```

### å­˜å‚¨æ–¹æ¡ˆ: Core Data

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Core Data å­˜å‚¨æ–¹æ¡ˆ                                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                             â”‚
â”‚ Entity: CurrentlyReading                                                                    â”‚
â”‚   - åªå­˜å‚¨ä¸€æ¡è®°å½•ï¼Œè¡¨ç¤ºå½“å‰æ­£åœ¨é˜…è¯»çš„ä¹¦                                                       â”‚
â”‚   - æ–°é˜…è¯»ä¼šæ›¿æ¢æ—§è®°å½•                                                                       â”‚
â”‚                                                                                             â”‚
â”‚ Entity: BookReadingProgress                                                                 â”‚
â”‚   - æ¯æœ¬ä¹¦ä¸€æ¡è®°å½•                                                                           â”‚
â”‚   - bookId ä½œä¸ºä¸»é”®                                                                         â”‚
â”‚   - æ”¯æŒå¤æ‚æŸ¥è¯¢å’Œç´¢å¼•                                                                       â”‚
â”‚                                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. æ•°æ®æµ: å†™å…¥

### åœºæ™¯ A: ç”¨æˆ·å¼€å§‹é˜…è¯»ä¸€æœ¬ä¹¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç‚¹å‡» "å¼€å§‹é˜…è¯»" æˆ–ç‚¹å‡» "æ­£åœ¨é˜…è¯»" å¡ç‰‡                                                    â”‚
â”‚           â”‚                                                                                 â”‚
â”‚           â–¼                                                                                 â”‚
â”‚ æ‰“å¼€é˜…è¯»å™¨ (EnhancedReaderView)                                                              â”‚
â”‚           â”‚                                                                                 â”‚
â”‚           â–¼                                                                                 â”‚
â”‚ ä» Core Data åŠ è½½è¯¥ä¹¦çš„é˜…è¯»è¿›åº¦ (å¦‚æœæœ‰)                                                      â”‚
â”‚   - currentChapter                                                                         â”‚
â”‚   - scrollPosition                                                                         â”‚
â”‚           â”‚                                                                                 â”‚
â”‚           â–¼                                                                                 â”‚
â”‚ æ¢å¤åˆ°ä¸Šæ¬¡é˜…è¯»ä½ç½®                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœºæ™¯ B: ç”¨æˆ·é˜…è¯»è¿‡ç¨‹ä¸­ (æ»‘åŠ¨é¡µé¢) [æš‚ä¸å®ç°]

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æ»‘åŠ¨é¡µé¢                                                                                â”‚
â”‚           â”‚                                                                                 â”‚
â”‚           â–¼                                                                                 â”‚
â”‚ ğŸ“± æœ¬åœ°æ›´æ–°: currentChapter, scrollPosition                                                â”‚
â”‚   (é˜²æŠ–: 2ç§’å†…åªä¿å­˜ä¸€æ¬¡)                                                                    â”‚
â”‚           â”‚                                                                                 â”‚
â”‚           â–¼                                                                                 â”‚
â”‚ ğŸ“± æ›´æ–° "æ­£åœ¨é˜…è¯»" ä¸ºå½“å‰ä¹¦ç±                                                                â”‚
â”‚   (æ›¿æ¢ä¹‹å‰çš„ "æ­£åœ¨é˜…è¯»")                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœºæ™¯ C: å…³é—­é˜…è¯»å™¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·å…³é—­é˜…è¯»å™¨                                                                              â”‚
â”‚           â”‚                                                                                 â”‚
â”‚           â–¼                                                                                 â”‚
â”‚ ğŸ“± ä¿å­˜æœ€ç»ˆé˜…è¯»ä½ç½®åˆ° Core Data                                                              â”‚
â”‚   - BookReadingProgress[bookId]                                                            â”‚
â”‚   - CurrentlyReading = å½“å‰ä¹¦ç±                                                             â”‚
â”‚           â”‚                                                                                 â”‚
â”‚           â–¼                                                                                 â”‚
â”‚ â˜ï¸ API: POST /reading/sessions (å¯é€‰: è®°å½•é˜…è¯»æ—¶é•¿ç»Ÿè®¡)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¿å­˜æ—¶æœº

| æ—¶æœº | çŠ¶æ€ | è¯´æ˜ |
|-----|------|------|
| é€€å‡ºé˜…è¯»å™¨ | âœ… æ”¯æŒ | ç”¨æˆ·ä¸»åŠ¨å…³é—­é˜…è¯»ç•Œé¢ |
| App è¿›å…¥åå° | âœ… æ”¯æŒ | é˜²æ­¢æ„å¤–å…³é—­å¯¼è‡´è¿›åº¦ä¸¢å¤± |
| ç¿»é¡µ | â³ æš‚ä¸å®ç° | ç”¨æˆ·æ˜ç¡®çš„ä½ç½®å˜æ›´ |
| ç« èŠ‚åˆ‡æ¢ | â³ æš‚ä¸å®ç° | é‡è¦ä½ç½®èŠ‚ç‚¹ |
| æ»šåŠ¨åœæ­¢ | â³ æš‚ä¸å®ç° | éœ€é˜²æŠ–å¤„ç†é¿å…é¢‘ç¹å†™å…¥ |

---

## 5. æ•°æ®æµ: è¯»å–

### ä¹¦æ¶ Tab åŠ è½½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              LibraryView åŠ è½½                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                             â”‚
â”‚   loadInitialData()                                                                         â”‚
â”‚         â”‚                                                                                   â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚         â”‚                          â”‚                          â”‚                             â”‚
â”‚         â–¼                          â–¼                          â–¼                             â”‚
â”‚   ğŸ“± Core Data è¯»å–           â˜ï¸ API è¯·æ±‚                â˜ï¸ API è¯·æ±‚                       â”‚
â”‚   CurrentlyReading            GET /history/books         GET /favorites                    â”‚
â”‚         â”‚                          â”‚                          â”‚                             â”‚
â”‚         â–¼                          â–¼                          â–¼                             â”‚
â”‚   æ­£åœ¨é˜…è¯»å¡ç‰‡              æœ€è¿‘æµè§ˆåˆ—è¡¨              æ”¶è—ä¹¦ç±ç½‘æ ¼                          â”‚
â”‚   (1æœ¬ä¹¦)                  (æ°´å¹³æ»šåŠ¨)                (3åˆ—ç½‘æ ¼)                             â”‚
â”‚                                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¢å¤é˜…è¯»ä½ç½®

```
æ‰“å¼€ä¹¦ç±
    â”‚
    â–¼
æŸ¥è¯¢ Core Data: BookReadingProgress[bookId]
    â”‚
    â”œâ”€â”€â”€ æœ‰è®°å½• â”€â”€â”€â–º è·³è½¬åˆ°è®°å½•çš„ç« èŠ‚å’Œä½ç½®
    â”‚
    â””â”€â”€â”€ æ— è®°å½• â”€â”€â”€â–º ä»ç¬¬ä¸€ç« å¼€å§‹
```

### API è°ƒç”¨é¢‘ç‡

| è§¦å‘æ—¶æœº | æ•°æ®æº | è¯´æ˜ |
|----------|--------|------|
| LibraryView åŠ è½½ | ğŸ“± Core Data | è¯»å– "æ­£åœ¨é˜…è¯»" |
| LibraryView åŠ è½½ | â˜ï¸ `GET /history/books` | æœ€è¿‘æµè§ˆ |
| LibraryView åŠ è½½ | â˜ï¸ `GET /favorites` | æ”¶è—ä¹¦ç± |

---

## 6. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

| ä¼˜åŒ–ç‚¹ | æ–¹æ¡ˆ |
|-------|------|
| å†™å…¥é¢‘ç‡ | ä»…åœ¨é€€å‡º/åå°æ—¶å†™å…¥ï¼Œæœ€å°åŒ–IO |
| å­˜å‚¨å¤§å° | åªå­˜å¿…è¦å­—æ®µï¼ˆçº¦100å­—èŠ‚/ä¹¦ï¼‰ |
| å­˜å‚¨ä»‹è´¨ | Core Dataï¼ˆæ”¯æŒç´¢å¼•å’Œé«˜æ•ˆæŸ¥è¯¢ï¼‰ |
| è¯»å–æ€§èƒ½ | å†…å­˜ç¼“å­˜ + æŒ‰éœ€åŠ è½½ |
| å­˜å‚¨ä¸Šé™ | æœ€å¤šä¿ç•™100æœ¬ä¹¦çš„è®°å½•ï¼ŒLRUæ·˜æ±° |

---

## 7. ä¸ç°æœ‰ç³»ç»Ÿçš„å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ReaderViewModel                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ æœ¬åœ°ä¿å­˜ (æ–°)   â”‚    â”‚ æœåŠ¡å™¨åŒæ­¥ (ç°æœ‰) â”‚         â”‚
â”‚  â”‚ ReadingProgress â”‚    â”‚ saveProgress()  â”‚         â”‚
â”‚  â”‚ Store          â”‚    â”‚ (å¯é€‰/åœ¨çº¿æ—¶)    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚          â”‚                      â”‚                  â”‚
â”‚          â–¼                      â–¼                  â”‚
â”‚    Core Data               API Server            â”‚
â”‚   (å§‹ç»ˆå¯ç”¨)                 (éœ€è¦ç½‘ç»œ)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. å±•ç¤ºé€»è¾‘

### æ­£åœ¨é˜…è¯»å¡ç‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å±•ç¤ºæ¡ä»¶:                                                                                    â”‚
â”‚   âœ“ Core Data ä¸­çš„ CurrentlyReading ä¸ä¸ºç©º                                                   â”‚
â”‚                                                                                             â”‚
â”‚ ç‚¹å‡»è¡Œä¸º:                                                                                    â”‚
â”‚   â†’ ç‚¹å‡»çƒ­åŒº: æ•´ä¸ªå¡ç‰‡                                                                       â”‚
â”‚   â†’ ç›´æ¥æ‰“å¼€é˜…è¯»å™¨ (EnhancedReaderView)                                                      â”‚
â”‚   â†’ è‡ªåŠ¨æ¢å¤åˆ°ä¸Šæ¬¡é˜…è¯»ä½ç½® (chapter + scrollPosition)                                        â”‚
â”‚                                                                                             â”‚
â”‚ æ›´æ–°è§„åˆ™:                                                                                    â”‚
â”‚   â†’ ä»»ä½•ä¹¦ç±è¢«é˜…è¯»åï¼Œéƒ½ä¼šæˆä¸ºæ–°çš„ "æ­£åœ¨é˜…è¯»"                                                 â”‚
â”‚   â†’ åªä¿ç•™æœ€è¿‘é˜…è¯»çš„ä¸€æœ¬ä¹¦                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¡ç‰‡è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­£åœ¨é˜…è¯»                                             â† ç‚¹å‡»çƒ­åŒº: æ•´ä¸ªå¡ç‰‡                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  ä¸‰ä½“                                                                            â”‚
â”‚ â”‚ Cover  â”‚  åˆ˜æ…ˆæ¬£                                                                          â”‚
â”‚ â”‚        â”‚                                                                                  â”‚
â”‚ â”‚        â”‚  ç¬¬ 3 ç«  / å…± 15 ç«                                                               â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                                                       â”‚
â”‚                                                                                             â”‚
â”‚             [ç»§ç»­é˜…è¯»]  â† ç‚¹å‡»æ‰“å¼€é˜…è¯»å™¨ï¼Œæ¢å¤ä½ç½®                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. å®ç°è¦ç‚¹

### éœ€è¦åˆ›å»ºçš„æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `ReadingProgressStore.swift` | Core Data æœ¬åœ°å­˜å‚¨ç®¡ç†å™¨ |
| `ReadingProgress.xcdatamodeld` | Core Data æ¨¡å‹å®šä¹‰ |

### ReadingProgressStore æ¥å£è®¾è®¡

```
@MainActor
class ReadingProgressStore: ObservableObject {
    static let shared = ReadingProgressStore()

    @Published var currentlyReading: CurrentlyReading?

    // è·å–å½“å‰é˜…è¯»çš„ä¹¦
    func getCurrentlyReading() -> CurrentlyReading?

    // æ›´æ–°æ­£åœ¨é˜…è¯» (é˜…è¯»ä»»ä½•ä¹¦æ—¶è°ƒç”¨)
    func setCurrentlyReading(book: Book, chapter: Int, position: Double)

    // è·å–æŸæœ¬ä¹¦çš„é˜…è¯»è¿›åº¦
    func getProgress(for bookId: String) -> BookReadingProgress?

    // ä¿å­˜é˜…è¯»è¿›åº¦
    func saveProgress(bookId: String, chapter: Int, position: Double)
}
```

### å®ç°æ­¥éª¤

| æ­¥éª¤ | å†…å®¹ |
|-----|------|
| 1 | åˆ›å»º Core Data æ¨¡å‹ `ReadingProgress.xcdatamodeld` |
| 2 | åˆ›å»º `ReadingProgressStore` å•ä¾‹ç±» |
| 3 | åœ¨ `ReaderViewModel` ä¸­é›†æˆæœ¬åœ°ä¿å­˜é€»è¾‘ |
| 4 | åœ¨æ‰“å¼€ä¹¦ç±æ—¶æ¢å¤é˜…è¯»ä½ç½® |
| 5 | æ·»åŠ  App ç”Ÿå‘½å‘¨æœŸç›‘å¬ï¼ˆè¿›å…¥åå°æ—¶ä¿å­˜ï¼‰ |

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|----------|
| `LibraryView.swift` | ä» Core Data è¯»å– "æ­£åœ¨é˜…è¯»"ï¼Œç‚¹å‡»æ•´ä¸ªå¡ç‰‡ç›´æ¥æ‰“å¼€é˜…è¯»å™¨ |
| `ReaderViewModel.swift` | ä¿å­˜/æ¢å¤é˜…è¯»è¿›åº¦åˆ° Core Data |
| `BookDetailView.swift` | ç§»é™¤ API addToLibrary è°ƒç”¨ (å¼€å§‹é˜…è¯»æ—¶) |
| `EnhancedReaderView.swift` | ç›‘å¬é€€å‡ºäº‹ä»¶ï¼Œä¿å­˜è¿›åº¦ |

---

## 10. æ•°æ®è¿ç§»è¯´æ˜

å½“å‰ `user_books` è¡¨ä¸­çš„ä»¥ä¸‹å­—æ®µå°†ä¸å†ä½¿ç”¨:
- `current_chapter` â†’ è¿ç§»åˆ°æœ¬åœ° Core Data
- `progress_percent` â†’ è¿ç§»åˆ°æœ¬åœ° Core Data
- `status` â†’ "READING" çŠ¶æ€ç”±æœ¬åœ° CurrentlyReading å†³å®š

æœåŠ¡å™¨ç«¯ `user_books` è¡¨ä»…ç”¨äº:
- è®°å½•ç”¨æˆ·æ›¾ç»é˜…è¯»è¿‡çš„ä¹¦ç± (å†å²è®°å½•)
- é˜…è¯»æ—¶é•¿ç»Ÿè®¡ (`total_reading_minutes`)

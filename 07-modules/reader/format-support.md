# 阅读器格式支持

> 本文档描述 Readmigo 阅读器支持的电子书格式、技术特点及功能对比。

---

## 当前支持状态

```
当前支持:
├── EPUB2     ✅ 完全支持
│   ├── HTML/XHTML 内容渲染
│   ├── CSS 样式
│   ├── 图片嵌入
│   ├── 目录导航 (NCX)
│   └── 基础元数据
│
├── EPUB3     ✅ 基础支持 (不含音视频)
│   ├── HTML5 内容
│   ├── CSS3 样式
│   ├── 导航文档 (NAV)
│   └── 增强元数据
│
└── EPUB 功能支持详情:
    ├── 内容渲染    ████████████████ 95%
    ├── 主题切换    ████████████████ 95%
    ├── 字体调整    ████████████░░░░ 70%
    ├── 目录导航    ████████████████ 95%
    ├── 进度追踪    ████████████████ 95%
    ├── 文字选择    ████████████████ 90%
    ├── AI 集成     ████████████████ 95%
    └── 音视频      ░░░░░░░░░░░░░░░░  0%

未支持:
├── PDF       ❌ 未实现
│   └── 需要: PDFKit 或 PSPDFKit 集成
│
├── TXT       ❌ 未实现
│   └── 需要: 简单文本解析器
│
├── MOBI      ❌ 未实现
│   └── 需要: 格式解析库或转换服务
│
├── DJVU      ❌ 未实现
│   └── 需要: 专用解析库
│
└── 用户上传   ⚠️ 基础设施就绪
    └── 需要: 上传界面、格式验证

书籍来源:
├── Standard Ebooks  ✅ 已实现
│   └── API 集成，高质量 EPUB
│
├── Project Gutenberg ✅ 已实现
│   └── API 集成，EPUB 下载
│
├── Internet Archive  ⚠️ 基础设施就绪
│   └── 需要: 借阅 API 集成
│
├── 用户上传书籍     ✅ 已实现 (iOS)
│   └── 支持本地 EPUB 导入
│
└── 第三方书库      ❌ 未计划
```

---

## 格式详细说明

### 1. EPUB (Electronic Publication)

**版本说明:**
- **EPUB2** (2007): 基础标准，广泛支持
- **EPUB3** (2011): 支持 HTML5、CSS3、JavaScript、音视频

**技术特点:**
```
EPUB 文件结构:
├── mimetype                 # 固定内容 "application/epub+zip"
├── META-INF/
│   └── container.xml        # 指向 content.opf
└── OEBPS/
    ├── content.opf          # 包清单、元数据、书脊顺序
    ├── toc.ncx              # EPUB2 目录
    ├── nav.xhtml            # EPUB3 导航文档
    ├── chapter1.xhtml       # 章节内容
    ├── chapter2.xhtml
    ├── styles/
    │   └── main.css         # 样式表
    └── images/
        └── cover.jpg        # 封面图片
```

**优势:**
- ✅ 开放标准 (IDPF/W3C)
- ✅ 文本可重排，适应不同屏幕
- ✅ 支持字体嵌入
- ✅ 语义化结构 (HTML5)
- ✅ 辅助功能支持 (ARIA)
- ✅ 元数据丰富 (Dublin Core)

**劣势:**
- ❌ 复杂排版可能丢失
- ❌ 音视频支持依赖阅读器
- ❌ DRM 实现不统一

**阅读体验:** ⭐⭐⭐⭐⭐ (最佳)

---

### 2. PDF (Portable Document Format)

**技术特点:**
- 固定版式，保留原书排版
- 基于 PostScript 的矢量格式
- 支持字体嵌入、图形、表格
- 文件大小通常较大

**优势:**
- ✅ 精确还原原书排版
- ✅ 学术文献标准格式
- ✅ 打印友好
- ✅ 跨平台一致性
- ✅ 支持注释和表单

**劣势:**
- ❌ 小屏幕阅读体验差
- ❌ 文字重排困难
- ❌ 扫描版 OCR 质量不一
- ❌ 文件体积较大

**阅读体验:** ⭐⭐⭐ (中等，小屏设备体验差)

**扫描 PDF vs 原生 PDF:**
| 类型 | 文字选择 | 搜索 | 文件大小 | 质量 |
|------|---------|------|---------|------|
| 原生 PDF | ✅ | ✅ | 较小 | 高 |
| 扫描 PDF | ⚠️ OCR | ⚠️ OCR | 较大 | 依赖扫描 |

---

### 3. TXT (Plain Text)

**技术特点:**
- 纯文本，无格式标记
- 文件体积最小
- 编码问题 (UTF-8, ASCII, Latin-1)

**优势:**
- ✅ 通用性最强
- ✅ 文件极小
- ✅ 无依赖
- ✅ 易于处理和转换

**劣势:**
- ❌ 无格式、无章节标记
- ❌ 无图片支持
- ❌ 无目录导航
- ❌ 阅读体验较差

**阅读体验:** ⭐⭐ (基础)

---

### 4. HTML (HyperText Markup Language)

**技术特点:**
- 网页格式，在线阅读
- 支持富媒体
- 需要联网或本地服务器

**优势:**
- ✅ 浏览器直接阅读
- ✅ 富媒体支持
- ✅ 响应式布局
- ✅ 链接和交互

**劣势:**
- ❌ 通常需要联网
- ❌ 离线保存复杂
- ❌ 分页不标准

**阅读体验:** ⭐⭐⭐⭐ (良好，依赖实现)

---

### 5. MOBI / AZW (Amazon Kindle)

**技术特点:**
- Amazon 专有格式
- 基于 Palm DOC 和 HTML
- AZW3 (KF8) 支持更多 CSS

**优势:**
- ✅ Kindle 设备原生支持
- ✅ 文本可重排
- ✅ X-Ray、Whispersync 功能

**劣势:**
- ❌ 专有格式，封闭生态
- ❌ 非 Kindle 设备支持有限
- ❌ 格式转换可能丢失样式

**阅读体验:** ⭐⭐⭐ (Kindle 设备上良好)

---

### 6. FB2 (FictionBook)

**技术特点:**
- XML 格式，俄语世界流行
- 结构化标记
- 支持元数据和书签

**优势:**
- ✅ 结构清晰
- ✅ 元数据丰富
- ✅ 易于转换

**劣势:**
- ❌ 主要在俄语区使用
- ❌ 西方阅读器支持有限
- ❌ 图片处理方式特殊

**阅读体验:** ⭐⭐⭐ (中等)

---

### 7. DJVU (DjVu)

**技术特点:**
- 扫描文档压缩格式
- 层分离技术（文字层、背景层）
- 比 PDF 压缩率更高

**优势:**
- ✅ 压缩率高
- ✅ 适合扫描书籍
- ✅ 支持 OCR 文字层

**劣势:**
- ❌ 阅读器支持有限
- ❌ 主要用于学术扫描
- ❌ 小屏体验差

**阅读体验:** ⭐⭐ (专用场景)

---

### 8. CBZ/CBR (Comic Book Archive)

**技术特点:**
- ZIP/RAR 压缩的图片集合
- 用于漫画和图像书籍
- 无文字内容（纯图片）

**优势:**
- ✅ 漫画阅读标准格式
- ✅ 简单直接
- ✅ 图片质量保留

**劣势:**
- ❌ 纯图片，无文字搜索
- ❌ 文件较大
- ❌ 不适合文字书籍

**阅读体验:** ⭐⭐⭐ (漫画专用)

---

## 格式功能对比矩阵

| 功能 | EPUB3 | EPUB2 | PDF | TXT | HTML | MOBI | FB2 | DJVU | CBZ |
|------|:-----:|:-----:|:---:|:---:|:----:|:----:|:---:|:----:|:---:|
| **文本重排** | ✅ | ✅ | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ |
| **字体调整** | ✅ | ✅ | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ |
| **主题切换** | ✅ | ✅ | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ |
| **文字选择** | ✅ | ✅ | ⚠️ | ✅ | ✅ | ✅ | ✅ | ⚠️ | ❌ |
| **全文搜索** | ✅ | ✅ | ⚠️ | ✅ | ✅ | ✅ | ✅ | ⚠️ | ❌ |
| **内嵌图片** | ✅ | ✅ | ✅ | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **音频支持** | ✅ | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ |
| **视频支持** | ✅ | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ |
| **MathML 公式** | ✅ | ❌ | ✅ | ❌ | ✅ | ❌ | ❌ | ⚠️ | ❌ |
| **SVG 矢量图** | ✅ | ⚠️ | ✅ | ❌ | ✅ | ⚠️ | ⚠️ | ❌ | ❌ |
| **交互内容** | ✅ | ❌ | ⚠️ | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ |
| **语义结构** | ✅ | ✅ | ❌ | ❌ | ✅ | ⚠️ | ✅ | ❌ | ❌ |
| **目录导航** | ✅ | ✅ | ✅ | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ |
| **书签支持** | ✅ | ✅ | ✅ | ⚠️ | ⚠️ | ✅ | ✅ | ⚠️ | ⚠️ |
| **注释批注** | ✅ | ✅ | ✅ | ❌ | ⚠️ | ⚠️ | ⚠️ | ⚠️ | ❌ |

**图例:** ✅ 完全支持 | ⚠️ 部分/依赖实现 | ❌ 不支持

---

## 格式支持优先级

### 高优先级 (P0)

1. **PDF 支持**
   - 理由: 学术文献和扫描书籍的标准格式
   - 技术方案: PDFKit (系统) 或 PSPDFKit (商业)

2. **离线阅读**
   - 理由: 用户核心需求，无网络时可阅读
   - 技术方案: CoreData + FileManager 缓存

### 中优先级 (P1)

3. **TXT 支持**
   - 理由: 简单格式，部分公版书仅提供 TXT
   - 技术方案: 简单解析器 + 分章算法

### 低优先级 (P2)

4. **MOBI 支持**
   - 理由: Kindle 用户迁移需求
   - 技术方案: 服务端转换为 EPUB

5. **有声书支持**
   - 理由: 扩展内容形态
   - 技术方案: AVFoundation 音频播放

---

## PDF 渲染方案对比

| 方案 | 优点 | 缺点 | 成本 |
|------|------|------|------|
| PDFKit (系统) | 免费、原生 | 功能有限、定制性差 | 免费 |
| PSPDFKit | 功能强大、体验好 | 价格高 | $$$$ |
| MuPDF | 开源、轻量 | 需要集成、维护成本 | 免费 |
| WKWebView (PDF.js) | 跨平台 | 性能一般 | 免费 |

**推荐:** 先用 PDFKit 实现基础功能，后续可升级 PSPDFKit

---

## 相关文档

- [竞品分析](../../00-market/competitive/reader-apps.md) - 与商业阅读器对比
- [渲染引擎](./rendering-engine.md) - 多格式渲染引擎设计
- [阅读器架构](./architecture.md) - 核心架构设计
- [EPUB 架构](./epub-architecture.md) - EPUB 解析实现

---

*最后更新: 2025-12-28*

# MOBI/AZW3 æ ¼å¼ç”µå­ä¹¦å¯¼å…¥è¯¦ç»†è®¾è®¡æ–‡æ¡£

> æ–‡æ¡£ç‰ˆæœ¬: v1.0
> åˆ›å»ºæ—¥æœŸ: 2025-12-28
> çŠ¶æ€: å·²å®ç°

---

## ç›®å½•

1. [æ¦‚è¿°](#ä¸€æ¦‚è¿°)
2. [æ ¼å¼æŠ€æœ¯åˆ†æ](#äºŒæ ¼å¼æŠ€æœ¯åˆ†æ)
3. [æŠ€æœ¯æ–¹æ¡ˆé€‰å‹](#ä¸‰æŠ€æœ¯æ–¹æ¡ˆé€‰å‹)
4. [åç«¯å®ç°è®¾è®¡](#å››åç«¯å®ç°è®¾è®¡)
5. [iOS å®¢æˆ·ç«¯é€‚é…](#äº”ios-å®¢æˆ·ç«¯é€‚é…)
6. [API è®¾è®¡](#å…­api-è®¾è®¡)
7. [è§£ææµç¨‹è¯¦è§£](#ä¸ƒè§£ææµç¨‹è¯¦è§£)
8. [é”™è¯¯å¤„ç†ç­–ç•¥](#å…«é”™è¯¯å¤„ç†ç­–ç•¥)
9. [æ€§èƒ½ä¼˜åŒ–](#ä¹æ€§èƒ½ä¼˜åŒ–)
10. [æµ‹è¯•ç­–ç•¥](#åæµ‹è¯•ç­–ç•¥)
11. [éƒ¨ç½²ä¸è¿ç»´](#åä¸€éƒ¨ç½²ä¸è¿ç»´)
12. [é™„å½•](#åäºŒé™„å½•)

---

## ä¸€ã€æ¦‚è¿°

### 1.1 èƒŒæ™¯

MOBI å’Œ AZW3 æ˜¯ Amazon Kindle è®¾å¤‡ä½¿ç”¨çš„ä¸“æœ‰ç”µå­ä¹¦æ ¼å¼ã€‚è®¸å¤šç”¨æˆ·æ‹¥æœ‰å¤§é‡ Kindle æ ¼å¼çš„ç”µå­ä¹¦ï¼Œå¸Œæœ›èƒ½å¤Ÿåœ¨ Readmigo ä¸­é˜…è¯»è¿™äº›ä¹¦ç±å¹¶ä½¿ç”¨ AI è¾…åŠ©åŠŸèƒ½ã€‚

### 1.2 ç›®æ ‡

- æ”¯æŒç”¨æˆ·å¯¼å…¥ MOBIã€AZWã€AZW3 æ ¼å¼çš„ç”µå­ä¹¦
- ä¿æŒä¸ç°æœ‰ EPUB å¯¼å…¥æµç¨‹ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒ
- å®ç°å®Œæ•´çš„å…ƒæ•°æ®æå–å’Œç« èŠ‚è§£æ
- æ”¯æŒä¸å¹³å°ä¹¦ç±ç›¸åŒçš„é˜…è¯»å™¨åŠŸèƒ½

### 1.3 èŒƒå›´

| é¡¹ç›® | åŒ…å« | ä¸åŒ…å« |
|-----|------|--------|
| æ–‡ä»¶æ ¼å¼ | MOBI, AZW, AZW3 | KFX (Kindle Format 10) |
| DRM | æ—  DRM ä¿æŠ¤çš„ä¹¦ç± | DRM åŠ å¯†ä¹¦ç± |
| å†…å®¹ç±»å‹ | æ–‡æœ¬ä¹¦ç± | æ‚å¿—ã€æ¼«ç”»ç­‰å›ºå®šå¸ƒå±€ |

### 1.4 å½“å‰å®ç°çŠ¶æ€

| æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|-----|------|------|
| åç«¯ MOBI è§£æå™¨ | âœ… å·²å®Œæˆ | `scripts/book-ingestion/processors/mobi-parser.ts` |
| iOS å®¢æˆ·ç«¯æ”¯æŒ | âœ… å·²å®Œæˆ | MIME ç±»å‹ã€æ–‡ä»¶é€‰æ‹©å™¨å·²æ›´æ–° |
| æ ¼å¼è½¬æ¢ | âœ… å·²å®Œæˆ | Calibre ebook-convert é›†æˆ |
| å›é€€è§£æ | âœ… å·²å®Œæˆ | åŸºç¡€å…ƒæ•°æ®æå– |

---

## äºŒã€æ ¼å¼æŠ€æœ¯åˆ†æ

### 2.1 MOBI æ ¼å¼æ¦‚è¿°

MOBI (Mobipocket) æ˜¯åŸºäº PalmDOC æ•°æ®åº“æ ¼å¼çš„ç”µå­ä¹¦æ ¼å¼ï¼Œç”± Mobipocket SA å¼€å‘ï¼Œåè¢« Amazon æ”¶è´­ã€‚

```
MOBI æ–‡ä»¶ç»“æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PDB Header (78 bytes)        â”‚  â† æ•°æ®åº“å¤´ï¼ŒåŒ…å«åŸºæœ¬ä¿¡æ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Record Info List (8 Ã— N)        â”‚  â† è®°å½•ç´¢å¼•è¡¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        PalmDOC Header (16 bytes)     â”‚  â† å‹ç¼©ä¿¡æ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         MOBI Header (â‰¥232 bytes)     â”‚  â† æ ¼å¼ç‰ˆæœ¬ã€ç¼–ç ç­‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      EXTH Header (Optional)          â”‚  â† æ‰©å±•å…ƒæ•°æ®ï¼ˆä½œè€…ã€æè¿°ç­‰ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Text Records                 â”‚  â† å‹ç¼©çš„æ–‡æœ¬å†…å®¹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Image Records                â”‚  â† å›¾ç‰‡èµ„æº
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Other Records               â”‚  â† å…¶ä»–èµ„æºï¼ˆå­—ä½“ç­‰ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 AZW3/KF8 æ ¼å¼æ¦‚è¿°

AZW3 (ä¹Ÿç§°ä¸º KF8 - Kindle Format 8) æ˜¯ Amazon æ¨å‡ºçš„å¢å¼ºæ ¼å¼ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå®¹å™¨æ–‡ä»¶ï¼š

```
AZW3 æ–‡ä»¶ç»“æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       PDB/MOBI Container             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚       RESC Section          â”‚  â”‚  â† èµ„æºéƒ¨åˆ†
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚    â”‚  â”‚   EPUB-like Content â”‚   â”‚  â”‚  â† ç±»ä¼¼ EPUB çš„ HTML/CSS
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 å…³é”®æŠ€æœ¯å‚æ•°

| å‚æ•° | MOBI | AZW3 |
|-----|------|------|
| æ–‡ä»¶æ ‡è¯†ç¬¦ | `BOOKMOBI` / `TEXtREAd` | `BOOKMOBI` + KF8 æ ‡è®° |
| å‹ç¼©æ–¹å¼ | PalmDOC (LZ77 å˜ä½“) | æ— å‹ç¼© / PalmDOC |
| HTML ç‰ˆæœ¬ | åŸºç¡€ HTML | HTML5 + CSS3 |
| å›¾ç‰‡æ ¼å¼ | JPEG, GIF | JPEG, GIF, PNG |
| æœ€å¤§æ–‡ä»¶å¤§å° | æ— é™åˆ¶ | æ— é™åˆ¶ |
| DRM æ”¯æŒ | Mobipocket DRM | Amazon DRM (ADEPT) |

### 2.4 EXTH è®°å½•ç±»å‹ï¼ˆå…ƒæ•°æ®ï¼‰

---

## ä¸‰ã€æŠ€æœ¯æ–¹æ¡ˆé€‰å‹

### 3.1 æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | æè¿° | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|-----|------|------|------|--------|
| **Calibre è½¬æ¢** | ä½¿ç”¨ Calibre è½¬ EPUB | å®Œæ•´æ”¯æŒã€ç¨³å®šå¯é  | éœ€å®‰è£…ä¾èµ– | â˜…â˜…â˜…â˜…â˜… |
| **çº¯ JS è§£æ** | è‡ªç ” MOBI è§£æå™¨ | æ— å¤–éƒ¨ä¾èµ– | å¼€å‘æˆæœ¬é«˜ã€å…¼å®¹æ€§å·® | â˜…â˜…â˜†â˜†â˜† |
| **KindleUnpack** | Python åº“è§£åŒ… | åŠŸèƒ½å®Œæ•´ | Python ä¾èµ–ã€æ€§èƒ½ä¸€èˆ¬ | â˜…â˜…â˜…â˜†â˜† |
| **mobi-js** | npm åº“è§£æ | æ˜“é›†æˆ | åŠŸèƒ½æœ‰é™ã€ä¸æ´»è·ƒ | â˜…â˜…â˜†â˜†â˜† |

### 3.2 æœ€ç»ˆæ–¹æ¡ˆï¼šCalibre è½¬æ¢ + å›é€€è§£æ

```mermaid
flowchart TD
    Input["MOBI/AZW3 æ–‡ä»¶è¾“å…¥"] --> Check{"æ£€æµ‹ Calibre<br>æ˜¯å¦å¯ç”¨"}
    Check -->|"å¯ç”¨"| Convert["ebook-convert<br>MOBI â†’ EPUB"]
    Check -->|"ä¸å¯ç”¨"| Fallback["å›é€€è§£æå™¨<br>åŸºç¡€å…ƒæ•°æ®æå–"]
    Convert --> EPUBParser["å¤ç”¨ EPUB è§£æå™¨<br>æå–å®Œæ•´å†…å®¹"]
    EPUBParser --> Result["è¿”å› ParsedBook"]
    Fallback --> Result
```

### 3.3 æ–¹æ¡ˆä¼˜åŠ¿

1. **å®Œæ•´æ€§**: Calibre æ˜¯ä¸šç•Œæœ€æˆç†Ÿçš„ç”µå­ä¹¦è½¬æ¢å·¥å…·ï¼Œæ”¯æŒå‡ ä¹æ‰€æœ‰è¾¹ç¼˜æƒ…å†µ
2. **å¯ç»´æŠ¤æ€§**: å¤ç”¨ç°æœ‰ EPUB è§£æå™¨ï¼Œå‡å°‘ä»£ç é‡å¤
3. **å®¹é”™æ€§**: æä¾›å›é€€æœºåˆ¶ï¼Œå³ä½¿ Calibre ä¸å¯ç”¨ä¹Ÿèƒ½æå–åŸºç¡€ä¿¡æ¯
4. **æ‰©å±•æ€§**: æœªæ¥å¯è½»æ¾æ·»åŠ å…¶ä»–æ ¼å¼æ”¯æŒ

---

## å››ã€åç«¯å®ç°è®¾è®¡

### 4.1 æ¨¡å—æ¶æ„

```
scripts/book-ingestion/processors/
â”œâ”€â”€ epub-parser.ts          # EPUB è§£æå™¨ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ mobi-parser.ts          # MOBI/AZW3 è§£æå™¨ï¼ˆæ–°å¢ï¼‰
â””â”€â”€ index.ts                # ç»Ÿä¸€å¯¼å‡º

src/modules/user-books/
â”œâ”€â”€ processors/
â”‚   â””â”€â”€ book-processor.ts   # ä¹¦ç±å¤„ç†å…¥å£
â””â”€â”€ ...
```

### 4.2 MobiParser ç±»è®¾è®¡

### 4.3 MOBI Header è§£æ

### 4.4 æ ¼å¼æ£€æµ‹å·¥å…·

### 4.5 ä¹¦ç±å¤„ç†å…¥å£

---

## äº”ã€iOS å®¢æˆ·ç«¯é€‚é…

### 5.1 æ”¯æŒçš„æ–‡ä»¶ç±»å‹

### 5.2 MIME ç±»å‹æ˜ å°„

### 5.3 æ ¼å¼å¾½ç« æ˜¾ç¤º

### 5.4 ç”¨æˆ·ç•Œé¢æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¯¼å…¥ç•Œé¢                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚           â”‚          ğŸ“¥ å¯¼å…¥                  â”‚              â”‚
â”‚           â”‚      Import Your Books           â”‚              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                             â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚           â”‚ ğŸ“‚  ä»æ–‡ä»¶å¯¼å…¥                    â”‚              â”‚
â”‚           â”‚     Select from your files       â”‚              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                             â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚           â”‚ æ”¯æŒçš„æ ¼å¼:                       â”‚              â”‚
â”‚           â”‚                                  â”‚              â”‚
â”‚           â”‚ [EPUB] [TXT] [PDF] [MOBI] [AZW3] â”‚              â”‚
â”‚           â”‚                                  â”‚              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…­ã€API è®¾è®¡

### 6.1 å¯¼å…¥å‘èµ· API

```http
POST /api/user-books/import/initiate

Request:
{
  "filename": "kindle-book.mobi",
  "fileSize": 5242880,
  "contentType": "application/x-mobipocket-ebook",
  "md5": "abc123..."  // optional
}

Response:
{
  "jobId": "uuid",
  "uploadUrl": "https://r2.../presigned-url",
  "uploadKey": "user-uploads/{userId}/{jobId}/kindle-book.mobi",
  "expiresIn": 600
}

æ”¯æŒçš„ Content-Type:
- application/epub+zip
- text/plain
- application/pdf
- application/x-mobipocket-ebook     â† MOBI
- application/vnd.amazon.ebook       â† AZW/AZW3
- application/octet-stream           â† é€šç”¨äºŒè¿›åˆ¶
```

### 6.2 æ ¼å¼éªŒè¯é€»è¾‘

### 6.3 æ–‡ä»¶å¤§å°é™åˆ¶

| æ ¼å¼ | æœ€å¤§æ–‡ä»¶å¤§å° | è¯´æ˜ |
|-----|-------------|------|
| EPUB | 100 MB | æ ‡å‡†é™åˆ¶ |
| TXT | 50 MB | çº¯æ–‡æœ¬ |
| PDF | 100 MB | å¯èƒ½åŒ…å«å›¾ç‰‡ |
| MOBI | 100 MB | ä¸ EPUB ç›¸åŒ |
| AZW3 | 100 MB | ä¸ EPUB ç›¸åŒ |

---

## ä¸ƒã€è§£ææµç¨‹è¯¦è§£

### 7.1 å®Œæ•´æµç¨‹å›¾

```mermaid
flowchart TD
    Select["ç”¨æˆ·é€‰æ‹© MOBI æ–‡ä»¶"] --> Initiate["iOS: è·å–é¢„ç­¾å URL<br>POST /import/initiate"]
    Initiate --> Upload["iOS: ç›´ä¼  R2 å­˜å‚¨<br>PUT presignedUrl"]
    Upload --> Confirm["iOS: ç¡®è®¤ä¸Šä¼ å®Œæˆ<br>POST /import/complete"]
    Confirm --> Worker["åç«¯å¤„ç† Worker<br>1. ä» R2 ä¸‹è½½æ–‡ä»¶<br>2. æ£€æµ‹æ–‡ä»¶æ ¼å¼<br>3. MobiParser.parse()<br>4-5. åˆ›å»º Book/Chapter è®°å½•<br>6. ä¸Šä¼ å°é¢å’Œç« èŠ‚åˆ° R2<br>7-8. æ›´æ–°é…é¢å’ŒçŠ¶æ€<br>9. æ¸…ç†ä¸´æ—¶æ–‡ä»¶"]
    Worker --> Poll["iOS: è½®è¯¢çŠ¶æ€å®Œæˆ<br>GET /import/{jobId}/status"]
    Poll --> Read["è¿›å…¥ä¹¦ç±è¯¦æƒ…é¡µå¼€å§‹é˜…è¯»"]
```

### 7.2 Calibre è½¬æ¢å‘½ä»¤

### 7.3 è½¬æ¢æ—¶é—´é¢„ä¼°

| æ–‡ä»¶å¤§å° | é¢„ä¼°è½¬æ¢æ—¶é—´ | è¯´æ˜ |
|---------|-------------|------|
| < 1 MB | < 5 ç§’ | å°å‹ä¹¦ç± |
| 1-5 MB | 5-15 ç§’ | ä¸­å‹ä¹¦ç± |
| 5-20 MB | 15-45 ç§’ | å¤§å‹ä¹¦ç± |
| 20-50 MB | 45-90 ç§’ | ç‰¹å¤§ä¹¦ç± |
| > 50 MB | > 90 ç§’ | å¯èƒ½è¶…æ—¶ |

### 7.4 è¿›åº¦æ›´æ–°èŠ‚ç‚¹

---

## å…«ã€é”™è¯¯å¤„ç†ç­–ç•¥

### 8.1 é”™è¯¯ç±»å‹åˆ†ç±»

### 8.2 é”™è¯¯å¤„ç†æ˜ å°„

| é”™è¯¯ç±»å‹ | ç”¨æˆ·æç¤º | å¤„ç†ç­–ç•¥ |
|---------|---------|---------|
| `FILE_NOT_FOUND` | "æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·é‡æ–°ä¸Šä¼ " | é‡è¯•ä¸Šä¼  |
| `UNSUPPORTED_FORMAT` | "ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼" | å¼•å¯¼ç”¨æˆ·è½¬æ¢ |
| `DRM_PROTECTED` | "æ­¤ä¹¦ç±å—ç‰ˆæƒä¿æŠ¤ï¼Œæ— æ³•å¯¼å…¥" | è¯´æ˜é™åˆ¶ |
| `CONVERSION_FAILED` | "æ–‡ä»¶è½¬æ¢å¤±è´¥ï¼Œè¯·ç¡®è®¤æ–‡ä»¶å®Œæ•´æ€§" | å°è¯•å›é€€è§£æ |
| `CONVERSION_TIMEOUT` | "æ–‡ä»¶å¤„ç†è¶…æ—¶ï¼Œè¯·å°è¯•è¾ƒå°çš„æ–‡ä»¶" | å»ºè®®æ‹†åˆ† |
| `PARSE_FAILED` | "æ–‡ä»¶è§£æå¤±è´¥ï¼Œæ ¼å¼å¯èƒ½æŸå" | å»ºè®®é‡æ–°ä¸‹è½½ |
| `INVALID_STRUCTURE` | "æ–‡ä»¶ç»“æ„å¼‚å¸¸" | å›é€€è§£æ |

### 8.3 DRM æ£€æµ‹

### 8.4 é”™è¯¯æ¢å¤æµç¨‹

```mermaid
flowchart TD
    Convert["Calibre è½¬æ¢"] --> Success{"è½¬æ¢æˆåŠŸï¼Ÿ"}
    Success -->|"æˆåŠŸ"| Parse["EPUB è§£æ"]
    Success -->|"å¤±è´¥"| ErrorType{"é”™è¯¯ç±»å‹åˆ¤æ–­"}
    ErrorType --> DRM["DRM é”™è¯¯"] --> ReturnErr["è¿”å›é”™è¯¯<br>æç¤ºç”¨æˆ·"]
    ErrorType --> Timeout["è¶…æ—¶é”™è¯¯"] --> Retry["å¢åŠ è¶…æ—¶<br>é‡è¯•ä¸€æ¬¡"]
    ErrorType --> Other["å…¶ä»–é”™è¯¯"] --> Fallback["å›é€€è§£æ<br>åŸºç¡€å…ƒæ•°æ®"]
```

---

## ä¹ã€æ€§èƒ½ä¼˜åŒ–

### 9.1 å¹¶å‘å¤„ç†

### 9.2 ä¸´æ—¶æ–‡ä»¶ç®¡ç†

### 9.3 å†…å­˜ç®¡ç†

---

## åã€æµ‹è¯•ç­–ç•¥

### 10.1 å•å…ƒæµ‹è¯•

### 10.2 é›†æˆæµ‹è¯•

### 10.3 æµ‹è¯•æ–‡ä»¶é›†

| æ–‡ä»¶å | æ ¼å¼ | å¤§å° | æµ‹è¯•ç›®çš„ |
|-------|------|------|---------|
| `sample-minimal.mobi` | MOBI | < 100 KB | åŸºç¡€è§£æ |
| `sample-with-images.mobi` | MOBI | 1-5 MB | å›¾ç‰‡æå– |
| `sample-chinese.mobi` | MOBI | 1-2 MB | ä¸­æ–‡ç¼–ç  |
| `sample-large.mobi` | MOBI | > 20 MB | å¤§æ–‡ä»¶å¤„ç† |
| `sample-azw3.azw3` | AZW3 | 1-5 MB | KF8 æ ¼å¼ |
| `sample-drm.mobi` | MOBI | - | DRM æ£€æµ‹ |
| `sample-corrupt.mobi` | MOBI | - | é”™è¯¯å¤„ç† |

---

## åä¸€ã€éƒ¨ç½²ä¸è¿ç»´

### 11.1 æœåŠ¡å™¨ä¾èµ–å®‰è£…

### 11.2 Docker éƒ¨ç½²

### 11.3 ç›‘æ§æŒ‡æ ‡

### 11.4 å‘Šè­¦è§„åˆ™

| æŒ‡æ ‡ | é˜ˆå€¼ | ä¸¥é‡çº§åˆ« |
|-----|------|---------|
| å¯¼å…¥æˆåŠŸç‡ | < 90% | P2 |
| å¹³å‡è½¬æ¢æ—¶é—´ | > 60s | P3 |
| å›é€€ç‡ | > 10% | P2 |
| é˜Ÿåˆ—ç§¯å‹ | > 50 | P1 |

### 11.5 æ—¥å¿—è®°å½•

---

## åäºŒã€é™„å½•

### A. MOBI æ ¼å¼è§„èŒƒå‚è€ƒ

- [MobileRead Wiki - MOBI](https://wiki.mobileread.com/wiki/MOBI)
- [MobileRead Wiki - PDB](https://wiki.mobileread.com/wiki/PDB)
- [EXTH Records](https://wiki.mobileread.com/wiki/MOBI#EXTH_Header)

### B. Calibre ç›¸å…³èµ„æº

- [Calibre å®˜ç½‘](https://calibre-ebook.com/)
- [ebook-convert å‘½ä»¤å‚è€ƒ](https://manual.calibre-ebook.com/generated/en/ebook-convert.html)
- [Calibre FAQ](https://calibre-ebook.com/help)

### C. ç›¸å…³æ–‡æ¡£

- [local-import.md](./local-import.md) - æœ¬åœ°æ–‡ä»¶å¯¼å…¥åŠŸèƒ½å®Œæ•´æ–¹æ¡ˆ
- [book-formats-analysis.md](./book-formats-analysis.md) - ç”µå­ä¹¦æ ¼å¼åˆ†æ
- [epub-architecture.md](./epub-architecture.md) - EPUB æ¶æ„è®¾è®¡
- [user-book-import-status.md](../ios/user-book-import-status.md) - iOS å¯¼å…¥åŠŸèƒ½çŠ¶æ€

### D. ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´è¯´æ˜ |
|-----|------|---------|
| v1.0 | 2025-12-28 | åˆå§‹ç‰ˆæœ¬ï¼ŒCalibre è½¬æ¢æ–¹æ¡ˆ |

---

## æ€»ç»“

MOBI/AZW3 æ ¼å¼æ”¯æŒå·²å®Œæ•´å®ç°ï¼Œé‡‡ç”¨ **Calibre è½¬æ¢ + EPUB è§£æ** çš„æŠ€æœ¯æ–¹æ¡ˆï¼š

1. **åç«¯**ï¼š`MobiParser` ç±»å®ç°è½¬æ¢å’Œè§£æé€»è¾‘
2. **å›é€€**ï¼šæ—  Calibre æ—¶æä¾›åŸºç¡€å…ƒæ•°æ®æå–
3. **iOS**ï¼šå·²æ›´æ–°æ–‡ä»¶é€‰æ‹©å™¨å’Œ MIME ç±»å‹æ”¯æŒ
4. **ç”¨æˆ·ä½“éªŒ**ï¼šä¸ EPUB å¯¼å…¥æµç¨‹ä¸€è‡´

ä¸»è¦é™åˆ¶ï¼š
- éœ€è¦æœåŠ¡å™¨å®‰è£… Calibre
- ä¸æ”¯æŒ DRM ä¿æŠ¤çš„ä¹¦ç±
- å¤§æ–‡ä»¶è½¬æ¢å¯èƒ½è¾ƒæ…¢

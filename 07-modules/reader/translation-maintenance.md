# ç¿»è¯‘å†…å®¹ç»´æŠ¤æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è®°å½•äº† Readmigo é¡¹ç›®ä¸­æ‰€æœ‰éœ€è¦ç¿»è¯‘çš„å†…å®¹ç±»å‹ã€æ”¯æŒçš„è¯­è¨€å’Œç¿»è¯‘è¦†ç›–æƒ…å†µã€‚

## æ”¯æŒçš„è¯­è¨€

### æºè¯­è¨€ï¼ˆSource Languageï¼‰
- **è‹±æ–‡ï¼ˆEnglishï¼‰**: `en`

### ç›®æ ‡è¯­è¨€ï¼ˆTarget Languagesï¼‰
- **ç®€ä½“ä¸­æ–‡ï¼ˆSimplified Chineseï¼‰**: `zh-Hans`
- **ç¹ä½“ä¸­æ–‡ï¼ˆTraditional Chineseï¼‰**: `zh-Hant`

## éœ€è¦ç¿»è¯‘çš„å†…å®¹ç±»å‹

### 1. ä¹¦ç±ï¼ˆBooksï¼‰

#### 1.1 ä¹¦ç±æ ‡é¢˜ï¼ˆtitleï¼‰
- **Entity Type**: `book`
- **Field Name**: `title`
- **æ•°æ®é‡**: 1,277 æœ¬æ´»è·ƒä¹¦ç±
- **ç¿»è¯‘çŠ¶æ€**: âœ… 100% å®Œæˆï¼ˆ1,423 æ¡ç¿»è¯‘ï¼ŒåŒ…å«å†å²æ•°æ®ï¼‰
- **ç¤ºä¾‹**:
  - EN: "Pride and Prejudice"
  - zh-Hans: "å‚²æ…¢ä¸åè§"
  - zh-Hant: "å‚²æ…¢èˆ‡åè¦‹"

#### 1.2 ä¹¦ç±ç®€ä»‹ï¼ˆdescriptionï¼‰
- **Entity Type**: `book`
- **Field Name**: `description`
- **æ•°æ®é‡**: 1,277 æœ¬ä¹¦æœ‰ç®€ä»‹
- **ç¿»è¯‘çŠ¶æ€**: ğŸ”„ è¿›è¡Œä¸­ï¼ˆ56.6% å®Œæˆï¼Œ698 æ¡å¾…ç¿»è¯‘ï¼‰
- **ç¿»è¯‘æ–¹æ³•**:
  - å…ˆç¿»è¯‘ä¸ºç®€ä½“ä¸­æ–‡ï¼ˆzh-Hansï¼‰
  - ä½¿ç”¨å·¥å…·è½¬æ¢ä¸ºç¹ä½“ä¸­æ–‡ï¼ˆzh-Hantï¼‰
- **ç¤ºä¾‹**:
  - EN: "A timeless love story set in 19th century England..."
  - zh-Hans: "ä¸€ä¸ªå‘ç”Ÿåœ¨19ä¸–çºªè‹±æ ¼å…°çš„æ°¸æ’çˆ±æƒ…æ•…äº‹..."
  - zh-Hant: "ä¸€å€‹ç™¼ç”Ÿåœ¨19ä¸–ç´€è‹±æ ¼è˜­çš„æ°¸æ†æ„›æƒ…æ•…äº‹..."

### 2. ä½œè€…ï¼ˆAuthorsï¼‰

#### 2.1 ä½œè€…å§“åï¼ˆnameï¼‰
- **Entity Type**: `author`
- **Field Name**: `name`
- **æ•°æ®é‡**: 578 ä½ä½œè€…
- **ç¿»è¯‘çŠ¶æ€**: âœ… 100% å®Œæˆï¼ˆ578 æ¡ç¿»è¯‘ï¼‰
- **ç¤ºä¾‹**:
  - EN: "William Shakespeare"
  - zh-Hans: "å¨å»‰Â·èå£«æ¯”äºš"
  - zh-Hant: "å¨å»‰Â·èå£«æ¯”äº"

### 3. ä½“è£/ç±»å‹ï¼ˆGenresï¼‰

#### 3.1 ä½“è£åç§°ï¼ˆnameï¼‰
- **Entity Type**: `genre`
- **Field Name**: `name`
- **Entity ID**: ä½¿ç”¨ä½“è£åç§°æœ¬èº«ä½œä¸º IDï¼ˆå¦‚ "Short Stories"ï¼‰
- **æ•°æ®é‡**: 31 ä¸ªä¸åŒçš„ä½“è£
- **ç¿»è¯‘çŠ¶æ€**: âœ… 100% å®Œæˆï¼ˆ55 æ¡ç¿»è¯‘ï¼ŒåŒ…å«å¤§å°å†™å˜ä½“ï¼‰
- **æ³¨æ„äº‹é¡¹**:
  - ä½“è£åç§°å­˜å‚¨åœ¨ `books.genres` å­—æ®µï¼ˆæ•°ç»„ç±»å‹ï¼‰
  - å­˜åœ¨å¤§å°å†™å˜ä½“ï¼ˆå¦‚ "Fiction" å’Œ "fiction"ï¼‰
- **ç¤ºä¾‹**:
  - EN: "Short Stories"
  - zh-Hans: "çŸ­ç¯‡å°è¯´"
  - zh-Hant: "çŸ­ç¯‡å°èªª"

  - EN: "Science Fiction"
  - zh-Hans: "ç§‘å¹»"
  - zh-Hant: "ç§‘å¹»"

### 4. åˆ†ç±»ï¼ˆCategoriesï¼‰

#### 4.1 åˆ†ç±»åç§°ï¼ˆnameï¼‰
- **Entity Type**: `category`
- **Field Name**: `name`
- **æ•°æ®é‡**: 10 ä¸ªåˆ†ç±»
- **ç¿»è¯‘çŠ¶æ€**: â„¹ï¸ åˆ†ç±»åç§°æœ¬èº«å·²æ˜¯ä¸­æ–‡ï¼Œæ— éœ€ç¿»è¯‘
- **æ³¨æ„äº‹é¡¹**:
  - `category.name` å­—æ®µå·²å­˜å‚¨ä¸­æ–‡åç§°
  - `category.slug` å­—æ®µå­˜å‚¨è‹±æ–‡ slug
- **æ•°æ®ç»“æ„**:
  ```
  { name: "å†’é™©", slug: "adventure" }
  { name: "å“²å­¦", slug: "philosophy" }
  { name: "å¥‡å¹»", slug: "fantasy" }
  { name: "ææ€–", slug: "horror" }
  { name: "æ‚¬ç–‘", slug: "mystery" }
  { name: "æˆå‰§", slug: "drama" }
  { name: "æµªæ¼«", slug: "romance" }
  { name: "è¯—æ­Œ", slug: "poetry" }
  { name: "ç»å…¸æ–‡å­¦", slug: "classics" }
  { name: "å°è¯´", slug: "fiction" }
  ```

## æ•°æ®åº“ç»“æ„

### Translation è¡¨ç»“æ„
```prisma
model Translation {
  id         String   @id @default(uuid())
  entityType String   @map("entity_type")  // book, author, genre, category
  entityId   String   @map("entity_id")    // å®ä½“çš„ ID
  fieldName  String   @map("field_name")   // title, description, name
  locale     String                        // zh-Hans, zh-Hant, en
  value      String   @db.Text            // ç¿»è¯‘åçš„æ–‡æœ¬
  source     String   @default("manual")   // ai, manual
  status     String   @default("published") // published, draft
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([entityType, entityId, fieldName, locale])
}
```

## ç¿»è¯‘å·¥ä½œæµç¨‹

### æ–°å¢å†…å®¹ç¿»è¯‘æµç¨‹

1. **ä¹¦ç±å¯¼å…¥æ—¶**
   - åˆ›å»ºè‹±æ–‡ `title` å’Œ `description`
   - è§¦å‘ç¿»è¯‘è„šæœ¬ç”Ÿæˆ zh-Hans å’Œ zh-Hant ç¿»è¯‘
   - åœ¨ `translations` è¡¨ä¸­åˆ›å»ºç›¸åº”è®°å½•

2. **ä½œè€…æ·»åŠ æ—¶**
   - åˆ›å»ºè‹±æ–‡ `name`
   - ç¿»è¯‘ä¸º zh-Hans å’Œ zh-Hant
   - åœ¨ `translations` è¡¨ä¸­åˆ›å»ºè®°å½•

3. **ä½“è£æ·»åŠ æ—¶**
   - åœ¨ `books.genres` æ•°ç»„ä¸­æ·»åŠ è‹±æ–‡ä½“è£å
   - åœ¨ `translations` è¡¨ä¸­æ·»åŠ å¯¹åº”ç¿»è¯‘
   - entityId ä½¿ç”¨ä½“è£åç§°æœ¬èº«

### ç®€ç¹è½¬æ¢è§„åˆ™

- **ç®€ä½“ â†’ ç¹ä½“**: ä½¿ç”¨å­—ç¬¦æ˜ å°„è¡¨æˆ– opencc å·¥å…·
- **å¸¸ç”¨å­—ç¬¦æ˜ å°„**:
  ```
  ä¸ºâ†’ç‚º, å›½â†’åœ‹, å‘â†’ç™¼, ä¼šâ†’æœƒ, æ¥â†’ä¾†, ä¸ªâ†’å€‹
  ä»¬â†’å€‘, è¿™â†’é€™, è¯´â†’èªª, å¯¹â†’å°, å¼€â†’é–‹, å…³â†’é—œ
  æ—¶â†’æ™‚, è¿‡â†’é, æ²¡â†’æ²’, ç°â†’ç¾, åº”â†’æ‡‰, ä¹‰â†’ç¾©
  é•¿â†’é•·, ç»â†’ç¶“, é—¨â†’é–€, é—®â†’å•, å½“â†’ç•¶, ä»â†’å¾
  ...
  ```

## ç¿»è¯‘è¦†ç›–ç»Ÿè®¡

| å†…å®¹ç±»å‹ | æ€»æ•° | zh-Hans | zh-Hant | è¦†ç›–ç‡ | çŠ¶æ€ |
|---------|------|---------|---------|--------|------|
| ä¹¦ç±æ ‡é¢˜ | 1,277 | 1,423 | 1,423 | 111.4% | âœ… å®Œæˆ |
| ä¹¦ç±ç®€ä»‹ | 1,277 | 723 | 723 | 56.6% | ğŸ”„ è¿›è¡Œä¸­ |
| ä½œè€…å§“å | 578 | 578 | 578 | 100% | âœ… å®Œæˆ |
| ä½“è£åç§° | 31 | 55 | 55 | 100% | âœ… å®Œæˆ |
| åˆ†ç±»åç§° | 10 | - | - | - | â„¹ï¸ å·²æ˜¯ä¸­æ–‡ |

## ç›¸å…³è„šæœ¬

### ç¿»è¯‘è„šæœ¬
- `scripts/ensure-translation-coverage.ts` - ç¡®ä¿ç¿»è¯‘è¦†ç›–ï¼ˆå·²å¼ƒç”¨ï¼Œä½¿ç”¨æ‰‹åŠ¨ç¿»è¯‘ï¼‰
- `scripts/temp-get-missing.ts` - æŸ¥è¯¢ç¼ºå¤±ç¿»è¯‘ï¼ˆä¸´æ—¶è„šæœ¬ï¼‰

### æ•°æ®åº“æŸ¥è¯¢

#### æŸ¥è¯¢ç¼ºå¤±ç¿»è¯‘çš„ä¹¦ç±æ ‡é¢˜
```typescript
const books = await prisma.book.findMany({
  where: { status: 'ACTIVE' },
  select: { id: true, title: true }
});

const existing = await prisma.translation.findMany({
  where: {
    entityType: 'book',
    fieldName: 'title',
    locale: 'zh-Hans',
    status: 'published'
  },
  select: { entityId: true }
});

const existingIds = new Set(existing.map(t => t.entityId));
const missing = books.filter(b => !existingIds.has(b.id));
```

#### æ’å…¥ç¿»è¯‘
```typescript
await prisma.translation.upsert({
  where: {
    entityType_entityId_fieldName_locale: {
      entityType: 'book',
      entityId: bookId,
      fieldName: 'title',
      locale: 'zh-Hans'
    }
  },
  update: {
    value: translatedText,
    source: 'ai',
    status: 'published',
    updatedAt: new Date()
  },
  create: {
    entityType: 'book',
    entityId: bookId,
    fieldName: 'title',
    locale: 'zh-Hans',
    value: translatedText,
    source: 'ai',
    status: 'published'
  }
});
```

## æ³¨æ„äº‹é¡¹

1. **ç¿»è¯‘è´¨é‡**
   - ä¹¦åç¿»è¯‘åº”ä½¿ç”¨é€šç”¨è¯‘å
   - ä½œè€…ååº”ä½¿ç”¨æ ‡å‡†è¯‘å
   - ä½“è£ç¿»è¯‘åº”ç®€æ´æ˜äº†

2. **æ•°æ®ä¸€è‡´æ€§**
   - ä½¿ç”¨ `upsert` æ“ä½œé¿å…é‡å¤
   - ç¡®ä¿ entityId æ­£ç¡®å¯¹åº”
   - ä¿æŒ source å’Œ status å­—æ®µçš„å‡†ç¡®æ€§

3. **æ€§èƒ½è€ƒè™‘**
   - ç®€ä»‹ç¿»è¯‘é‡å¤§ï¼Œå»ºè®®åˆ†æ‰¹å¤„ç†
   - æ¯æ‰¹å¤„ç† 10-15 æ¡è®°å½•
   - ç®€ä½“ç¿»è¯‘åæ‰¹é‡è½¬æ¢ç¹ä½“

4. **æ–°å¢è¯­è¨€æ”¯æŒ**
   - å¦‚éœ€æ·»åŠ å…¶ä»–è¯­è¨€ï¼Œéœ€è¦ï¼š
     - æ›´æ–° locale æšä¸¾
     - åˆ›å»ºç›¸åº”ç¿»è¯‘è®°å½•
     - æ›´æ–°å‰ç«¯è¯­è¨€é€‰æ‹©å™¨

## æ›´æ–°è®°å½•

- **2026-02-03**:
  - âœ… å®Œæˆä¹¦ç±æ ‡é¢˜ç¿»è¯‘ï¼ˆ1,423 æ¡ï¼‰
  - âœ… å®Œæˆä½œè€…å§“åç¿»è¯‘ï¼ˆ578 æ¡ï¼‰
  - âœ… å®Œæˆä½“è£åç§°ç¿»è¯‘ï¼ˆ55 æ¡ï¼‰
  - ğŸ”„ å¼€å§‹ä¹¦ç±ç®€ä»‹ç¿»è¯‘ï¼ˆ698 æ¡å¾…å®Œæˆï¼‰
  - ğŸ“„ åˆ›å»ºç¿»è¯‘ç»´æŠ¤æ–‡æ¡£

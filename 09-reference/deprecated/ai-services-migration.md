# AI 服务废弃迁移指南

> 记录 Readmigo 产品功能中 AI 服务的废弃过程和替代方案

---

## 一、废弃背景

### 1.1 废弃原因

| 原因 | 说明 |
|------|------|
| 成本控制 | AI API 调用成本随用户增长线性上升 |
| 产品聚焦 | 回归阅读本质，简化产品功能 |
| 技术简化 | 减少外部依赖，提高系统稳定性 |
| 维护成本 | AI 提示词维护、模型切换等持续成本 |

### 1.2 废弃范围

**100% 废弃**: 产品功能中的所有 AI 服务

**不受影响**: 开发过程中使用 AI 编写代码和运维

---

## 二、废弃服务清单

### 2.1 阅读场景 AI

| 服务 | 原功能 | 使用模型 | 替代方案 |
|------|--------|----------|----------|
| AI 查词 | 基于上下文解释单词 | DeepSeek / GPT-4o-mini | 本地词典 ECDICT |
| AI 翻译 | 实时翻译句子/段落 | GPT-4o-mini | 预处理双语数据 |
| AI 解释 | 解释难句/段落 | GPT-4o-mini | 移除功能 |

### 2.2 对话场景 AI

| 服务 | 原功能 | 使用模型 | 替代方案 |
|------|--------|----------|----------|
| 书籍问答 | 回答关于书籍内容的问题 | GPT-4o | 移除功能 |
| 内容总结 | 章节/全书摘要 | GPT-4o | 移除功能 |
| 角色对话 | 与书中角色对话 | Claude Sonnet | 移除功能 |
| 文学分析 | 深度文学分析 | GPT-4o | 移除功能 |

### 2.3 推荐场景 AI

| 服务 | 原功能 | 使用模型 | 替代方案 |
|------|--------|----------|----------|
| 书籍推荐 | 个性化推荐 | Embedding + ML | 基于规则的推荐 |
| 词汇推荐 | 学习词汇推荐 | ML Model | 热门词汇排行 |
| 阅读计划 | 智能阅读计划 | GPT-4o-mini | 移除功能 |

### 2.4 数据处理 AI

| 服务 | 原功能 | 使用模型 | 替代方案 |
|------|--------|----------|----------|
| 双语翻译 | 批量翻译书籍 | DeepL / GPT-4 | 仅使用已有数据 |
| 语义对齐 | 段落对齐 | sentence-transformers | 保留 (离线处理) |

---

## 三、替代方案详情

### 3.1 本地词典替代 AI 查词

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          查词功能对比                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  原 AI 查词                              本地词典替代                    │
│  ═══════════                             ════════════                   │
│                                                                         │
│  输入: "The quick brown fox"             输入: "quick"                  │
│  选中: "quick"                                                          │
│                                                                         │
│  AI 响应:                                词典响应:                       │
│  ┌────────────────────────────┐         ┌────────────────────────────┐ │
│  │ quick /kwɪk/               │         │ quick /kwɪk/               │ │
│  │                            │         │                            │ │
│  │ 在这个语境中，quick 描述   │         │ adj. 快速的，迅速的        │ │
│  │ 狐狸的敏捷特性，暗示其     │         │ adv. 快，迅速地            │ │
│  │ 反应速度快、动作灵活...   │         │ n. 核心，要害              │ │
│  │                            │         │                            │ │
│  │ 词根: PIE *gwei- (活的)    │         │ 例句: Be quick!            │ │
│  └────────────────────────────┘         └────────────────────────────┘ │
│                                                                         │
│  ✓ 上下文相关              ✗ 无上下文理解                               │
│  ✓ 词根分析                ✓ 标准释义                                   │
│  ✗ 成本高                  ✓ 零成本                                     │
│  ✗ 需要网络                ✓ 离线可用                                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 预处理双语数据替代实时翻译

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          翻译功能对比                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  原实时翻译                              预处理双语数据                  │
│  ═══════════                             ══════════════                 │
│                                                                         │
│  ┌────────────────────────────┐         ┌────────────────────────────┐ │
│  │ 用户选中任意文本            │         │ 仅支持已处理书籍           │ │
│  │         │                  │         │         │                  │ │
│  │         ▼                  │         │         ▼                  │ │
│  │ 调用 GPT-4o-mini API       │         │ 查询 BilingualParagraph   │ │
│  │         │                  │         │         │                  │ │
│  │         ▼                  │         │         ▼                  │ │
│  │ 返回翻译结果               │         │ 显示预存翻译               │ │
│  └────────────────────────────┘         └────────────────────────────┘ │
│                                                                         │
│  优势:                                  优势:                           │
│  ✓ 任意文本                            ✓ 零成本                        │
│  ✓ 高质量翻译                          ✓ 即时响应                      │
│                                        ✓ 离线可用                      │
│  劣势:                                  ✓ 翻译质量可控                  │
│  ✗ API 成本                                                            │
│  ✗ 响应延迟                            劣势:                           │
│  ✗ 需要网络                            ✗ 仅限已处理书籍                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.3 基于规则的推荐替代 AI 推荐

| 推荐策略 | 算法 |
|----------|------|
| 热门推荐 | 按阅读人数/评分排序 |
| 相似推荐 | 同作者/同分类/同难度 |
| 新书推荐 | 按上架时间排序 |
| 随机推荐 | 随机抽取 |

---

## 四、代码清理清单

### 4.1 后端代码

| 模块 | 路径 | 操作 |
|------|------|------|
| AI Service | `apps/backend/src/ai/` | 删除整个目录 |
| AI Endpoints | `apps/backend/src/api/ai/` | 删除整个目录 |
| Prompt Templates | `apps/backend/prompts/` | 删除整个目录 |
| AI Types | `apps/backend/src/types/ai.ts` | 删除文件 |
| AI Config | `apps/backend/src/config/ai.ts` | 删除文件 |

### 4.2 客户端代码

| 平台 | 模块 | 操作 |
|------|------|------|
| iOS | `Features/AI/` | 删除整个目录 |
| iOS | AI 相关 UI 组件 | 删除 |
| Android | `features/ai/` | 删除整个目录 |
| Web | `components/ai/` | 删除整个目录 |

### 4.3 环境变量

| 变量名 | 平台 | 操作 |
|--------|------|------|
| OPENAI_API_KEY | Fly.io Secrets | 删除 |
| DEEPSEEK_API_KEY | Fly.io Secrets | 删除 |
| ANTHROPIC_API_KEY | Fly.io Secrets | 删除 |
| AI_CACHE_TTL | Fly.io Secrets | 删除 |
| AI_RATE_LIMIT | Fly.io Secrets | 删除 |

### 4.4 数据库清理

| 表名 | 操作 | 说明 |
|------|------|------|
| ai_usage_logs | 备份后删除 | AI 调用日志 |
| ai_cache | 删除 | AI 响应缓存 |
| user_ai_quota | 删除 | 用户 AI 配额 |

### 4.5 Redis 清理

| Key Pattern | 操作 |
|-------------|------|
| ai:cache:* | 删除 |
| ai:quota:* | 删除 |
| ai:rate:* | 删除 |

---

## 五、迁移步骤

### 5.1 Phase 1: 准备 (1周)

```
□ 备份所有 AI 相关代码
□ 备份 AI 调用日志和缓存数据
□ 更新产品文档，标注功能变更
□ 准备用户通知（如需要）
```

### 5.2 Phase 2: 后端迁移 (1周)

```
□ 删除 AI Service 模块
□ 删除 AI API Endpoints
□ 更新路由配置
□ 删除 AI 相关 Secrets
□ 部署后端更新
```

### 5.3 Phase 3: 客户端迁移 (1周)

```
□ iOS: 删除 AI 功能模块
□ iOS: 更新 UI，移除 AI 入口
□ Android: 删除 AI 功能模块
□ Web: 删除 AI 功能模块
□ 发布客户端更新
```

### 5.4 Phase 4: 数据清理 (1周)

```
□ 导出 AI 调用日志（可选，用于分析）
□ 删除 ai_usage_logs 表
□ 删除 ai_cache 表
□ 清理 Redis AI 相关 Keys
```

### 5.5 Phase 5: 验证 (1周)

```
□ 全面测试所有保留功能
□ 监控错误率
□ 确认成本下降
□ 更新监控告警配置
```

---

## 六、用户影响

### 6.1 功能变更通知

| 功能 | 变更说明 |
|------|----------|
| 查词 | 仍可使用，但不再提供上下文相关解释 |
| 翻译 | 仅支持已处理的双语书籍 |
| AI 问答 | 功能移除 |
| AI 总结 | 功能移除 |
| 智能推荐 | 改为基于热门/相似的推荐 |

### 6.2 App 更新说明文案

```
本次更新：
- 优化了查词功能，现支持完全离线使用
- 双语阅读体验提升，响应更快
- 移除了部分实验性 AI 功能

感谢您的理解与支持！
```

---

## 七、相关文档

| 文档 | 说明 |
|------|------|
| [基础设施改造计划](../../plans/2026-01-26-infrastructure-overhaul.md) | 整体改造计划 |
| [AI 服务架构](../../07-modules/ai/ai-services-architecture.md) | 原 AI 架构 (已废弃) |
| [双语阅读系统](../../03-architecture/bilingual-reading-system.md) | 保留的双语功能 |

---

*创建日期: 2026-01-26*

# SE Content Pipeline 设计方案

> 从 Standard Ebooks 获取高质量书籍，通过 Readmigo 客户端提供完美阅读体验

## 1. 背景与决策

### 1.1 核心决策

| 决策项 | 选择 | 理由 |
|-------|------|------|
| 内容来源 | 仅 Standard Ebooks | 质量优先，SE 已完成排版优化 |
| 自动化程度 | 半自动化 | 自动获取 → 人工审核 → 发布 |
| 排版模式 | 混合模式 | SE 已做重排版，客户端做轻排版 |

### 1.2 为什么不用 Project Gutenberg

PG 直接使用存在的质量问题：

| 问题 | PG 示例 | SE 处理 |
|-----|--------|---------|
| 直引号 | `"text"` | `"text"` |
| 无语义标记 | `Mr.` | `<abbr epub:type="z3998:name-title">Mr.</abbr>` |
| 页码残留 | `{2}` `{vii}` | 无 |
| Boilerplate | 500+ 行头尾信息 | 无 |
| 图片标题 | `<img alt="Chapter I">` | `<h2>I</h2>` |

### 1.3 为什么选择 SE

- 1000+ 高质量公共领域书籍
- 完美排版（弯引号、破折号、省略号、语义标记）
- 干净 HTML 结构
- 持续更新（志愿者社区维护）
- SE 无客户端，Readmigo 可做体验层差异化

## 2. 价值定位

```
┌─────────────────────────────────────────────────────────────────┐
│                         价值链分析                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   Standard Ebooks              Readmigo                          │
│   ─────────────────            ─────────────────                 │
│   ✅ 高质量内容                 ✅ 高质量内容 (来自 SE)           │
│   ✅ 排版规范                   ✅ 排版规范 (继承 SE)             │
│   ❌ 无客户端                   ✅ 原生客户端 (iOS/Android)       │
│   ❌ 无阅读体验优化             ✅ 翻页动画、主题、字体            │
│   ❌ 无 AI 功能                 ✅ 双击翻译、AI 解释              │
│   ❌ 无学习功能                 ✅ 生词本、进度同步                │
│   ❌ 无 TTS                    ✅ TTS 朗读、音文同步              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**用户体验对比**：

```
SE 用户流程（5步）:
访问网站 → 搜索书 → 选格式 → 下载 → 导入阅读器 → 开始阅读

Readmigo 用户流程（2步）:
打开 App → 点击书籍 → 开始阅读
```

## 3. 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                    内容层 (Standard Ebooks)                      │
│                                                                  │
│   • 1000+ 高质量公共领域书籍                                     │
│   • 完美排版（弯引号、破折号、语义标记）                          │
│   • 干净 HTML 结构                                               │
│                                                                  │
└──────────────────────────┬──────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────────┐
│                    服务层 (Readmigo Backend)                     │
│                                                                  │
│   ┌──────────┐    ┌──────────┐    ┌──────────┐                 │
│   │ Importer │───→│ Adapter  │───→│ Publisher│                 │
│   │ SE同步   │    │ 轻量适配 │    │ 发布上架 │                 │
│   └──────────┘    └──────────┘    └──────────┘                 │
│        │               │               │                        │
│   从SE获取EPUB    段落ID注入      数据库+R2存储                  │
│   元数据提取      图片路径适配                                   │
│                                                                  │
└──────────────────────────┬──────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────────┐
│                    体验层 (Readmigo App)                         │
│                                                                  │
│   iOS / Android 原生客户端                                       │
│   ├── 书库浏览、搜索、分类                                       │
│   ├── 阅读器：字体、行距、主题、翻页                             │
│   ├── AI 功能：双击翻译、单词解释                                │
│   ├── 学习功能：生词本、进度同步                                 │
│   ├── TTS：朗读、音文同步                                        │
│   └── 社区功能：笔记、高亮、书评                                 │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 4. 模块设计

### 4.1 SE Importer

从 Standard Ebooks 获取书籍。

**输入**: SE 书籍 URL 或书籍列表
**输出**: EPUB 文件 + 元数据

**功能**:
- 同步 SE 书籍列表（定期检查新书）
- 下载 EPUB 文件
- 提取元数据（标题、作者、描述、封面）

### 4.2 Adapter（轻量适配）

将 SE EPUB 适配为 Readmigo 格式。

**功能**:
- 段落 ID 注入（用于双击翻译、TTS 同步）
- 图片路径适配（SE 路径 → R2 路径）
- 章节拆分存储

**注意**: SE 内容质量已高，无需清洗或重排版。

### 4.3 Publisher

发布书籍到 Readmigo 平台。

**功能**:
- 写入数据库（Book、Chapter 表）
- 上传 R2（EPUB、封面、章节 HTML）
- 状态管理（草稿 → 审核 → 发布）

## 5. 与现有系统的关系

| 现有模块 | 本方案用途 |
|---------|-----------|
| `epub-parser.service.ts` | 复用，解析 SE EPUB |
| `content-studio` | 可选，SE 质量已高，快速审核即可 |
| `reader-template.ts` | 复用，客户端渲染 |
| iOS/Android 阅读器 | 复用，体验层核心 |

## 6. 实现计划

### Phase 1: SE Importer

- [ ] 实现 SE 书籍列表同步
- [ ] 实现 EPUB 下载
- [ ] 实现元数据提取

### Phase 2: Adapter

- [ ] 实现段落 ID 注入
- [ ] 实现图片路径适配
- [ ] 实现章节拆分

### Phase 3: 集成

- [ ] 对接现有 Publisher
- [ ] Content Studio 审核流程
- [ ] 端到端测试

## 7. 参考资源

| 资源 | 链接 |
|-----|------|
| SE 官网 | https://standardebooks.org |
| SE GitHub | https://github.com/standardebooks |
| SE 书籍列表 API | https://standardebooks.org/ebooks |
| SE 工具分析 | `docs/03-architecture/standard-ebooks-tools-analysis.md` |

---

*文档创建日期: 2026-01-26*
